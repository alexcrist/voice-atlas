function A2(i,o){for(var l=0;l<o.length;l++){const m=o[l];if(typeof m!="string"&&!Array.isArray(m)){for(const y in m)if(y!=="default"&&!(y in i)){const T=Object.getOwnPropertyDescriptor(m,y);T&&Object.defineProperty(i,y,T.get?T:{enumerable:!0,get:()=>m[y]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))m(y);new MutationObserver(y=>{for(const T of y)if(T.type==="childList")for(const w of T.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&m(w)}).observe(document,{childList:!0,subtree:!0});function l(y){const T={};return y.integrity&&(T.integrity=y.integrity),y.referrerPolicy&&(T.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?T.credentials="include":y.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function m(y){if(y.ep)return;y.ep=!0;const T=l(y);fetch(y.href,T)}})();var D2=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function e1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var t1={exports:{}},Cp={},i1={exports:{}},Mt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ph=Symbol.for("react.element"),L2=Symbol.for("react.portal"),R2=Symbol.for("react.fragment"),F2=Symbol.for("react.strict_mode"),B2=Symbol.for("react.profiler"),O2=Symbol.for("react.provider"),N2=Symbol.for("react.context"),V2=Symbol.for("react.forward_ref"),j2=Symbol.for("react.suspense"),U2=Symbol.for("react.memo"),$2=Symbol.for("react.lazy"),I0=Symbol.iterator;function q2(i){return i===null||typeof i!="object"?null:(i=I0&&i[I0]||i["@@iterator"],typeof i=="function"?i:null)}var n1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},r1=Object.assign,o1={};function pu(i,o,l){this.props=i,this.context=o,this.refs=o1,this.updater=l||n1}pu.prototype.isReactComponent={};pu.prototype.setState=function(i,o){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,o,"setState")};pu.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function s1(){}s1.prototype=pu.prototype;function $g(i,o,l){this.props=i,this.context=o,this.refs=o1,this.updater=l||n1}var qg=$g.prototype=new s1;qg.constructor=$g;r1(qg,pu.prototype);qg.isPureReactComponent=!0;var E0=Array.isArray,a1=Object.prototype.hasOwnProperty,Zg={current:null},l1={key:!0,ref:!0,__self:!0,__source:!0};function u1(i,o,l){var m,y={},T=null,w=null;if(o!=null)for(m in o.ref!==void 0&&(w=o.ref),o.key!==void 0&&(T=""+o.key),o)a1.call(o,m)&&!l1.hasOwnProperty(m)&&(y[m]=o[m]);var d=arguments.length-2;if(d===1)y.children=l;else if(1<d){for(var O=Array(d),W=0;W<d;W++)O[W]=arguments[W+2];y.children=O}if(i&&i.defaultProps)for(m in d=i.defaultProps,d)y[m]===void 0&&(y[m]=d[m]);return{$$typeof:ph,type:i,key:T,ref:w,props:y,_owner:Zg.current}}function Z2(i,o){return{$$typeof:ph,type:i.type,key:o,ref:i.ref,props:i.props,_owner:i._owner}}function Gg(i){return typeof i=="object"&&i!==null&&i.$$typeof===ph}function G2(i){var o={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(l){return o[l]})}var C0=/\/+/g;function hm(i,o){return typeof i=="object"&&i!==null&&i.key!=null?G2(""+i.key):o.toString(36)}function jd(i,o,l,m,y){var T=typeof i;(T==="undefined"||T==="boolean")&&(i=null);var w=!1;if(i===null)w=!0;else switch(T){case"string":case"number":w=!0;break;case"object":switch(i.$$typeof){case ph:case L2:w=!0}}if(w)return w=i,y=y(w),i=m===""?"."+hm(w,0):m,E0(y)?(l="",i!=null&&(l=i.replace(C0,"$&/")+"/"),jd(y,o,l,"",function(W){return W})):y!=null&&(Gg(y)&&(y=Z2(y,l+(!y.key||w&&w.key===y.key?"":(""+y.key).replace(C0,"$&/")+"/")+i)),o.push(y)),1;if(w=0,m=m===""?".":m+":",E0(i))for(var d=0;d<i.length;d++){T=i[d];var O=m+hm(T,d);w+=jd(T,o,l,O,y)}else if(O=q2(i),typeof O=="function")for(i=O.call(i),d=0;!(T=i.next()).done;)T=T.value,O=m+hm(T,d++),w+=jd(T,o,l,O,y);else if(T==="object")throw o=String(i),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return w}function bd(i,o,l){if(i==null)return i;var m=[],y=0;return jd(i,m,"","",function(T){return o.call(l,T,y++)}),m}function H2(i){if(i._status===-1){var o=i._result;o=o(),o.then(function(l){(i._status===0||i._status===-1)&&(i._status=1,i._result=l)},function(l){(i._status===0||i._status===-1)&&(i._status=2,i._result=l)}),i._status===-1&&(i._status=0,i._result=o)}if(i._status===1)return i._result.default;throw i._result}var Cn={current:null},Ud={transition:null},W2={ReactCurrentDispatcher:Cn,ReactCurrentBatchConfig:Ud,ReactCurrentOwner:Zg};function c1(){throw Error("act(...) is not supported in production builds of React.")}Mt.Children={map:bd,forEach:function(i,o,l){bd(i,function(){o.apply(this,arguments)},l)},count:function(i){var o=0;return bd(i,function(){o++}),o},toArray:function(i){return bd(i,function(o){return o})||[]},only:function(i){if(!Gg(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};Mt.Component=pu;Mt.Fragment=R2;Mt.Profiler=B2;Mt.PureComponent=$g;Mt.StrictMode=F2;Mt.Suspense=j2;Mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W2;Mt.act=c1;Mt.cloneElement=function(i,o,l){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var m=r1({},i.props),y=i.key,T=i.ref,w=i._owner;if(o!=null){if(o.ref!==void 0&&(T=o.ref,w=Zg.current),o.key!==void 0&&(y=""+o.key),i.type&&i.type.defaultProps)var d=i.type.defaultProps;for(O in o)a1.call(o,O)&&!l1.hasOwnProperty(O)&&(m[O]=o[O]===void 0&&d!==void 0?d[O]:o[O])}var O=arguments.length-2;if(O===1)m.children=l;else if(1<O){d=Array(O);for(var W=0;W<O;W++)d[W]=arguments[W+2];m.children=d}return{$$typeof:ph,type:i.type,key:y,ref:T,props:m,_owner:w}};Mt.createContext=function(i){return i={$$typeof:N2,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:O2,_context:i},i.Consumer=i};Mt.createElement=u1;Mt.createFactory=function(i){var o=u1.bind(null,i);return o.type=i,o};Mt.createRef=function(){return{current:null}};Mt.forwardRef=function(i){return{$$typeof:V2,render:i}};Mt.isValidElement=Gg;Mt.lazy=function(i){return{$$typeof:$2,_payload:{_status:-1,_result:i},_init:H2}};Mt.memo=function(i,o){return{$$typeof:U2,type:i,compare:o===void 0?null:o}};Mt.startTransition=function(i){var o=Ud.transition;Ud.transition={};try{i()}finally{Ud.transition=o}};Mt.unstable_act=c1;Mt.useCallback=function(i,o){return Cn.current.useCallback(i,o)};Mt.useContext=function(i){return Cn.current.useContext(i)};Mt.useDebugValue=function(){};Mt.useDeferredValue=function(i){return Cn.current.useDeferredValue(i)};Mt.useEffect=function(i,o){return Cn.current.useEffect(i,o)};Mt.useId=function(){return Cn.current.useId()};Mt.useImperativeHandle=function(i,o,l){return Cn.current.useImperativeHandle(i,o,l)};Mt.useInsertionEffect=function(i,o){return Cn.current.useInsertionEffect(i,o)};Mt.useLayoutEffect=function(i,o){return Cn.current.useLayoutEffect(i,o)};Mt.useMemo=function(i,o){return Cn.current.useMemo(i,o)};Mt.useReducer=function(i,o,l){return Cn.current.useReducer(i,o,l)};Mt.useRef=function(i){return Cn.current.useRef(i)};Mt.useState=function(i){return Cn.current.useState(i)};Mt.useSyncExternalStore=function(i,o,l){return Cn.current.useSyncExternalStore(i,o,l)};Mt.useTransition=function(){return Cn.current.useTransition()};Mt.version="18.3.1";i1.exports=Mt;var bt=i1.exports;const Hg=e1(bt),P0=A2({__proto__:null,default:Hg},[bt]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X2=bt,K2=Symbol.for("react.element"),Y2=Symbol.for("react.fragment"),J2=Object.prototype.hasOwnProperty,Q2=X2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,e4={key:!0,ref:!0,__self:!0,__source:!0};function h1(i,o,l){var m,y={},T=null,w=null;l!==void 0&&(T=""+l),o.key!==void 0&&(T=""+o.key),o.ref!==void 0&&(w=o.ref);for(m in o)J2.call(o,m)&&!e4.hasOwnProperty(m)&&(y[m]=o[m]);if(i&&i.defaultProps)for(m in o=i.defaultProps,o)y[m]===void 0&&(y[m]=o[m]);return{$$typeof:K2,type:i,key:T,ref:w,props:y,_owner:Q2.current}}Cp.Fragment=Y2;Cp.jsx=h1;Cp.jsxs=h1;t1.exports=Cp;var kt=t1.exports,Um={},d1={exports:{}},fr={},p1={exports:{}},f1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function o(We,ct){var ht=We.length;We.push(ct);e:for(;0<ht;){var It=ht-1>>>1,Bt=We[It];if(0<y(Bt,ct))We[It]=ct,We[ht]=Bt,ht=It;else break e}}function l(We){return We.length===0?null:We[0]}function m(We){if(We.length===0)return null;var ct=We[0],ht=We.pop();if(ht!==ct){We[0]=ht;e:for(var It=0,Bt=We.length,Gn=Bt>>>1;It<Gn;){var Di=2*(It+1)-1,tn=We[Di],nn=Di+1,bi=We[nn];if(0>y(tn,ht))nn<Bt&&0>y(bi,tn)?(We[It]=bi,We[nn]=ht,It=nn):(We[It]=tn,We[Di]=ht,It=Di);else if(nn<Bt&&0>y(bi,ht))We[It]=bi,We[nn]=ht,It=nn;else break e}}return ct}function y(We,ct){var ht=We.sortIndex-ct.sortIndex;return ht!==0?ht:We.id-ct.id}if(typeof performance=="object"&&typeof performance.now=="function"){var T=performance;i.unstable_now=function(){return T.now()}}else{var w=Date,d=w.now();i.unstable_now=function(){return w.now()-d}}var O=[],W=[],oe=1,X=null,$=3,be=!1,Te=!1,Ie=!1,Qe=typeof setTimeout=="function"?setTimeout:null,ue=typeof clearTimeout=="function"?clearTimeout:null,ie=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function se(We){for(var ct=l(W);ct!==null;){if(ct.callback===null)m(W);else if(ct.startTime<=We)m(W),ct.sortIndex=ct.expirationTime,o(O,ct);else break;ct=l(W)}}function xe(We){if(Ie=!1,se(We),!Te)if(l(O)!==null)Te=!0,_r(Pe);else{var ct=l(W);ct!==null&&en(xe,ct.startTime-We)}}function Pe(We,ct){Te=!1,Ie&&(Ie=!1,ue(Ge),Ge=-1),be=!0;var ht=$;try{for(se(ct),X=l(O);X!==null&&(!(X.expirationTime>ct)||We&&!gt());){var It=X.callback;if(typeof It=="function"){X.callback=null,$=X.priorityLevel;var Bt=It(X.expirationTime<=ct);ct=i.unstable_now(),typeof Bt=="function"?X.callback=Bt:X===l(O)&&m(O),se(ct)}else m(O);X=l(O)}if(X!==null)var Gn=!0;else{var Di=l(W);Di!==null&&en(xe,Di.startTime-ct),Gn=!1}return Gn}finally{X=null,$=ht,be=!1}}var $e=!1,Ve=null,Ge=-1,Et=5,mt=-1;function gt(){return!(i.unstable_now()-mt<Et)}function gr(){if(Ve!==null){var We=i.unstable_now();mt=We;var ct=!0;try{ct=Ve(!0,We)}finally{ct?oi():($e=!1,Ve=null)}}else $e=!1}var oi;if(typeof ie=="function")oi=function(){ie(gr)};else if(typeof MessageChannel<"u"){var wi=new MessageChannel,Zn=wi.port2;wi.port1.onmessage=gr,oi=function(){Zn.postMessage(null)}}else oi=function(){Qe(gr,0)};function _r(We){Ve=We,$e||($e=!0,oi())}function en(We,ct){Ge=Qe(function(){We(i.unstable_now())},ct)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(We){We.callback=null},i.unstable_continueExecution=function(){Te||be||(Te=!0,_r(Pe))},i.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Et=0<We?Math.floor(1e3/We):5},i.unstable_getCurrentPriorityLevel=function(){return $},i.unstable_getFirstCallbackNode=function(){return l(O)},i.unstable_next=function(We){switch($){case 1:case 2:case 3:var ct=3;break;default:ct=$}var ht=$;$=ct;try{return We()}finally{$=ht}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(We,ct){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var ht=$;$=We;try{return ct()}finally{$=ht}},i.unstable_scheduleCallback=function(We,ct,ht){var It=i.unstable_now();switch(typeof ht=="object"&&ht!==null?(ht=ht.delay,ht=typeof ht=="number"&&0<ht?It+ht:It):ht=It,We){case 1:var Bt=-1;break;case 2:Bt=250;break;case 5:Bt=1073741823;break;case 4:Bt=1e4;break;default:Bt=5e3}return Bt=ht+Bt,We={id:oe++,callback:ct,priorityLevel:We,startTime:ht,expirationTime:Bt,sortIndex:-1},ht>It?(We.sortIndex=ht,o(W,We),l(O)===null&&We===l(W)&&(Ie?(ue(Ge),Ge=-1):Ie=!0,en(xe,ht-It))):(We.sortIndex=Bt,o(O,We),Te||be||(Te=!0,_r(Pe))),We},i.unstable_shouldYield=gt,i.unstable_wrapCallback=function(We){var ct=$;return function(){var ht=$;$=ct;try{return We.apply(this,arguments)}finally{$=ht}}}})(f1);p1.exports=f1;var t4=p1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i4=bt,hr=t4;function Me(i){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+i,l=1;l<arguments.length;l++)o+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var m1=new Set,Wc={};function qa(i,o){ou(i,o),ou(i+"Capture",o)}function ou(i,o){for(Wc[i]=o,i=0;i<o.length;i++)m1.add(o[i])}var jo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$m=Object.prototype.hasOwnProperty,n4=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,M0={},z0={};function r4(i){return $m.call(z0,i)?!0:$m.call(M0,i)?!1:n4.test(i)?z0[i]=!0:(M0[i]=!0,!1)}function o4(i,o,l,m){if(l!==null&&l.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return m?!1:l!==null?!l.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function s4(i,o,l,m){if(o===null||typeof o>"u"||o4(i,o,l,m))return!0;if(m)return!1;if(l!==null)switch(l.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Pn(i,o,l,m,y,T,w){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=m,this.attributeNamespace=y,this.mustUseProperty=l,this.propertyName=i,this.type=o,this.sanitizeURL=T,this.removeEmptyString=w}var Qi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Qi[i]=new Pn(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var o=i[0];Qi[o]=new Pn(o,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Qi[i]=new Pn(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Qi[i]=new Pn(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Qi[i]=new Pn(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Qi[i]=new Pn(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Qi[i]=new Pn(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Qi[i]=new Pn(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Qi[i]=new Pn(i,5,!1,i.toLowerCase(),null,!1,!1)});var Wg=/[\-:]([a-z])/g;function Xg(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var o=i.replace(Wg,Xg);Qi[o]=new Pn(o,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var o=i.replace(Wg,Xg);Qi[o]=new Pn(o,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var o=i.replace(Wg,Xg);Qi[o]=new Pn(o,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Qi[i]=new Pn(i,1,!1,i.toLowerCase(),null,!1,!1)});Qi.xlinkHref=new Pn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Qi[i]=new Pn(i,1,!1,i.toLowerCase(),null,!0,!0)});function Kg(i,o,l,m){var y=Qi.hasOwnProperty(o)?Qi[o]:null;(y!==null?y.type!==0:m||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(s4(o,l,y,m)&&(l=null),m||y===null?r4(o)&&(l===null?i.removeAttribute(o):i.setAttribute(o,""+l)):y.mustUseProperty?i[y.propertyName]=l===null?y.type===3?!1:"":l:(o=y.attributeName,m=y.attributeNamespace,l===null?i.removeAttribute(o):(y=y.type,l=y===3||y===4&&l===!0?"":""+l,m?i.setAttributeNS(m,o,l):i.setAttribute(o,l))))}var Go=i4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Sd=Symbol.for("react.element"),jl=Symbol.for("react.portal"),Ul=Symbol.for("react.fragment"),Yg=Symbol.for("react.strict_mode"),qm=Symbol.for("react.profiler"),g1=Symbol.for("react.provider"),_1=Symbol.for("react.context"),Jg=Symbol.for("react.forward_ref"),Zm=Symbol.for("react.suspense"),Gm=Symbol.for("react.suspense_list"),Qg=Symbol.for("react.memo"),Ms=Symbol.for("react.lazy"),y1=Symbol.for("react.offscreen"),A0=Symbol.iterator;function Tc(i){return i===null||typeof i!="object"?null:(i=A0&&i[A0]||i["@@iterator"],typeof i=="function"?i:null)}var fi=Object.assign,dm;function Lc(i){if(dm===void 0)try{throw Error()}catch(l){var o=l.stack.trim().match(/\n( *(at )?)/);dm=o&&o[1]||""}return`
`+dm+i}var pm=!1;function fm(i,o){if(!i||pm)return"";pm=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(W){var m=W}Reflect.construct(i,[],o)}else{try{o.call()}catch(W){m=W}i.call(o.prototype)}else{try{throw Error()}catch(W){m=W}i()}}catch(W){if(W&&m&&typeof W.stack=="string"){for(var y=W.stack.split(`
`),T=m.stack.split(`
`),w=y.length-1,d=T.length-1;1<=w&&0<=d&&y[w]!==T[d];)d--;for(;1<=w&&0<=d;w--,d--)if(y[w]!==T[d]){if(w!==1||d!==1)do if(w--,d--,0>d||y[w]!==T[d]){var O=`
`+y[w].replace(" at new "," at ");return i.displayName&&O.includes("<anonymous>")&&(O=O.replace("<anonymous>",i.displayName)),O}while(1<=w&&0<=d);break}}}finally{pm=!1,Error.prepareStackTrace=l}return(i=i?i.displayName||i.name:"")?Lc(i):""}function a4(i){switch(i.tag){case 5:return Lc(i.type);case 16:return Lc("Lazy");case 13:return Lc("Suspense");case 19:return Lc("SuspenseList");case 0:case 2:case 15:return i=fm(i.type,!1),i;case 11:return i=fm(i.type.render,!1),i;case 1:return i=fm(i.type,!0),i;default:return""}}function Hm(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Ul:return"Fragment";case jl:return"Portal";case qm:return"Profiler";case Yg:return"StrictMode";case Zm:return"Suspense";case Gm:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case _1:return(i.displayName||"Context")+".Consumer";case g1:return(i._context.displayName||"Context")+".Provider";case Jg:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Qg:return o=i.displayName||null,o!==null?o:Hm(i.type)||"Memo";case Ms:o=i._payload,i=i._init;try{return Hm(i(o))}catch{}}return null}function l4(i){var o=i.type;switch(i.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=o.render,i=i.displayName||i.name||"",o.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Hm(o);case 8:return o===Yg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function qs(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function v1(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function u4(i){var o=v1(i)?"checked":"value",l=Object.getOwnPropertyDescriptor(i.constructor.prototype,o),m=""+i[o];if(!i.hasOwnProperty(o)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var y=l.get,T=l.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return y.call(this)},set:function(w){m=""+w,T.call(this,w)}}),Object.defineProperty(i,o,{enumerable:l.enumerable}),{getValue:function(){return m},setValue:function(w){m=""+w},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function Td(i){i._valueTracker||(i._valueTracker=u4(i))}function x1(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var l=o.getValue(),m="";return i&&(m=v1(i)?i.checked?"true":"false":i.value),i=m,i!==l?(o.setValue(i),!0):!1}function Qd(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Wm(i,o){var l=o.checked;return fi({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??i._wrapperState.initialChecked})}function D0(i,o){var l=o.defaultValue==null?"":o.defaultValue,m=o.checked!=null?o.checked:o.defaultChecked;l=qs(o.value!=null?o.value:l),i._wrapperState={initialChecked:m,initialValue:l,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function w1(i,o){o=o.checked,o!=null&&Kg(i,"checked",o,!1)}function Xm(i,o){w1(i,o);var l=qs(o.value),m=o.type;if(l!=null)m==="number"?(l===0&&i.value===""||i.value!=l)&&(i.value=""+l):i.value!==""+l&&(i.value=""+l);else if(m==="submit"||m==="reset"){i.removeAttribute("value");return}o.hasOwnProperty("value")?Km(i,o.type,l):o.hasOwnProperty("defaultValue")&&Km(i,o.type,qs(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(i.defaultChecked=!!o.defaultChecked)}function L0(i,o,l){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var m=o.type;if(!(m!=="submit"&&m!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+i._wrapperState.initialValue,l||o===i.value||(i.value=o),i.defaultValue=o}l=i.name,l!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,l!==""&&(i.name=l)}function Km(i,o,l){(o!=="number"||Qd(i.ownerDocument)!==i)&&(l==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+l&&(i.defaultValue=""+l))}var Rc=Array.isArray;function Ql(i,o,l,m){if(i=i.options,o){o={};for(var y=0;y<l.length;y++)o["$"+l[y]]=!0;for(l=0;l<i.length;l++)y=o.hasOwnProperty("$"+i[l].value),i[l].selected!==y&&(i[l].selected=y),y&&m&&(i[l].defaultSelected=!0)}else{for(l=""+qs(l),o=null,y=0;y<i.length;y++){if(i[y].value===l){i[y].selected=!0,m&&(i[y].defaultSelected=!0);return}o!==null||i[y].disabled||(o=i[y])}o!==null&&(o.selected=!0)}}function Ym(i,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Me(91));return fi({},o,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function R0(i,o){var l=o.value;if(l==null){if(l=o.children,o=o.defaultValue,l!=null){if(o!=null)throw Error(Me(92));if(Rc(l)){if(1<l.length)throw Error(Me(93));l=l[0]}o=l}o==null&&(o=""),l=o}i._wrapperState={initialValue:qs(l)}}function b1(i,o){var l=qs(o.value),m=qs(o.defaultValue);l!=null&&(l=""+l,l!==i.value&&(i.value=l),o.defaultValue==null&&i.defaultValue!==l&&(i.defaultValue=l)),m!=null&&(i.defaultValue=""+m)}function F0(i){var o=i.textContent;o===i._wrapperState.initialValue&&o!==""&&o!==null&&(i.value=o)}function S1(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Jm(i,o){return i==null||i==="http://www.w3.org/1999/xhtml"?S1(o):i==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var kd,T1=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,l,m,y){MSApp.execUnsafeLocalFunction(function(){return i(o,l,m,y)})}:i}(function(i,o){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=o;else{for(kd=kd||document.createElement("div"),kd.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=kd.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;o.firstChild;)i.appendChild(o.firstChild)}});function Xc(i,o){if(o){var l=i.firstChild;if(l&&l===i.lastChild&&l.nodeType===3){l.nodeValue=o;return}}i.textContent=o}var Nc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},c4=["Webkit","ms","Moz","O"];Object.keys(Nc).forEach(function(i){c4.forEach(function(o){o=o+i.charAt(0).toUpperCase()+i.substring(1),Nc[o]=Nc[i]})});function k1(i,o,l){return o==null||typeof o=="boolean"||o===""?"":l||typeof o!="number"||o===0||Nc.hasOwnProperty(i)&&Nc[i]?(""+o).trim():o+"px"}function I1(i,o){i=i.style;for(var l in o)if(o.hasOwnProperty(l)){var m=l.indexOf("--")===0,y=k1(l,o[l],m);l==="float"&&(l="cssFloat"),m?i.setProperty(l,y):i[l]=y}}var h4=fi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Qm(i,o){if(o){if(h4[i]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Me(137,i));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Me(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Me(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Me(62))}}function eg(i,o){if(i.indexOf("-")===-1)return typeof o.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tg=null;function e_(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var ig=null,eu=null,tu=null;function B0(i){if(i=gh(i)){if(typeof ig!="function")throw Error(Me(280));var o=i.stateNode;o&&(o=Dp(o),ig(i.stateNode,i.type,o))}}function E1(i){eu?tu?tu.push(i):tu=[i]:eu=i}function C1(){if(eu){var i=eu,o=tu;if(tu=eu=null,B0(i),o)for(i=0;i<o.length;i++)B0(o[i])}}function P1(i,o){return i(o)}function M1(){}var mm=!1;function z1(i,o,l){if(mm)return i(o,l);mm=!0;try{return P1(i,o,l)}finally{mm=!1,(eu!==null||tu!==null)&&(M1(),C1())}}function Kc(i,o){var l=i.stateNode;if(l===null)return null;var m=Dp(l);if(m===null)return null;l=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(i=i.type,m=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!m;break e;default:i=!1}if(i)return null;if(l&&typeof l!="function")throw Error(Me(231,o,typeof l));return l}var ng=!1;if(jo)try{var kc={};Object.defineProperty(kc,"passive",{get:function(){ng=!0}}),window.addEventListener("test",kc,kc),window.removeEventListener("test",kc,kc)}catch{ng=!1}function d4(i,o,l,m,y,T,w,d,O){var W=Array.prototype.slice.call(arguments,3);try{o.apply(l,W)}catch(oe){this.onError(oe)}}var Vc=!1,ep=null,tp=!1,rg=null,p4={onError:function(i){Vc=!0,ep=i}};function f4(i,o,l,m,y,T,w,d,O){Vc=!1,ep=null,d4.apply(p4,arguments)}function m4(i,o,l,m,y,T,w,d,O){if(f4.apply(this,arguments),Vc){if(Vc){var W=ep;Vc=!1,ep=null}else throw Error(Me(198));tp||(tp=!0,rg=W)}}function Za(i){var o=i,l=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,o.flags&4098&&(l=o.return),i=o.return;while(i)}return o.tag===3?l:null}function A1(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function O0(i){if(Za(i)!==i)throw Error(Me(188))}function g4(i){var o=i.alternate;if(!o){if(o=Za(i),o===null)throw Error(Me(188));return o!==i?null:i}for(var l=i,m=o;;){var y=l.return;if(y===null)break;var T=y.alternate;if(T===null){if(m=y.return,m!==null){l=m;continue}break}if(y.child===T.child){for(T=y.child;T;){if(T===l)return O0(y),i;if(T===m)return O0(y),o;T=T.sibling}throw Error(Me(188))}if(l.return!==m.return)l=y,m=T;else{for(var w=!1,d=y.child;d;){if(d===l){w=!0,l=y,m=T;break}if(d===m){w=!0,m=y,l=T;break}d=d.sibling}if(!w){for(d=T.child;d;){if(d===l){w=!0,l=T,m=y;break}if(d===m){w=!0,m=T,l=y;break}d=d.sibling}if(!w)throw Error(Me(189))}}if(l.alternate!==m)throw Error(Me(190))}if(l.tag!==3)throw Error(Me(188));return l.stateNode.current===l?i:o}function D1(i){return i=g4(i),i!==null?L1(i):null}function L1(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var o=L1(i);if(o!==null)return o;i=i.sibling}return null}var R1=hr.unstable_scheduleCallback,N0=hr.unstable_cancelCallback,_4=hr.unstable_shouldYield,y4=hr.unstable_requestPaint,xi=hr.unstable_now,v4=hr.unstable_getCurrentPriorityLevel,t_=hr.unstable_ImmediatePriority,F1=hr.unstable_UserBlockingPriority,ip=hr.unstable_NormalPriority,x4=hr.unstable_LowPriority,B1=hr.unstable_IdlePriority,Pp=null,po=null;function w4(i){if(po&&typeof po.onCommitFiberRoot=="function")try{po.onCommitFiberRoot(Pp,i,void 0,(i.current.flags&128)===128)}catch{}}var Hr=Math.clz32?Math.clz32:T4,b4=Math.log,S4=Math.LN2;function T4(i){return i>>>=0,i===0?32:31-(b4(i)/S4|0)|0}var Id=64,Ed=4194304;function Fc(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function np(i,o){var l=i.pendingLanes;if(l===0)return 0;var m=0,y=i.suspendedLanes,T=i.pingedLanes,w=l&268435455;if(w!==0){var d=w&~y;d!==0?m=Fc(d):(T&=w,T!==0&&(m=Fc(T)))}else w=l&~y,w!==0?m=Fc(w):T!==0&&(m=Fc(T));if(m===0)return 0;if(o!==0&&o!==m&&!(o&y)&&(y=m&-m,T=o&-o,y>=T||y===16&&(T&4194240)!==0))return o;if(m&4&&(m|=l&16),o=i.entangledLanes,o!==0)for(i=i.entanglements,o&=m;0<o;)l=31-Hr(o),y=1<<l,m|=i[l],o&=~y;return m}function k4(i,o){switch(i){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function I4(i,o){for(var l=i.suspendedLanes,m=i.pingedLanes,y=i.expirationTimes,T=i.pendingLanes;0<T;){var w=31-Hr(T),d=1<<w,O=y[w];O===-1?(!(d&l)||d&m)&&(y[w]=k4(d,o)):O<=o&&(i.expiredLanes|=d),T&=~d}}function og(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function O1(){var i=Id;return Id<<=1,!(Id&4194240)&&(Id=64),i}function gm(i){for(var o=[],l=0;31>l;l++)o.push(i);return o}function fh(i,o,l){i.pendingLanes|=o,o!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,o=31-Hr(o),i[o]=l}function E4(i,o){var l=i.pendingLanes&~o;i.pendingLanes=o,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=o,i.mutableReadLanes&=o,i.entangledLanes&=o,o=i.entanglements;var m=i.eventTimes;for(i=i.expirationTimes;0<l;){var y=31-Hr(l),T=1<<y;o[y]=0,m[y]=-1,i[y]=-1,l&=~T}}function i_(i,o){var l=i.entangledLanes|=o;for(i=i.entanglements;l;){var m=31-Hr(l),y=1<<m;y&o|i[m]&o&&(i[m]|=o),l&=~y}}var Gt=0;function N1(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var V1,n_,j1,U1,$1,sg=!1,Cd=[],Fs=null,Bs=null,Os=null,Yc=new Map,Jc=new Map,As=[],C4="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function V0(i,o){switch(i){case"focusin":case"focusout":Fs=null;break;case"dragenter":case"dragleave":Bs=null;break;case"mouseover":case"mouseout":Os=null;break;case"pointerover":case"pointerout":Yc.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jc.delete(o.pointerId)}}function Ic(i,o,l,m,y,T){return i===null||i.nativeEvent!==T?(i={blockedOn:o,domEventName:l,eventSystemFlags:m,nativeEvent:T,targetContainers:[y]},o!==null&&(o=gh(o),o!==null&&n_(o)),i):(i.eventSystemFlags|=m,o=i.targetContainers,y!==null&&o.indexOf(y)===-1&&o.push(y),i)}function P4(i,o,l,m,y){switch(o){case"focusin":return Fs=Ic(Fs,i,o,l,m,y),!0;case"dragenter":return Bs=Ic(Bs,i,o,l,m,y),!0;case"mouseover":return Os=Ic(Os,i,o,l,m,y),!0;case"pointerover":var T=y.pointerId;return Yc.set(T,Ic(Yc.get(T)||null,i,o,l,m,y)),!0;case"gotpointercapture":return T=y.pointerId,Jc.set(T,Ic(Jc.get(T)||null,i,o,l,m,y)),!0}return!1}function q1(i){var o=za(i.target);if(o!==null){var l=Za(o);if(l!==null){if(o=l.tag,o===13){if(o=A1(l),o!==null){i.blockedOn=o,$1(i.priority,function(){j1(l)});return}}else if(o===3&&l.stateNode.current.memoizedState.isDehydrated){i.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}i.blockedOn=null}function $d(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var l=ag(i.domEventName,i.eventSystemFlags,o[0],i.nativeEvent);if(l===null){l=i.nativeEvent;var m=new l.constructor(l.type,l);tg=m,l.target.dispatchEvent(m),tg=null}else return o=gh(l),o!==null&&n_(o),i.blockedOn=l,!1;o.shift()}return!0}function j0(i,o,l){$d(i)&&l.delete(o)}function M4(){sg=!1,Fs!==null&&$d(Fs)&&(Fs=null),Bs!==null&&$d(Bs)&&(Bs=null),Os!==null&&$d(Os)&&(Os=null),Yc.forEach(j0),Jc.forEach(j0)}function Ec(i,o){i.blockedOn===o&&(i.blockedOn=null,sg||(sg=!0,hr.unstable_scheduleCallback(hr.unstable_NormalPriority,M4)))}function Qc(i){function o(y){return Ec(y,i)}if(0<Cd.length){Ec(Cd[0],i);for(var l=1;l<Cd.length;l++){var m=Cd[l];m.blockedOn===i&&(m.blockedOn=null)}}for(Fs!==null&&Ec(Fs,i),Bs!==null&&Ec(Bs,i),Os!==null&&Ec(Os,i),Yc.forEach(o),Jc.forEach(o),l=0;l<As.length;l++)m=As[l],m.blockedOn===i&&(m.blockedOn=null);for(;0<As.length&&(l=As[0],l.blockedOn===null);)q1(l),l.blockedOn===null&&As.shift()}var iu=Go.ReactCurrentBatchConfig,rp=!0;function z4(i,o,l,m){var y=Gt,T=iu.transition;iu.transition=null;try{Gt=1,r_(i,o,l,m)}finally{Gt=y,iu.transition=T}}function A4(i,o,l,m){var y=Gt,T=iu.transition;iu.transition=null;try{Gt=4,r_(i,o,l,m)}finally{Gt=y,iu.transition=T}}function r_(i,o,l,m){if(rp){var y=ag(i,o,l,m);if(y===null)Im(i,o,m,op,l),V0(i,m);else if(P4(y,i,o,l,m))m.stopPropagation();else if(V0(i,m),o&4&&-1<C4.indexOf(i)){for(;y!==null;){var T=gh(y);if(T!==null&&V1(T),T=ag(i,o,l,m),T===null&&Im(i,o,m,op,l),T===y)break;y=T}y!==null&&m.stopPropagation()}else Im(i,o,m,null,l)}}var op=null;function ag(i,o,l,m){if(op=null,i=e_(m),i=za(i),i!==null)if(o=Za(i),o===null)i=null;else if(l=o.tag,l===13){if(i=A1(o),i!==null)return i;i=null}else if(l===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null);return op=i,null}function Z1(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(v4()){case t_:return 1;case F1:return 4;case ip:case x4:return 16;case B1:return 536870912;default:return 16}default:return 16}}var Ls=null,o_=null,qd=null;function G1(){if(qd)return qd;var i,o=o_,l=o.length,m,y="value"in Ls?Ls.value:Ls.textContent,T=y.length;for(i=0;i<l&&o[i]===y[i];i++);var w=l-i;for(m=1;m<=w&&o[l-m]===y[T-m];m++);return qd=y.slice(i,1<m?1-m:void 0)}function Zd(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function Pd(){return!0}function U0(){return!1}function mr(i){function o(l,m,y,T,w){this._reactName=l,this._targetInst=y,this.type=m,this.nativeEvent=T,this.target=w,this.currentTarget=null;for(var d in i)i.hasOwnProperty(d)&&(l=i[d],this[d]=l?l(T):T[d]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Pd:U0,this.isPropagationStopped=U0,this}return fi(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Pd)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Pd)},persist:function(){},isPersistent:Pd}),o}var fu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},s_=mr(fu),mh=fi({},fu,{view:0,detail:0}),D4=mr(mh),_m,ym,Cc,Mp=fi({},mh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:a_,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Cc&&(Cc&&i.type==="mousemove"?(_m=i.screenX-Cc.screenX,ym=i.screenY-Cc.screenY):ym=_m=0,Cc=i),_m)},movementY:function(i){return"movementY"in i?i.movementY:ym}}),$0=mr(Mp),L4=fi({},Mp,{dataTransfer:0}),R4=mr(L4),F4=fi({},mh,{relatedTarget:0}),vm=mr(F4),B4=fi({},fu,{animationName:0,elapsedTime:0,pseudoElement:0}),O4=mr(B4),N4=fi({},fu,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),V4=mr(N4),j4=fi({},fu,{data:0}),q0=mr(j4),U4={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$4={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},q4={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Z4(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=q4[i])?!!o[i]:!1}function a_(){return Z4}var G4=fi({},mh,{key:function(i){if(i.key){var o=U4[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=Zd(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?$4[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:a_,charCode:function(i){return i.type==="keypress"?Zd(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Zd(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),H4=mr(G4),W4=fi({},Mp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Z0=mr(W4),X4=fi({},mh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:a_}),K4=mr(X4),Y4=fi({},fu,{propertyName:0,elapsedTime:0,pseudoElement:0}),J4=mr(Y4),Q4=fi({},Mp,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),e3=mr(Q4),t3=[9,13,27,32],l_=jo&&"CompositionEvent"in window,jc=null;jo&&"documentMode"in document&&(jc=document.documentMode);var i3=jo&&"TextEvent"in window&&!jc,H1=jo&&(!l_||jc&&8<jc&&11>=jc),G0=" ",H0=!1;function W1(i,o){switch(i){case"keyup":return t3.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function X1(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var $l=!1;function n3(i,o){switch(i){case"compositionend":return X1(o);case"keypress":return o.which!==32?null:(H0=!0,G0);case"textInput":return i=o.data,i===G0&&H0?null:i;default:return null}}function r3(i,o){if($l)return i==="compositionend"||!l_&&W1(i,o)?(i=G1(),qd=o_=Ls=null,$l=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return H1&&o.locale!=="ko"?null:o.data;default:return null}}var o3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function W0(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!o3[i.type]:o==="textarea"}function K1(i,o,l,m){E1(m),o=sp(o,"onChange"),0<o.length&&(l=new s_("onChange","change",null,l,m),i.push({event:l,listeners:o}))}var Uc=null,eh=null;function s3(i){ax(i,0)}function zp(i){var o=Gl(i);if(x1(o))return i}function a3(i,o){if(i==="change")return o}var Y1=!1;if(jo){var xm;if(jo){var wm="oninput"in document;if(!wm){var X0=document.createElement("div");X0.setAttribute("oninput","return;"),wm=typeof X0.oninput=="function"}xm=wm}else xm=!1;Y1=xm&&(!document.documentMode||9<document.documentMode)}function K0(){Uc&&(Uc.detachEvent("onpropertychange",J1),eh=Uc=null)}function J1(i){if(i.propertyName==="value"&&zp(eh)){var o=[];K1(o,eh,i,e_(i)),z1(s3,o)}}function l3(i,o,l){i==="focusin"?(K0(),Uc=o,eh=l,Uc.attachEvent("onpropertychange",J1)):i==="focusout"&&K0()}function u3(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return zp(eh)}function c3(i,o){if(i==="click")return zp(o)}function h3(i,o){if(i==="input"||i==="change")return zp(o)}function d3(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var Xr=typeof Object.is=="function"?Object.is:d3;function th(i,o){if(Xr(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var l=Object.keys(i),m=Object.keys(o);if(l.length!==m.length)return!1;for(m=0;m<l.length;m++){var y=l[m];if(!$m.call(o,y)||!Xr(i[y],o[y]))return!1}return!0}function Y0(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function J0(i,o){var l=Y0(i);i=0;for(var m;l;){if(l.nodeType===3){if(m=i+l.textContent.length,i<=o&&m>=o)return{node:l,offset:o-i};i=m}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Y0(l)}}function Q1(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?Q1(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function ex(){for(var i=window,o=Qd();o instanceof i.HTMLIFrameElement;){try{var l=typeof o.contentWindow.location.href=="string"}catch{l=!1}if(l)i=o.contentWindow;else break;o=Qd(i.document)}return o}function u_(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}function p3(i){var o=ex(),l=i.focusedElem,m=i.selectionRange;if(o!==l&&l&&l.ownerDocument&&Q1(l.ownerDocument.documentElement,l)){if(m!==null&&u_(l)){if(o=m.start,i=m.end,i===void 0&&(i=o),"selectionStart"in l)l.selectionStart=o,l.selectionEnd=Math.min(i,l.value.length);else if(i=(o=l.ownerDocument||document)&&o.defaultView||window,i.getSelection){i=i.getSelection();var y=l.textContent.length,T=Math.min(m.start,y);m=m.end===void 0?T:Math.min(m.end,y),!i.extend&&T>m&&(y=m,m=T,T=y),y=J0(l,T);var w=J0(l,m);y&&w&&(i.rangeCount!==1||i.anchorNode!==y.node||i.anchorOffset!==y.offset||i.focusNode!==w.node||i.focusOffset!==w.offset)&&(o=o.createRange(),o.setStart(y.node,y.offset),i.removeAllRanges(),T>m?(i.addRange(o),i.extend(w.node,w.offset)):(o.setEnd(w.node,w.offset),i.addRange(o)))}}for(o=[],i=l;i=i.parentNode;)i.nodeType===1&&o.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<o.length;l++)i=o[l],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var f3=jo&&"documentMode"in document&&11>=document.documentMode,ql=null,lg=null,$c=null,ug=!1;function Q0(i,o,l){var m=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;ug||ql==null||ql!==Qd(m)||(m=ql,"selectionStart"in m&&u_(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),$c&&th($c,m)||($c=m,m=sp(lg,"onSelect"),0<m.length&&(o=new s_("onSelect","select",null,o,l),i.push({event:o,listeners:m}),o.target=ql)))}function Md(i,o){var l={};return l[i.toLowerCase()]=o.toLowerCase(),l["Webkit"+i]="webkit"+o,l["Moz"+i]="moz"+o,l}var Zl={animationend:Md("Animation","AnimationEnd"),animationiteration:Md("Animation","AnimationIteration"),animationstart:Md("Animation","AnimationStart"),transitionend:Md("Transition","TransitionEnd")},bm={},tx={};jo&&(tx=document.createElement("div").style,"AnimationEvent"in window||(delete Zl.animationend.animation,delete Zl.animationiteration.animation,delete Zl.animationstart.animation),"TransitionEvent"in window||delete Zl.transitionend.transition);function Ap(i){if(bm[i])return bm[i];if(!Zl[i])return i;var o=Zl[i],l;for(l in o)if(o.hasOwnProperty(l)&&l in tx)return bm[i]=o[l];return i}var ix=Ap("animationend"),nx=Ap("animationiteration"),rx=Ap("animationstart"),ox=Ap("transitionend"),sx=new Map,ev="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Hs(i,o){sx.set(i,o),qa(o,[i])}for(var Sm=0;Sm<ev.length;Sm++){var Tm=ev[Sm],m3=Tm.toLowerCase(),g3=Tm[0].toUpperCase()+Tm.slice(1);Hs(m3,"on"+g3)}Hs(ix,"onAnimationEnd");Hs(nx,"onAnimationIteration");Hs(rx,"onAnimationStart");Hs("dblclick","onDoubleClick");Hs("focusin","onFocus");Hs("focusout","onBlur");Hs(ox,"onTransitionEnd");ou("onMouseEnter",["mouseout","mouseover"]);ou("onMouseLeave",["mouseout","mouseover"]);ou("onPointerEnter",["pointerout","pointerover"]);ou("onPointerLeave",["pointerout","pointerover"]);qa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));qa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));qa("onBeforeInput",["compositionend","keypress","textInput","paste"]);qa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));qa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));qa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_3=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bc));function tv(i,o,l){var m=i.type||"unknown-event";i.currentTarget=l,m4(m,o,void 0,i),i.currentTarget=null}function ax(i,o){o=(o&4)!==0;for(var l=0;l<i.length;l++){var m=i[l],y=m.event;m=m.listeners;e:{var T=void 0;if(o)for(var w=m.length-1;0<=w;w--){var d=m[w],O=d.instance,W=d.currentTarget;if(d=d.listener,O!==T&&y.isPropagationStopped())break e;tv(y,d,W),T=O}else for(w=0;w<m.length;w++){if(d=m[w],O=d.instance,W=d.currentTarget,d=d.listener,O!==T&&y.isPropagationStopped())break e;tv(y,d,W),T=O}}}if(tp)throw i=rg,tp=!1,rg=null,i}function ni(i,o){var l=o[fg];l===void 0&&(l=o[fg]=new Set);var m=i+"__bubble";l.has(m)||(lx(o,i,2,!1),l.add(m))}function km(i,o,l){var m=0;o&&(m|=4),lx(l,i,m,o)}var zd="_reactListening"+Math.random().toString(36).slice(2);function ih(i){if(!i[zd]){i[zd]=!0,m1.forEach(function(l){l!=="selectionchange"&&(_3.has(l)||km(l,!1,i),km(l,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[zd]||(o[zd]=!0,km("selectionchange",!1,o))}}function lx(i,o,l,m){switch(Z1(o)){case 1:var y=z4;break;case 4:y=A4;break;default:y=r_}l=y.bind(null,o,l,i),y=void 0,!ng||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(y=!0),m?y!==void 0?i.addEventListener(o,l,{capture:!0,passive:y}):i.addEventListener(o,l,!0):y!==void 0?i.addEventListener(o,l,{passive:y}):i.addEventListener(o,l,!1)}function Im(i,o,l,m,y){var T=m;if(!(o&1)&&!(o&2)&&m!==null)e:for(;;){if(m===null)return;var w=m.tag;if(w===3||w===4){var d=m.stateNode.containerInfo;if(d===y||d.nodeType===8&&d.parentNode===y)break;if(w===4)for(w=m.return;w!==null;){var O=w.tag;if((O===3||O===4)&&(O=w.stateNode.containerInfo,O===y||O.nodeType===8&&O.parentNode===y))return;w=w.return}for(;d!==null;){if(w=za(d),w===null)return;if(O=w.tag,O===5||O===6){m=T=w;continue e}d=d.parentNode}}m=m.return}z1(function(){var W=T,oe=e_(l),X=[];e:{var $=sx.get(i);if($!==void 0){var be=s_,Te=i;switch(i){case"keypress":if(Zd(l)===0)break e;case"keydown":case"keyup":be=H4;break;case"focusin":Te="focus",be=vm;break;case"focusout":Te="blur",be=vm;break;case"beforeblur":case"afterblur":be=vm;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":be=$0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":be=R4;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":be=K4;break;case ix:case nx:case rx:be=O4;break;case ox:be=J4;break;case"scroll":be=D4;break;case"wheel":be=e3;break;case"copy":case"cut":case"paste":be=V4;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":be=Z0}var Ie=(o&4)!==0,Qe=!Ie&&i==="scroll",ue=Ie?$!==null?$+"Capture":null:$;Ie=[];for(var ie=W,se;ie!==null;){se=ie;var xe=se.stateNode;if(se.tag===5&&xe!==null&&(se=xe,ue!==null&&(xe=Kc(ie,ue),xe!=null&&Ie.push(nh(ie,xe,se)))),Qe)break;ie=ie.return}0<Ie.length&&($=new be($,Te,null,l,oe),X.push({event:$,listeners:Ie}))}}if(!(o&7)){e:{if($=i==="mouseover"||i==="pointerover",be=i==="mouseout"||i==="pointerout",$&&l!==tg&&(Te=l.relatedTarget||l.fromElement)&&(za(Te)||Te[Uo]))break e;if((be||$)&&($=oe.window===oe?oe:($=oe.ownerDocument)?$.defaultView||$.parentWindow:window,be?(Te=l.relatedTarget||l.toElement,be=W,Te=Te?za(Te):null,Te!==null&&(Qe=Za(Te),Te!==Qe||Te.tag!==5&&Te.tag!==6)&&(Te=null)):(be=null,Te=W),be!==Te)){if(Ie=$0,xe="onMouseLeave",ue="onMouseEnter",ie="mouse",(i==="pointerout"||i==="pointerover")&&(Ie=Z0,xe="onPointerLeave",ue="onPointerEnter",ie="pointer"),Qe=be==null?$:Gl(be),se=Te==null?$:Gl(Te),$=new Ie(xe,ie+"leave",be,l,oe),$.target=Qe,$.relatedTarget=se,xe=null,za(oe)===W&&(Ie=new Ie(ue,ie+"enter",Te,l,oe),Ie.target=se,Ie.relatedTarget=Qe,xe=Ie),Qe=xe,be&&Te)t:{for(Ie=be,ue=Te,ie=0,se=Ie;se;se=Vl(se))ie++;for(se=0,xe=ue;xe;xe=Vl(xe))se++;for(;0<ie-se;)Ie=Vl(Ie),ie--;for(;0<se-ie;)ue=Vl(ue),se--;for(;ie--;){if(Ie===ue||ue!==null&&Ie===ue.alternate)break t;Ie=Vl(Ie),ue=Vl(ue)}Ie=null}else Ie=null;be!==null&&iv(X,$,be,Ie,!1),Te!==null&&Qe!==null&&iv(X,Qe,Te,Ie,!0)}}e:{if($=W?Gl(W):window,be=$.nodeName&&$.nodeName.toLowerCase(),be==="select"||be==="input"&&$.type==="file")var Pe=a3;else if(W0($))if(Y1)Pe=h3;else{Pe=u3;var $e=l3}else(be=$.nodeName)&&be.toLowerCase()==="input"&&($.type==="checkbox"||$.type==="radio")&&(Pe=c3);if(Pe&&(Pe=Pe(i,W))){K1(X,Pe,l,oe);break e}$e&&$e(i,$,W),i==="focusout"&&($e=$._wrapperState)&&$e.controlled&&$.type==="number"&&Km($,"number",$.value)}switch($e=W?Gl(W):window,i){case"focusin":(W0($e)||$e.contentEditable==="true")&&(ql=$e,lg=W,$c=null);break;case"focusout":$c=lg=ql=null;break;case"mousedown":ug=!0;break;case"contextmenu":case"mouseup":case"dragend":ug=!1,Q0(X,l,oe);break;case"selectionchange":if(f3)break;case"keydown":case"keyup":Q0(X,l,oe)}var Ve;if(l_)e:{switch(i){case"compositionstart":var Ge="onCompositionStart";break e;case"compositionend":Ge="onCompositionEnd";break e;case"compositionupdate":Ge="onCompositionUpdate";break e}Ge=void 0}else $l?W1(i,l)&&(Ge="onCompositionEnd"):i==="keydown"&&l.keyCode===229&&(Ge="onCompositionStart");Ge&&(H1&&l.locale!=="ko"&&($l||Ge!=="onCompositionStart"?Ge==="onCompositionEnd"&&$l&&(Ve=G1()):(Ls=oe,o_="value"in Ls?Ls.value:Ls.textContent,$l=!0)),$e=sp(W,Ge),0<$e.length&&(Ge=new q0(Ge,i,null,l,oe),X.push({event:Ge,listeners:$e}),Ve?Ge.data=Ve:(Ve=X1(l),Ve!==null&&(Ge.data=Ve)))),(Ve=i3?n3(i,l):r3(i,l))&&(W=sp(W,"onBeforeInput"),0<W.length&&(oe=new q0("onBeforeInput","beforeinput",null,l,oe),X.push({event:oe,listeners:W}),oe.data=Ve))}ax(X,o)})}function nh(i,o,l){return{instance:i,listener:o,currentTarget:l}}function sp(i,o){for(var l=o+"Capture",m=[];i!==null;){var y=i,T=y.stateNode;y.tag===5&&T!==null&&(y=T,T=Kc(i,l),T!=null&&m.unshift(nh(i,T,y)),T=Kc(i,o),T!=null&&m.push(nh(i,T,y))),i=i.return}return m}function Vl(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function iv(i,o,l,m,y){for(var T=o._reactName,w=[];l!==null&&l!==m;){var d=l,O=d.alternate,W=d.stateNode;if(O!==null&&O===m)break;d.tag===5&&W!==null&&(d=W,y?(O=Kc(l,T),O!=null&&w.unshift(nh(l,O,d))):y||(O=Kc(l,T),O!=null&&w.push(nh(l,O,d)))),l=l.return}w.length!==0&&i.push({event:o,listeners:w})}var y3=/\r\n?/g,v3=/\u0000|\uFFFD/g;function nv(i){return(typeof i=="string"?i:""+i).replace(y3,`
`).replace(v3,"")}function Ad(i,o,l){if(o=nv(o),nv(i)!==o&&l)throw Error(Me(425))}function ap(){}var cg=null,hg=null;function dg(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var pg=typeof setTimeout=="function"?setTimeout:void 0,x3=typeof clearTimeout=="function"?clearTimeout:void 0,rv=typeof Promise=="function"?Promise:void 0,w3=typeof queueMicrotask=="function"?queueMicrotask:typeof rv<"u"?function(i){return rv.resolve(null).then(i).catch(b3)}:pg;function b3(i){setTimeout(function(){throw i})}function Em(i,o){var l=o,m=0;do{var y=l.nextSibling;if(i.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"){if(m===0){i.removeChild(y),Qc(o);return}m--}else l!=="$"&&l!=="$?"&&l!=="$!"||m++;l=y}while(l);Qc(o)}function Ns(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return i}function ov(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var l=i.data;if(l==="$"||l==="$!"||l==="$?"){if(o===0)return i;o--}else l==="/$"&&o++}i=i.previousSibling}return null}var mu=Math.random().toString(36).slice(2),ho="__reactFiber$"+mu,rh="__reactProps$"+mu,Uo="__reactContainer$"+mu,fg="__reactEvents$"+mu,S3="__reactListeners$"+mu,T3="__reactHandles$"+mu;function za(i){var o=i[ho];if(o)return o;for(var l=i.parentNode;l;){if(o=l[Uo]||l[ho]){if(l=o.alternate,o.child!==null||l!==null&&l.child!==null)for(i=ov(i);i!==null;){if(l=i[ho])return l;i=ov(i)}return o}i=l,l=i.parentNode}return null}function gh(i){return i=i[ho]||i[Uo],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Gl(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Me(33))}function Dp(i){return i[rh]||null}var mg=[],Hl=-1;function Ws(i){return{current:i}}function ri(i){0>Hl||(i.current=mg[Hl],mg[Hl]=null,Hl--)}function Qt(i,o){Hl++,mg[Hl]=i.current,i.current=o}var Zs={},_n=Ws(Zs),jn=Ws(!1),Fa=Zs;function su(i,o){var l=i.type.contextTypes;if(!l)return Zs;var m=i.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===o)return m.__reactInternalMemoizedMaskedChildContext;var y={},T;for(T in l)y[T]=o[T];return m&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=o,i.__reactInternalMemoizedMaskedChildContext=y),y}function Un(i){return i=i.childContextTypes,i!=null}function lp(){ri(jn),ri(_n)}function sv(i,o,l){if(_n.current!==Zs)throw Error(Me(168));Qt(_n,o),Qt(jn,l)}function ux(i,o,l){var m=i.stateNode;if(o=o.childContextTypes,typeof m.getChildContext!="function")return l;m=m.getChildContext();for(var y in m)if(!(y in o))throw Error(Me(108,l4(i)||"Unknown",y));return fi({},l,m)}function up(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Zs,Fa=_n.current,Qt(_n,i),Qt(jn,jn.current),!0}function av(i,o,l){var m=i.stateNode;if(!m)throw Error(Me(169));l?(i=ux(i,o,Fa),m.__reactInternalMemoizedMergedChildContext=i,ri(jn),ri(_n),Qt(_n,i)):ri(jn),Qt(jn,l)}var Bo=null,Lp=!1,Cm=!1;function cx(i){Bo===null?Bo=[i]:Bo.push(i)}function k3(i){Lp=!0,cx(i)}function Xs(){if(!Cm&&Bo!==null){Cm=!0;var i=0,o=Gt;try{var l=Bo;for(Gt=1;i<l.length;i++){var m=l[i];do m=m(!0);while(m!==null)}Bo=null,Lp=!1}catch(y){throw Bo!==null&&(Bo=Bo.slice(i+1)),R1(t_,Xs),y}finally{Gt=o,Cm=!1}}return null}var Wl=[],Xl=0,cp=null,hp=0,Cr=[],Pr=0,Ba=null,Oo=1,No="";function Ea(i,o){Wl[Xl++]=hp,Wl[Xl++]=cp,cp=i,hp=o}function hx(i,o,l){Cr[Pr++]=Oo,Cr[Pr++]=No,Cr[Pr++]=Ba,Ba=i;var m=Oo;i=No;var y=32-Hr(m)-1;m&=~(1<<y),l+=1;var T=32-Hr(o)+y;if(30<T){var w=y-y%5;T=(m&(1<<w)-1).toString(32),m>>=w,y-=w,Oo=1<<32-Hr(o)+y|l<<y|m,No=T+i}else Oo=1<<T|l<<y|m,No=i}function c_(i){i.return!==null&&(Ea(i,1),hx(i,1,0))}function h_(i){for(;i===cp;)cp=Wl[--Xl],Wl[Xl]=null,hp=Wl[--Xl],Wl[Xl]=null;for(;i===Ba;)Ba=Cr[--Pr],Cr[Pr]=null,No=Cr[--Pr],Cr[Pr]=null,Oo=Cr[--Pr],Cr[Pr]=null}var cr=null,lr=null,ui=!1,Zr=null;function dx(i,o){var l=Mr(5,null,null,0);l.elementType="DELETED",l.stateNode=o,l.return=i,o=i.deletions,o===null?(i.deletions=[l],i.flags|=16):o.push(l)}function lv(i,o){switch(i.tag){case 5:var l=i.type;return o=o.nodeType!==1||l.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(i.stateNode=o,cr=i,lr=Ns(o.firstChild),!0):!1;case 6:return o=i.pendingProps===""||o.nodeType!==3?null:o,o!==null?(i.stateNode=o,cr=i,lr=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(l=Ba!==null?{id:Oo,overflow:No}:null,i.memoizedState={dehydrated:o,treeContext:l,retryLane:1073741824},l=Mr(18,null,null,0),l.stateNode=o,l.return=i,i.child=l,cr=i,lr=null,!0):!1;default:return!1}}function gg(i){return(i.mode&1)!==0&&(i.flags&128)===0}function _g(i){if(ui){var o=lr;if(o){var l=o;if(!lv(i,o)){if(gg(i))throw Error(Me(418));o=Ns(l.nextSibling);var m=cr;o&&lv(i,o)?dx(m,l):(i.flags=i.flags&-4097|2,ui=!1,cr=i)}}else{if(gg(i))throw Error(Me(418));i.flags=i.flags&-4097|2,ui=!1,cr=i}}}function uv(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;cr=i}function Dd(i){if(i!==cr)return!1;if(!ui)return uv(i),ui=!0,!1;var o;if((o=i.tag!==3)&&!(o=i.tag!==5)&&(o=i.type,o=o!=="head"&&o!=="body"&&!dg(i.type,i.memoizedProps)),o&&(o=lr)){if(gg(i))throw px(),Error(Me(418));for(;o;)dx(i,o),o=Ns(o.nextSibling)}if(uv(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Me(317));e:{for(i=i.nextSibling,o=0;i;){if(i.nodeType===8){var l=i.data;if(l==="/$"){if(o===0){lr=Ns(i.nextSibling);break e}o--}else l!=="$"&&l!=="$!"&&l!=="$?"||o++}i=i.nextSibling}lr=null}}else lr=cr?Ns(i.stateNode.nextSibling):null;return!0}function px(){for(var i=lr;i;)i=Ns(i.nextSibling)}function au(){lr=cr=null,ui=!1}function d_(i){Zr===null?Zr=[i]:Zr.push(i)}var I3=Go.ReactCurrentBatchConfig;function Pc(i,o,l){if(i=l.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(Me(309));var m=l.stateNode}if(!m)throw Error(Me(147,i));var y=m,T=""+i;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===T?o.ref:(o=function(w){var d=y.refs;w===null?delete d[T]:d[T]=w},o._stringRef=T,o)}if(typeof i!="string")throw Error(Me(284));if(!l._owner)throw Error(Me(290,i))}return i}function Ld(i,o){throw i=Object.prototype.toString.call(o),Error(Me(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i))}function cv(i){var o=i._init;return o(i._payload)}function fx(i){function o(ue,ie){if(i){var se=ue.deletions;se===null?(ue.deletions=[ie],ue.flags|=16):se.push(ie)}}function l(ue,ie){if(!i)return null;for(;ie!==null;)o(ue,ie),ie=ie.sibling;return null}function m(ue,ie){for(ue=new Map;ie!==null;)ie.key!==null?ue.set(ie.key,ie):ue.set(ie.index,ie),ie=ie.sibling;return ue}function y(ue,ie){return ue=$s(ue,ie),ue.index=0,ue.sibling=null,ue}function T(ue,ie,se){return ue.index=se,i?(se=ue.alternate,se!==null?(se=se.index,se<ie?(ue.flags|=2,ie):se):(ue.flags|=2,ie)):(ue.flags|=1048576,ie)}function w(ue){return i&&ue.alternate===null&&(ue.flags|=2),ue}function d(ue,ie,se,xe){return ie===null||ie.tag!==6?(ie=Rm(se,ue.mode,xe),ie.return=ue,ie):(ie=y(ie,se),ie.return=ue,ie)}function O(ue,ie,se,xe){var Pe=se.type;return Pe===Ul?oe(ue,ie,se.props.children,xe,se.key):ie!==null&&(ie.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===Ms&&cv(Pe)===ie.type)?(xe=y(ie,se.props),xe.ref=Pc(ue,ie,se),xe.return=ue,xe):(xe=Jd(se.type,se.key,se.props,null,ue.mode,xe),xe.ref=Pc(ue,ie,se),xe.return=ue,xe)}function W(ue,ie,se,xe){return ie===null||ie.tag!==4||ie.stateNode.containerInfo!==se.containerInfo||ie.stateNode.implementation!==se.implementation?(ie=Fm(se,ue.mode,xe),ie.return=ue,ie):(ie=y(ie,se.children||[]),ie.return=ue,ie)}function oe(ue,ie,se,xe,Pe){return ie===null||ie.tag!==7?(ie=Ra(se,ue.mode,xe,Pe),ie.return=ue,ie):(ie=y(ie,se),ie.return=ue,ie)}function X(ue,ie,se){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return ie=Rm(""+ie,ue.mode,se),ie.return=ue,ie;if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case Sd:return se=Jd(ie.type,ie.key,ie.props,null,ue.mode,se),se.ref=Pc(ue,null,ie),se.return=ue,se;case jl:return ie=Fm(ie,ue.mode,se),ie.return=ue,ie;case Ms:var xe=ie._init;return X(ue,xe(ie._payload),se)}if(Rc(ie)||Tc(ie))return ie=Ra(ie,ue.mode,se,null),ie.return=ue,ie;Ld(ue,ie)}return null}function $(ue,ie,se,xe){var Pe=ie!==null?ie.key:null;if(typeof se=="string"&&se!==""||typeof se=="number")return Pe!==null?null:d(ue,ie,""+se,xe);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case Sd:return se.key===Pe?O(ue,ie,se,xe):null;case jl:return se.key===Pe?W(ue,ie,se,xe):null;case Ms:return Pe=se._init,$(ue,ie,Pe(se._payload),xe)}if(Rc(se)||Tc(se))return Pe!==null?null:oe(ue,ie,se,xe,null);Ld(ue,se)}return null}function be(ue,ie,se,xe,Pe){if(typeof xe=="string"&&xe!==""||typeof xe=="number")return ue=ue.get(se)||null,d(ie,ue,""+xe,Pe);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case Sd:return ue=ue.get(xe.key===null?se:xe.key)||null,O(ie,ue,xe,Pe);case jl:return ue=ue.get(xe.key===null?se:xe.key)||null,W(ie,ue,xe,Pe);case Ms:var $e=xe._init;return be(ue,ie,se,$e(xe._payload),Pe)}if(Rc(xe)||Tc(xe))return ue=ue.get(se)||null,oe(ie,ue,xe,Pe,null);Ld(ie,xe)}return null}function Te(ue,ie,se,xe){for(var Pe=null,$e=null,Ve=ie,Ge=ie=0,Et=null;Ve!==null&&Ge<se.length;Ge++){Ve.index>Ge?(Et=Ve,Ve=null):Et=Ve.sibling;var mt=$(ue,Ve,se[Ge],xe);if(mt===null){Ve===null&&(Ve=Et);break}i&&Ve&&mt.alternate===null&&o(ue,Ve),ie=T(mt,ie,Ge),$e===null?Pe=mt:$e.sibling=mt,$e=mt,Ve=Et}if(Ge===se.length)return l(ue,Ve),ui&&Ea(ue,Ge),Pe;if(Ve===null){for(;Ge<se.length;Ge++)Ve=X(ue,se[Ge],xe),Ve!==null&&(ie=T(Ve,ie,Ge),$e===null?Pe=Ve:$e.sibling=Ve,$e=Ve);return ui&&Ea(ue,Ge),Pe}for(Ve=m(ue,Ve);Ge<se.length;Ge++)Et=be(Ve,ue,Ge,se[Ge],xe),Et!==null&&(i&&Et.alternate!==null&&Ve.delete(Et.key===null?Ge:Et.key),ie=T(Et,ie,Ge),$e===null?Pe=Et:$e.sibling=Et,$e=Et);return i&&Ve.forEach(function(gt){return o(ue,gt)}),ui&&Ea(ue,Ge),Pe}function Ie(ue,ie,se,xe){var Pe=Tc(se);if(typeof Pe!="function")throw Error(Me(150));if(se=Pe.call(se),se==null)throw Error(Me(151));for(var $e=Pe=null,Ve=ie,Ge=ie=0,Et=null,mt=se.next();Ve!==null&&!mt.done;Ge++,mt=se.next()){Ve.index>Ge?(Et=Ve,Ve=null):Et=Ve.sibling;var gt=$(ue,Ve,mt.value,xe);if(gt===null){Ve===null&&(Ve=Et);break}i&&Ve&&gt.alternate===null&&o(ue,Ve),ie=T(gt,ie,Ge),$e===null?Pe=gt:$e.sibling=gt,$e=gt,Ve=Et}if(mt.done)return l(ue,Ve),ui&&Ea(ue,Ge),Pe;if(Ve===null){for(;!mt.done;Ge++,mt=se.next())mt=X(ue,mt.value,xe),mt!==null&&(ie=T(mt,ie,Ge),$e===null?Pe=mt:$e.sibling=mt,$e=mt);return ui&&Ea(ue,Ge),Pe}for(Ve=m(ue,Ve);!mt.done;Ge++,mt=se.next())mt=be(Ve,ue,Ge,mt.value,xe),mt!==null&&(i&&mt.alternate!==null&&Ve.delete(mt.key===null?Ge:mt.key),ie=T(mt,ie,Ge),$e===null?Pe=mt:$e.sibling=mt,$e=mt);return i&&Ve.forEach(function(gr){return o(ue,gr)}),ui&&Ea(ue,Ge),Pe}function Qe(ue,ie,se,xe){if(typeof se=="object"&&se!==null&&se.type===Ul&&se.key===null&&(se=se.props.children),typeof se=="object"&&se!==null){switch(se.$$typeof){case Sd:e:{for(var Pe=se.key,$e=ie;$e!==null;){if($e.key===Pe){if(Pe=se.type,Pe===Ul){if($e.tag===7){l(ue,$e.sibling),ie=y($e,se.props.children),ie.return=ue,ue=ie;break e}}else if($e.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===Ms&&cv(Pe)===$e.type){l(ue,$e.sibling),ie=y($e,se.props),ie.ref=Pc(ue,$e,se),ie.return=ue,ue=ie;break e}l(ue,$e);break}else o(ue,$e);$e=$e.sibling}se.type===Ul?(ie=Ra(se.props.children,ue.mode,xe,se.key),ie.return=ue,ue=ie):(xe=Jd(se.type,se.key,se.props,null,ue.mode,xe),xe.ref=Pc(ue,ie,se),xe.return=ue,ue=xe)}return w(ue);case jl:e:{for($e=se.key;ie!==null;){if(ie.key===$e)if(ie.tag===4&&ie.stateNode.containerInfo===se.containerInfo&&ie.stateNode.implementation===se.implementation){l(ue,ie.sibling),ie=y(ie,se.children||[]),ie.return=ue,ue=ie;break e}else{l(ue,ie);break}else o(ue,ie);ie=ie.sibling}ie=Fm(se,ue.mode,xe),ie.return=ue,ue=ie}return w(ue);case Ms:return $e=se._init,Qe(ue,ie,$e(se._payload),xe)}if(Rc(se))return Te(ue,ie,se,xe);if(Tc(se))return Ie(ue,ie,se,xe);Ld(ue,se)}return typeof se=="string"&&se!==""||typeof se=="number"?(se=""+se,ie!==null&&ie.tag===6?(l(ue,ie.sibling),ie=y(ie,se),ie.return=ue,ue=ie):(l(ue,ie),ie=Rm(se,ue.mode,xe),ie.return=ue,ue=ie),w(ue)):l(ue,ie)}return Qe}var lu=fx(!0),mx=fx(!1),dp=Ws(null),pp=null,Kl=null,p_=null;function f_(){p_=Kl=pp=null}function m_(i){var o=dp.current;ri(dp),i._currentValue=o}function yg(i,o,l){for(;i!==null;){var m=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),i===l)break;i=i.return}}function nu(i,o){pp=i,p_=Kl=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&o&&(Vn=!0),i.firstContext=null)}function Ar(i){var o=i._currentValue;if(p_!==i)if(i={context:i,memoizedValue:o,next:null},Kl===null){if(pp===null)throw Error(Me(308));Kl=i,pp.dependencies={lanes:0,firstContext:i}}else Kl=Kl.next=i;return o}var Aa=null;function g_(i){Aa===null?Aa=[i]:Aa.push(i)}function gx(i,o,l,m){var y=o.interleaved;return y===null?(l.next=l,g_(o)):(l.next=y.next,y.next=l),o.interleaved=l,$o(i,m)}function $o(i,o){i.lanes|=o;var l=i.alternate;for(l!==null&&(l.lanes|=o),l=i,i=i.return;i!==null;)i.childLanes|=o,l=i.alternate,l!==null&&(l.childLanes|=o),l=i,i=i.return;return l.tag===3?l.stateNode:null}var zs=!1;function __(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _x(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Vo(i,o){return{eventTime:i,lane:o,tag:0,payload:null,callback:null,next:null}}function Vs(i,o,l){var m=i.updateQueue;if(m===null)return null;if(m=m.shared,Ft&2){var y=m.pending;return y===null?o.next=o:(o.next=y.next,y.next=o),m.pending=o,$o(i,l)}return y=m.interleaved,y===null?(o.next=o,g_(m)):(o.next=y.next,y.next=o),m.interleaved=o,$o(i,l)}function Gd(i,o,l){if(o=o.updateQueue,o!==null&&(o=o.shared,(l&4194240)!==0)){var m=o.lanes;m&=i.pendingLanes,l|=m,o.lanes=l,i_(i,l)}}function hv(i,o){var l=i.updateQueue,m=i.alternate;if(m!==null&&(m=m.updateQueue,l===m)){var y=null,T=null;if(l=l.firstBaseUpdate,l!==null){do{var w={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};T===null?y=T=w:T=T.next=w,l=l.next}while(l!==null);T===null?y=T=o:T=T.next=o}else y=T=o;l={baseState:m.baseState,firstBaseUpdate:y,lastBaseUpdate:T,shared:m.shared,effects:m.effects},i.updateQueue=l;return}i=l.lastBaseUpdate,i===null?l.firstBaseUpdate=o:i.next=o,l.lastBaseUpdate=o}function fp(i,o,l,m){var y=i.updateQueue;zs=!1;var T=y.firstBaseUpdate,w=y.lastBaseUpdate,d=y.shared.pending;if(d!==null){y.shared.pending=null;var O=d,W=O.next;O.next=null,w===null?T=W:w.next=W,w=O;var oe=i.alternate;oe!==null&&(oe=oe.updateQueue,d=oe.lastBaseUpdate,d!==w&&(d===null?oe.firstBaseUpdate=W:d.next=W,oe.lastBaseUpdate=O))}if(T!==null){var X=y.baseState;w=0,oe=W=O=null,d=T;do{var $=d.lane,be=d.eventTime;if((m&$)===$){oe!==null&&(oe=oe.next={eventTime:be,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var Te=i,Ie=d;switch($=o,be=l,Ie.tag){case 1:if(Te=Ie.payload,typeof Te=="function"){X=Te.call(be,X,$);break e}X=Te;break e;case 3:Te.flags=Te.flags&-65537|128;case 0:if(Te=Ie.payload,$=typeof Te=="function"?Te.call(be,X,$):Te,$==null)break e;X=fi({},X,$);break e;case 2:zs=!0}}d.callback!==null&&d.lane!==0&&(i.flags|=64,$=y.effects,$===null?y.effects=[d]:$.push(d))}else be={eventTime:be,lane:$,tag:d.tag,payload:d.payload,callback:d.callback,next:null},oe===null?(W=oe=be,O=X):oe=oe.next=be,w|=$;if(d=d.next,d===null){if(d=y.shared.pending,d===null)break;$=d,d=$.next,$.next=null,y.lastBaseUpdate=$,y.shared.pending=null}}while(!0);if(oe===null&&(O=X),y.baseState=O,y.firstBaseUpdate=W,y.lastBaseUpdate=oe,o=y.shared.interleaved,o!==null){y=o;do w|=y.lane,y=y.next;while(y!==o)}else T===null&&(y.shared.lanes=0);Na|=w,i.lanes=w,i.memoizedState=X}}function dv(i,o,l){if(i=o.effects,o.effects=null,i!==null)for(o=0;o<i.length;o++){var m=i[o],y=m.callback;if(y!==null){if(m.callback=null,m=l,typeof y!="function")throw Error(Me(191,y));y.call(m)}}}var _h={},fo=Ws(_h),oh=Ws(_h),sh=Ws(_h);function Da(i){if(i===_h)throw Error(Me(174));return i}function y_(i,o){switch(Qt(sh,o),Qt(oh,i),Qt(fo,_h),i=o.nodeType,i){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Jm(null,"");break;default:i=i===8?o.parentNode:o,o=i.namespaceURI||null,i=i.tagName,o=Jm(o,i)}ri(fo),Qt(fo,o)}function uu(){ri(fo),ri(oh),ri(sh)}function yx(i){Da(sh.current);var o=Da(fo.current),l=Jm(o,i.type);o!==l&&(Qt(oh,i),Qt(fo,l))}function v_(i){oh.current===i&&(ri(fo),ri(oh))}var di=Ws(0);function mp(i){for(var o=i;o!==null;){if(o.tag===13){var l=o.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Pm=[];function x_(){for(var i=0;i<Pm.length;i++)Pm[i]._workInProgressVersionPrimary=null;Pm.length=0}var Hd=Go.ReactCurrentDispatcher,Mm=Go.ReactCurrentBatchConfig,Oa=0,pi=null,zi=null,Ui=null,gp=!1,qc=!1,ah=0,E3=0;function pn(){throw Error(Me(321))}function w_(i,o){if(o===null)return!1;for(var l=0;l<o.length&&l<i.length;l++)if(!Xr(i[l],o[l]))return!1;return!0}function b_(i,o,l,m,y,T){if(Oa=T,pi=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Hd.current=i===null||i.memoizedState===null?z3:A3,i=l(m,y),qc){T=0;do{if(qc=!1,ah=0,25<=T)throw Error(Me(301));T+=1,Ui=zi=null,o.updateQueue=null,Hd.current=D3,i=l(m,y)}while(qc)}if(Hd.current=_p,o=zi!==null&&zi.next!==null,Oa=0,Ui=zi=pi=null,gp=!1,o)throw Error(Me(300));return i}function S_(){var i=ah!==0;return ah=0,i}function co(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ui===null?pi.memoizedState=Ui=i:Ui=Ui.next=i,Ui}function Dr(){if(zi===null){var i=pi.alternate;i=i!==null?i.memoizedState:null}else i=zi.next;var o=Ui===null?pi.memoizedState:Ui.next;if(o!==null)Ui=o,zi=i;else{if(i===null)throw Error(Me(310));zi=i,i={memoizedState:zi.memoizedState,baseState:zi.baseState,baseQueue:zi.baseQueue,queue:zi.queue,next:null},Ui===null?pi.memoizedState=Ui=i:Ui=Ui.next=i}return Ui}function lh(i,o){return typeof o=="function"?o(i):o}function zm(i){var o=Dr(),l=o.queue;if(l===null)throw Error(Me(311));l.lastRenderedReducer=i;var m=zi,y=m.baseQueue,T=l.pending;if(T!==null){if(y!==null){var w=y.next;y.next=T.next,T.next=w}m.baseQueue=y=T,l.pending=null}if(y!==null){T=y.next,m=m.baseState;var d=w=null,O=null,W=T;do{var oe=W.lane;if((Oa&oe)===oe)O!==null&&(O=O.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),m=W.hasEagerState?W.eagerState:i(m,W.action);else{var X={lane:oe,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};O===null?(d=O=X,w=m):O=O.next=X,pi.lanes|=oe,Na|=oe}W=W.next}while(W!==null&&W!==T);O===null?w=m:O.next=d,Xr(m,o.memoizedState)||(Vn=!0),o.memoizedState=m,o.baseState=w,o.baseQueue=O,l.lastRenderedState=m}if(i=l.interleaved,i!==null){y=i;do T=y.lane,pi.lanes|=T,Na|=T,y=y.next;while(y!==i)}else y===null&&(l.lanes=0);return[o.memoizedState,l.dispatch]}function Am(i){var o=Dr(),l=o.queue;if(l===null)throw Error(Me(311));l.lastRenderedReducer=i;var m=l.dispatch,y=l.pending,T=o.memoizedState;if(y!==null){l.pending=null;var w=y=y.next;do T=i(T,w.action),w=w.next;while(w!==y);Xr(T,o.memoizedState)||(Vn=!0),o.memoizedState=T,o.baseQueue===null&&(o.baseState=T),l.lastRenderedState=T}return[T,m]}function vx(){}function xx(i,o){var l=pi,m=Dr(),y=o(),T=!Xr(m.memoizedState,y);if(T&&(m.memoizedState=y,Vn=!0),m=m.queue,T_(Sx.bind(null,l,m,i),[i]),m.getSnapshot!==o||T||Ui!==null&&Ui.memoizedState.tag&1){if(l.flags|=2048,uh(9,bx.bind(null,l,m,y,o),void 0,null),$i===null)throw Error(Me(349));Oa&30||wx(l,o,y)}return y}function wx(i,o,l){i.flags|=16384,i={getSnapshot:o,value:l},o=pi.updateQueue,o===null?(o={lastEffect:null,stores:null},pi.updateQueue=o,o.stores=[i]):(l=o.stores,l===null?o.stores=[i]:l.push(i))}function bx(i,o,l,m){o.value=l,o.getSnapshot=m,Tx(o)&&kx(i)}function Sx(i,o,l){return l(function(){Tx(o)&&kx(i)})}function Tx(i){var o=i.getSnapshot;i=i.value;try{var l=o();return!Xr(i,l)}catch{return!0}}function kx(i){var o=$o(i,1);o!==null&&Wr(o,i,1,-1)}function pv(i){var o=co();return typeof i=="function"&&(i=i()),o.memoizedState=o.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lh,lastRenderedState:i},o.queue=i,i=i.dispatch=M3.bind(null,pi,i),[o.memoizedState,i]}function uh(i,o,l,m){return i={tag:i,create:o,destroy:l,deps:m,next:null},o=pi.updateQueue,o===null?(o={lastEffect:null,stores:null},pi.updateQueue=o,o.lastEffect=i.next=i):(l=o.lastEffect,l===null?o.lastEffect=i.next=i:(m=l.next,l.next=i,i.next=m,o.lastEffect=i)),i}function Ix(){return Dr().memoizedState}function Wd(i,o,l,m){var y=co();pi.flags|=i,y.memoizedState=uh(1|o,l,void 0,m===void 0?null:m)}function Rp(i,o,l,m){var y=Dr();m=m===void 0?null:m;var T=void 0;if(zi!==null){var w=zi.memoizedState;if(T=w.destroy,m!==null&&w_(m,w.deps)){y.memoizedState=uh(o,l,T,m);return}}pi.flags|=i,y.memoizedState=uh(1|o,l,T,m)}function fv(i,o){return Wd(8390656,8,i,o)}function T_(i,o){return Rp(2048,8,i,o)}function Ex(i,o){return Rp(4,2,i,o)}function Cx(i,o){return Rp(4,4,i,o)}function Px(i,o){if(typeof o=="function")return i=i(),o(i),function(){o(null)};if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function Mx(i,o,l){return l=l!=null?l.concat([i]):null,Rp(4,4,Px.bind(null,o,i),l)}function k_(){}function zx(i,o){var l=Dr();o=o===void 0?null:o;var m=l.memoizedState;return m!==null&&o!==null&&w_(o,m[1])?m[0]:(l.memoizedState=[i,o],i)}function Ax(i,o){var l=Dr();o=o===void 0?null:o;var m=l.memoizedState;return m!==null&&o!==null&&w_(o,m[1])?m[0]:(i=i(),l.memoizedState=[i,o],i)}function Dx(i,o,l){return Oa&21?(Xr(l,o)||(l=O1(),pi.lanes|=l,Na|=l,i.baseState=!0),o):(i.baseState&&(i.baseState=!1,Vn=!0),i.memoizedState=l)}function C3(i,o){var l=Gt;Gt=l!==0&&4>l?l:4,i(!0);var m=Mm.transition;Mm.transition={};try{i(!1),o()}finally{Gt=l,Mm.transition=m}}function Lx(){return Dr().memoizedState}function P3(i,o,l){var m=Us(i);if(l={lane:m,action:l,hasEagerState:!1,eagerState:null,next:null},Rx(i))Fx(o,l);else if(l=gx(i,o,l,m),l!==null){var y=En();Wr(l,i,m,y),Bx(l,o,m)}}function M3(i,o,l){var m=Us(i),y={lane:m,action:l,hasEagerState:!1,eagerState:null,next:null};if(Rx(i))Fx(o,y);else{var T=i.alternate;if(i.lanes===0&&(T===null||T.lanes===0)&&(T=o.lastRenderedReducer,T!==null))try{var w=o.lastRenderedState,d=T(w,l);if(y.hasEagerState=!0,y.eagerState=d,Xr(d,w)){var O=o.interleaved;O===null?(y.next=y,g_(o)):(y.next=O.next,O.next=y),o.interleaved=y;return}}catch{}finally{}l=gx(i,o,y,m),l!==null&&(y=En(),Wr(l,i,m,y),Bx(l,o,m))}}function Rx(i){var o=i.alternate;return i===pi||o!==null&&o===pi}function Fx(i,o){qc=gp=!0;var l=i.pending;l===null?o.next=o:(o.next=l.next,l.next=o),i.pending=o}function Bx(i,o,l){if(l&4194240){var m=o.lanes;m&=i.pendingLanes,l|=m,o.lanes=l,i_(i,l)}}var _p={readContext:Ar,useCallback:pn,useContext:pn,useEffect:pn,useImperativeHandle:pn,useInsertionEffect:pn,useLayoutEffect:pn,useMemo:pn,useReducer:pn,useRef:pn,useState:pn,useDebugValue:pn,useDeferredValue:pn,useTransition:pn,useMutableSource:pn,useSyncExternalStore:pn,useId:pn,unstable_isNewReconciler:!1},z3={readContext:Ar,useCallback:function(i,o){return co().memoizedState=[i,o===void 0?null:o],i},useContext:Ar,useEffect:fv,useImperativeHandle:function(i,o,l){return l=l!=null?l.concat([i]):null,Wd(4194308,4,Px.bind(null,o,i),l)},useLayoutEffect:function(i,o){return Wd(4194308,4,i,o)},useInsertionEffect:function(i,o){return Wd(4,2,i,o)},useMemo:function(i,o){var l=co();return o=o===void 0?null:o,i=i(),l.memoizedState=[i,o],i},useReducer:function(i,o,l){var m=co();return o=l!==void 0?l(o):o,m.memoizedState=m.baseState=o,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:o},m.queue=i,i=i.dispatch=P3.bind(null,pi,i),[m.memoizedState,i]},useRef:function(i){var o=co();return i={current:i},o.memoizedState=i},useState:pv,useDebugValue:k_,useDeferredValue:function(i){return co().memoizedState=i},useTransition:function(){var i=pv(!1),o=i[0];return i=C3.bind(null,i[1]),co().memoizedState=i,[o,i]},useMutableSource:function(){},useSyncExternalStore:function(i,o,l){var m=pi,y=co();if(ui){if(l===void 0)throw Error(Me(407));l=l()}else{if(l=o(),$i===null)throw Error(Me(349));Oa&30||wx(m,o,l)}y.memoizedState=l;var T={value:l,getSnapshot:o};return y.queue=T,fv(Sx.bind(null,m,T,i),[i]),m.flags|=2048,uh(9,bx.bind(null,m,T,l,o),void 0,null),l},useId:function(){var i=co(),o=$i.identifierPrefix;if(ui){var l=No,m=Oo;l=(m&~(1<<32-Hr(m)-1)).toString(32)+l,o=":"+o+"R"+l,l=ah++,0<l&&(o+="H"+l.toString(32)),o+=":"}else l=E3++,o=":"+o+"r"+l.toString(32)+":";return i.memoizedState=o},unstable_isNewReconciler:!1},A3={readContext:Ar,useCallback:zx,useContext:Ar,useEffect:T_,useImperativeHandle:Mx,useInsertionEffect:Ex,useLayoutEffect:Cx,useMemo:Ax,useReducer:zm,useRef:Ix,useState:function(){return zm(lh)},useDebugValue:k_,useDeferredValue:function(i){var o=Dr();return Dx(o,zi.memoizedState,i)},useTransition:function(){var i=zm(lh)[0],o=Dr().memoizedState;return[i,o]},useMutableSource:vx,useSyncExternalStore:xx,useId:Lx,unstable_isNewReconciler:!1},D3={readContext:Ar,useCallback:zx,useContext:Ar,useEffect:T_,useImperativeHandle:Mx,useInsertionEffect:Ex,useLayoutEffect:Cx,useMemo:Ax,useReducer:Am,useRef:Ix,useState:function(){return Am(lh)},useDebugValue:k_,useDeferredValue:function(i){var o=Dr();return zi===null?o.memoizedState=i:Dx(o,zi.memoizedState,i)},useTransition:function(){var i=Am(lh)[0],o=Dr().memoizedState;return[i,o]},useMutableSource:vx,useSyncExternalStore:xx,useId:Lx,unstable_isNewReconciler:!1};function $r(i,o){if(i&&i.defaultProps){o=fi({},o),i=i.defaultProps;for(var l in i)o[l]===void 0&&(o[l]=i[l]);return o}return o}function vg(i,o,l,m){o=i.memoizedState,l=l(m,o),l=l==null?o:fi({},o,l),i.memoizedState=l,i.lanes===0&&(i.updateQueue.baseState=l)}var Fp={isMounted:function(i){return(i=i._reactInternals)?Za(i)===i:!1},enqueueSetState:function(i,o,l){i=i._reactInternals;var m=En(),y=Us(i),T=Vo(m,y);T.payload=o,l!=null&&(T.callback=l),o=Vs(i,T,y),o!==null&&(Wr(o,i,y,m),Gd(o,i,y))},enqueueReplaceState:function(i,o,l){i=i._reactInternals;var m=En(),y=Us(i),T=Vo(m,y);T.tag=1,T.payload=o,l!=null&&(T.callback=l),o=Vs(i,T,y),o!==null&&(Wr(o,i,y,m),Gd(o,i,y))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var l=En(),m=Us(i),y=Vo(l,m);y.tag=2,o!=null&&(y.callback=o),o=Vs(i,y,m),o!==null&&(Wr(o,i,m,l),Gd(o,i,m))}};function mv(i,o,l,m,y,T,w){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(m,T,w):o.prototype&&o.prototype.isPureReactComponent?!th(l,m)||!th(y,T):!0}function Ox(i,o,l){var m=!1,y=Zs,T=o.contextType;return typeof T=="object"&&T!==null?T=Ar(T):(y=Un(o)?Fa:_n.current,m=o.contextTypes,T=(m=m!=null)?su(i,y):Zs),o=new o(l,T),i.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Fp,i.stateNode=o,o._reactInternals=i,m&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=y,i.__reactInternalMemoizedMaskedChildContext=T),o}function gv(i,o,l,m){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(l,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(l,m),o.state!==i&&Fp.enqueueReplaceState(o,o.state,null)}function xg(i,o,l,m){var y=i.stateNode;y.props=l,y.state=i.memoizedState,y.refs={},__(i);var T=o.contextType;typeof T=="object"&&T!==null?y.context=Ar(T):(T=Un(o)?Fa:_n.current,y.context=su(i,T)),y.state=i.memoizedState,T=o.getDerivedStateFromProps,typeof T=="function"&&(vg(i,o,T,l),y.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(o=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),o!==y.state&&Fp.enqueueReplaceState(y,y.state,null),fp(i,l,y,m),y.state=i.memoizedState),typeof y.componentDidMount=="function"&&(i.flags|=4194308)}function cu(i,o){try{var l="",m=o;do l+=a4(m),m=m.return;while(m);var y=l}catch(T){y=`
Error generating stack: `+T.message+`
`+T.stack}return{value:i,source:o,stack:y,digest:null}}function Dm(i,o,l){return{value:i,source:null,stack:l??null,digest:o??null}}function wg(i,o){try{console.error(o.value)}catch(l){setTimeout(function(){throw l})}}var L3=typeof WeakMap=="function"?WeakMap:Map;function Nx(i,o,l){l=Vo(-1,l),l.tag=3,l.payload={element:null};var m=o.value;return l.callback=function(){vp||(vp=!0,zg=m),wg(i,o)},l}function Vx(i,o,l){l=Vo(-1,l),l.tag=3;var m=i.type.getDerivedStateFromError;if(typeof m=="function"){var y=o.value;l.payload=function(){return m(y)},l.callback=function(){wg(i,o)}}var T=i.stateNode;return T!==null&&typeof T.componentDidCatch=="function"&&(l.callback=function(){wg(i,o),typeof m!="function"&&(js===null?js=new Set([this]):js.add(this));var w=o.stack;this.componentDidCatch(o.value,{componentStack:w!==null?w:""})}),l}function _v(i,o,l){var m=i.pingCache;if(m===null){m=i.pingCache=new L3;var y=new Set;m.set(o,y)}else y=m.get(o),y===void 0&&(y=new Set,m.set(o,y));y.has(l)||(y.add(l),i=W3.bind(null,i,o,l),o.then(i,i))}function yv(i){do{var o;if((o=i.tag===13)&&(o=i.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return i;i=i.return}while(i!==null);return null}function vv(i,o,l,m,y){return i.mode&1?(i.flags|=65536,i.lanes=y,i):(i===o?i.flags|=65536:(i.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(o=Vo(-1,1),o.tag=2,Vs(l,o,1))),l.lanes|=1),i)}var R3=Go.ReactCurrentOwner,Vn=!1;function In(i,o,l,m){o.child=i===null?mx(o,null,l,m):lu(o,i.child,l,m)}function xv(i,o,l,m,y){l=l.render;var T=o.ref;return nu(o,y),m=b_(i,o,l,m,T,y),l=S_(),i!==null&&!Vn?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~y,qo(i,o,y)):(ui&&l&&c_(o),o.flags|=1,In(i,o,m,y),o.child)}function wv(i,o,l,m,y){if(i===null){var T=l.type;return typeof T=="function"&&!D_(T)&&T.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(o.tag=15,o.type=T,jx(i,o,T,m,y)):(i=Jd(l.type,null,m,o,o.mode,y),i.ref=o.ref,i.return=o,o.child=i)}if(T=i.child,!(i.lanes&y)){var w=T.memoizedProps;if(l=l.compare,l=l!==null?l:th,l(w,m)&&i.ref===o.ref)return qo(i,o,y)}return o.flags|=1,i=$s(T,m),i.ref=o.ref,i.return=o,o.child=i}function jx(i,o,l,m,y){if(i!==null){var T=i.memoizedProps;if(th(T,m)&&i.ref===o.ref)if(Vn=!1,o.pendingProps=m=T,(i.lanes&y)!==0)i.flags&131072&&(Vn=!0);else return o.lanes=i.lanes,qo(i,o,y)}return bg(i,o,l,m,y)}function Ux(i,o,l){var m=o.pendingProps,y=m.children,T=i!==null?i.memoizedState:null;if(m.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qt(Jl,ar),ar|=l;else{if(!(l&1073741824))return i=T!==null?T.baseLanes|l:l,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:i,cachePool:null,transitions:null},o.updateQueue=null,Qt(Jl,ar),ar|=i,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=T!==null?T.baseLanes:l,Qt(Jl,ar),ar|=m}else T!==null?(m=T.baseLanes|l,o.memoizedState=null):m=l,Qt(Jl,ar),ar|=m;return In(i,o,y,l),o.child}function $x(i,o){var l=o.ref;(i===null&&l!==null||i!==null&&i.ref!==l)&&(o.flags|=512,o.flags|=2097152)}function bg(i,o,l,m,y){var T=Un(l)?Fa:_n.current;return T=su(o,T),nu(o,y),l=b_(i,o,l,m,T,y),m=S_(),i!==null&&!Vn?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~y,qo(i,o,y)):(ui&&m&&c_(o),o.flags|=1,In(i,o,l,y),o.child)}function bv(i,o,l,m,y){if(Un(l)){var T=!0;up(o)}else T=!1;if(nu(o,y),o.stateNode===null)Xd(i,o),Ox(o,l,m),xg(o,l,m,y),m=!0;else if(i===null){var w=o.stateNode,d=o.memoizedProps;w.props=d;var O=w.context,W=l.contextType;typeof W=="object"&&W!==null?W=Ar(W):(W=Un(l)?Fa:_n.current,W=su(o,W));var oe=l.getDerivedStateFromProps,X=typeof oe=="function"||typeof w.getSnapshotBeforeUpdate=="function";X||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(d!==m||O!==W)&&gv(o,w,m,W),zs=!1;var $=o.memoizedState;w.state=$,fp(o,m,w,y),O=o.memoizedState,d!==m||$!==O||jn.current||zs?(typeof oe=="function"&&(vg(o,l,oe,m),O=o.memoizedState),(d=zs||mv(o,l,d,m,$,O,W))?(X||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(o.flags|=4194308)):(typeof w.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=O),w.props=m,w.state=O,w.context=W,m=d):(typeof w.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{w=o.stateNode,_x(i,o),d=o.memoizedProps,W=o.type===o.elementType?d:$r(o.type,d),w.props=W,X=o.pendingProps,$=w.context,O=l.contextType,typeof O=="object"&&O!==null?O=Ar(O):(O=Un(l)?Fa:_n.current,O=su(o,O));var be=l.getDerivedStateFromProps;(oe=typeof be=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(d!==X||$!==O)&&gv(o,w,m,O),zs=!1,$=o.memoizedState,w.state=$,fp(o,m,w,y);var Te=o.memoizedState;d!==X||$!==Te||jn.current||zs?(typeof be=="function"&&(vg(o,l,be,m),Te=o.memoizedState),(W=zs||mv(o,l,W,m,$,Te,O)||!1)?(oe||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(m,Te,O),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(m,Te,O)),typeof w.componentDidUpdate=="function"&&(o.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof w.componentDidUpdate!="function"||d===i.memoizedProps&&$===i.memoizedState||(o.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&$===i.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=Te),w.props=m,w.state=Te,w.context=O,m=W):(typeof w.componentDidUpdate!="function"||d===i.memoizedProps&&$===i.memoizedState||(o.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&$===i.memoizedState||(o.flags|=1024),m=!1)}return Sg(i,o,l,m,T,y)}function Sg(i,o,l,m,y,T){$x(i,o);var w=(o.flags&128)!==0;if(!m&&!w)return y&&av(o,l,!1),qo(i,o,T);m=o.stateNode,R3.current=o;var d=w&&typeof l.getDerivedStateFromError!="function"?null:m.render();return o.flags|=1,i!==null&&w?(o.child=lu(o,i.child,null,T),o.child=lu(o,null,d,T)):In(i,o,d,T),o.memoizedState=m.state,y&&av(o,l,!0),o.child}function qx(i){var o=i.stateNode;o.pendingContext?sv(i,o.pendingContext,o.pendingContext!==o.context):o.context&&sv(i,o.context,!1),y_(i,o.containerInfo)}function Sv(i,o,l,m,y){return au(),d_(y),o.flags|=256,In(i,o,l,m),o.child}var Tg={dehydrated:null,treeContext:null,retryLane:0};function kg(i){return{baseLanes:i,cachePool:null,transitions:null}}function Zx(i,o,l){var m=o.pendingProps,y=di.current,T=!1,w=(o.flags&128)!==0,d;if((d=w)||(d=i!==null&&i.memoizedState===null?!1:(y&2)!==0),d?(T=!0,o.flags&=-129):(i===null||i.memoizedState!==null)&&(y|=1),Qt(di,y&1),i===null)return _g(o),i=o.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(o.mode&1?i.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(w=m.children,i=m.fallback,T?(m=o.mode,T=o.child,w={mode:"hidden",children:w},!(m&1)&&T!==null?(T.childLanes=0,T.pendingProps=w):T=Np(w,m,0,null),i=Ra(i,m,l,null),T.return=o,i.return=o,T.sibling=i,o.child=T,o.child.memoizedState=kg(l),o.memoizedState=Tg,i):I_(o,w));if(y=i.memoizedState,y!==null&&(d=y.dehydrated,d!==null))return F3(i,o,w,m,d,y,l);if(T){T=m.fallback,w=o.mode,y=i.child,d=y.sibling;var O={mode:"hidden",children:m.children};return!(w&1)&&o.child!==y?(m=o.child,m.childLanes=0,m.pendingProps=O,o.deletions=null):(m=$s(y,O),m.subtreeFlags=y.subtreeFlags&14680064),d!==null?T=$s(d,T):(T=Ra(T,w,l,null),T.flags|=2),T.return=o,m.return=o,m.sibling=T,o.child=m,m=T,T=o.child,w=i.child.memoizedState,w=w===null?kg(l):{baseLanes:w.baseLanes|l,cachePool:null,transitions:w.transitions},T.memoizedState=w,T.childLanes=i.childLanes&~l,o.memoizedState=Tg,m}return T=i.child,i=T.sibling,m=$s(T,{mode:"visible",children:m.children}),!(o.mode&1)&&(m.lanes=l),m.return=o,m.sibling=null,i!==null&&(l=o.deletions,l===null?(o.deletions=[i],o.flags|=16):l.push(i)),o.child=m,o.memoizedState=null,m}function I_(i,o){return o=Np({mode:"visible",children:o},i.mode,0,null),o.return=i,i.child=o}function Rd(i,o,l,m){return m!==null&&d_(m),lu(o,i.child,null,l),i=I_(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function F3(i,o,l,m,y,T,w){if(l)return o.flags&256?(o.flags&=-257,m=Dm(Error(Me(422))),Rd(i,o,w,m)):o.memoizedState!==null?(o.child=i.child,o.flags|=128,null):(T=m.fallback,y=o.mode,m=Np({mode:"visible",children:m.children},y,0,null),T=Ra(T,y,w,null),T.flags|=2,m.return=o,T.return=o,m.sibling=T,o.child=m,o.mode&1&&lu(o,i.child,null,w),o.child.memoizedState=kg(w),o.memoizedState=Tg,T);if(!(o.mode&1))return Rd(i,o,w,null);if(y.data==="$!"){if(m=y.nextSibling&&y.nextSibling.dataset,m)var d=m.dgst;return m=d,T=Error(Me(419)),m=Dm(T,m,void 0),Rd(i,o,w,m)}if(d=(w&i.childLanes)!==0,Vn||d){if(m=$i,m!==null){switch(w&-w){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}y=y&(m.suspendedLanes|w)?0:y,y!==0&&y!==T.retryLane&&(T.retryLane=y,$o(i,y),Wr(m,i,y,-1))}return A_(),m=Dm(Error(Me(421))),Rd(i,o,w,m)}return y.data==="$?"?(o.flags|=128,o.child=i.child,o=X3.bind(null,i),y._reactRetry=o,null):(i=T.treeContext,lr=Ns(y.nextSibling),cr=o,ui=!0,Zr=null,i!==null&&(Cr[Pr++]=Oo,Cr[Pr++]=No,Cr[Pr++]=Ba,Oo=i.id,No=i.overflow,Ba=o),o=I_(o,m.children),o.flags|=4096,o)}function Tv(i,o,l){i.lanes|=o;var m=i.alternate;m!==null&&(m.lanes|=o),yg(i.return,o,l)}function Lm(i,o,l,m,y){var T=i.memoizedState;T===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:l,tailMode:y}:(T.isBackwards=o,T.rendering=null,T.renderingStartTime=0,T.last=m,T.tail=l,T.tailMode=y)}function Gx(i,o,l){var m=o.pendingProps,y=m.revealOrder,T=m.tail;if(In(i,o,m.children,l),m=di.current,m&2)m=m&1|2,o.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Tv(i,l,o);else if(i.tag===19)Tv(i,l,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}m&=1}if(Qt(di,m),!(o.mode&1))o.memoizedState=null;else switch(y){case"forwards":for(l=o.child,y=null;l!==null;)i=l.alternate,i!==null&&mp(i)===null&&(y=l),l=l.sibling;l=y,l===null?(y=o.child,o.child=null):(y=l.sibling,l.sibling=null),Lm(o,!1,y,l,T);break;case"backwards":for(l=null,y=o.child,o.child=null;y!==null;){if(i=y.alternate,i!==null&&mp(i)===null){o.child=y;break}i=y.sibling,y.sibling=l,l=y,y=i}Lm(o,!0,l,null,T);break;case"together":Lm(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Xd(i,o){!(o.mode&1)&&i!==null&&(i.alternate=null,o.alternate=null,o.flags|=2)}function qo(i,o,l){if(i!==null&&(o.dependencies=i.dependencies),Na|=o.lanes,!(l&o.childLanes))return null;if(i!==null&&o.child!==i.child)throw Error(Me(153));if(o.child!==null){for(i=o.child,l=$s(i,i.pendingProps),o.child=l,l.return=o;i.sibling!==null;)i=i.sibling,l=l.sibling=$s(i,i.pendingProps),l.return=o;l.sibling=null}return o.child}function B3(i,o,l){switch(o.tag){case 3:qx(o),au();break;case 5:yx(o);break;case 1:Un(o.type)&&up(o);break;case 4:y_(o,o.stateNode.containerInfo);break;case 10:var m=o.type._context,y=o.memoizedProps.value;Qt(dp,m._currentValue),m._currentValue=y;break;case 13:if(m=o.memoizedState,m!==null)return m.dehydrated!==null?(Qt(di,di.current&1),o.flags|=128,null):l&o.child.childLanes?Zx(i,o,l):(Qt(di,di.current&1),i=qo(i,o,l),i!==null?i.sibling:null);Qt(di,di.current&1);break;case 19:if(m=(l&o.childLanes)!==0,i.flags&128){if(m)return Gx(i,o,l);o.flags|=128}if(y=o.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),Qt(di,di.current),m)break;return null;case 22:case 23:return o.lanes=0,Ux(i,o,l)}return qo(i,o,l)}var Hx,Ig,Wx,Xx;Hx=function(i,o){for(var l=o.child;l!==null;){if(l.tag===5||l.tag===6)i.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};Ig=function(){};Wx=function(i,o,l,m){var y=i.memoizedProps;if(y!==m){i=o.stateNode,Da(fo.current);var T=null;switch(l){case"input":y=Wm(i,y),m=Wm(i,m),T=[];break;case"select":y=fi({},y,{value:void 0}),m=fi({},m,{value:void 0}),T=[];break;case"textarea":y=Ym(i,y),m=Ym(i,m),T=[];break;default:typeof y.onClick!="function"&&typeof m.onClick=="function"&&(i.onclick=ap)}Qm(l,m);var w;l=null;for(W in y)if(!m.hasOwnProperty(W)&&y.hasOwnProperty(W)&&y[W]!=null)if(W==="style"){var d=y[W];for(w in d)d.hasOwnProperty(w)&&(l||(l={}),l[w]="")}else W!=="dangerouslySetInnerHTML"&&W!=="children"&&W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(Wc.hasOwnProperty(W)?T||(T=[]):(T=T||[]).push(W,null));for(W in m){var O=m[W];if(d=y!=null?y[W]:void 0,m.hasOwnProperty(W)&&O!==d&&(O!=null||d!=null))if(W==="style")if(d){for(w in d)!d.hasOwnProperty(w)||O&&O.hasOwnProperty(w)||(l||(l={}),l[w]="");for(w in O)O.hasOwnProperty(w)&&d[w]!==O[w]&&(l||(l={}),l[w]=O[w])}else l||(T||(T=[]),T.push(W,l)),l=O;else W==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,d=d?d.__html:void 0,O!=null&&d!==O&&(T=T||[]).push(W,O)):W==="children"?typeof O!="string"&&typeof O!="number"||(T=T||[]).push(W,""+O):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&(Wc.hasOwnProperty(W)?(O!=null&&W==="onScroll"&&ni("scroll",i),T||d===O||(T=[])):(T=T||[]).push(W,O))}l&&(T=T||[]).push("style",l);var W=T;(o.updateQueue=W)&&(o.flags|=4)}};Xx=function(i,o,l,m){l!==m&&(o.flags|=4)};function Mc(i,o){if(!ui)switch(i.tailMode){case"hidden":o=i.tail;for(var l=null;o!==null;)o.alternate!==null&&(l=o),o=o.sibling;l===null?i.tail=null:l.sibling=null;break;case"collapsed":l=i.tail;for(var m=null;l!==null;)l.alternate!==null&&(m=l),l=l.sibling;m===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:m.sibling=null}}function fn(i){var o=i.alternate!==null&&i.alternate.child===i.child,l=0,m=0;if(o)for(var y=i.child;y!==null;)l|=y.lanes|y.childLanes,m|=y.subtreeFlags&14680064,m|=y.flags&14680064,y.return=i,y=y.sibling;else for(y=i.child;y!==null;)l|=y.lanes|y.childLanes,m|=y.subtreeFlags,m|=y.flags,y.return=i,y=y.sibling;return i.subtreeFlags|=m,i.childLanes=l,o}function O3(i,o,l){var m=o.pendingProps;switch(h_(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fn(o),null;case 1:return Un(o.type)&&lp(),fn(o),null;case 3:return m=o.stateNode,uu(),ri(jn),ri(_n),x_(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(i===null||i.child===null)&&(Dd(o)?o.flags|=4:i===null||i.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,Zr!==null&&(Lg(Zr),Zr=null))),Ig(i,o),fn(o),null;case 5:v_(o);var y=Da(sh.current);if(l=o.type,i!==null&&o.stateNode!=null)Wx(i,o,l,m,y),i.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!m){if(o.stateNode===null)throw Error(Me(166));return fn(o),null}if(i=Da(fo.current),Dd(o)){m=o.stateNode,l=o.type;var T=o.memoizedProps;switch(m[ho]=o,m[rh]=T,i=(o.mode&1)!==0,l){case"dialog":ni("cancel",m),ni("close",m);break;case"iframe":case"object":case"embed":ni("load",m);break;case"video":case"audio":for(y=0;y<Bc.length;y++)ni(Bc[y],m);break;case"source":ni("error",m);break;case"img":case"image":case"link":ni("error",m),ni("load",m);break;case"details":ni("toggle",m);break;case"input":D0(m,T),ni("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!T.multiple},ni("invalid",m);break;case"textarea":R0(m,T),ni("invalid",m)}Qm(l,T),y=null;for(var w in T)if(T.hasOwnProperty(w)){var d=T[w];w==="children"?typeof d=="string"?m.textContent!==d&&(T.suppressHydrationWarning!==!0&&Ad(m.textContent,d,i),y=["children",d]):typeof d=="number"&&m.textContent!==""+d&&(T.suppressHydrationWarning!==!0&&Ad(m.textContent,d,i),y=["children",""+d]):Wc.hasOwnProperty(w)&&d!=null&&w==="onScroll"&&ni("scroll",m)}switch(l){case"input":Td(m),L0(m,T,!0);break;case"textarea":Td(m),F0(m);break;case"select":case"option":break;default:typeof T.onClick=="function"&&(m.onclick=ap)}m=y,o.updateQueue=m,m!==null&&(o.flags|=4)}else{w=y.nodeType===9?y:y.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=S1(l)),i==="http://www.w3.org/1999/xhtml"?l==="script"?(i=w.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof m.is=="string"?i=w.createElement(l,{is:m.is}):(i=w.createElement(l),l==="select"&&(w=i,m.multiple?w.multiple=!0:m.size&&(w.size=m.size))):i=w.createElementNS(i,l),i[ho]=o,i[rh]=m,Hx(i,o,!1,!1),o.stateNode=i;e:{switch(w=eg(l,m),l){case"dialog":ni("cancel",i),ni("close",i),y=m;break;case"iframe":case"object":case"embed":ni("load",i),y=m;break;case"video":case"audio":for(y=0;y<Bc.length;y++)ni(Bc[y],i);y=m;break;case"source":ni("error",i),y=m;break;case"img":case"image":case"link":ni("error",i),ni("load",i),y=m;break;case"details":ni("toggle",i),y=m;break;case"input":D0(i,m),y=Wm(i,m),ni("invalid",i);break;case"option":y=m;break;case"select":i._wrapperState={wasMultiple:!!m.multiple},y=fi({},m,{value:void 0}),ni("invalid",i);break;case"textarea":R0(i,m),y=Ym(i,m),ni("invalid",i);break;default:y=m}Qm(l,y),d=y;for(T in d)if(d.hasOwnProperty(T)){var O=d[T];T==="style"?I1(i,O):T==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,O!=null&&T1(i,O)):T==="children"?typeof O=="string"?(l!=="textarea"||O!=="")&&Xc(i,O):typeof O=="number"&&Xc(i,""+O):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(Wc.hasOwnProperty(T)?O!=null&&T==="onScroll"&&ni("scroll",i):O!=null&&Kg(i,T,O,w))}switch(l){case"input":Td(i),L0(i,m,!1);break;case"textarea":Td(i),F0(i);break;case"option":m.value!=null&&i.setAttribute("value",""+qs(m.value));break;case"select":i.multiple=!!m.multiple,T=m.value,T!=null?Ql(i,!!m.multiple,T,!1):m.defaultValue!=null&&Ql(i,!!m.multiple,m.defaultValue,!0);break;default:typeof y.onClick=="function"&&(i.onclick=ap)}switch(l){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return fn(o),null;case 6:if(i&&o.stateNode!=null)Xx(i,o,i.memoizedProps,m);else{if(typeof m!="string"&&o.stateNode===null)throw Error(Me(166));if(l=Da(sh.current),Da(fo.current),Dd(o)){if(m=o.stateNode,l=o.memoizedProps,m[ho]=o,(T=m.nodeValue!==l)&&(i=cr,i!==null))switch(i.tag){case 3:Ad(m.nodeValue,l,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Ad(m.nodeValue,l,(i.mode&1)!==0)}T&&(o.flags|=4)}else m=(l.nodeType===9?l:l.ownerDocument).createTextNode(m),m[ho]=o,o.stateNode=m}return fn(o),null;case 13:if(ri(di),m=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(ui&&lr!==null&&o.mode&1&&!(o.flags&128))px(),au(),o.flags|=98560,T=!1;else if(T=Dd(o),m!==null&&m.dehydrated!==null){if(i===null){if(!T)throw Error(Me(318));if(T=o.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(Me(317));T[ho]=o}else au(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;fn(o),T=!1}else Zr!==null&&(Lg(Zr),Zr=null),T=!0;if(!T)return o.flags&65536?o:null}return o.flags&128?(o.lanes=l,o):(m=m!==null,m!==(i!==null&&i.memoizedState!==null)&&m&&(o.child.flags|=8192,o.mode&1&&(i===null||di.current&1?Ai===0&&(Ai=3):A_())),o.updateQueue!==null&&(o.flags|=4),fn(o),null);case 4:return uu(),Ig(i,o),i===null&&ih(o.stateNode.containerInfo),fn(o),null;case 10:return m_(o.type._context),fn(o),null;case 17:return Un(o.type)&&lp(),fn(o),null;case 19:if(ri(di),T=o.memoizedState,T===null)return fn(o),null;if(m=(o.flags&128)!==0,w=T.rendering,w===null)if(m)Mc(T,!1);else{if(Ai!==0||i!==null&&i.flags&128)for(i=o.child;i!==null;){if(w=mp(i),w!==null){for(o.flags|=128,Mc(T,!1),m=w.updateQueue,m!==null&&(o.updateQueue=m,o.flags|=4),o.subtreeFlags=0,m=l,l=o.child;l!==null;)T=l,i=m,T.flags&=14680066,w=T.alternate,w===null?(T.childLanes=0,T.lanes=i,T.child=null,T.subtreeFlags=0,T.memoizedProps=null,T.memoizedState=null,T.updateQueue=null,T.dependencies=null,T.stateNode=null):(T.childLanes=w.childLanes,T.lanes=w.lanes,T.child=w.child,T.subtreeFlags=0,T.deletions=null,T.memoizedProps=w.memoizedProps,T.memoizedState=w.memoizedState,T.updateQueue=w.updateQueue,T.type=w.type,i=w.dependencies,T.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),l=l.sibling;return Qt(di,di.current&1|2),o.child}i=i.sibling}T.tail!==null&&xi()>hu&&(o.flags|=128,m=!0,Mc(T,!1),o.lanes=4194304)}else{if(!m)if(i=mp(w),i!==null){if(o.flags|=128,m=!0,l=i.updateQueue,l!==null&&(o.updateQueue=l,o.flags|=4),Mc(T,!0),T.tail===null&&T.tailMode==="hidden"&&!w.alternate&&!ui)return fn(o),null}else 2*xi()-T.renderingStartTime>hu&&l!==1073741824&&(o.flags|=128,m=!0,Mc(T,!1),o.lanes=4194304);T.isBackwards?(w.sibling=o.child,o.child=w):(l=T.last,l!==null?l.sibling=w:o.child=w,T.last=w)}return T.tail!==null?(o=T.tail,T.rendering=o,T.tail=o.sibling,T.renderingStartTime=xi(),o.sibling=null,l=di.current,Qt(di,m?l&1|2:l&1),o):(fn(o),null);case 22:case 23:return z_(),m=o.memoizedState!==null,i!==null&&i.memoizedState!==null!==m&&(o.flags|=8192),m&&o.mode&1?ar&1073741824&&(fn(o),o.subtreeFlags&6&&(o.flags|=8192)):fn(o),null;case 24:return null;case 25:return null}throw Error(Me(156,o.tag))}function N3(i,o){switch(h_(o),o.tag){case 1:return Un(o.type)&&lp(),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return uu(),ri(jn),ri(_n),x_(),i=o.flags,i&65536&&!(i&128)?(o.flags=i&-65537|128,o):null;case 5:return v_(o),null;case 13:if(ri(di),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(Me(340));au()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return ri(di),null;case 4:return uu(),null;case 10:return m_(o.type._context),null;case 22:case 23:return z_(),null;case 24:return null;default:return null}}var Fd=!1,mn=!1,V3=typeof WeakSet=="function"?WeakSet:Set,it=null;function Yl(i,o){var l=i.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(m){yi(i,o,m)}else l.current=null}function Eg(i,o,l){try{l()}catch(m){yi(i,o,m)}}var kv=!1;function j3(i,o){if(cg=rp,i=ex(),u_(i)){if("selectionStart"in i)var l={start:i.selectionStart,end:i.selectionEnd};else e:{l=(l=i.ownerDocument)&&l.defaultView||window;var m=l.getSelection&&l.getSelection();if(m&&m.rangeCount!==0){l=m.anchorNode;var y=m.anchorOffset,T=m.focusNode;m=m.focusOffset;try{l.nodeType,T.nodeType}catch{l=null;break e}var w=0,d=-1,O=-1,W=0,oe=0,X=i,$=null;t:for(;;){for(var be;X!==l||y!==0&&X.nodeType!==3||(d=w+y),X!==T||m!==0&&X.nodeType!==3||(O=w+m),X.nodeType===3&&(w+=X.nodeValue.length),(be=X.firstChild)!==null;)$=X,X=be;for(;;){if(X===i)break t;if($===l&&++W===y&&(d=w),$===T&&++oe===m&&(O=w),(be=X.nextSibling)!==null)break;X=$,$=X.parentNode}X=be}l=d===-1||O===-1?null:{start:d,end:O}}else l=null}l=l||{start:0,end:0}}else l=null;for(hg={focusedElem:i,selectionRange:l},rp=!1,it=o;it!==null;)if(o=it,i=o.child,(o.subtreeFlags&1028)!==0&&i!==null)i.return=o,it=i;else for(;it!==null;){o=it;try{var Te=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Te!==null){var Ie=Te.memoizedProps,Qe=Te.memoizedState,ue=o.stateNode,ie=ue.getSnapshotBeforeUpdate(o.elementType===o.type?Ie:$r(o.type,Ie),Qe);ue.__reactInternalSnapshotBeforeUpdate=ie}break;case 3:var se=o.stateNode.containerInfo;se.nodeType===1?se.textContent="":se.nodeType===9&&se.documentElement&&se.removeChild(se.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Me(163))}}catch(xe){yi(o,o.return,xe)}if(i=o.sibling,i!==null){i.return=o.return,it=i;break}it=o.return}return Te=kv,kv=!1,Te}function Zc(i,o,l){var m=o.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var y=m=m.next;do{if((y.tag&i)===i){var T=y.destroy;y.destroy=void 0,T!==void 0&&Eg(o,l,T)}y=y.next}while(y!==m)}}function Bp(i,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var l=o=o.next;do{if((l.tag&i)===i){var m=l.create;l.destroy=m()}l=l.next}while(l!==o)}}function Cg(i){var o=i.ref;if(o!==null){var l=i.stateNode;switch(i.tag){case 5:i=l;break;default:i=l}typeof o=="function"?o(i):o.current=i}}function Kx(i){var o=i.alternate;o!==null&&(i.alternate=null,Kx(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&(delete o[ho],delete o[rh],delete o[fg],delete o[S3],delete o[T3])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function Yx(i){return i.tag===5||i.tag===3||i.tag===4}function Iv(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Yx(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Pg(i,o,l){var m=i.tag;if(m===5||m===6)i=i.stateNode,o?l.nodeType===8?l.parentNode.insertBefore(i,o):l.insertBefore(i,o):(l.nodeType===8?(o=l.parentNode,o.insertBefore(i,l)):(o=l,o.appendChild(i)),l=l._reactRootContainer,l!=null||o.onclick!==null||(o.onclick=ap));else if(m!==4&&(i=i.child,i!==null))for(Pg(i,o,l),i=i.sibling;i!==null;)Pg(i,o,l),i=i.sibling}function Mg(i,o,l){var m=i.tag;if(m===5||m===6)i=i.stateNode,o?l.insertBefore(i,o):l.appendChild(i);else if(m!==4&&(i=i.child,i!==null))for(Mg(i,o,l),i=i.sibling;i!==null;)Mg(i,o,l),i=i.sibling}var Yi=null,qr=!1;function Ps(i,o,l){for(l=l.child;l!==null;)Jx(i,o,l),l=l.sibling}function Jx(i,o,l){if(po&&typeof po.onCommitFiberUnmount=="function")try{po.onCommitFiberUnmount(Pp,l)}catch{}switch(l.tag){case 5:mn||Yl(l,o);case 6:var m=Yi,y=qr;Yi=null,Ps(i,o,l),Yi=m,qr=y,Yi!==null&&(qr?(i=Yi,l=l.stateNode,i.nodeType===8?i.parentNode.removeChild(l):i.removeChild(l)):Yi.removeChild(l.stateNode));break;case 18:Yi!==null&&(qr?(i=Yi,l=l.stateNode,i.nodeType===8?Em(i.parentNode,l):i.nodeType===1&&Em(i,l),Qc(i)):Em(Yi,l.stateNode));break;case 4:m=Yi,y=qr,Yi=l.stateNode.containerInfo,qr=!0,Ps(i,o,l),Yi=m,qr=y;break;case 0:case 11:case 14:case 15:if(!mn&&(m=l.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){y=m=m.next;do{var T=y,w=T.destroy;T=T.tag,w!==void 0&&(T&2||T&4)&&Eg(l,o,w),y=y.next}while(y!==m)}Ps(i,o,l);break;case 1:if(!mn&&(Yl(l,o),m=l.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=l.memoizedProps,m.state=l.memoizedState,m.componentWillUnmount()}catch(d){yi(l,o,d)}Ps(i,o,l);break;case 21:Ps(i,o,l);break;case 22:l.mode&1?(mn=(m=mn)||l.memoizedState!==null,Ps(i,o,l),mn=m):Ps(i,o,l);break;default:Ps(i,o,l)}}function Ev(i){var o=i.updateQueue;if(o!==null){i.updateQueue=null;var l=i.stateNode;l===null&&(l=i.stateNode=new V3),o.forEach(function(m){var y=K3.bind(null,i,m);l.has(m)||(l.add(m),m.then(y,y))})}}function Ur(i,o){var l=o.deletions;if(l!==null)for(var m=0;m<l.length;m++){var y=l[m];try{var T=i,w=o,d=w;e:for(;d!==null;){switch(d.tag){case 5:Yi=d.stateNode,qr=!1;break e;case 3:Yi=d.stateNode.containerInfo,qr=!0;break e;case 4:Yi=d.stateNode.containerInfo,qr=!0;break e}d=d.return}if(Yi===null)throw Error(Me(160));Jx(T,w,y),Yi=null,qr=!1;var O=y.alternate;O!==null&&(O.return=null),y.return=null}catch(W){yi(y,o,W)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)Qx(o,i),o=o.sibling}function Qx(i,o){var l=i.alternate,m=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Ur(o,i),uo(i),m&4){try{Zc(3,i,i.return),Bp(3,i)}catch(Ie){yi(i,i.return,Ie)}try{Zc(5,i,i.return)}catch(Ie){yi(i,i.return,Ie)}}break;case 1:Ur(o,i),uo(i),m&512&&l!==null&&Yl(l,l.return);break;case 5:if(Ur(o,i),uo(i),m&512&&l!==null&&Yl(l,l.return),i.flags&32){var y=i.stateNode;try{Xc(y,"")}catch(Ie){yi(i,i.return,Ie)}}if(m&4&&(y=i.stateNode,y!=null)){var T=i.memoizedProps,w=l!==null?l.memoizedProps:T,d=i.type,O=i.updateQueue;if(i.updateQueue=null,O!==null)try{d==="input"&&T.type==="radio"&&T.name!=null&&w1(y,T),eg(d,w);var W=eg(d,T);for(w=0;w<O.length;w+=2){var oe=O[w],X=O[w+1];oe==="style"?I1(y,X):oe==="dangerouslySetInnerHTML"?T1(y,X):oe==="children"?Xc(y,X):Kg(y,oe,X,W)}switch(d){case"input":Xm(y,T);break;case"textarea":b1(y,T);break;case"select":var $=y._wrapperState.wasMultiple;y._wrapperState.wasMultiple=!!T.multiple;var be=T.value;be!=null?Ql(y,!!T.multiple,be,!1):$!==!!T.multiple&&(T.defaultValue!=null?Ql(y,!!T.multiple,T.defaultValue,!0):Ql(y,!!T.multiple,T.multiple?[]:"",!1))}y[rh]=T}catch(Ie){yi(i,i.return,Ie)}}break;case 6:if(Ur(o,i),uo(i),m&4){if(i.stateNode===null)throw Error(Me(162));y=i.stateNode,T=i.memoizedProps;try{y.nodeValue=T}catch(Ie){yi(i,i.return,Ie)}}break;case 3:if(Ur(o,i),uo(i),m&4&&l!==null&&l.memoizedState.isDehydrated)try{Qc(o.containerInfo)}catch(Ie){yi(i,i.return,Ie)}break;case 4:Ur(o,i),uo(i);break;case 13:Ur(o,i),uo(i),y=i.child,y.flags&8192&&(T=y.memoizedState!==null,y.stateNode.isHidden=T,!T||y.alternate!==null&&y.alternate.memoizedState!==null||(P_=xi())),m&4&&Ev(i);break;case 22:if(oe=l!==null&&l.memoizedState!==null,i.mode&1?(mn=(W=mn)||oe,Ur(o,i),mn=W):Ur(o,i),uo(i),m&8192){if(W=i.memoizedState!==null,(i.stateNode.isHidden=W)&&!oe&&i.mode&1)for(it=i,oe=i.child;oe!==null;){for(X=it=oe;it!==null;){switch($=it,be=$.child,$.tag){case 0:case 11:case 14:case 15:Zc(4,$,$.return);break;case 1:Yl($,$.return);var Te=$.stateNode;if(typeof Te.componentWillUnmount=="function"){m=$,l=$.return;try{o=m,Te.props=o.memoizedProps,Te.state=o.memoizedState,Te.componentWillUnmount()}catch(Ie){yi(m,l,Ie)}}break;case 5:Yl($,$.return);break;case 22:if($.memoizedState!==null){Pv(X);continue}}be!==null?(be.return=$,it=be):Pv(X)}oe=oe.sibling}e:for(oe=null,X=i;;){if(X.tag===5){if(oe===null){oe=X;try{y=X.stateNode,W?(T=y.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none"):(d=X.stateNode,O=X.memoizedProps.style,w=O!=null&&O.hasOwnProperty("display")?O.display:null,d.style.display=k1("display",w))}catch(Ie){yi(i,i.return,Ie)}}}else if(X.tag===6){if(oe===null)try{X.stateNode.nodeValue=W?"":X.memoizedProps}catch(Ie){yi(i,i.return,Ie)}}else if((X.tag!==22&&X.tag!==23||X.memoizedState===null||X===i)&&X.child!==null){X.child.return=X,X=X.child;continue}if(X===i)break e;for(;X.sibling===null;){if(X.return===null||X.return===i)break e;oe===X&&(oe=null),X=X.return}oe===X&&(oe=null),X.sibling.return=X.return,X=X.sibling}}break;case 19:Ur(o,i),uo(i),m&4&&Ev(i);break;case 21:break;default:Ur(o,i),uo(i)}}function uo(i){var o=i.flags;if(o&2){try{e:{for(var l=i.return;l!==null;){if(Yx(l)){var m=l;break e}l=l.return}throw Error(Me(160))}switch(m.tag){case 5:var y=m.stateNode;m.flags&32&&(Xc(y,""),m.flags&=-33);var T=Iv(i);Mg(i,T,y);break;case 3:case 4:var w=m.stateNode.containerInfo,d=Iv(i);Pg(i,d,w);break;default:throw Error(Me(161))}}catch(O){yi(i,i.return,O)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function U3(i,o,l){it=i,ew(i)}function ew(i,o,l){for(var m=(i.mode&1)!==0;it!==null;){var y=it,T=y.child;if(y.tag===22&&m){var w=y.memoizedState!==null||Fd;if(!w){var d=y.alternate,O=d!==null&&d.memoizedState!==null||mn;d=Fd;var W=mn;if(Fd=w,(mn=O)&&!W)for(it=y;it!==null;)w=it,O=w.child,w.tag===22&&w.memoizedState!==null?Mv(y):O!==null?(O.return=w,it=O):Mv(y);for(;T!==null;)it=T,ew(T),T=T.sibling;it=y,Fd=d,mn=W}Cv(i)}else y.subtreeFlags&8772&&T!==null?(T.return=y,it=T):Cv(i)}}function Cv(i){for(;it!==null;){var o=it;if(o.flags&8772){var l=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:mn||Bp(5,o);break;case 1:var m=o.stateNode;if(o.flags&4&&!mn)if(l===null)m.componentDidMount();else{var y=o.elementType===o.type?l.memoizedProps:$r(o.type,l.memoizedProps);m.componentDidUpdate(y,l.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var T=o.updateQueue;T!==null&&dv(o,T,m);break;case 3:var w=o.updateQueue;if(w!==null){if(l=null,o.child!==null)switch(o.child.tag){case 5:l=o.child.stateNode;break;case 1:l=o.child.stateNode}dv(o,w,l)}break;case 5:var d=o.stateNode;if(l===null&&o.flags&4){l=d;var O=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":O.autoFocus&&l.focus();break;case"img":O.src&&(l.src=O.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var W=o.alternate;if(W!==null){var oe=W.memoizedState;if(oe!==null){var X=oe.dehydrated;X!==null&&Qc(X)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Me(163))}mn||o.flags&512&&Cg(o)}catch($){yi(o,o.return,$)}}if(o===i){it=null;break}if(l=o.sibling,l!==null){l.return=o.return,it=l;break}it=o.return}}function Pv(i){for(;it!==null;){var o=it;if(o===i){it=null;break}var l=o.sibling;if(l!==null){l.return=o.return,it=l;break}it=o.return}}function Mv(i){for(;it!==null;){var o=it;try{switch(o.tag){case 0:case 11:case 15:var l=o.return;try{Bp(4,o)}catch(O){yi(o,l,O)}break;case 1:var m=o.stateNode;if(typeof m.componentDidMount=="function"){var y=o.return;try{m.componentDidMount()}catch(O){yi(o,y,O)}}var T=o.return;try{Cg(o)}catch(O){yi(o,T,O)}break;case 5:var w=o.return;try{Cg(o)}catch(O){yi(o,w,O)}}}catch(O){yi(o,o.return,O)}if(o===i){it=null;break}var d=o.sibling;if(d!==null){d.return=o.return,it=d;break}it=o.return}}var $3=Math.ceil,yp=Go.ReactCurrentDispatcher,E_=Go.ReactCurrentOwner,zr=Go.ReactCurrentBatchConfig,Ft=0,$i=null,Ei=null,Ji=0,ar=0,Jl=Ws(0),Ai=0,ch=null,Na=0,Op=0,C_=0,Gc=null,Nn=null,P_=0,hu=1/0,Fo=null,vp=!1,zg=null,js=null,Bd=!1,Rs=null,xp=0,Hc=0,Ag=null,Kd=-1,Yd=0;function En(){return Ft&6?xi():Kd!==-1?Kd:Kd=xi()}function Us(i){return i.mode&1?Ft&2&&Ji!==0?Ji&-Ji:I3.transition!==null?(Yd===0&&(Yd=O1()),Yd):(i=Gt,i!==0||(i=window.event,i=i===void 0?16:Z1(i.type)),i):1}function Wr(i,o,l,m){if(50<Hc)throw Hc=0,Ag=null,Error(Me(185));fh(i,l,m),(!(Ft&2)||i!==$i)&&(i===$i&&(!(Ft&2)&&(Op|=l),Ai===4&&Ds(i,Ji)),$n(i,m),l===1&&Ft===0&&!(o.mode&1)&&(hu=xi()+500,Lp&&Xs()))}function $n(i,o){var l=i.callbackNode;I4(i,o);var m=np(i,i===$i?Ji:0);if(m===0)l!==null&&N0(l),i.callbackNode=null,i.callbackPriority=0;else if(o=m&-m,i.callbackPriority!==o){if(l!=null&&N0(l),o===1)i.tag===0?k3(zv.bind(null,i)):cx(zv.bind(null,i)),w3(function(){!(Ft&6)&&Xs()}),l=null;else{switch(N1(m)){case 1:l=t_;break;case 4:l=F1;break;case 16:l=ip;break;case 536870912:l=B1;break;default:l=ip}l=lw(l,tw.bind(null,i))}i.callbackPriority=o,i.callbackNode=l}}function tw(i,o){if(Kd=-1,Yd=0,Ft&6)throw Error(Me(327));var l=i.callbackNode;if(ru()&&i.callbackNode!==l)return null;var m=np(i,i===$i?Ji:0);if(m===0)return null;if(m&30||m&i.expiredLanes||o)o=wp(i,m);else{o=m;var y=Ft;Ft|=2;var T=nw();($i!==i||Ji!==o)&&(Fo=null,hu=xi()+500,La(i,o));do try{G3();break}catch(d){iw(i,d)}while(!0);f_(),yp.current=T,Ft=y,Ei!==null?o=0:($i=null,Ji=0,o=Ai)}if(o!==0){if(o===2&&(y=og(i),y!==0&&(m=y,o=Dg(i,y))),o===1)throw l=ch,La(i,0),Ds(i,m),$n(i,xi()),l;if(o===6)Ds(i,m);else{if(y=i.current.alternate,!(m&30)&&!q3(y)&&(o=wp(i,m),o===2&&(T=og(i),T!==0&&(m=T,o=Dg(i,T))),o===1))throw l=ch,La(i,0),Ds(i,m),$n(i,xi()),l;switch(i.finishedWork=y,i.finishedLanes=m,o){case 0:case 1:throw Error(Me(345));case 2:Ca(i,Nn,Fo);break;case 3:if(Ds(i,m),(m&130023424)===m&&(o=P_+500-xi(),10<o)){if(np(i,0)!==0)break;if(y=i.suspendedLanes,(y&m)!==m){En(),i.pingedLanes|=i.suspendedLanes&y;break}i.timeoutHandle=pg(Ca.bind(null,i,Nn,Fo),o);break}Ca(i,Nn,Fo);break;case 4:if(Ds(i,m),(m&4194240)===m)break;for(o=i.eventTimes,y=-1;0<m;){var w=31-Hr(m);T=1<<w,w=o[w],w>y&&(y=w),m&=~T}if(m=y,m=xi()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*$3(m/1960))-m,10<m){i.timeoutHandle=pg(Ca.bind(null,i,Nn,Fo),m);break}Ca(i,Nn,Fo);break;case 5:Ca(i,Nn,Fo);break;default:throw Error(Me(329))}}}return $n(i,xi()),i.callbackNode===l?tw.bind(null,i):null}function Dg(i,o){var l=Gc;return i.current.memoizedState.isDehydrated&&(La(i,o).flags|=256),i=wp(i,o),i!==2&&(o=Nn,Nn=l,o!==null&&Lg(o)),i}function Lg(i){Nn===null?Nn=i:Nn.push.apply(Nn,i)}function q3(i){for(var o=i;;){if(o.flags&16384){var l=o.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var m=0;m<l.length;m++){var y=l[m],T=y.getSnapshot;y=y.value;try{if(!Xr(T(),y))return!1}catch{return!1}}}if(l=o.child,o.subtreeFlags&16384&&l!==null)l.return=o,o=l;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ds(i,o){for(o&=~C_,o&=~Op,i.suspendedLanes|=o,i.pingedLanes&=~o,i=i.expirationTimes;0<o;){var l=31-Hr(o),m=1<<l;i[l]=-1,o&=~m}}function zv(i){if(Ft&6)throw Error(Me(327));ru();var o=np(i,0);if(!(o&1))return $n(i,xi()),null;var l=wp(i,o);if(i.tag!==0&&l===2){var m=og(i);m!==0&&(o=m,l=Dg(i,m))}if(l===1)throw l=ch,La(i,0),Ds(i,o),$n(i,xi()),l;if(l===6)throw Error(Me(345));return i.finishedWork=i.current.alternate,i.finishedLanes=o,Ca(i,Nn,Fo),$n(i,xi()),null}function M_(i,o){var l=Ft;Ft|=1;try{return i(o)}finally{Ft=l,Ft===0&&(hu=xi()+500,Lp&&Xs())}}function Va(i){Rs!==null&&Rs.tag===0&&!(Ft&6)&&ru();var o=Ft;Ft|=1;var l=zr.transition,m=Gt;try{if(zr.transition=null,Gt=1,i)return i()}finally{Gt=m,zr.transition=l,Ft=o,!(Ft&6)&&Xs()}}function z_(){ar=Jl.current,ri(Jl)}function La(i,o){i.finishedWork=null,i.finishedLanes=0;var l=i.timeoutHandle;if(l!==-1&&(i.timeoutHandle=-1,x3(l)),Ei!==null)for(l=Ei.return;l!==null;){var m=l;switch(h_(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&lp();break;case 3:uu(),ri(jn),ri(_n),x_();break;case 5:v_(m);break;case 4:uu();break;case 13:ri(di);break;case 19:ri(di);break;case 10:m_(m.type._context);break;case 22:case 23:z_()}l=l.return}if($i=i,Ei=i=$s(i.current,null),Ji=ar=o,Ai=0,ch=null,C_=Op=Na=0,Nn=Gc=null,Aa!==null){for(o=0;o<Aa.length;o++)if(l=Aa[o],m=l.interleaved,m!==null){l.interleaved=null;var y=m.next,T=l.pending;if(T!==null){var w=T.next;T.next=y,m.next=w}l.pending=m}Aa=null}return i}function iw(i,o){do{var l=Ei;try{if(f_(),Hd.current=_p,gp){for(var m=pi.memoizedState;m!==null;){var y=m.queue;y!==null&&(y.pending=null),m=m.next}gp=!1}if(Oa=0,Ui=zi=pi=null,qc=!1,ah=0,E_.current=null,l===null||l.return===null){Ai=1,ch=o,Ei=null;break}e:{var T=i,w=l.return,d=l,O=o;if(o=Ji,d.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){var W=O,oe=d,X=oe.tag;if(!(oe.mode&1)&&(X===0||X===11||X===15)){var $=oe.alternate;$?(oe.updateQueue=$.updateQueue,oe.memoizedState=$.memoizedState,oe.lanes=$.lanes):(oe.updateQueue=null,oe.memoizedState=null)}var be=yv(w);if(be!==null){be.flags&=-257,vv(be,w,d,T,o),be.mode&1&&_v(T,W,o),o=be,O=W;var Te=o.updateQueue;if(Te===null){var Ie=new Set;Ie.add(O),o.updateQueue=Ie}else Te.add(O);break e}else{if(!(o&1)){_v(T,W,o),A_();break e}O=Error(Me(426))}}else if(ui&&d.mode&1){var Qe=yv(w);if(Qe!==null){!(Qe.flags&65536)&&(Qe.flags|=256),vv(Qe,w,d,T,o),d_(cu(O,d));break e}}T=O=cu(O,d),Ai!==4&&(Ai=2),Gc===null?Gc=[T]:Gc.push(T),T=w;do{switch(T.tag){case 3:T.flags|=65536,o&=-o,T.lanes|=o;var ue=Nx(T,O,o);hv(T,ue);break e;case 1:d=O;var ie=T.type,se=T.stateNode;if(!(T.flags&128)&&(typeof ie.getDerivedStateFromError=="function"||se!==null&&typeof se.componentDidCatch=="function"&&(js===null||!js.has(se)))){T.flags|=65536,o&=-o,T.lanes|=o;var xe=Vx(T,d,o);hv(T,xe);break e}}T=T.return}while(T!==null)}ow(l)}catch(Pe){o=Pe,Ei===l&&l!==null&&(Ei=l=l.return);continue}break}while(!0)}function nw(){var i=yp.current;return yp.current=_p,i===null?_p:i}function A_(){(Ai===0||Ai===3||Ai===2)&&(Ai=4),$i===null||!(Na&268435455)&&!(Op&268435455)||Ds($i,Ji)}function wp(i,o){var l=Ft;Ft|=2;var m=nw();($i!==i||Ji!==o)&&(Fo=null,La(i,o));do try{Z3();break}catch(y){iw(i,y)}while(!0);if(f_(),Ft=l,yp.current=m,Ei!==null)throw Error(Me(261));return $i=null,Ji=0,Ai}function Z3(){for(;Ei!==null;)rw(Ei)}function G3(){for(;Ei!==null&&!_4();)rw(Ei)}function rw(i){var o=aw(i.alternate,i,ar);i.memoizedProps=i.pendingProps,o===null?ow(i):Ei=o,E_.current=null}function ow(i){var o=i;do{var l=o.alternate;if(i=o.return,o.flags&32768){if(l=N3(l,o),l!==null){l.flags&=32767,Ei=l;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Ai=6,Ei=null;return}}else if(l=O3(l,o,ar),l!==null){Ei=l;return}if(o=o.sibling,o!==null){Ei=o;return}Ei=o=i}while(o!==null);Ai===0&&(Ai=5)}function Ca(i,o,l){var m=Gt,y=zr.transition;try{zr.transition=null,Gt=1,H3(i,o,l,m)}finally{zr.transition=y,Gt=m}return null}function H3(i,o,l,m){do ru();while(Rs!==null);if(Ft&6)throw Error(Me(327));l=i.finishedWork;var y=i.finishedLanes;if(l===null)return null;if(i.finishedWork=null,i.finishedLanes=0,l===i.current)throw Error(Me(177));i.callbackNode=null,i.callbackPriority=0;var T=l.lanes|l.childLanes;if(E4(i,T),i===$i&&(Ei=$i=null,Ji=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||Bd||(Bd=!0,lw(ip,function(){return ru(),null})),T=(l.flags&15990)!==0,l.subtreeFlags&15990||T){T=zr.transition,zr.transition=null;var w=Gt;Gt=1;var d=Ft;Ft|=4,E_.current=null,j3(i,l),Qx(l,i),p3(hg),rp=!!cg,hg=cg=null,i.current=l,U3(l),y4(),Ft=d,Gt=w,zr.transition=T}else i.current=l;if(Bd&&(Bd=!1,Rs=i,xp=y),T=i.pendingLanes,T===0&&(js=null),w4(l.stateNode),$n(i,xi()),o!==null)for(m=i.onRecoverableError,l=0;l<o.length;l++)y=o[l],m(y.value,{componentStack:y.stack,digest:y.digest});if(vp)throw vp=!1,i=zg,zg=null,i;return xp&1&&i.tag!==0&&ru(),T=i.pendingLanes,T&1?i===Ag?Hc++:(Hc=0,Ag=i):Hc=0,Xs(),null}function ru(){if(Rs!==null){var i=N1(xp),o=zr.transition,l=Gt;try{if(zr.transition=null,Gt=16>i?16:i,Rs===null)var m=!1;else{if(i=Rs,Rs=null,xp=0,Ft&6)throw Error(Me(331));var y=Ft;for(Ft|=4,it=i.current;it!==null;){var T=it,w=T.child;if(it.flags&16){var d=T.deletions;if(d!==null){for(var O=0;O<d.length;O++){var W=d[O];for(it=W;it!==null;){var oe=it;switch(oe.tag){case 0:case 11:case 15:Zc(8,oe,T)}var X=oe.child;if(X!==null)X.return=oe,it=X;else for(;it!==null;){oe=it;var $=oe.sibling,be=oe.return;if(Kx(oe),oe===W){it=null;break}if($!==null){$.return=be,it=$;break}it=be}}}var Te=T.alternate;if(Te!==null){var Ie=Te.child;if(Ie!==null){Te.child=null;do{var Qe=Ie.sibling;Ie.sibling=null,Ie=Qe}while(Ie!==null)}}it=T}}if(T.subtreeFlags&2064&&w!==null)w.return=T,it=w;else e:for(;it!==null;){if(T=it,T.flags&2048)switch(T.tag){case 0:case 11:case 15:Zc(9,T,T.return)}var ue=T.sibling;if(ue!==null){ue.return=T.return,it=ue;break e}it=T.return}}var ie=i.current;for(it=ie;it!==null;){w=it;var se=w.child;if(w.subtreeFlags&2064&&se!==null)se.return=w,it=se;else e:for(w=ie;it!==null;){if(d=it,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:Bp(9,d)}}catch(Pe){yi(d,d.return,Pe)}if(d===w){it=null;break e}var xe=d.sibling;if(xe!==null){xe.return=d.return,it=xe;break e}it=d.return}}if(Ft=y,Xs(),po&&typeof po.onPostCommitFiberRoot=="function")try{po.onPostCommitFiberRoot(Pp,i)}catch{}m=!0}return m}finally{Gt=l,zr.transition=o}}return!1}function Av(i,o,l){o=cu(l,o),o=Nx(i,o,1),i=Vs(i,o,1),o=En(),i!==null&&(fh(i,1,o),$n(i,o))}function yi(i,o,l){if(i.tag===3)Av(i,i,l);else for(;o!==null;){if(o.tag===3){Av(o,i,l);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(js===null||!js.has(m))){i=cu(l,i),i=Vx(o,i,1),o=Vs(o,i,1),i=En(),o!==null&&(fh(o,1,i),$n(o,i));break}}o=o.return}}function W3(i,o,l){var m=i.pingCache;m!==null&&m.delete(o),o=En(),i.pingedLanes|=i.suspendedLanes&l,$i===i&&(Ji&l)===l&&(Ai===4||Ai===3&&(Ji&130023424)===Ji&&500>xi()-P_?La(i,0):C_|=l),$n(i,o)}function sw(i,o){o===0&&(i.mode&1?(o=Ed,Ed<<=1,!(Ed&130023424)&&(Ed=4194304)):o=1);var l=En();i=$o(i,o),i!==null&&(fh(i,o,l),$n(i,l))}function X3(i){var o=i.memoizedState,l=0;o!==null&&(l=o.retryLane),sw(i,l)}function K3(i,o){var l=0;switch(i.tag){case 13:var m=i.stateNode,y=i.memoizedState;y!==null&&(l=y.retryLane);break;case 19:m=i.stateNode;break;default:throw Error(Me(314))}m!==null&&m.delete(o),sw(i,l)}var aw;aw=function(i,o,l){if(i!==null)if(i.memoizedProps!==o.pendingProps||jn.current)Vn=!0;else{if(!(i.lanes&l)&&!(o.flags&128))return Vn=!1,B3(i,o,l);Vn=!!(i.flags&131072)}else Vn=!1,ui&&o.flags&1048576&&hx(o,hp,o.index);switch(o.lanes=0,o.tag){case 2:var m=o.type;Xd(i,o),i=o.pendingProps;var y=su(o,_n.current);nu(o,l),y=b_(null,o,m,i,y,l);var T=S_();return o.flags|=1,typeof y=="object"&&y!==null&&typeof y.render=="function"&&y.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Un(m)?(T=!0,up(o)):T=!1,o.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,__(o),y.updater=Fp,o.stateNode=y,y._reactInternals=o,xg(o,m,i,l),o=Sg(null,o,m,!0,T,l)):(o.tag=0,ui&&T&&c_(o),In(null,o,y,l),o=o.child),o;case 16:m=o.elementType;e:{switch(Xd(i,o),i=o.pendingProps,y=m._init,m=y(m._payload),o.type=m,y=o.tag=J3(m),i=$r(m,i),y){case 0:o=bg(null,o,m,i,l);break e;case 1:o=bv(null,o,m,i,l);break e;case 11:o=xv(null,o,m,i,l);break e;case 14:o=wv(null,o,m,$r(m.type,i),l);break e}throw Error(Me(306,m,""))}return o;case 0:return m=o.type,y=o.pendingProps,y=o.elementType===m?y:$r(m,y),bg(i,o,m,y,l);case 1:return m=o.type,y=o.pendingProps,y=o.elementType===m?y:$r(m,y),bv(i,o,m,y,l);case 3:e:{if(qx(o),i===null)throw Error(Me(387));m=o.pendingProps,T=o.memoizedState,y=T.element,_x(i,o),fp(o,m,null,l);var w=o.memoizedState;if(m=w.element,T.isDehydrated)if(T={element:m,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},o.updateQueue.baseState=T,o.memoizedState=T,o.flags&256){y=cu(Error(Me(423)),o),o=Sv(i,o,m,l,y);break e}else if(m!==y){y=cu(Error(Me(424)),o),o=Sv(i,o,m,l,y);break e}else for(lr=Ns(o.stateNode.containerInfo.firstChild),cr=o,ui=!0,Zr=null,l=mx(o,null,m,l),o.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(au(),m===y){o=qo(i,o,l);break e}In(i,o,m,l)}o=o.child}return o;case 5:return yx(o),i===null&&_g(o),m=o.type,y=o.pendingProps,T=i!==null?i.memoizedProps:null,w=y.children,dg(m,y)?w=null:T!==null&&dg(m,T)&&(o.flags|=32),$x(i,o),In(i,o,w,l),o.child;case 6:return i===null&&_g(o),null;case 13:return Zx(i,o,l);case 4:return y_(o,o.stateNode.containerInfo),m=o.pendingProps,i===null?o.child=lu(o,null,m,l):In(i,o,m,l),o.child;case 11:return m=o.type,y=o.pendingProps,y=o.elementType===m?y:$r(m,y),xv(i,o,m,y,l);case 7:return In(i,o,o.pendingProps,l),o.child;case 8:return In(i,o,o.pendingProps.children,l),o.child;case 12:return In(i,o,o.pendingProps.children,l),o.child;case 10:e:{if(m=o.type._context,y=o.pendingProps,T=o.memoizedProps,w=y.value,Qt(dp,m._currentValue),m._currentValue=w,T!==null)if(Xr(T.value,w)){if(T.children===y.children&&!jn.current){o=qo(i,o,l);break e}}else for(T=o.child,T!==null&&(T.return=o);T!==null;){var d=T.dependencies;if(d!==null){w=T.child;for(var O=d.firstContext;O!==null;){if(O.context===m){if(T.tag===1){O=Vo(-1,l&-l),O.tag=2;var W=T.updateQueue;if(W!==null){W=W.shared;var oe=W.pending;oe===null?O.next=O:(O.next=oe.next,oe.next=O),W.pending=O}}T.lanes|=l,O=T.alternate,O!==null&&(O.lanes|=l),yg(T.return,l,o),d.lanes|=l;break}O=O.next}}else if(T.tag===10)w=T.type===o.type?null:T.child;else if(T.tag===18){if(w=T.return,w===null)throw Error(Me(341));w.lanes|=l,d=w.alternate,d!==null&&(d.lanes|=l),yg(w,l,o),w=T.sibling}else w=T.child;if(w!==null)w.return=T;else for(w=T;w!==null;){if(w===o){w=null;break}if(T=w.sibling,T!==null){T.return=w.return,w=T;break}w=w.return}T=w}In(i,o,y.children,l),o=o.child}return o;case 9:return y=o.type,m=o.pendingProps.children,nu(o,l),y=Ar(y),m=m(y),o.flags|=1,In(i,o,m,l),o.child;case 14:return m=o.type,y=$r(m,o.pendingProps),y=$r(m.type,y),wv(i,o,m,y,l);case 15:return jx(i,o,o.type,o.pendingProps,l);case 17:return m=o.type,y=o.pendingProps,y=o.elementType===m?y:$r(m,y),Xd(i,o),o.tag=1,Un(m)?(i=!0,up(o)):i=!1,nu(o,l),Ox(o,m,y),xg(o,m,y,l),Sg(null,o,m,!0,i,l);case 19:return Gx(i,o,l);case 22:return Ux(i,o,l)}throw Error(Me(156,o.tag))};function lw(i,o){return R1(i,o)}function Y3(i,o,l,m){this.tag=i,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mr(i,o,l,m){return new Y3(i,o,l,m)}function D_(i){return i=i.prototype,!(!i||!i.isReactComponent)}function J3(i){if(typeof i=="function")return D_(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Jg)return 11;if(i===Qg)return 14}return 2}function $s(i,o){var l=i.alternate;return l===null?(l=Mr(i.tag,o,i.key,i.mode),l.elementType=i.elementType,l.type=i.type,l.stateNode=i.stateNode,l.alternate=i,i.alternate=l):(l.pendingProps=o,l.type=i.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=i.flags&14680064,l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,o=i.dependencies,l.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},l.sibling=i.sibling,l.index=i.index,l.ref=i.ref,l}function Jd(i,o,l,m,y,T){var w=2;if(m=i,typeof i=="function")D_(i)&&(w=1);else if(typeof i=="string")w=5;else e:switch(i){case Ul:return Ra(l.children,y,T,o);case Yg:w=8,y|=8;break;case qm:return i=Mr(12,l,o,y|2),i.elementType=qm,i.lanes=T,i;case Zm:return i=Mr(13,l,o,y),i.elementType=Zm,i.lanes=T,i;case Gm:return i=Mr(19,l,o,y),i.elementType=Gm,i.lanes=T,i;case y1:return Np(l,y,T,o);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case g1:w=10;break e;case _1:w=9;break e;case Jg:w=11;break e;case Qg:w=14;break e;case Ms:w=16,m=null;break e}throw Error(Me(130,i==null?i:typeof i,""))}return o=Mr(w,l,o,y),o.elementType=i,o.type=m,o.lanes=T,o}function Ra(i,o,l,m){return i=Mr(7,i,m,o),i.lanes=l,i}function Np(i,o,l,m){return i=Mr(22,i,m,o),i.elementType=y1,i.lanes=l,i.stateNode={isHidden:!1},i}function Rm(i,o,l){return i=Mr(6,i,null,o),i.lanes=l,i}function Fm(i,o,l){return o=Mr(4,i.children!==null?i.children:[],i.key,o),o.lanes=l,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}function Q3(i,o,l,m,y){this.tag=o,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gm(0),this.expirationTimes=gm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gm(0),this.identifierPrefix=m,this.onRecoverableError=y,this.mutableSourceEagerHydrationData=null}function L_(i,o,l,m,y,T,w,d,O){return i=new Q3(i,o,l,d,O),o===1?(o=1,T===!0&&(o|=8)):o=0,T=Mr(3,null,null,o),i.current=T,T.stateNode=i,T.memoizedState={element:m,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},__(T),i}function e5(i,o,l){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:jl,key:m==null?null:""+m,children:i,containerInfo:o,implementation:l}}function uw(i){if(!i)return Zs;i=i._reactInternals;e:{if(Za(i)!==i||i.tag!==1)throw Error(Me(170));var o=i;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Un(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Me(171))}if(i.tag===1){var l=i.type;if(Un(l))return ux(i,l,o)}return o}function cw(i,o,l,m,y,T,w,d,O){return i=L_(l,m,!0,i,y,T,w,d,O),i.context=uw(null),l=i.current,m=En(),y=Us(l),T=Vo(m,y),T.callback=o??null,Vs(l,T,y),i.current.lanes=y,fh(i,y,m),$n(i,m),i}function Vp(i,o,l,m){var y=o.current,T=En(),w=Us(y);return l=uw(l),o.context===null?o.context=l:o.pendingContext=l,o=Vo(T,w),o.payload={element:i},m=m===void 0?null:m,m!==null&&(o.callback=m),i=Vs(y,o,w),i!==null&&(Wr(i,y,w,T),Gd(i,y,w)),w}function bp(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Dv(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var l=i.retryLane;i.retryLane=l!==0&&l<o?l:o}}function R_(i,o){Dv(i,o),(i=i.alternate)&&Dv(i,o)}function t5(){return null}var hw=typeof reportError=="function"?reportError:function(i){console.error(i)};function F_(i){this._internalRoot=i}jp.prototype.render=F_.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(Me(409));Vp(i,o,null,null)};jp.prototype.unmount=F_.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;Va(function(){Vp(null,i,null,null)}),o[Uo]=null}};function jp(i){this._internalRoot=i}jp.prototype.unstable_scheduleHydration=function(i){if(i){var o=U1();i={blockedOn:null,target:i,priority:o};for(var l=0;l<As.length&&o!==0&&o<As[l].priority;l++);As.splice(l,0,i),l===0&&q1(i)}};function B_(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Up(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Lv(){}function i5(i,o,l,m,y){if(y){if(typeof m=="function"){var T=m;m=function(){var W=bp(w);T.call(W)}}var w=cw(o,m,i,0,null,!1,!1,"",Lv);return i._reactRootContainer=w,i[Uo]=w.current,ih(i.nodeType===8?i.parentNode:i),Va(),w}for(;y=i.lastChild;)i.removeChild(y);if(typeof m=="function"){var d=m;m=function(){var W=bp(O);d.call(W)}}var O=L_(i,0,!1,null,null,!1,!1,"",Lv);return i._reactRootContainer=O,i[Uo]=O.current,ih(i.nodeType===8?i.parentNode:i),Va(function(){Vp(o,O,l,m)}),O}function $p(i,o,l,m,y){var T=l._reactRootContainer;if(T){var w=T;if(typeof y=="function"){var d=y;y=function(){var O=bp(w);d.call(O)}}Vp(o,w,i,y)}else w=i5(l,o,i,y,m);return bp(w)}V1=function(i){switch(i.tag){case 3:var o=i.stateNode;if(o.current.memoizedState.isDehydrated){var l=Fc(o.pendingLanes);l!==0&&(i_(o,l|1),$n(o,xi()),!(Ft&6)&&(hu=xi()+500,Xs()))}break;case 13:Va(function(){var m=$o(i,1);if(m!==null){var y=En();Wr(m,i,1,y)}}),R_(i,1)}};n_=function(i){if(i.tag===13){var o=$o(i,134217728);if(o!==null){var l=En();Wr(o,i,134217728,l)}R_(i,134217728)}};j1=function(i){if(i.tag===13){var o=Us(i),l=$o(i,o);if(l!==null){var m=En();Wr(l,i,o,m)}R_(i,o)}};U1=function(){return Gt};$1=function(i,o){var l=Gt;try{return Gt=i,o()}finally{Gt=l}};ig=function(i,o,l){switch(o){case"input":if(Xm(i,l),o=l.name,l.type==="radio"&&o!=null){for(l=i;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<l.length;o++){var m=l[o];if(m!==i&&m.form===i.form){var y=Dp(m);if(!y)throw Error(Me(90));x1(m),Xm(m,y)}}}break;case"textarea":b1(i,l);break;case"select":o=l.value,o!=null&&Ql(i,!!l.multiple,o,!1)}};P1=M_;M1=Va;var n5={usingClientEntryPoint:!1,Events:[gh,Gl,Dp,E1,C1,M_]},zc={findFiberByHostInstance:za,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},r5={bundleType:zc.bundleType,version:zc.version,rendererPackageName:zc.rendererPackageName,rendererConfig:zc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Go.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=D1(i),i===null?null:i.stateNode},findFiberByHostInstance:zc.findFiberByHostInstance||t5,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Od=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Od.isDisabled&&Od.supportsFiber)try{Pp=Od.inject(r5),po=Od}catch{}}fr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=n5;fr.createPortal=function(i,o){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!B_(o))throw Error(Me(200));return e5(i,o,null,l)};fr.createRoot=function(i,o){if(!B_(i))throw Error(Me(299));var l=!1,m="",y=hw;return o!=null&&(o.unstable_strictMode===!0&&(l=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onRecoverableError!==void 0&&(y=o.onRecoverableError)),o=L_(i,1,!1,null,null,l,!1,m,y),i[Uo]=o.current,ih(i.nodeType===8?i.parentNode:i),new F_(o)};fr.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(Me(188)):(i=Object.keys(i).join(","),Error(Me(268,i)));return i=D1(o),i=i===null?null:i.stateNode,i};fr.flushSync=function(i){return Va(i)};fr.hydrate=function(i,o,l){if(!Up(o))throw Error(Me(200));return $p(null,i,o,!0,l)};fr.hydrateRoot=function(i,o,l){if(!B_(i))throw Error(Me(405));var m=l!=null&&l.hydratedSources||null,y=!1,T="",w=hw;if(l!=null&&(l.unstable_strictMode===!0&&(y=!0),l.identifierPrefix!==void 0&&(T=l.identifierPrefix),l.onRecoverableError!==void 0&&(w=l.onRecoverableError)),o=cw(o,null,i,1,l??null,y,!1,T,w),i[Uo]=o.current,ih(i),m)for(i=0;i<m.length;i++)l=m[i],y=l._getVersion,y=y(l._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[l,y]:o.mutableSourceEagerHydrationData.push(l,y);return new jp(o)};fr.render=function(i,o,l){if(!Up(o))throw Error(Me(200));return $p(null,i,o,!1,l)};fr.unmountComponentAtNode=function(i){if(!Up(i))throw Error(Me(40));return i._reactRootContainer?(Va(function(){$p(null,null,i,!1,function(){i._reactRootContainer=null,i[Uo]=null})}),!0):!1};fr.unstable_batchedUpdates=M_;fr.unstable_renderSubtreeIntoContainer=function(i,o,l,m){if(!Up(l))throw Error(Me(200));if(i==null||i._reactInternals===void 0)throw Error(Me(38));return $p(i,o,l,!1,m)};fr.version="18.3.1-next-f1338f8080-20240426";function dw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(dw)}catch(i){console.error(i)}}dw(),d1.exports=fr;var o5=d1.exports,Rv=o5;Um.createRoot=Rv.createRoot,Um.hydrateRoot=Rv.hydrateRoot;var pw={exports:{}},fw={};/**
 * @license React
 * use-sync-external-store-with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yh=bt;function s5(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var a5=typeof Object.is=="function"?Object.is:s5,l5=yh.useSyncExternalStore,u5=yh.useRef,c5=yh.useEffect,h5=yh.useMemo,d5=yh.useDebugValue;fw.useSyncExternalStoreWithSelector=function(i,o,l,m,y){var T=u5(null);if(T.current===null){var w={hasValue:!1,value:null};T.current=w}else w=T.current;T=h5(function(){function O(be){if(!W){if(W=!0,oe=be,be=m(be),y!==void 0&&w.hasValue){var Te=w.value;if(y(Te,be))return X=Te}return X=be}if(Te=X,a5(oe,be))return Te;var Ie=m(be);return y!==void 0&&y(Te,Ie)?Te:(oe=be,X=Ie)}var W=!1,oe,X,$=l===void 0?null:l;return[function(){return O(o())},$===null?void 0:function(){return O($())}]},[o,l,m,y]);var d=l5(i,T[0],T[1]);return c5(function(){w.hasValue=!0,w.value=d},[d]),d5(d),d};pw.exports=fw;var p5=pw.exports,ur="default"in P0?Hg:P0,Fv=Symbol.for("react-redux-context"),Bv=typeof globalThis<"u"?globalThis:{};function f5(){if(!ur.createContext)return{};const i=Bv[Fv]??(Bv[Fv]=new Map);let o=i.get(ur.createContext);return o||(o=ur.createContext(null),i.set(ur.createContext,o)),o}var Gs=f5(),m5=()=>{throw new Error("uSES not initialized!")};function O_(i=Gs){return function(){return ur.useContext(i)}}var mw=O_(),gw=m5,g5=i=>{gw=i},_5=(i,o)=>i===o;function y5(i=Gs){const o=i===Gs?mw:O_(i),l=(m,y={})=>{const{equalityFn:T=_5,devModeChecks:w={}}=typeof y=="function"?{equalityFn:y}:y,{store:d,subscription:O,getServerState:W,stabilityCheck:oe,identityFunctionCheck:X}=o();ur.useRef(!0);const $=ur.useCallback({[m.name](Te){return m(Te)}}[m.name],[m,oe,w.stabilityCheck]),be=gw(O.addNestedSub,d.getState,W||d.getState,$,T);return ur.useDebugValue(be),be};return Object.assign(l,{withTypes:()=>l}),l}var qn=y5();function v5(i){i()}function x5(){let i=null,o=null;return{clear(){i=null,o=null},notify(){v5(()=>{let l=i;for(;l;)l.callback(),l=l.next})},get(){const l=[];let m=i;for(;m;)l.push(m),m=m.next;return l},subscribe(l){let m=!0;const y=o={callback:l,next:null,prev:o};return y.prev?y.prev.next=y:i=y,function(){!m||i===null||(m=!1,y.next?y.next.prev=y.prev:o=y.prev,y.prev?y.prev.next=y.next:i=y.next)}}}}var Ov={notify(){},get:()=>[]};function w5(i,o){let l,m=Ov,y=0,T=!1;function w(Ie){oe();const Qe=m.subscribe(Ie);let ue=!1;return()=>{ue||(ue=!0,Qe(),X())}}function d(){m.notify()}function O(){Te.onStateChange&&Te.onStateChange()}function W(){return T}function oe(){y++,l||(l=i.subscribe(O),m=x5())}function X(){y--,l&&y===0&&(l(),l=void 0,m.clear(),m=Ov)}function $(){T||(T=!0,oe())}function be(){T&&(T=!1,X())}const Te={addNestedSub:w,notifyNestedSubs:d,handleChangeWrapper:O,isSubscribed:W,trySubscribe:$,tryUnsubscribe:be,getListeners:()=>m};return Te}var b5=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",S5=typeof navigator<"u"&&navigator.product==="ReactNative",T5=b5||S5?ur.useLayoutEffect:ur.useEffect;function k5({store:i,context:o,children:l,serverState:m,stabilityCheck:y="once",identityFunctionCheck:T="once"}){const w=ur.useMemo(()=>{const W=w5(i);return{store:i,subscription:W,getServerState:m?()=>m:void 0,stabilityCheck:y,identityFunctionCheck:T}},[i,m,y,T]),d=ur.useMemo(()=>i.getState(),[i]);T5(()=>{const{subscription:W}=w;return W.onStateChange=W.notifyNestedSubs,W.trySubscribe(),d!==i.getState()&&W.notifyNestedSubs(),()=>{W.tryUnsubscribe(),W.onStateChange=void 0}},[w,d]);const O=o||Gs;return ur.createElement(O.Provider,{value:w},l)}var I5=k5;function _w(i=Gs){const o=i===Gs?mw:O_(i),l=()=>{const{store:m}=o();return m};return Object.assign(l,{withTypes:()=>l}),l}var E5=_w();function C5(i=Gs){const o=i===Gs?E5:_w(i),l=()=>o().dispatch;return Object.assign(l,{withTypes:()=>l}),l}var N_=C5();g5(p5.useSyncExternalStoreWithSelector);function P5(i,o){var l=0,m=0,y=0,T=0,w=0,d=0,O=0,W=0,oe=null,X=null,$=i[0],be=i[1],Te=o.length;for(l;l<Te;l++){m=0;var Ie=o[l].length-1,Qe=o[l];if(oe=Qe[0],oe[0]!==Qe[Ie][0]&&oe[1]!==Qe[Ie][1])throw new Error("First and last coordinates in a ring must be the same");for(w=oe[0]-$,d=oe[1]-be,m;m<Ie;m++){if(X=Qe[m+1],W=X[1]-be,d<0&&W<0||d>0&&W>0){oe=X,d=W,w=oe[0]-$;continue}if(O=X[0]-i[0],W>0&&d<=0){if(T=w*W-O*d,T>0)y=y+1;else if(T===0)return 0}else if(d>0&&W<=0){if(T=w*W-O*d,T<0)y=y+1;else if(T===0)return 0}else if(W===0&&d<0){if(T=w*W-O*d,T===0)return 0}else if(d===0&&W<0){if(T=w*W-O*d,T===0)return 0}else if(d===0&&W===0){if(O<=0&&w>=0)return 0;if(w<=0&&O>=0)return 0}oe=X,d=W,w=O}}return y%2!==0}function M5(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return[...i.geometry.coordinates];if(i.type==="Point")return[...i.coordinates]}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return[...i];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function z5(i){return i.type==="Feature"?i.geometry:i}function A5(i,o,l={}){if(!i)throw new Error("point is required");if(!o)throw new Error("polygon is required");const m=M5(i),y=z5(o),T=y.type,w=o.bbox;let d=y.coordinates;if(w&&D5(m,w)===!1)return!1;T==="Polygon"&&(d=[d]);let O=!1;for(var W=0;W<d.length;++W){const oe=P5(m,d[W]);if(oe===0)return!l.ignoreBoundary;oe&&(O=!0)}return O}function D5(i,o){return o[0]<=i[0]&&o[1]<=i[1]&&o[2]>=i[0]&&o[3]>=i[1]}var L5=A5;const R5="modulepreload",F5=function(i){return"https://alexcrist.github.io/voice-atlas/"+i},Nv={},Rg=function(o,l,m){let y=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const w=document.querySelector("meta[property=csp-nonce]"),d=(w==null?void 0:w.nonce)||(w==null?void 0:w.getAttribute("nonce"));y=Promise.allSettled(l.map(O=>{if(O=F5(O),O in Nv)return;Nv[O]=!0;const W=O.endsWith(".css"),oe=W?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${O}"]${oe}`))return;const X=document.createElement("link");if(X.rel=W?"stylesheet":R5,W||(X.as="script"),X.crossOrigin="",X.href=O,d&&X.setAttribute("nonce",d),document.head.appendChild(X),W)return new Promise(($,be)=>{X.addEventListener("load",$),X.addEventListener("error",()=>be(new Error(`Unable to preload CSS for ${O}`)))})}))}function T(w){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=w,window.dispatchEvent(d),!d.defaultPrevented)throw w}return y.then(w=>{for(const d of w||[])d.status==="rejected"&&T(d.reason);return o().catch(T)})},B5=Rg(()=>import("./country-borders-P9p-TcxA.js"),[]),Fg={USA:Rg(()=>import("./state-borders-usa-_8J44aaB.js"),[]),CAN:Rg(()=>import("./state-borders-can-CwVHHxpH.js"),[])},O5=async()=>(await B5).default,N5=i=>i in Fg,V5=async i=>{if(!(i in Fg))throw Error(`Could not find state data for country ${i}`);return(await Fg[i]).default},yw=async(i,o)=>{i=xw(i);const l=await O5();for(let m=0;m<l.length;m++){const y=l[m];if(ww(i,o,y.bbox,y.geojson))return await U5(y)}return null},vw=async(i,o,l)=>{i=xw(i);for(let m=0;m<l.length;m++){const y=l[m];if(ww(i,o,y.bbox,y.geojson))return y}return null},xw=i=>{for(;i>180;)i-=360;for(;i<-180;)i+=360;return i},ww=(i,o,l,m)=>j5(i,o,l)?L5([i,o],m):!1,j5=(i,o,l)=>{const m=l[0],y=l[1],T=l[2],w=l[3];return i>=m&&i<=T&&o>=y&&o<=w},U5=async i=>{let o=null;return N5(i.codeIso3)&&(o=await V5(i.codeIso3)),{...i,statesData:o}},$5="_container_ppg42_1",q5={container:$5},Z5=({children:i,style:o})=>kt.jsx("div",{style:o,className:q5.container,children:i}),G5="_container_12zem_1",H5="_title_12zem_6",W5="_description_12zem_10",Bm={container:G5,title:H5,description:W5},Ma=({title:i,descriptions:o})=>kt.jsxs("div",{className:Bm.container,children:[i!==void 0&&kt.jsx("h2",{className:Bm.title,children:i}),o!==void 0&&o.map((l,m)=>kt.jsx("p",{className:Bm.description,children:l},m))]}),X5=()=>{const i=qn(o=>o.main.focusedCountry);return kt.jsx(kt.Fragment,{children:kt.jsx(Ma,{title:i.name,descriptions:[`Name: ${i.name}`,`Code: ${i.codeIso3}`]})})};function Ki(i){return`Minified Redux error #${i}; visit https://redux.js.org/Errors?code=${i} for the full message or use the non-minified dev environment for full errors. `}var K5=typeof Symbol=="function"&&Symbol.observable||"@@observable",Vv=K5,Om=()=>Math.random().toString(36).substring(7).split("").join("."),Y5={INIT:`@@redux/INIT${Om()}`,REPLACE:`@@redux/REPLACE${Om()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Om()}`},Sp=Y5;function V_(i){if(typeof i!="object"||i===null)return!1;let o=i;for(;Object.getPrototypeOf(o)!==null;)o=Object.getPrototypeOf(o);return Object.getPrototypeOf(i)===o||Object.getPrototypeOf(i)===null}function bw(i,o,l){if(typeof i!="function")throw new Error(Ki(2));if(typeof o=="function"&&typeof l=="function"||typeof l=="function"&&typeof arguments[3]=="function")throw new Error(Ki(0));if(typeof o=="function"&&typeof l>"u"&&(l=o,o=void 0),typeof l<"u"){if(typeof l!="function")throw new Error(Ki(1));return l(bw)(i,o)}let m=i,y=o,T=new Map,w=T,d=0,O=!1;function W(){w===T&&(w=new Map,T.forEach((Qe,ue)=>{w.set(ue,Qe)}))}function oe(){if(O)throw new Error(Ki(3));return y}function X(Qe){if(typeof Qe!="function")throw new Error(Ki(4));if(O)throw new Error(Ki(5));let ue=!0;W();const ie=d++;return w.set(ie,Qe),function(){if(ue){if(O)throw new Error(Ki(6));ue=!1,W(),w.delete(ie),T=null}}}function $(Qe){if(!V_(Qe))throw new Error(Ki(7));if(typeof Qe.type>"u")throw new Error(Ki(8));if(typeof Qe.type!="string")throw new Error(Ki(17));if(O)throw new Error(Ki(9));try{O=!0,y=m(y,Qe)}finally{O=!1}return(T=w).forEach(ie=>{ie()}),Qe}function be(Qe){if(typeof Qe!="function")throw new Error(Ki(10));m=Qe,$({type:Sp.REPLACE})}function Te(){const Qe=X;return{subscribe(ue){if(typeof ue!="object"||ue===null)throw new Error(Ki(11));function ie(){const xe=ue;xe.next&&xe.next(oe())}return ie(),{unsubscribe:Qe(ie)}},[Vv](){return this}}}return $({type:Sp.INIT}),{dispatch:$,subscribe:X,getState:oe,replaceReducer:be,[Vv]:Te}}function J5(i){Object.keys(i).forEach(o=>{const l=i[o];if(typeof l(void 0,{type:Sp.INIT})>"u")throw new Error(Ki(12));if(typeof l(void 0,{type:Sp.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Ki(13))})}function Q5(i){const o=Object.keys(i),l={};for(let T=0;T<o.length;T++){const w=o[T];typeof i[w]=="function"&&(l[w]=i[w])}const m=Object.keys(l);let y;try{J5(l)}catch(T){y=T}return function(w={},d){if(y)throw y;let O=!1;const W={};for(let oe=0;oe<m.length;oe++){const X=m[oe],$=l[X],be=w[X],Te=$(be,d);if(typeof Te>"u")throw d&&d.type,new Error(Ki(14));W[X]=Te,O=O||Te!==be}return O=O||m.length!==Object.keys(w).length,O?W:w}}function Tp(...i){return i.length===0?o=>o:i.length===1?i[0]:i.reduce((o,l)=>(...m)=>o(l(...m)))}function eS(...i){return o=>(l,m)=>{const y=o(l,m);let T=()=>{throw new Error(Ki(15))};const w={getState:y.getState,dispatch:(O,...W)=>T(O,...W)},d=i.map(O=>O(w));return T=Tp(...d)(y.dispatch),{...y,dispatch:T}}}function tS(i){return V_(i)&&"type"in i&&typeof i.type=="string"}var Sw=Symbol.for("immer-nothing"),jv=Symbol.for("immer-draftable"),dr=Symbol.for("immer-state");function Gr(i,...o){throw new Error(`[Immer] minified error nr: ${i}. Full error at: https://bit.ly/3cXEKWf`)}var du=Object.getPrototypeOf;function ja(i){return!!i&&!!i[dr]}function Zo(i){var o;return i?Tw(i)||Array.isArray(i)||!!i[jv]||!!((o=i.constructor)!=null&&o[jv])||Zp(i)||Gp(i):!1}var iS=Object.prototype.constructor.toString();function Tw(i){if(!i||typeof i!="object")return!1;const o=du(i);if(o===null)return!0;const l=Object.hasOwnProperty.call(o,"constructor")&&o.constructor;return l===Object?!0:typeof l=="function"&&Function.toString.call(l)===iS}function kp(i,o){qp(i)===0?Reflect.ownKeys(i).forEach(l=>{o(l,i[l],i)}):i.forEach((l,m)=>o(m,l,i))}function qp(i){const o=i[dr];return o?o.type_:Array.isArray(i)?1:Zp(i)?2:Gp(i)?3:0}function Bg(i,o){return qp(i)===2?i.has(o):Object.prototype.hasOwnProperty.call(i,o)}function kw(i,o,l){const m=qp(i);m===2?i.set(o,l):m===3?i.add(l):i[o]=l}function nS(i,o){return i===o?i!==0||1/i===1/o:i!==i&&o!==o}function Zp(i){return i instanceof Map}function Gp(i){return i instanceof Set}function Pa(i){return i.copy_||i.base_}function Og(i,o){if(Zp(i))return new Map(i);if(Gp(i))return new Set(i);if(Array.isArray(i))return Array.prototype.slice.call(i);const l=Tw(i);if(o===!0||o==="class_only"&&!l){const m=Object.getOwnPropertyDescriptors(i);delete m[dr];let y=Reflect.ownKeys(m);for(let T=0;T<y.length;T++){const w=y[T],d=m[w];d.writable===!1&&(d.writable=!0,d.configurable=!0),(d.get||d.set)&&(m[w]={configurable:!0,writable:!0,enumerable:d.enumerable,value:i[w]})}return Object.create(du(i),m)}else{const m=du(i);if(m!==null&&l)return{...i};const y=Object.create(m);return Object.assign(y,i)}}function j_(i,o=!1){return Hp(i)||ja(i)||!Zo(i)||(qp(i)>1&&(i.set=i.add=i.clear=i.delete=rS),Object.freeze(i),o&&Object.entries(i).forEach(([l,m])=>j_(m,!0))),i}function rS(){Gr(2)}function Hp(i){return Object.isFrozen(i)}var oS={};function Ua(i){const o=oS[i];return o||Gr(0,i),o}var hh;function Iw(){return hh}function sS(i,o){return{drafts_:[],parent_:i,immer_:o,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Uv(i,o){o&&(Ua("Patches"),i.patches_=[],i.inversePatches_=[],i.patchListener_=o)}function Ng(i){Vg(i),i.drafts_.forEach(aS),i.drafts_=null}function Vg(i){i===hh&&(hh=i.parent_)}function $v(i){return hh=sS(hh,i)}function aS(i){const o=i[dr];o.type_===0||o.type_===1?o.revoke_():o.revoked_=!0}function qv(i,o){o.unfinalizedDrafts_=o.drafts_.length;const l=o.drafts_[0];return i!==void 0&&i!==l?(l[dr].modified_&&(Ng(o),Gr(4)),Zo(i)&&(i=Ip(o,i),o.parent_||Ep(o,i)),o.patches_&&Ua("Patches").generateReplacementPatches_(l[dr].base_,i,o.patches_,o.inversePatches_)):i=Ip(o,l,[]),Ng(o),o.patches_&&o.patchListener_(o.patches_,o.inversePatches_),i!==Sw?i:void 0}function Ip(i,o,l){if(Hp(o))return o;const m=o[dr];if(!m)return kp(o,(y,T)=>Zv(i,m,o,y,T,l)),o;if(m.scope_!==i)return o;if(!m.modified_)return Ep(i,m.base_,!0),m.base_;if(!m.finalized_){m.finalized_=!0,m.scope_.unfinalizedDrafts_--;const y=m.copy_;let T=y,w=!1;m.type_===3&&(T=new Set(y),y.clear(),w=!0),kp(T,(d,O)=>Zv(i,m,y,d,O,l,w)),Ep(i,y,!1),l&&i.patches_&&Ua("Patches").generatePatches_(m,l,i.patches_,i.inversePatches_)}return m.copy_}function Zv(i,o,l,m,y,T,w){if(ja(y)){const d=T&&o&&o.type_!==3&&!Bg(o.assigned_,m)?T.concat(m):void 0,O=Ip(i,y,d);if(kw(l,m,O),ja(O))i.canAutoFreeze_=!1;else return}else w&&l.add(y);if(Zo(y)&&!Hp(y)){if(!i.immer_.autoFreeze_&&i.unfinalizedDrafts_<1)return;Ip(i,y),(!o||!o.scope_.parent_)&&typeof m!="symbol"&&Object.prototype.propertyIsEnumerable.call(l,m)&&Ep(i,y)}}function Ep(i,o,l=!1){!i.parent_&&i.immer_.autoFreeze_&&i.canAutoFreeze_&&j_(o,l)}function lS(i,o){const l=Array.isArray(i),m={type_:l?1:0,scope_:o?o.scope_:Iw(),modified_:!1,finalized_:!1,assigned_:{},parent_:o,base_:i,draft_:null,copy_:null,revoke_:null,isManual_:!1};let y=m,T=U_;l&&(y=[m],T=dh);const{revoke:w,proxy:d}=Proxy.revocable(y,T);return m.draft_=d,m.revoke_=w,d}var U_={get(i,o){if(o===dr)return i;const l=Pa(i);if(!Bg(l,o))return uS(i,l,o);const m=l[o];return i.finalized_||!Zo(m)?m:m===Nm(i.base_,o)?(Vm(i),i.copy_[o]=Ug(m,i)):m},has(i,o){return o in Pa(i)},ownKeys(i){return Reflect.ownKeys(Pa(i))},set(i,o,l){const m=Ew(Pa(i),o);if(m!=null&&m.set)return m.set.call(i.draft_,l),!0;if(!i.modified_){const y=Nm(Pa(i),o),T=y==null?void 0:y[dr];if(T&&T.base_===l)return i.copy_[o]=l,i.assigned_[o]=!1,!0;if(nS(l,y)&&(l!==void 0||Bg(i.base_,o)))return!0;Vm(i),jg(i)}return i.copy_[o]===l&&(l!==void 0||o in i.copy_)||Number.isNaN(l)&&Number.isNaN(i.copy_[o])||(i.copy_[o]=l,i.assigned_[o]=!0),!0},deleteProperty(i,o){return Nm(i.base_,o)!==void 0||o in i.base_?(i.assigned_[o]=!1,Vm(i),jg(i)):delete i.assigned_[o],i.copy_&&delete i.copy_[o],!0},getOwnPropertyDescriptor(i,o){const l=Pa(i),m=Reflect.getOwnPropertyDescriptor(l,o);return m&&{writable:!0,configurable:i.type_!==1||o!=="length",enumerable:m.enumerable,value:l[o]}},defineProperty(){Gr(11)},getPrototypeOf(i){return du(i.base_)},setPrototypeOf(){Gr(12)}},dh={};kp(U_,(i,o)=>{dh[i]=function(){return arguments[0]=arguments[0][0],o.apply(this,arguments)}});dh.deleteProperty=function(i,o){return dh.set.call(this,i,o,void 0)};dh.set=function(i,o,l){return U_.set.call(this,i[0],o,l,i[0])};function Nm(i,o){const l=i[dr];return(l?Pa(l):i)[o]}function uS(i,o,l){var y;const m=Ew(o,l);return m?"value"in m?m.value:(y=m.get)==null?void 0:y.call(i.draft_):void 0}function Ew(i,o){if(!(o in i))return;let l=du(i);for(;l;){const m=Object.getOwnPropertyDescriptor(l,o);if(m)return m;l=du(l)}}function jg(i){i.modified_||(i.modified_=!0,i.parent_&&jg(i.parent_))}function Vm(i){i.copy_||(i.copy_=Og(i.base_,i.scope_.immer_.useStrictShallowCopy_))}var cS=class{constructor(i){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(o,l,m)=>{if(typeof o=="function"&&typeof l!="function"){const T=l;l=o;const w=this;return function(O=T,...W){return w.produce(O,oe=>l.call(this,oe,...W))}}typeof l!="function"&&Gr(6),m!==void 0&&typeof m!="function"&&Gr(7);let y;if(Zo(o)){const T=$v(this),w=Ug(o,void 0);let d=!0;try{y=l(w),d=!1}finally{d?Ng(T):Vg(T)}return Uv(T,m),qv(y,T)}else if(!o||typeof o!="object"){if(y=l(o),y===void 0&&(y=o),y===Sw&&(y=void 0),this.autoFreeze_&&j_(y,!0),m){const T=[],w=[];Ua("Patches").generateReplacementPatches_(o,y,T,w),m(T,w)}return y}else Gr(1,o)},this.produceWithPatches=(o,l)=>{if(typeof o=="function")return(w,...d)=>this.produceWithPatches(w,O=>o(O,...d));let m,y;return[this.produce(o,l,(w,d)=>{m=w,y=d}),m,y]},typeof(i==null?void 0:i.autoFreeze)=="boolean"&&this.setAutoFreeze(i.autoFreeze),typeof(i==null?void 0:i.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(i.useStrictShallowCopy)}createDraft(i){Zo(i)||Gr(8),ja(i)&&(i=hS(i));const o=$v(this),l=Ug(i,void 0);return l[dr].isManual_=!0,Vg(o),l}finishDraft(i,o){const l=i&&i[dr];(!l||!l.isManual_)&&Gr(9);const{scope_:m}=l;return Uv(m,o),qv(void 0,m)}setAutoFreeze(i){this.autoFreeze_=i}setUseStrictShallowCopy(i){this.useStrictShallowCopy_=i}applyPatches(i,o){let l;for(l=o.length-1;l>=0;l--){const y=o[l];if(y.path.length===0&&y.op==="replace"){i=y.value;break}}l>-1&&(o=o.slice(l+1));const m=Ua("Patches").applyPatches_;return ja(i)?m(i,o):this.produce(i,y=>m(y,o))}};function Ug(i,o){const l=Zp(i)?Ua("MapSet").proxyMap_(i,o):Gp(i)?Ua("MapSet").proxySet_(i,o):lS(i,o);return(o?o.scope_:Iw()).drafts_.push(l),l}function hS(i){return ja(i)||Gr(10,i),Cw(i)}function Cw(i){if(!Zo(i)||Hp(i))return i;const o=i[dr];let l;if(o){if(!o.modified_)return o.base_;o.finalized_=!0,l=Og(i,o.scope_.immer_.useStrictShallowCopy_)}else l=Og(i,!0);return kp(l,(m,y)=>{kw(l,m,Cw(y))}),o&&(o.finalized_=!1),l}var pr=new cS,Pw=pr.produce;pr.produceWithPatches.bind(pr);pr.setAutoFreeze.bind(pr);pr.setUseStrictShallowCopy.bind(pr);pr.applyPatches.bind(pr);pr.createDraft.bind(pr);pr.finishDraft.bind(pr);function Mw(i){return({dispatch:l,getState:m})=>y=>T=>typeof T=="function"?T(l,m,i):y(T)}var dS=Mw(),pS=Mw,fS=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Tp:Tp.apply(null,arguments)};function Gv(i,o){function l(...m){if(o){let y=o(...m);if(!y)throw new Error(mo(0));return{type:i,payload:y.payload,..."meta"in y&&{meta:y.meta},..."error"in y&&{error:y.error}}}return{type:i,payload:m[0]}}return l.toString=()=>`${i}`,l.type=i,l.match=m=>tS(m)&&m.type===i,l}var zw=class Oc extends Array{constructor(...o){super(...o),Object.setPrototypeOf(this,Oc.prototype)}static get[Symbol.species](){return Oc}concat(...o){return super.concat.apply(this,o)}prepend(...o){return o.length===1&&Array.isArray(o[0])?new Oc(...o[0].concat(this)):new Oc(...o.concat(this))}};function Hv(i){return Zo(i)?Pw(i,()=>{}):i}function Wv(i,o,l){if(i.has(o)){let y=i.get(o);return l.update&&(y=l.update(y,o,i),i.set(o,y)),y}if(!l.insert)throw new Error(mo(10));const m=l.insert(o,i);return i.set(o,m),m}function mS(i){return typeof i=="boolean"}var gS=()=>function(o){const{thunk:l=!0,immutableCheck:m=!0,serializableCheck:y=!0,actionCreatorCheck:T=!0}=o??{};let w=new zw;return l&&(mS(l)?w.push(dS):w.push(pS(l.extraArgument))),w},_S="RTK_autoBatch",Aw=i=>o=>{setTimeout(o,i)},yS=typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Aw(10),vS=(i={type:"raf"})=>o=>(...l)=>{const m=o(...l);let y=!0,T=!1,w=!1;const d=new Set,O=i.type==="tick"?queueMicrotask:i.type==="raf"?yS:i.type==="callback"?i.queueNotification:Aw(i.timeout),W=()=>{w=!1,T&&(T=!1,d.forEach(oe=>oe()))};return Object.assign({},m,{subscribe(oe){const X=()=>y&&oe(),$=m.subscribe(X);return d.add(oe),()=>{$(),d.delete(oe)}},dispatch(oe){var X;try{return y=!((X=oe==null?void 0:oe.meta)!=null&&X[_S]),T=!y,T&&(w||(w=!0,O(W))),m.dispatch(oe)}finally{y=!0}}})},xS=i=>function(l){const{autoBatch:m=!0}=l??{};let y=new zw(i);return m&&y.push(vS(typeof m=="object"?m:void 0)),y};function wS(i){const o=gS(),{reducer:l=void 0,middleware:m,devTools:y=!0,preloadedState:T=void 0,enhancers:w=void 0}=i||{};let d;if(typeof l=="function")d=l;else if(V_(l))d=Q5(l);else throw new Error(mo(1));let O;typeof m=="function"?O=m(o):O=o();let W=Tp;y&&(W=fS({trace:!1,...typeof y=="object"&&y}));const oe=eS(...O),X=xS(oe);let $=typeof w=="function"?w(X):X();const be=W(...$);return bw(d,T,be)}function Dw(i){const o={},l=[];let m;const y={addCase(T,w){const d=typeof T=="string"?T:T.type;if(!d)throw new Error(mo(28));if(d in o)throw new Error(mo(29));return o[d]=w,y},addMatcher(T,w){return l.push({matcher:T,reducer:w}),y},addDefaultCase(T){return m=T,y}};return i(y),[o,l,m]}function bS(i){return typeof i=="function"}function SS(i,o){let[l,m,y]=Dw(o),T;if(bS(i))T=()=>Hv(i());else{const d=Hv(i);T=()=>d}function w(d=T(),O){let W=[l[O.type],...m.filter(({matcher:oe})=>oe(O)).map(({reducer:oe})=>oe)];return W.filter(oe=>!!oe).length===0&&(W=[y]),W.reduce((oe,X)=>{if(X)if(ja(oe)){const be=X(oe,O);return be===void 0?oe:be}else{if(Zo(oe))return Pw(oe,$=>X($,O));{const $=X(oe,O);if($===void 0){if(oe===null)return oe;throw Error("A case reducer on a non-draftable value must not return undefined")}return $}}return oe},d)}return w.getInitialState=T,w}var TS=Symbol.for("rtk-slice-createasyncthunk");function kS(i,o){return`${i}/${o}`}function IS({creators:i}={}){var l;const o=(l=i==null?void 0:i.asyncThunk)==null?void 0:l[TS];return function(y){const{name:T,reducerPath:w=T}=y;if(!T)throw new Error(mo(11));typeof process<"u";const d=(typeof y.reducers=="function"?y.reducers(PS()):y.reducers)||{},O=Object.keys(d),W={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},oe={addCase(se,xe){const Pe=typeof se=="string"?se:se.type;if(!Pe)throw new Error(mo(12));if(Pe in W.sliceCaseReducersByType)throw new Error(mo(13));return W.sliceCaseReducersByType[Pe]=xe,oe},addMatcher(se,xe){return W.sliceMatchers.push({matcher:se,reducer:xe}),oe},exposeAction(se,xe){return W.actionCreators[se]=xe,oe},exposeCaseReducer(se,xe){return W.sliceCaseReducersByName[se]=xe,oe}};O.forEach(se=>{const xe=d[se],Pe={reducerName:se,type:kS(T,se),createNotation:typeof y.reducers=="function"};zS(xe)?DS(Pe,xe,oe,o):MS(Pe,xe,oe)});function X(){const[se={},xe=[],Pe=void 0]=typeof y.extraReducers=="function"?Dw(y.extraReducers):[y.extraReducers],$e={...se,...W.sliceCaseReducersByType};return SS(y.initialState,Ve=>{for(let Ge in $e)Ve.addCase(Ge,$e[Ge]);for(let Ge of W.sliceMatchers)Ve.addMatcher(Ge.matcher,Ge.reducer);for(let Ge of xe)Ve.addMatcher(Ge.matcher,Ge.reducer);Pe&&Ve.addDefaultCase(Pe)})}const $=se=>se,be=new Map;let Te;function Ie(se,xe){return Te||(Te=X()),Te(se,xe)}function Qe(){return Te||(Te=X()),Te.getInitialState()}function ue(se,xe=!1){function Pe(Ve){let Ge=Ve[se];return typeof Ge>"u"&&xe&&(Ge=Qe()),Ge}function $e(Ve=$){const Ge=Wv(be,xe,{insert:()=>new WeakMap});return Wv(Ge,Ve,{insert:()=>{const Et={};for(const[mt,gt]of Object.entries(y.selectors??{}))Et[mt]=ES(gt,Ve,Qe,xe);return Et}})}return{reducerPath:se,getSelectors:$e,get selectors(){return $e(Pe)},selectSlice:Pe}}const ie={name:T,reducer:Ie,actions:W.actionCreators,caseReducers:W.sliceCaseReducersByName,getInitialState:Qe,...ue(w),injectInto(se,{reducerPath:xe,...Pe}={}){const $e=xe??w;return se.inject({reducerPath:$e,reducer:Ie},Pe),{...ie,...ue($e,!0)}}};return ie}}function ES(i,o,l,m){function y(T,...w){let d=o(T);return typeof d>"u"&&m&&(d=l()),i(d,...w)}return y.unwrapped=i,y}var CS=IS();function PS(){function i(o,l){return{_reducerDefinitionType:"asyncThunk",payloadCreator:o,...l}}return i.withTypes=()=>i,{reducer(o){return Object.assign({[o.name](...l){return o(...l)}}[o.name],{_reducerDefinitionType:"reducer"})},preparedReducer(o,l){return{_reducerDefinitionType:"reducerWithPrepare",prepare:o,reducer:l}},asyncThunk:i}}function MS({type:i,reducerName:o,createNotation:l},m,y){let T,w;if("reducer"in m){if(l&&!AS(m))throw new Error(mo(17));T=m.reducer,w=m.prepare}else T=m;y.addCase(i,T).exposeCaseReducer(o,T).exposeAction(o,w?Gv(i,w):Gv(i))}function zS(i){return i._reducerDefinitionType==="asyncThunk"}function AS(i){return i._reducerDefinitionType==="reducerWithPrepare"}function DS({type:i,reducerName:o},l,m,y){if(!y)throw new Error(mo(18));const{payloadCreator:T,fulfilled:w,pending:d,rejected:O,settled:W,options:oe}=l,X=y(i,T,oe);m.exposeAction(o,X),w&&m.addCase(X.fulfilled,w),d&&m.addCase(X.pending,d),O&&m.addCase(X.rejected,O),W&&m.addMatcher(X.settled,W),m.exposeCaseReducer(o,{fulfilled:w||Nd,pending:d||Nd,rejected:O||Nd,settled:W||Nd})}function Nd(){}function mo(i){return`Minified Redux Toolkit error #${i}; visit https://redux-toolkit.js.org/Errors?code=${i} for the full message or use the non-minified dev environment for full errors. `}const $a=CS({name:"main",initialState:{isMapInitialized:!1,focusedCountry:null,focusedState:null,menuWidthPx:300},reducers:{setIsMapInitialized:(i,o)=>{i.isMapInitialized=o.payload},setFocusedCountry:(i,o)=>{i.focusedCountry=o.payload},setFocusedState:(i,o)=>{i.focusedState=o.payload},setMenuWidthPx:(i,o)=>{i.menuWidthPx=o.payload}}}),LS="_container_16n2u_1",RS={container:LS},Xv=200,Kv=.8,FS=()=>{const[i,o]=bt.useState(null),[l,m]=bt.useState(null),y=qn(d=>d.main.menuWidthPx),T=bt.useCallback(d=>{m({x:d.pageX,y:d.pageY}),o(y)},[y]);bt.useEffect(()=>{const d=()=>{m(null),o(null)};return document.addEventListener("mouseup",d),()=>document.removeEventListener("mouseup",d)},[]);const w=N_();return bt.useEffect(()=>{const d=O=>{if(l!==null){const W=O.pageX-l.x;let oe=i+W;const X=window.innerWidth*Kv;oe=Math.min(oe,X),oe=Math.max(oe,Xv),w($a.actions.setMenuWidthPx(oe))}};return document.addEventListener("mousemove",d),()=>document.removeEventListener("mousemove",d)},[w,l,y,i]),bt.useEffect(()=>{const d=()=>{const O=window.innerWidth*Kv;let W=y;W=Math.min(W,O),W=Math.max(W,Xv),w($a.actions.setMenuWidthPx(W))};return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[w,y,i]),kt.jsx("div",{className:RS.container,onMouseDown:T})},BS=()=>kt.jsxs(kt.Fragment,{children:[kt.jsx(Ma,{title:"About",descriptions:["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."]}),kt.jsx(Ma,{title:"Datasets",descriptions:["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."]}),kt.jsx(Ma,{title:"Map capabilities",descriptions:["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."]}),kt.jsx(Ma,{title:"Contact",descriptions:["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."]}),kt.jsx(Ma,{title:"Attributions",descriptions:["Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."]})]}),OS=()=>{const i=qn(l=>l.main.focusedCountry),o=qn(l=>l.main.focusedState);return kt.jsx(kt.Fragment,{children:kt.jsx(Ma,{title:`${o.name}, ${i.name}`,descriptions:[`Name: ${o.name}`,`Code: ${o.stateCode}`,`Country name: ${i.name}`,`Country code: ${i.codeIso3}`]})})},NS="_header_11l9p_1",VS="_headerAccent_11l9p_14",jS="_content_11l9p_20",Ac={header:NS,headerAccent:VS,content:jS},US=()=>{const i=qn(y=>y.main.focusedCountry),o=qn(y=>y.main.focusedState),l=qn(y=>y.main.menuWidthPx);let m;return o?m=kt.jsx(OS,{}):i?m=kt.jsx(X5,{}):m=kt.jsx(BS,{}),kt.jsxs(Z5,{style:{width:`${l}px`},children:[kt.jsx(FS,{}),kt.jsxs("div",{className:Ac.header,children:[kt.jsx("div",{className:Ac.headerAccent}),kt.jsx("h1",{className:Ac.headerText,children:"Voice Atlas"}),kt.jsx("div",{className:Ac.headerAccent})]}),kt.jsx("div",{className:Ac.content,children:m})]})};var Lw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(i,o){(function(l,m){i.exports=m()})(D2,function(){var l={},m={};function y(w,d,O){if(m[w]=O,w==="index"){var W="var sharedModule = {}; ("+m.shared+")(sharedModule); ("+m.worker+")(sharedModule);",oe={};return m.shared(oe),m.index(l,oe),typeof window<"u"&&l.setWorkerUrl(window.URL.createObjectURL(new Blob([W],{type:"text/javascript"}))),l}}y("shared",["exports"],function(w){function d(n,t,r,a){return new(r||(r=Promise))(function(h,g){function _(I){try{b(a.next(I))}catch(E){g(E)}}function v(I){try{b(a.throw(I))}catch(E){g(E)}}function b(I){var E;I.done?h(I.value):(E=I.value,E instanceof r?E:new r(function(P){P(E)})).then(_,v)}b((a=a.apply(n,t||[])).next())})}function O(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}typeof SuppressedError=="function"&&SuppressedError;var W=oe;function oe(n,t){this.x=n,this.y=t}oe.prototype={clone:function(){return new oe(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,r=n.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=t,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),r=Math.sin(n),a=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=a,this},_rotateAround:function(n,t){var r=Math.cos(n),a=Math.sin(n),h=t.y+a*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-a*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oe.convert=function(n){return n instanceof oe?n:Array.isArray(n)?new oe(n[0],n[1]):n};var X=O(W),$=be;function be(n,t,r,a){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=a}be.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,a=0;a<8;a++){var h=this.sampleCurveX(r)-n;if(Math.abs(h)<t)return r;var g=this.sampleCurveDerivativeX(r);if(Math.abs(g)<1e-6)break;r-=h/g}var _=0,v=1;for(r=n,a=0;a<20&&(h=this.sampleCurveX(r),!(Math.abs(h-n)<t));a++)n>h?_=r:v=r,r=.5*(v-_)+_;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Te=O($);let Ie,Qe;function ue(){return Ie==null&&(Ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ie}function ie(){if(Qe==null&&(Qe=!1,ue())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){const h=4*a;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){Qe=!0;break}}}return Qe||!1}function se(n,t,r,a){const h=new Te(n,t,r,a);return g=>h.solve(g)}const xe=se(.25,.1,.25,1);function Pe(n,t,r){return Math.min(r,Math.max(t,n))}function $e(n,t,r){const a=r-t,h=((n-t)%a+a)%a+t;return h===t?r:h}function Ve(n,...t){for(const r of t)for(const a in r)n[a]=r[a];return n}let Ge=1;function Et(n,t,r){const a={};for(const h in n)a[h]=t.call(this,n[h],h,n);return a}function mt(n,t,r){const a={};for(const h in n)t.call(this,n[h],h,n)&&(a[h]=n[h]);return a}function gt(n){return Array.isArray(n)?n.map(gt):typeof n=="object"&&n?Et(n,gt):n}const gr={};function oi(n){gr[n]||(typeof console<"u"&&console.warn(n),gr[n]=!0)}function wi(n,t,r){return(r.y-n.y)*(t.x-n.x)>(t.y-n.y)*(r.x-n.x)}function Zn(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let _r=null;function en(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const We="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ct(n,t,r,a,h){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(n,{timestamp:0});try{const _=g==null?void 0:g.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const v=_.startsWith("BGR"),b=new Uint8ClampedArray(a*h*4);if(yield g.copyTo(b,function(I,E,P,A,R){const B=4*Math.max(-E,0),N=(Math.max(0,P)-P)*A*4+B,Z=4*A,Y=Math.max(0,E),pe=Math.max(0,P);return{rect:{x:Y,y:pe,width:Math.min(I.width,E+A)-Y,height:Math.min(I.height,P+R)-pe},layout:[{offset:N,stride:Z}]}}(n,t,r,a,h)),v)for(let I=0;I<b.length;I+=4){const E=b[I];b[I]=b[I+2],b[I+2]=E}return b}finally{g.close()}})}let ht,It;const Bt="AbortError";function Gn(){return new Error(Bt)}const Di={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function tn(n){return Di.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const nn="global-dispatcher";class bi extends Error{constructor(t,r,a,h){super(`AJAXError: ${r} (${t}): ${a}`),this.status=t,this.statusText=r,this.url=a,this.body=h}}const Hn=()=>Zn(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,go=function(n,t){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const a=tn(n.url);if(a)return a(n,t);if(Zn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:nn},t)}if(!(/^file:/.test(r=n.url)||/^file:/.test(Hn())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,h){return d(this,void 0,void 0,function*(){const g=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:Hn(),signal:h.signal});a.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");const _=yield fetch(g);if(!_.ok){const I=yield _.blob();throw new bi(_.status,_.statusText,a.url,I)}let v;v=a.type==="arrayBuffer"||a.type==="image"?_.arrayBuffer():a.type==="json"?_.json():_.text();const b=yield v;if(h.signal.aborted)throw Gn();return{data:b,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(n,t);if(Zn(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:nn},t)}var r;return function(a,h){return new Promise((g,_)=>{var v;const b=new XMLHttpRequest;b.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(b.responseType="arraybuffer");for(const I in a.headers)b.setRequestHeader(I,a.headers[I]);a.type==="json"&&(b.responseType="text",!((v=a.headers)===null||v===void 0)&&v.Accept||b.setRequestHeader("Accept","application/json")),b.withCredentials=a.credentials==="include",b.onerror=()=>{_(new Error(b.statusText))},b.onload=()=>{if(!h.signal.aborted)if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){let I=b.response;if(a.type==="json")try{I=JSON.parse(b.response)}catch(E){return void _(E)}g({data:I,cacheControl:b.getResponseHeader("Cache-Control"),expires:b.getResponseHeader("Expires")})}else{const I=new Blob([b.response],{type:b.getResponseHeader("Content-Type")});_(new bi(b.status,b.statusText,a.url,I))}},h.signal.addEventListener("abort",()=>{b.abort(),_(Gn())}),b.send(a.body)})}(n,t)};function _o(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const t=new URL(n),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Ks(n,t,r){r[n]&&r[n].indexOf(t)!==-1||(r[n]=r[n]||[],r[n].push(t))}function Lr(n,t,r){if(r&&r[n]){const a=r[n].indexOf(t);a!==-1&&r[n].splice(a,1)}}class Kr{constructor(t,r={}){Ve(this,r),this.type=t}}class Yr extends Kr{constructor(t,r={}){super("error",Ve({error:t},r))}}class Ho{on(t,r){return this._listeners=this._listeners||{},Ks(t,r,this._listeners),this}off(t,r){return Lr(t,r,this._listeners),Lr(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ks(t,r,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,r){typeof t=="string"&&(t=new Kr(t,r||{}));const a=t.type;if(this.listens(a)){t.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of h)v.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of g)Lr(a,v,this._oneTimeListeners),v.call(this,t);const _=this._eventedParent;_&&(Ve(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof Yr&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const yo=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ys(n,t){const r={};for(const a in n)a!=="ref"&&(r[a]=n[a]);return yo.forEach(a=>{a in t&&(r[a]=t[a])}),r}function Dt(n,t){if(Array.isArray(n)){if(!Array.isArray(t)||n.length!==t.length)return!1;for(let r=0;r<n.length;r++)if(!Dt(n[r],t[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&t!==null){if(typeof t!="object"||Object.keys(n).length!==Object.keys(t).length)return!1;for(const r in n)if(!Dt(n[r],t[r]))return!1;return!0}return n===t}function ei(n,t){n.push(t)}function Js(n,t,r){ei(r,{command:"addSource",args:[n,t[n]]})}function Jr(n,t,r){ei(t,{command:"removeSource",args:[n]}),r[n]=!0}function Rr(n,t,r,a){Jr(n,r,a),Js(n,t,r)}function Wo(n,t,r){let a;for(a in n[r])if(Object.prototype.hasOwnProperty.call(n[r],a)&&a!=="data"&&!Dt(n[r][a],t[r][a]))return!1;for(a in t[r])if(Object.prototype.hasOwnProperty.call(t[r],a)&&a!=="data"&&!Dt(n[r][a],t[r][a]))return!1;return!0}function Mn(n,t,r,a,h,g){n=n||{},t=t||{};for(const _ in n)Object.prototype.hasOwnProperty.call(n,_)&&(Dt(n[_],t[_])||r.push({command:g,args:[a,_,t[_],h]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(n,_)&&(Dt(n[_],t[_])||r.push({command:g,args:[a,_,t[_],h]}))}function Qs(n){return n.id}function ea(n,t){return n[t.id]=t,n}class Ce{constructor(t,r,a,h){this.message=(t?`${t}: `:"")+a,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function yr(n,...t){for(const r of t)for(const a in r)n[a]=r[a];return n}class qi extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class vr{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[a,h]of r)this.bindings[a]=h}concat(t){return new vr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Qr={kind:"null"},Le={kind:"number"},_t={kind:"string"},st={kind:"boolean"},rn={kind:"color"},Wn={kind:"object"},dt={kind:"value"},xr={kind:"collator"},Fr={kind:"formatted"},eo={kind:"padding"},wr={kind:"resolvedImage"},K={kind:"variableAnchorOffsetCollection"};function L(n,t){return{kind:"array",itemType:n,N:t}}function D(n){if(n.kind==="array"){const t=D(n.itemType);return typeof n.N=="number"?`array<${t}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${t}>`}return n.kind}const j=[Qr,Le,_t,st,rn,Fr,Wn,L(dt),eo,wr,K];function G(n,t){if(t.kind==="error")return null;if(n.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!G(n.itemType,t.itemType))&&(typeof n.N!="number"||n.N===t.N))return null}else{if(n.kind===t.kind)return null;if(n.kind==="value"){for(const r of j)if(!G(r,t))return null}}return`Expected ${D(n)} but found ${D(t)} instead.`}function re(n,t){return t.some(r=>r.kind===n.kind)}function le(n,t){return t.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function de(n,t){return n.kind==="array"&&t.kind==="array"?n.itemType.kind===t.itemType.kind&&typeof n.N=="number":n.kind===t.kind}const ee=.96422,ye=.82521,Se=4/29,me=6/29,ze=3*me*me,tt=me*me*me,nt=Math.PI/180,Ct=180/Math.PI;function pt(n){return(n%=360)<0&&(n+=360),n}function Pt([n,t,r,a]){let h,g;const _=mi((.2225045*(n=xt(n))+.7168786*(t=xt(t))+.0606169*(r=xt(r)))/1);n===t&&t===r?h=g=_:(h=mi((.4360747*n+.3850649*t+.1430804*r)/ee),g=mi((.0139322*n+.0971045*t+.7141733*r)/ye));const v=116*_-16;return[v<0?0:v,500*(h-_),200*(_-g),a]}function xt(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function mi(n){return n>tt?Math.pow(n,1/3):n/ze+Se}function ti([n,t,r,a]){let h=(n+16)/116,g=isNaN(t)?h:h+t/500,_=isNaN(r)?h:h-r/200;return h=1*Ot(h),g=ee*Ot(g),_=ye*Ot(_),[yt(3.1338561*g-1.6168667*h-.4906146*_),yt(-.9787684*g+1.9161415*h+.033454*_),yt(.0719453*g-.2289914*h+1.4052427*_),a]}function yt(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Ot(n){return n>me?n*n*n:ze*(n-Se)}function Jt(n){return parseInt(n.padEnd(2,n),16)/255}function Si(n,t){return Ci(t?n/100:n,0,1)}function Ci(n,t,r){return Math.min(Math.max(t,n),r)}function Zi(n){return!n.some(Number.isNaN)}const Xo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Nt{constructor(t,r,a,h=1,g=!0){this.r=t,this.g=r,this.b=a,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,r,a,h]))}static parse(t){if(t instanceof Nt)return t;if(typeof t!="string")return;const r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Xo[a];if(h){const[_,v,b]=h;return[_/255,v/255,b/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const _=a.length<6?1:2;let v=1;return[Jt(a.slice(v,v+=_)),Jt(a.slice(v,v+=_)),Jt(a.slice(v,v+=_)),Jt(a.slice(v,v+_)||"ff")]}if(a.startsWith("rgb")){const _=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,b,I,E,P,A,R,B,N,Z,Y,pe]=_,ne=[E||" ",R||" ",Z].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const he=[I,A,N].join(""),_e=he==="%%%"?100:he===""?255:0;if(_e){const ke=[Ci(+b/_e,0,1),Ci(+P/_e,0,1),Ci(+B/_e,0,1),Y?Si(+Y,pe):1];if(Zi(ke))return ke}}return}}const g=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,v,b,I,E,P,A,R,B]=g,N=[b||" ",E||" ",A].join("");if(N==="  "||N==="  /"||N===",,"||N===",,,"){const Z=[+v,Ci(+I,0,100),Ci(+P,0,100),R?Si(+R,B):1];if(Zi(Z))return function([Y,pe,ne,he]){function _e(ke){const je=(ke+Y/30)%12,rt=pe*Math.min(ne,1-ne);return ne-rt*Math.max(-1,Math.min(je-3,9-je,1))}return Y=pt(Y),pe/=100,ne/=100,[_e(0),_e(8),_e(4),he]}(Z)}}}(t);return r?new Nt(...r,!1):void 0}get rgb(){const{r:t,g:r,b:a,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[t/g,r/g,a/g,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,a,h,g]=Pt(t),_=Math.sqrt(a*a+h*h);return[Math.round(1e4*_)?pt(Math.atan2(h,a)*Ct):NaN,_,r,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Pt(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,a,h]=this.rgb;return`rgba(${[t,r,a].map(g=>Math.round(255*g)).join(",")},${h})`}}Nt.black=new Nt(0,0,0,1),Nt.white=new Nt(1,1,1,1),Nt.transparent=new Nt(0,0,0,0),Nt.red=new Nt(1,0,0,1);class gu{constructor(t,r,a){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _u{constructor(t,r,a,h,g){this.text=t,this.image=r,this.scale=a,this.fontStack=h,this.textColor=g}}class yn{constructor(t){this.sections=t}static fromString(t){return new yn([new _u(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof yn?t:yn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class vn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof vn)return t;if(typeof t=="number")return new vn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new vn(t)}}toString(){return JSON.stringify(this.values)}}const Xp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class zn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof zn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const a=t[r],h=t[r+1];if(typeof a!="string"||!Xp.has(a)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new zn(t)}}toString(){return JSON.stringify(this.values)}}class xn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new xn({name:t,available:!1}):null}}function Ko(n,t,r,a){return typeof n=="number"&&n>=0&&n<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,t,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,t,r,a]:[n,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function vo(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Nt||n instanceof gu||n instanceof yn||n instanceof vn||n instanceof zn||n instanceof xn)return!0;if(Array.isArray(n)){for(const t of n)if(!vo(t))return!1;return!0}if(typeof n=="object"){for(const t in n)if(!vo(n[t]))return!1;return!0}return!1}function gi(n){if(n===null)return Qr;if(typeof n=="string")return _t;if(typeof n=="boolean")return st;if(typeof n=="number")return Le;if(n instanceof Nt)return rn;if(n instanceof gu)return xr;if(n instanceof yn)return Fr;if(n instanceof vn)return eo;if(n instanceof zn)return K;if(n instanceof xn)return wr;if(Array.isArray(n)){const t=n.length;let r;for(const a of n){const h=gi(a);if(r){if(r===h)continue;r=dt;break}r=h}return L(r||dt,t)}return Wn}function ta(n){const t=typeof n;return n===null?"":t==="string"||t==="number"||t==="boolean"?String(n):n instanceof Nt||n instanceof yn||n instanceof vn||n instanceof zn||n instanceof xn?n.toString():JSON.stringify(n)}class Xn{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!vo(t[1]))return r.error("invalid value");const a=t[1];let h=gi(a);const g=r.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Xn(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ci{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ga={string:_t,number:Le,boolean:st,object:Wn};class Kn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a,h=1;const g=t[0];if(g==="array"){let v,b;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in Ga)||I==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=Ga[I],h++}else v=dt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}a=L(v,b)}else{if(!Ga[g])throw new Error(`Types doesn't contain name = ${g}`);a=Ga[g]}const _=[];for(;h<t.length;h++){const v=r.parse(t[h],h,dt);if(!v)return null;_.push(v)}return new Kn(a,_)}evaluate(t){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(t);if(!G(this.type,gi(a)))return a;if(r===this.args.length-1)throw new ci(`Expected value to be of type ${D(this.type)}, but found ${D(gi(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const yu={"to-boolean":st,"to-color":rn,"to-number":Le,"to-string":_t};class Yn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const a=t[0];if(!yu[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return r.error("Expected one argument.");const h=yu[a],g=[];for(let _=1;_<t.length;_++){const v=r.parse(t[_],_,dt);if(!v)return null;g.push(v)}return new Yn(h,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,a;for(const h of this.args){if(r=h.evaluate(t),a=null,r instanceof Nt)return r;if(typeof r=="string"){const g=t.parseColor(r);if(g)return g}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ko(r[0],r[1],r[2],r[3]),!a))return new Nt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ci(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(t);const h=vn.parse(r);if(h)return h}throw new ci(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(t);const h=zn.parse(r);if(h)return h}throw new ci(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(t),r===null)return 0;const h=Number(r);if(!isNaN(h))return h}throw new ci(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return yn.fromString(ta(this.args[0].evaluate(t)));case"resolvedImage":return xn.fromString(ta(this.args[0].evaluate(t)));default:return ta(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Kp=["Unknown","Point","LineString","Polygon"];class Ha{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Kp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=Nt.parse(t)),r}}class xo{constructor(t,r,a=[],h,g=new vr,_=[]){this.registry=t,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=_,this.expectedType=h,this._isConstant=r}parse(t,r,a,h,g={}){return r?this.concat(r,a,h)._parse(t,g):this._parse(t,g)}_parse(t,r){function a(h,g,_){return _==="assert"?new Kn(g,[h]):_==="coerce"?new Yn(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let _=g.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,b=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(v.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(v,b))return null}else _=a(_,v,r.typeAnnotation||"coerce");else _=a(_,v,r.typeAnnotation||"coerce");else _=a(_,v,r.typeAnnotation||"coerce");else _=a(_,v,r.typeAnnotation||"assert")}if(!(_ instanceof Xn)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const v=new Ha;try{_=new Xn(_.type,_.evaluate(v))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,a){const h=typeof t=="number"?this.path.concat(t):this.path,g=a?this.scope.concat(a):this.scope;return new xo(this.registry,this._isConstant,h,r||null,g,this.errors)}error(t,...r){const a=`${this.key}${r.map(h=>`[${h}]`).join("")}`;this.errors.push(new qi(a,t))}checkSubtype(t,r){const a=G(t,r);return a&&this.error(a),a}}class to{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=r.parse(t[g+1],g+1);if(!v)return null;a.push([_,v])}const h=r.parse(t[t.length-1],t.length-1,r.expectedType,a);return h?new to(a,h):null}outputDefined(){return this.result.outputDefined()}}class Lt{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=t[1];return r.scope.has(a)?new Lt(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class vu{constructor(t,r,a){this.type=t,this.index=r,this.input=a}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,Le),h=r.parse(t[2],2,L(r.expectedType||dt));return a&&h?new vu(h.type.itemType,a,h):null}evaluate(t){const r=this.index.evaluate(t),a=this.input.evaluate(t);if(r<0)throw new ci(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new ci(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new ci(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class xu{constructor(t,r){this.type=st,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,dt),h=r.parse(t[2],2,dt);return a&&h?re(a.type,[st,_t,Le,Qr,dt])?new xu(a,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!le(r,["boolean","string","number","null"]))throw new ci(`Expected first argument to be of type boolean, string, number or null, but found ${D(gi(r))} instead.`);if(!le(a,["string","array"]))throw new ci(`Expected second argument to be of type array or string, but found ${D(gi(a))} instead.`);return a.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Yo{constructor(t,r,a){this.type=Le,this.needle=t,this.haystack=r,this.fromIndex=a}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,dt),h=r.parse(t[2],2,dt);if(!a||!h)return null;if(!re(a.type,[st,_t,Le,Qr,dt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(a.type)} instead`);if(t.length===4){const g=r.parse(t[3],3,Le);return g?new Yo(a,h,g):null}return new Yo(a,h)}evaluate(t){const r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!le(r,["boolean","string","number","null"]))throw new ci(`Expected first argument to be of type boolean, string, number or null, but found ${D(gi(r))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),le(a,["string"])){const g=a.indexOf(r,h);return g===-1?-1:[...a.slice(0,g)].length}if(le(a,["array"]))return a.indexOf(r,h);throw new ci(`Expected second argument to be of type array or string, but found ${D(gi(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class wu{constructor(t,r,a,h,g,_){this.inputType=t,this.type=r,this.input=a,this.cases=h,this.outputs=g,this.otherwise=_}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let a,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const g={},_=[];for(let I=2;I<t.length-1;I+=2){let E=t[I];const P=t[I+1];Array.isArray(E)||(E=[E]);const A=r.concat(I);if(E.length===0)return A.error("Expected at least one branch label.");for(const B of E){if(typeof B!="number"&&typeof B!="string")return A.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return A.error("Numeric branch labels must be integer values.");if(a){if(A.checkSubtype(a,gi(B)))return null}else a=gi(B);if(g[String(B)]!==void 0)return A.error("Branch labels must be unique.");g[String(B)]=_.length}const R=r.parse(P,I,h);if(!R)return null;h=h||R.type,_.push(R)}const v=r.parse(t[1],1,dt);if(!v)return null;const b=r.parse(t[t.length-1],t.length-1,h);return b?v.type.kind!=="value"&&r.concat(1).checkSubtype(a,v.type)?null:new wu(a,h,v,g,_,b):null}evaluate(t){const r=this.input.evaluate(t);return(gi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Wa{constructor(t,r,a){this.type=t,this.branches=r,this.otherwise=a}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const h=[];for(let _=1;_<t.length-1;_+=2){const v=r.parse(t[_],_,st);if(!v)return null;const b=r.parse(t[_+1],_+1,a);if(!b)return null;h.push([v,b]),a=a||b.type}const g=r.parse(t[t.length-1],t.length-1,a);if(!g)return null;if(!a)throw new Error("Can't infer output type");return new Wa(a,h,g)}evaluate(t){for(const[r,a]of this.branches)if(r.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,a]of this.branches)t(r),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ia{constructor(t,r,a,h){this.type=t,this.input=r,this.beginIndex=a,this.endIndex=h}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,dt),h=r.parse(t[2],2,Le);if(!a||!h)return null;if(!re(a.type,[L(dt),_t,dt]))return r.error(`Expected first argument to be of type array or string, but found ${D(a.type)} instead`);if(t.length===4){const g=r.parse(t[3],3,Le);return g?new ia(a.type,a,h,g):null}return new ia(a.type,a,h)}evaluate(t){const r=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),le(r,["string"]))return[...r].slice(a,h).join("");if(le(r,["array"]))return r.slice(a,h);throw new ci(`Expected first argument to be of type array or string, but found ${D(gi(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Xa(n,t){const r=n.length-1;let a,h,g=0,_=r,v=0;for(;g<=_;)if(v=Math.floor((g+_)/2),a=n[v],h=n[v+1],a<=t){if(v===r||t<h)return v;g=v+1}else{if(!(a>t))throw new ci("Input is not a number.");_=v-1}return 0}class Jo{constructor(t,r,a){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[h,g]of a)this.labels.push(h),this.outputs.push(g)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(t[1],1,Le);if(!a)return null;const h=[];let g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],b=t[_+1],I=_,E=_+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(h.length&&h[h.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const P=r.parse(b,E,g);if(!P)return null;g=g||P.type,h.push([v,P])}return new Jo(g,a,h)}evaluate(t){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=r[0])return a[0].evaluate(t);const g=r.length;return h>=r[g-1]?a[g-1].evaluate(t):a[Xa(r,h)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function xh(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Yp=wh;function wh(n,t,r,a){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=t,this.p2x=r,this.p2y=a}wh.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,t){if(t===void 0&&(t=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,a=0;a<8;a++){var h=this.sampleCurveX(r)-n;if(Math.abs(h)<t)return r;var g=this.sampleCurveDerivativeX(r);if(Math.abs(g)<1e-6)break;r-=h/g}var _=0,v=1;for(r=n,a=0;a<20&&(h=this.sampleCurveX(r),!(Math.abs(h-n)<t));a++)n>h?_=r:v=r,r=.5*(v-_)+_;return r},solve:function(n,t){return this.sampleCurveY(this.solveCurveX(n,t))}};var Jp=xh(Yp);function wo(n,t,r){return n+r*(t-n)}function na(n,t,r){return n.map((a,h)=>wo(a,t[h],r))}const on={number:wo,color:function(n,t,r,a="rgb"){switch(a){case"rgb":{const[h,g,_,v]=na(n.rgb,t.rgb,r);return new Nt(h,g,_,v,!1)}case"hcl":{const[h,g,_,v]=n.hcl,[b,I,E,P]=t.hcl;let A,R;if(isNaN(h)||isNaN(b))isNaN(h)?isNaN(b)?A=NaN:(A=b,_!==1&&_!==0||(R=I)):(A=h,E!==1&&E!==0||(R=g));else{let pe=b-h;b>h&&pe>180?pe-=360:b<h&&h-b>180&&(pe+=360),A=h+r*pe}const[B,N,Z,Y]=function([pe,ne,he,_e]){return pe=isNaN(pe)?0:pe*nt,ti([he,Math.cos(pe)*ne,Math.sin(pe)*ne,_e])}([A,R??wo(g,I,r),wo(_,E,r),wo(v,P,r)]);return new Nt(B,N,Z,Y,!1)}case"lab":{const[h,g,_,v]=ti(na(n.lab,t.lab,r));return new Nt(h,g,_,v,!1)}}},array:na,padding:function(n,t,r){return new vn(na(n.values,t.values,r))},variableAnchorOffsetCollection:function(n,t,r){const a=n.values,h=t.values;if(a.length!==h.length)throw new ci(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${t.toString()}`);const g=[];for(let _=0;_<a.length;_+=2){if(a[_]!==h[_])throw new ci(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${a[_]}, to[${_}]: ${h[_]}`);g.push(a[_]);const[v,b]=a[_+1],[I,E]=h[_+1];g.push([wo(v,I,r),wo(b,E,r)])}return new zn(g)}};class sn{constructor(t,r,a,h,g){this.type=t,this.operator=r,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[_,v]of g)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,r,a,h){let g=0;if(t.name==="exponential")g=Ka(r,t.base,a,h);else if(t.name==="linear")g=Ka(r,1,a,h);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new Jp(_[0],_[1],_[2],_[3]).solve(Ka(r,1,a,h))}return g}static parse(t,r){let[a,h,g,..._]=t;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const I=h[1];if(typeof I!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:I}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const I=h.slice(1);if(I.length!==4||I.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(g=r.parse(g,2,Le),!g)return null;const v=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=rn:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let I=0;I<_.length;I+=2){const E=_[I],P=_[I+1],A=I+3,R=I+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(v.length&&v[v.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const B=r.parse(P,R,b);if(!B)return null;b=b||B.type,v.push([E,B])}return de(b,Le)||de(b,rn)||de(b,eo)||de(b,K)||de(b,L(Le))?new sn(b,a,h,g,v):r.error(`Type ${D(b)} is not interpolatable.`)}evaluate(t){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);const h=this.input.evaluate(t);if(h<=r[0])return a[0].evaluate(t);const g=r.length;if(h>=r[g-1])return a[g-1].evaluate(t);const _=Xa(r,h),v=sn.interpolationFactor(this.interpolation,h,r[_],r[_+1]),b=a[_].evaluate(t),I=a[_+1].evaluate(t);switch(this.operator){case"interpolate":return on[this.type.kind](b,I,v);case"interpolate-hcl":return on.color(b,I,v,"hcl");case"interpolate-lab":return on.color(b,I,v,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ka(n,t,r,a){const h=a-r,g=n-r;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}class Ya{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let a=null;const h=r.expectedType;h&&h.kind!=="value"&&(a=h);const g=[];for(const v of t.slice(1)){const b=r.parse(v,1+g.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,g.push(b)}if(!a)throw new Error("No output type");const _=h&&g.some(v=>G(h,v.type));return new Ya(_?dt:a,g)}evaluate(t){let r,a=null,h=0;for(const g of this.args)if(h++,a=g.evaluate(t),a&&a instanceof xn&&!a.available&&(r||(r=a.name),a=null,h===this.args.length&&(a=r)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Ja(n,t){return n==="=="||n==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function bh(n,t,r,a){return a.compare(t,r)===0}function Qo(n,t,r){const a=n!=="=="&&n!=="!=";return class Rw{constructor(g,_,v){this.type=st,this.lhs=g,this.rhs=_,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const v=g[0];let b=_.parse(g[1],1,dt);if(!b)return null;if(!Ja(v,b.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${D(b.type)}'.`);let I=_.parse(g[2],2,dt);if(!I)return null;if(!Ja(v,I.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${D(I.type)}'.`);if(b.type.kind!==I.type.kind&&b.type.kind!=="value"&&I.type.kind!=="value")return _.error(`Cannot compare types '${D(b.type)}' and '${D(I.type)}'.`);a&&(b.type.kind==="value"&&I.type.kind!=="value"?b=new Kn(I.type,[b]):b.type.kind!=="value"&&I.type.kind==="value"&&(I=new Kn(b.type,[I])));let E=null;if(g.length===4){if(b.type.kind!=="string"&&I.type.kind!=="string"&&b.type.kind!=="value"&&I.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(E=_.parse(g[3],3,xr),!E)return null}return new Rw(b,I,E)}evaluate(g){const _=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(a&&this.hasUntypedArgument){const b=gi(_),I=gi(v);if(b.kind!==I.kind||b.kind!=="string"&&b.kind!=="number")throw new ci(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${I.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=gi(_),I=gi(v);if(b.kind!=="string"||I.kind!=="string")return t(g,_,v)}return this.collator?r(g,_,v,this.collator.evaluate(g)):t(g,_,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Qp=Qo("==",function(n,t,r){return t===r},bh),Sh=Qo("!=",function(n,t,r){return t!==r},function(n,t,r,a){return!bh(0,t,r,a)}),Th=Qo("<",function(n,t,r){return t<r},function(n,t,r,a){return a.compare(t,r)<0}),ef=Qo(">",function(n,t,r){return t>r},function(n,t,r,a){return a.compare(t,r)>0}),tf=Qo("<=",function(n,t,r){return t<=r},function(n,t,r,a){return a.compare(t,r)<=0}),kh=Qo(">=",function(n,t,r){return t>=r},function(n,t,r,a){return a.compare(t,r)>=0});class ra{constructor(t,r,a){this.type=xr,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const h=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,st);if(!h)return null;const g=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,st);if(!g)return null;let _=null;return a.locale&&(_=r.parse(a.locale,1,_t),!_)?null:new ra(h,g,_)}evaluate(t){return new gu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class bu{constructor(t,r,a,h,g){this.type=_t,this.number=t,this.locale=r,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const a=r.parse(t[1],1,Le);if(!a)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=r.parse(h.locale,1,_t),!g))return null;let _=null;if(h.currency&&(_=r.parse(h.currency,1,_t),!_))return null;let v=null;if(h["min-fraction-digits"]&&(v=r.parse(h["min-fraction-digits"],1,Le),!v))return null;let b=null;return h["max-fraction-digits"]&&(b=r.parse(h["max-fraction-digits"],1,Le),!b)?null:new bu(a,g,_,v,b)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Qa{constructor(t){this.type=Fr,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const h=[];let g=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let b=null;if(v["font-scale"]&&(b=r.parse(v["font-scale"],1,Le),!b))return null;let I=null;if(v["text-font"]&&(I=r.parse(v["text-font"],1,L(_t)),!I))return null;let E=null;if(v["text-color"]&&(E=r.parse(v["text-color"],1,rn),!E))return null;const P=h[h.length-1];P.scale=b,P.font=I,P.textColor=E}else{const b=r.parse(t[_],1,dt);if(!b)return null;const I=b.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new Qa(h)}evaluate(t){return new yn(this.sections.map(r=>{const a=r.content.evaluate(t);return gi(a)===wr?new _u("",a,null,null,null):new _u(ta(a),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Su{constructor(t){this.type=wr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const a=r.parse(t[1],1,_t);return a?new Su(a):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),a=xn.fromString(r);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(r)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class Tu{constructor(t){this.type=Le,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=r.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${D(a.type)} instead.`):new Tu(a):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new ci(`Expected value to be of type string or array, but found ${D(gi(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const br=8192;function nf(n,t){const r=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(r*h*br),Math.round(a*h*br)]}function ku(n,t){const r=Math.pow(2,t.z);return[(h=(n[0]/br+t.x)/r,360*h-180),(a=(n[1]/br+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,h}function bo(n,t){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function io(n,t){return!(n[0]<=t[0]||n[2]>=t[2]||n[1]<=t[1]||n[3]>=t[3])}function Rt(n,t,r){const a=n[0]-t[0],h=n[1]-t[1],g=n[0]-r[0],_=n[1]-r[1];return a*_-g*h==0&&a*g<=0&&h*_<=0}function el(n,t,r,a){return(h=[a[0]-r[0],a[1]-r[1]])[0]*(g=[t[0]-n[0],t[1]-n[1]])[1]-h[1]*g[0]!=0&&!(!Eh(n,t,r,a)||!Eh(r,a,n,t));var h,g}function rf(n,t,r){for(const a of r)for(let h=0;h<a.length-1;++h)if(el(n,t,a[h],a[h+1]))return!0;return!1}function es(n,t,r=!1){let a=!1;for(const v of t)for(let b=0;b<v.length-1;b++){if(Rt(n,v[b],v[b+1]))return r;(g=v[b])[1]>(h=n)[1]!=(_=v[b+1])[1]>h[1]&&h[0]<(_[0]-g[0])*(h[1]-g[1])/(_[1]-g[1])+g[0]&&(a=!a)}var h,g,_;return a}function of(n,t){for(const r of t)if(es(n,r))return!0;return!1}function Ih(n,t){for(const r of n)if(!es(r,t))return!1;for(let r=0;r<n.length-1;++r)if(rf(n[r],n[r+1],t))return!1;return!0}function sf(n,t){for(const r of t)if(Ih(n,r))return!0;return!1}function Eh(n,t,r,a){const h=a[0]-r[0],g=a[1]-r[1],_=(n[0]-r[0])*g-h*(n[1]-r[1]),v=(t[0]-r[0])*g-h*(t[1]-r[1]);return _>0&&v<0||_<0&&v>0}function Iu(n,t,r){const a=[];for(let h=0;h<n.length;h++){const g=[];for(let _=0;_<n[h].length;_++){const v=nf(n[h][_],r);bo(t,v),g.push(v)}a.push(g)}return a}function Ch(n,t,r){const a=[];for(let h=0;h<n.length;h++){const g=Iu(n[h],t,r);a.push(g)}return a}function Ph(n,t,r,a){if(n[0]<r[0]||n[0]>r[2]){const h=.5*a;let g=n[0]-r[0]>h?-a:r[0]-n[0]>h?a:0;g===0&&(g=n[0]-r[2]>h?-a:r[2]-n[0]>h?a:0),n[0]+=g}bo(t,n)}function Mh(n,t,r,a){const h=Math.pow(2,a.z)*br,g=[a.x*br,a.y*br],_=[];for(const v of n)for(const b of v){const I=[b.x+g[0],b.y+g[1]];Ph(I,t,r,h),_.push(I)}return _}function zh(n,t,r,a){const h=Math.pow(2,a.z)*br,g=[a.x*br,a.y*br],_=[];for(const b of n){const I=[];for(const E of b){const P=[E.x+g[0],E.y+g[1]];bo(t,P),I.push(P)}_.push(I)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of _)for(const I of b)Ph(I,t,r,h)}var v;return _}class So{constructor(t,r){this.type=st,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(vo(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const h=[];for(const g of a.features){const{type:_,coordinates:v}=g.geometry;_==="Polygon"&&h.push(v),_==="MultiPolygon"&&h.push(...v)}if(h.length)return new So(a,{type:"MultiPolygon",coordinates:h})}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new So(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new So(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(a.type==="Polygon"){const v=Iu(a.coordinates,g,_),b=Mh(r.geometry(),h,g,_);if(!io(h,g))return!1;for(const I of b)if(!es(I,v))return!1}if(a.type==="MultiPolygon"){const v=Ch(a.coordinates,g,_),b=Mh(r.geometry(),h,g,_);if(!io(h,g))return!1;for(const I of b)if(!of(I,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(a.type==="Polygon"){const v=Iu(a.coordinates,g,_),b=zh(r.geometry(),h,g,_);if(!io(h,g))return!1;for(const I of b)if(!Ih(I,v))return!1}if(a.type==="MultiPolygon"){const v=Ch(a.coordinates,g,_),b=zh(r.geometry(),h,g,_);if(!io(h,g))return!1;for(const I of b)if(!sf(I,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ah=class{constructor(n=[],t=(r,a)=>r<a?-1:r>a?1:0){if(this.data=n,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:t,compare:r}=this,a=t[n];for(;n>0;){const h=n-1>>1,g=t[h];if(r(a,g)>=0)break;t[n]=g,n=h}t[n]=a}_down(n){const{data:t,compare:r}=this,a=this.length>>1,h=t[n];for(;n<a;){let g=1+(n<<1);const _=g+1;if(_<this.length&&r(t[_],t[g])<0&&(g=_),r(t[g],h)>=0)break;t[n]=t[g],n=g}t[n]=h}};function af(n,t,r,a,h){Dh(n,t,r,a||n.length-1,h||lf)}function Dh(n,t,r,a,h){for(;a>r;){if(a-r>600){var g=a-r+1,_=t-r+1,v=Math.log(g),b=.5*Math.exp(2*v/3),I=.5*Math.sqrt(v*b*(g-b)/g)*(_-g/2<0?-1:1);Dh(n,t,Math.max(r,Math.floor(t-_*b/g+I)),Math.min(a,Math.floor(t+(g-_)*b/g+I)),h)}var E=n[t],P=r,A=a;for(oa(n,r,t),h(n[a],E)>0&&oa(n,r,a);P<A;){for(oa(n,P,A),P++,A--;h(n[P],E)<0;)P++;for(;h(n[A],E)>0;)A--}h(n[r],E)===0?oa(n,r,A):oa(n,++A,a),A<=t&&(r=A+1),t<=A&&(a=A-1)}}function oa(n,t,r){var a=n[t];n[t]=n[r],n[r]=a}function lf(n,t){return n<t?-1:n>t?1:0}function tl(n,t){if(n.length<=1)return[n];const r=[];let a,h;for(const g of n){const _=cf(g);_!==0&&(g.area=Math.abs(_),h===void 0&&(h=_<0),h===_<0?(a&&r.push(a),a=[g]):a.push(g))}if(a&&r.push(a),t>1)for(let g=0;g<r.length;g++)r[g].length<=t||(af(r[g],t,1,r[g].length-1,uf),r[g]=r[g].slice(0,t));return r}function uf(n,t){return t.area-n.area}function cf(n){let t=0;for(let r,a,h=0,g=n.length,_=g-1;h<g;_=h++)r=n[h],a=n[_],t+=(a.x-r.x)*(r.y+a.y);return t}const Lh=1/298.257223563,Rh=Lh*(2-Lh),Fh=Math.PI/180;class Eu{constructor(t){const r=6378.137*Fh*1e3,a=Math.cos(t*Fh),h=1/(1-Rh*(1-a*a)),g=Math.sqrt(h);this.kx=r*g*a,this.ky=r*g*h*(1-Rh)}distance(t,r){const a=this.wrap(t[0]-r[0])*this.kx,h=(t[1]-r[1])*this.ky;return Math.sqrt(a*a+h*h)}pointOnLine(t,r){let a,h,g,_,v=1/0;for(let b=0;b<t.length-1;b++){let I=t[b][0],E=t[b][1],P=this.wrap(t[b+1][0]-I)*this.kx,A=(t[b+1][1]-E)*this.ky,R=0;P===0&&A===0||(R=(this.wrap(r[0]-I)*this.kx*P+(r[1]-E)*this.ky*A)/(P*P+A*A),R>1?(I=t[b+1][0],E=t[b+1][1]):R>0&&(I+=P/this.kx*R,E+=A/this.ky*R)),P=this.wrap(r[0]-I)*this.kx,A=(r[1]-E)*this.ky;const B=P*P+A*A;B<v&&(v=B,a=I,h=E,g=b,_=R)}return{point:[a,h],index:g,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Bh(n,t){return t[0]-n[0]}function il(n){return n[1]-n[0]+1}function Br(n,t){return n[1]>=n[0]&&n[1]<t}function Cu(n,t){if(n[0]>n[1])return[null,null];const r=il(n);if(t){if(r===2)return[n,null];const h=Math.floor(r/2);return[[n[0],n[0]+h],[n[0]+h,n[1]]]}if(r===1)return[n,null];const a=Math.floor(r/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}function Pu(n,t){if(!Br(t,n.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)bo(r,n[a]);return r}function Mu(n){const t=[1/0,1/0,-1/0,-1/0];for(const r of n)for(const a of r)bo(t,a);return t}function nl(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function zu(n,t,r){if(!nl(n)||!nl(t))return NaN;let a=0,h=0;return n[2]<t[0]&&(a=t[0]-n[2]),n[0]>t[2]&&(a=n[0]-t[2]),n[1]>t[3]&&(h=n[1]-t[3]),n[3]<t[1]&&(h=t[1]-n[3]),r.distance([0,0],[a,h])}function To(n,t,r){const a=r.pointOnLine(t,n);return r.distance(n,a.point)}function Au(n,t,r,a,h){const g=Math.min(To(n,[r,a],h),To(t,[r,a],h)),_=Math.min(To(r,[n,t],h),To(a,[n,t],h));return Math.min(g,_)}function hf(n,t,r,a,h){if(!Br(t,n.length)||!Br(a,r.length))return 1/0;let g=1/0;for(let _=t[0];_<t[1];++_){const v=n[_],b=n[_+1];for(let I=a[0];I<a[1];++I){const E=r[I],P=r[I+1];if(el(v,b,E,P))return 0;g=Math.min(g,Au(v,b,E,P,h))}}return g}function si(n,t,r,a,h){if(!Br(t,n.length)||!Br(a,r.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let v=a[0];v<=a[1];++v)if(g=Math.min(g,h.distance(n[_],r[v])),g===0)return g;return g}function df(n,t,r){if(es(n,t,!0))return 0;let a=1/0;for(const h of t){const g=h[0],_=h[h.length-1];if(g!==_&&(a=Math.min(a,To(n,[_,g],r)),a===0))return a;const v=r.pointOnLine(h,n);if(a=Math.min(a,r.distance(n,v.point)),a===0)return a}return a}function vt(n,t,r,a){if(!Br(t,n.length))return NaN;for(let g=t[0];g<=t[1];++g)if(es(n[g],r,!0))return 0;let h=1/0;for(let g=t[0];g<t[1];++g){const _=n[g],v=n[g+1];for(const b of r)for(let I=0,E=b.length,P=E-1;I<E;P=I++){const A=b[P],R=b[I];if(el(_,v,A,R))return 0;h=Math.min(h,Au(_,v,A,R,a))}}return h}function rl(n,t){for(const r of n)for(const a of r)if(es(a,t,!0))return!0;return!1}function qt(n,t,r,a=1/0){const h=Mu(n),g=Mu(t);if(a!==1/0&&zu(h,g,r)>=a)return a;if(io(h,g)){if(rl(n,t))return 0}else if(rl(t,n))return 0;let _=1/0;for(const v of n)for(let b=0,I=v.length,E=I-1;b<I;E=b++){const P=v[E],A=v[b];for(const R of t)for(let B=0,N=R.length,Z=N-1;B<N;Z=B++){const Y=R[Z],pe=R[B];if(el(P,A,Y,pe))return 0;_=Math.min(_,Au(P,A,Y,pe,r))}}return _}function Vt(n,t,r,a,h,g){if(!g)return;const _=zu(Pu(a,g),h,r);_<t&&n.push([_,g,[0,0]])}function ko(n,t,r,a,h,g,_){if(!g||!_)return;const v=zu(Pu(a,g),Pu(h,_),r);v<t&&n.push([v,g,_])}function sa(n,t,r,a,h=1/0){let g=Math.min(a.distance(n[0],r[0][0]),h);if(g===0)return g;const _=new Ah([[0,[0,n.length-1],[0,0]]],Bh),v=Mu(r);for(;_.length>0;){const b=_.pop();if(b[0]>=g)continue;const I=b[1],E=t?50:100;if(il(I)<=E){if(!Br(I,n.length))return NaN;if(t){const P=vt(n,I,r,a);if(isNaN(P)||P===0)return P;g=Math.min(g,P)}else for(let P=I[0];P<=I[1];++P){const A=df(n[P],r,a);if(g=Math.min(g,A),g===0)return 0}}else{const P=Cu(I,t);Vt(_,g,a,n,v,P[0]),Vt(_,g,a,n,v,P[1])}}return g}function aa(n,t,r,a,h,g=1/0){let _=Math.min(g,h.distance(n[0],r[0]));if(_===0)return _;const v=new Ah([[0,[0,n.length-1],[0,r.length-1]]],Bh);for(;v.length>0;){const b=v.pop();if(b[0]>=_)continue;const I=b[1],E=b[2],P=t?50:100,A=a?50:100;if(il(I)<=P&&il(E)<=A){if(!Br(I,n.length)&&Br(E,r.length))return NaN;let R;if(t&&a)R=hf(n,I,r,E,h),_=Math.min(_,R);else if(t&&!a){const B=n.slice(I[0],I[1]+1);for(let N=E[0];N<=E[1];++N)if(R=To(r[N],B,h),_=Math.min(_,R),_===0)return _}else if(!t&&a){const B=r.slice(E[0],E[1]+1);for(let N=I[0];N<=I[1];++N)if(R=To(n[N],B,h),_=Math.min(_,R),_===0)return _}else R=si(n,I,r,E,h),_=Math.min(_,R)}else{const R=Cu(I,t),B=Cu(E,a);ko(v,_,h,n,r,R[0],B[0]),ko(v,_,h,n,r,R[0],B[1]),ko(v,_,h,n,r,R[1],B[0]),ko(v,_,h,n,r,R[1],B[1])}}return _}function Du(n){return n.type==="MultiPolygon"?n.coordinates.map(t=>({type:"Polygon",coordinates:t})):n.type==="MultiLineString"?n.coordinates.map(t=>({type:"LineString",coordinates:t})):n.type==="MultiPoint"?n.coordinates.map(t=>({type:"Point",coordinates:t})):[n]}class Io{constructor(t,r){this.type=Le,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(vo(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new Io(a,a.features.map(h=>Du(h.geometry)).flat());if(a.type==="Feature")return new Io(a,Du(a.geometry));if("type"in a&&"coordinates"in a)return new Io(a,Du(a))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){const h=r.geometry(),g=h.flat().map(b=>ku([b.x,b.y],r.canonical));if(h.length===0)return NaN;const _=new Eu(g[0][1]);let v=1/0;for(const b of a){switch(b.type){case"Point":v=Math.min(v,aa(g,!1,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,aa(g,!1,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,sa(g,!1,b.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){const h=r.geometry(),g=h.flat().map(b=>ku([b.x,b.y],r.canonical));if(h.length===0)return NaN;const _=new Eu(g[0][1]);let v=1/0;for(const b of a){switch(b.type){case"Point":v=Math.min(v,aa(g,!0,[b.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,aa(g,!0,b.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,sa(g,!0,b.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,a){const h=r.geometry();if(h.length===0||h[0].length===0)return NaN;const g=tl(h,0).map(b=>b.map(I=>I.map(E=>ku([E.x,E.y],r.canonical)))),_=new Eu(g[0][0][0][1]);let v=1/0;for(const b of a)for(const I of g){switch(b.type){case"Point":v=Math.min(v,sa([b.coordinates],!1,I,_,v));break;case"LineString":v=Math.min(v,sa(b.coordinates,!0,I,_,v));break;case"Polygon":v=Math.min(v,qt(I,b.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const ts={"==":Qp,"!=":Sh,">":ef,"<":Th,">=":kh,"<=":tf,array:Kn,at:vu,boolean:Kn,case:Wa,coalesce:Ya,collator:ra,format:Qa,image:Su,in:xu,"index-of":Yo,interpolate:sn,"interpolate-hcl":sn,"interpolate-lab":sn,length:Tu,let:to,literal:Xn,match:wu,number:Kn,"number-format":bu,object:Kn,slice:ia,step:Jo,string:Kn,"to-boolean":Yn,"to-color":Yn,"to-number":Yn,"to-string":Yn,var:Lt,within:So,distance:Io};class An{constructor(t,r,a,h){this.name=t,this.type=r,this._evaluate=a,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const a=t[0],h=An.definitions[a];if(!h)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=_.filter(([I])=>!Array.isArray(I)||I.length===t.length-1);let b=null;for(const[I,E]of v){b=new xo(r.registry,la,r.path,null,r.scope);const P=[];let A=!1;for(let R=1;R<t.length;R++){const B=t[R],N=Array.isArray(I)?I[R-1]:I.type,Z=b.parse(B,1+P.length,N);if(!Z){A=!0;break}P.push(Z)}if(!A)if(Array.isArray(I)&&I.length!==P.length)b.error(`Expected ${I.length} arguments, but found ${P.length} instead.`);else{for(let R=0;R<P.length;R++){const B=Array.isArray(I)?I[R]:I.type,N=P[R];b.concat(R+1).checkSubtype(B,N.type)}if(b.errors.length===0)return new An(a,g,E,P)}}if(v.length===1)r.errors.push(...b.errors);else{const I=(v.length?v:_).map(([P])=>{return A=P,Array.isArray(A)?`(${A.map(D).join(", ")})`:`(${D(A.type)}...)`;var A}).join(" | "),E=[];for(let P=1;P<t.length;P++){const A=r.parse(t[P],1+E.length);if(!A)return null;E.push(D(A.type))}r.error(`Expected arguments of type ${I}, but found (${E.join(", ")}) instead.`)}return null}static register(t,r){An.definitions=r;for(const a in r)t[a]=An}}function Lu(n,[t,r,a,h]){t=t.evaluate(n),r=r.evaluate(n),a=a.evaluate(n);const g=h?h.evaluate(n):1,_=Ko(t,r,a,g);if(_)throw new ci(_);return new Nt(t/255,r/255,a/255,g,!1)}function Ru(n,t){return n in t}function Fu(n,t){const r=t[n];return r===void 0?null:r}function Eo(n){return{type:n}}function la(n){if(n instanceof Lt)return la(n.boundExpression);if(n instanceof An&&n.name==="error"||n instanceof ra||n instanceof So||n instanceof Io)return!1;const t=n instanceof Yn||n instanceof Kn;let r=!0;return n.eachChild(a=>{r=t?r&&la(a):r&&a instanceof Xn}),!!r&&ua(n)&&ca(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ua(n){if(n instanceof An&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof So||n instanceof Io)return!1;let t=!0;return n.eachChild(r=>{t&&!ua(r)&&(t=!1)}),t}function is(n){if(n instanceof An&&n.name==="feature-state")return!1;let t=!0;return n.eachChild(r=>{t&&!is(r)&&(t=!1)}),t}function ca(n,t){if(n instanceof An&&t.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(a=>{r&&!ca(a,t)&&(r=!1)}),r}function ol(n){return{result:"success",value:n}}function ns(n){return{result:"error",value:n}}function rs(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Oh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Bu(n){return!!n.expression&&n.expression.interpolated}function zt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function sl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function pf(n){return n}function Nh(n,t){const r=t.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",h=a||!(a||n.property!==void 0),g=n.type||(Bu(t)?"exponential":"interval");if(r||t.type==="padding"){const E=r?Nt.parse:vn.parse;(n=yr({},n)).stops&&(n.stops=n.stops.map(P=>[P[0],E(P[1])])),n.default=E(n.default?n.default:t.default)}if(n.colorSpace&&(_=n.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var _;let v,b,I;if(g==="exponential")v=jh;else if(g==="interval")v=al;else if(g==="categorical"){v=Vh,b=Object.create(null);for(const E of n.stops)b[E[0]]=E[1];I=typeof n.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=Uh}if(a){const E={},P=[];for(let B=0;B<n.stops.length;B++){const N=n.stops[B],Z=N[0].zoom;E[Z]===void 0&&(E[Z]={zoom:Z,type:n.type,property:n.property,default:n.default,stops:[]},P.push(Z)),E[Z].stops.push([N[0].value,N[1]])}const A=[];for(const B of P)A.push([E[B].zoom,Nh(E[B],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:sn.interpolationFactor.bind(void 0,R),zoomStops:A.map(B=>B[0]),evaluate:({zoom:B},N)=>jh({stops:A,base:n.base},t,B).evaluate(B,N)}}if(h){const E=g==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:sn.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map(P=>P[0]),evaluate:({zoom:P})=>v(n,t,P,b,I)}}return{kind:"source",evaluate(E,P){const A=P&&P.properties?P.properties[n.property]:void 0;return A===void 0?os(n.default,t.default):v(n,t,A,b,I)}}}function os(n,t,r){return n!==void 0?n:t!==void 0?t:r!==void 0?r:void 0}function Vh(n,t,r,a,h){return os(typeof r===h?a[r]:void 0,n.default,t.default)}function al(n,t,r){if(zt(r)!=="number")return os(n.default,t.default);const a=n.stops.length;if(a===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[a-1][0])return n.stops[a-1][1];const h=Xa(n.stops.map(g=>g[0]),r);return n.stops[h][1]}function jh(n,t,r){const a=n.base!==void 0?n.base:1;if(zt(r)!=="number")return os(n.default,t.default);const h=n.stops.length;if(h===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[h-1][0])return n.stops[h-1][1];const g=Xa(n.stops.map(E=>E[0]),r),_=function(E,P,A,R){const B=R-A,N=E-A;return B===0?0:P===1?N/B:(Math.pow(P,N)-1)/(Math.pow(P,B)-1)}(r,a,n.stops[g][0],n.stops[g+1][0]),v=n.stops[g][1],b=n.stops[g+1][1],I=on[t.type]||pf;return typeof v.evaluate=="function"?{evaluate(...E){const P=v.evaluate.apply(void 0,E),A=b.evaluate.apply(void 0,E);if(P!==void 0&&A!==void 0)return I(P,A,_,n.colorSpace)}}:I(v,b,_,n.colorSpace)}function Uh(n,t,r){switch(t.type){case"color":r=Nt.parse(r);break;case"formatted":r=yn.fromString(r.toString());break;case"resolvedImage":r=xn.fromString(r.toString());break;case"padding":r=vn.parse(r);break;default:zt(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return os(r,n.default,t.default)}An.register(ts,{error:[{kind:"error"},[_t],(n,[t])=>{throw new ci(t.evaluate(n))}],typeof:[_t,[dt],(n,[t])=>D(gi(t.evaluate(n)))],"to-rgba":[L(Le,4),[rn],(n,[t])=>{const[r,a,h,g]=t.evaluate(n).rgb;return[255*r,255*a,255*h,g]}],rgb:[rn,[Le,Le,Le],Lu],rgba:[rn,[Le,Le,Le,Le],Lu],has:{type:st,overloads:[[[_t],(n,[t])=>Ru(t.evaluate(n),n.properties())],[[_t,Wn],(n,[t,r])=>Ru(t.evaluate(n),r.evaluate(n))]]},get:{type:dt,overloads:[[[_t],(n,[t])=>Fu(t.evaluate(n),n.properties())],[[_t,Wn],(n,[t,r])=>Fu(t.evaluate(n),r.evaluate(n))]]},"feature-state":[dt,[_t],(n,[t])=>Fu(t.evaluate(n),n.featureState||{})],properties:[Wn,[],n=>n.properties()],"geometry-type":[_t,[],n=>n.geometryType()],id:[dt,[],n=>n.id()],zoom:[Le,[],n=>n.globals.zoom],"heatmap-density":[Le,[],n=>n.globals.heatmapDensity||0],"line-progress":[Le,[],n=>n.globals.lineProgress||0],accumulated:[dt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Le,Eo(Le),(n,t)=>{let r=0;for(const a of t)r+=a.evaluate(n);return r}],"*":[Le,Eo(Le),(n,t)=>{let r=1;for(const a of t)r*=a.evaluate(n);return r}],"-":{type:Le,overloads:[[[Le,Le],(n,[t,r])=>t.evaluate(n)-r.evaluate(n)],[[Le],(n,[t])=>-t.evaluate(n)]]},"/":[Le,[Le,Le],(n,[t,r])=>t.evaluate(n)/r.evaluate(n)],"%":[Le,[Le,Le],(n,[t,r])=>t.evaluate(n)%r.evaluate(n)],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(n,[t,r])=>Math.pow(t.evaluate(n),r.evaluate(n))],sqrt:[Le,[Le],(n,[t])=>Math.sqrt(t.evaluate(n))],log10:[Le,[Le],(n,[t])=>Math.log(t.evaluate(n))/Math.LN10],ln:[Le,[Le],(n,[t])=>Math.log(t.evaluate(n))],log2:[Le,[Le],(n,[t])=>Math.log(t.evaluate(n))/Math.LN2],sin:[Le,[Le],(n,[t])=>Math.sin(t.evaluate(n))],cos:[Le,[Le],(n,[t])=>Math.cos(t.evaluate(n))],tan:[Le,[Le],(n,[t])=>Math.tan(t.evaluate(n))],asin:[Le,[Le],(n,[t])=>Math.asin(t.evaluate(n))],acos:[Le,[Le],(n,[t])=>Math.acos(t.evaluate(n))],atan:[Le,[Le],(n,[t])=>Math.atan(t.evaluate(n))],min:[Le,Eo(Le),(n,t)=>Math.min(...t.map(r=>r.evaluate(n)))],max:[Le,Eo(Le),(n,t)=>Math.max(...t.map(r=>r.evaluate(n)))],abs:[Le,[Le],(n,[t])=>Math.abs(t.evaluate(n))],round:[Le,[Le],(n,[t])=>{const r=t.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Le,[Le],(n,[t])=>Math.floor(t.evaluate(n))],ceil:[Le,[Le],(n,[t])=>Math.ceil(t.evaluate(n))],"filter-==":[st,[_t,dt],(n,[t,r])=>n.properties()[t.value]===r.value],"filter-id-==":[st,[dt],(n,[t])=>n.id()===t.value],"filter-type-==":[st,[_t],(n,[t])=>n.geometryType()===t.value],"filter-<":[st,[_t,dt],(n,[t,r])=>{const a=n.properties()[t.value],h=r.value;return typeof a==typeof h&&a<h}],"filter-id-<":[st,[dt],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r<a}],"filter->":[st,[_t,dt],(n,[t,r])=>{const a=n.properties()[t.value],h=r.value;return typeof a==typeof h&&a>h}],"filter-id->":[st,[dt],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r>a}],"filter-<=":[st,[_t,dt],(n,[t,r])=>{const a=n.properties()[t.value],h=r.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[st,[dt],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r<=a}],"filter->=":[st,[_t,dt],(n,[t,r])=>{const a=n.properties()[t.value],h=r.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[st,[dt],(n,[t])=>{const r=n.id(),a=t.value;return typeof r==typeof a&&r>=a}],"filter-has":[st,[dt],(n,[t])=>t.value in n.properties()],"filter-has-id":[st,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[st,[L(_t)],(n,[t])=>t.value.indexOf(n.geometryType())>=0],"filter-id-in":[st,[L(dt)],(n,[t])=>t.value.indexOf(n.id())>=0],"filter-in-small":[st,[_t,L(dt)],(n,[t,r])=>r.value.indexOf(n.properties()[t.value])>=0],"filter-in-large":[st,[_t,L(dt)],(n,[t,r])=>function(a,h,g,_){for(;g<=_;){const v=g+_>>1;if(h[v]===a)return!0;h[v]>a?_=v-1:g=v+1}return!1}(n.properties()[t.value],r.value,0,r.value.length-1)],all:{type:st,overloads:[[[st,st],(n,[t,r])=>t.evaluate(n)&&r.evaluate(n)],[Eo(st),(n,t)=>{for(const r of t)if(!r.evaluate(n))return!1;return!0}]]},any:{type:st,overloads:[[[st,st],(n,[t,r])=>t.evaluate(n)||r.evaluate(n)],[Eo(st),(n,t)=>{for(const r of t)if(r.evaluate(n))return!0;return!1}]]},"!":[st,[st],(n,[t])=>!t.evaluate(n)],"is-supported-script":[st,[_t],(n,[t])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(t.evaluate(n))}],upcase:[_t,[_t],(n,[t])=>t.evaluate(n).toUpperCase()],downcase:[_t,[_t],(n,[t])=>t.evaluate(n).toLowerCase()],concat:[_t,Eo(dt),(n,t)=>t.map(r=>ta(r.evaluate(n))).join("")],"resolved-locale":[_t,[xr],(n,[t])=>t.evaluate(n).resolvedLocale()]});class ll{constructor(t,r){var a;this.expression=t,this._warningHistory={},this._evaluator=new Ha,this._defaultValue=r?(a=r).type==="color"&&sl(a.default)?new Nt(0,0,0,0):a.type==="color"?Nt.parse(a.default)||null:a.type==="padding"?vn.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?zn.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,a,h,g,_){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,r,a,h,g,_){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new ci(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function ul(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in ts}function ss(n,t){const r=new xo(ts,la,[],t?function(h){const g={color:rn,string:_t,number:Le,enum:_t,boolean:st,formatted:Fr,padding:eo,resolvedImage:wr,variableAnchorOffsetCollection:K};return h.type==="array"?L(g[h.value]||dt,h.length):g[h.type]}(t):void 0),a=r.parse(n,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?ol(new ll(a,t)):ns(r.errors)}class as{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!is(r.expression)}evaluateWithoutErrorHandling(t,r,a,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,h,g,_)}evaluate(t,r,a,h,g,_){return this._styleExpression.evaluate(t,r,a,h,g,_)}}class ls{constructor(t,r,a,h){this.kind=t,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!is(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,r,a,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,h,g,_)}evaluate(t,r,a,h,g,_){return this._styleExpression.evaluate(t,r,a,h,g,_)}interpolationFactor(t,r,a){return this.interpolationType?sn.interpolationFactor(this.interpolationType,t,r,a):0}}function Ou(n,t){const r=ss(n,t);if(r.result==="error")return r;const a=r.value.expression,h=ua(a);if(!h&&!rs(t))return ns([new qi("","data expressions not supported")]);const g=ca(a,["zoom"]);if(!g&&!Oh(t))return ns([new qi("","zoom expressions not supported")]);const _=ha(a);return _||g?_ instanceof qi?ns([_]):_ instanceof sn&&!Bu(t)?ns([new qi("",'"interpolate" expressions cannot be used with this property')]):ol(_?new ls(h?"camera":"composite",r.value,_.labels,_ instanceof sn?_.interpolation:void 0):new as(h?"constant":"source",r.value)):ns([new qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class us{constructor(t,r){this._parameters=t,this._specification=r,yr(this,Nh(this._parameters,this._specification))}static deserialize(t){return new us(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ha(n){let t=null;if(n instanceof to)t=ha(n.result);else if(n instanceof Ya){for(const r of n.args)if(t=ha(r),t)break}else(n instanceof Jo||n instanceof sn)&&n.input instanceof An&&n.input.name==="zoom"&&(t=n);return t instanceof qi||n.eachChild(r=>{const a=ha(r);a instanceof qi?t=a:!t&&a?t=new qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new qi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function cl(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const t of n.slice(1))if(!cl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const hl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Nu(n){if(n==null)return{filter:()=>!0,needGeometry:!1};cl(n)||(n=dl(n));const t=ss(n,hl);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,h)=>t.value.evaluate(r,a,{},h),needGeometry:$h(n)}}function ff(n,t){return n<t?-1:n>t?1:0}function $h(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let t=1;t<n.length;t++)if($h(n[t]))return!0;return!1}function dl(n){if(!n)return!0;const t=n[0];return n.length<=1?t!=="any":t==="=="?Vu(n[1],n[2],"=="):t==="!="?Li(Vu(n[1],n[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Vu(n[1],n[2],t):t==="any"?(r=n.slice(1),["any"].concat(r.map(dl))):t==="all"?["all"].concat(n.slice(1).map(dl)):t==="none"?["all"].concat(n.slice(1).map(dl).map(Li)):t==="in"?da(n[1],n.slice(2)):t==="!in"?Li(da(n[1],n.slice(2))):t==="has"?pa(n[1]):t!=="!has"||Li(pa(n[1]));var r}function Vu(n,t,r){switch(n){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,n,t]}}function da(n,t){if(t.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",n,["literal",t.sort(ff)]]:["filter-in-small",n,["literal",t]]}}function pa(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Li(n){return["!",n]}function Co(n){const t=typeof n;if(t==="number"||t==="boolean"||t==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const g of n)h+=`${Co(g)},`;return`${h}]`}const r=Object.keys(n).sort();let a="{";for(let h=0;h<r.length;h++)a+=`${JSON.stringify(r[h])}:${Co(n[r[h]])},`;return`${a}}`}function qh(n){let t="";for(const r of yo)t+=`/${Co(n[r])}`;return t}function Zh(n){const t=n.value;return t?[new Ce(n.key,t,"constants have been deprecated as of v8")]:[]}function ai(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Jn(n){if(Array.isArray(n))return n.map(Jn);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const t={};for(const r in n)t[r]=Jn(n[r]);return t}return ai(n)}function wn(n){const t=n.key,r=n.value,a=n.valueSpec||{},h=n.objectElementValidators||{},g=n.style,_=n.styleSpec,v=n.validateSpec;let b=[];const I=zt(r);if(I!=="object")return[new Ce(t,r,`object expected, ${I} found`)];for(const E in r){const P=E.split(".")[0],A=a[P]||a["*"];let R;if(h[P])R=h[P];else if(a[P])R=v;else if(h["*"])R=h["*"];else{if(!a["*"]){b.push(new Ce(t,r[E],`unknown property "${E}"`));continue}R=v}b=b.concat(R({key:(t&&`${t}.`)+E,value:r[E],valueSpec:A,style:g,styleSpec:_,object:r,objectKey:E,validateSpec:v},r))}for(const E in a)h[E]||a[E].required&&a[E].default===void 0&&r[E]===void 0&&b.push(new Ce(t,r,`missing required property "${E}"`));return b}function fa(n){const t=n.value,r=n.valueSpec,a=n.style,h=n.styleSpec,g=n.key,_=n.arrayElementValidator||n.validateSpec;if(zt(t)!=="array")return[new Ce(g,t,`array expected, ${zt(t)} found`)];if(r.length&&t.length!==r.length)return[new Ce(g,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Ce(g,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let v={type:r.value,values:r.values};h.$version<7&&(v.function=r.function),zt(r.value)==="object"&&(v=r.value);let b=[];for(let I=0;I<t.length;I++)b=b.concat(_({array:t,arrayIndex:I,value:t[I],valueSpec:v,validateSpec:n.validateSpec,style:a,styleSpec:h,key:`${g}[${I}]`}));return b}function ju(n){const t=n.key,r=n.value,a=n.valueSpec;let h=zt(r);return h==="number"&&r!=r&&(h="NaN"),h!=="number"?[new Ce(t,r,`number expected, ${h} found`)]:"minimum"in a&&r<a.minimum?[new Ce(t,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new Ce(t,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function pl(n){const t=n.valueSpec,r=ai(n.value.type);let a,h,g,_={};const v=r!=="categorical"&&n.value.property===void 0,b=!v,I=zt(n.value.stops)==="array"&&zt(n.value.stops[0])==="array"&&zt(n.value.stops[0][0])==="object",E=wn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(R){if(r==="identity")return[new Ce(R.key,R.value,'identity function may not have a "stops" property')];let B=[];const N=R.value;return B=B.concat(fa({key:R.key,value:N,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:P})),zt(N)==="array"&&N.length===0&&B.push(new Ce(R.key,N,"array must have at least one stop")),B},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return r==="identity"&&v&&E.push(new Ce(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||E.push(new Ce(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!Bu(n.valueSpec)&&E.push(new Ce(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!rs(n.valueSpec)?E.push(new Ce(n.key,n.value,"property functions not supported")):v&&!Oh(n.valueSpec)&&E.push(new Ce(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!I||n.value.property!==void 0||E.push(new Ce(n.key,n.value,'"property" property is required')),E;function P(R){let B=[];const N=R.value,Z=R.key;if(zt(N)!=="array")return[new Ce(Z,N,`array expected, ${zt(N)} found`)];if(N.length!==2)return[new Ce(Z,N,`array length 2 expected, length ${N.length} found`)];if(I){if(zt(N[0])!=="object")return[new Ce(Z,N,`object expected, ${zt(N[0])} found`)];if(N[0].zoom===void 0)return[new Ce(Z,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new Ce(Z,N,"object stop key must have value")];if(g&&g>ai(N[0].zoom))return[new Ce(Z,N[0].zoom,"stop zoom values must appear in ascending order")];ai(N[0].zoom)!==g&&(g=ai(N[0].zoom),h=void 0,_={}),B=B.concat(wn({key:`${Z}[0]`,value:N[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:ju,value:A}}))}else B=B.concat(A({key:`${Z}[0]`,value:N[0],valueSpec:{},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},N));return ul(Jn(N[1]))?B.concat([new Ce(`${Z}[1]`,N[1],"expressions are not allowed in function stops.")]):B.concat(R.validateSpec({key:`${Z}[1]`,value:N[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function A(R,B){const N=zt(R.value),Z=ai(R.value),Y=R.value!==null?R.value:B;if(a){if(N!==a)return[new Ce(R.key,Y,`${N} stop domain type must match previous stop domain type ${a}`)]}else a=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new Ce(R.key,Y,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&r!=="categorical"){let pe=`number expected, ${N} found`;return rs(t)&&r===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ce(R.key,Y,pe)]}return r!=="categorical"||N!=="number"||isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&N==="number"&&h!==void 0&&Z<h?[new Ce(R.key,Y,"stop domain values must appear in ascending order")]:(h=Z,r==="categorical"&&Z in _?[new Ce(R.key,Y,"stop domain values must be unique")]:(_[Z]=!0,[])):[new Ce(R.key,Y,`integer expected, found ${Z}`)]}}function cs(n){const t=(n.expressionContext==="property"?Ou:ss)(Jn(n.value),n.valueSpec);if(t.result==="error")return t.value.map(a=>new Ce(`${n.key}${a.key}`,n.value,a.message));const r=t.value.expression||t.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Ce(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!is(r))return[new Ce(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!is(r))return[new Ce(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!ca(r,["zoom","feature-state"]))return[new Ce(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ua(r))return[new Ce(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Or(n){const t=n.key,r=n.value,a=n.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(ai(r))===-1&&h.push(new Ce(t,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(ai(r))===-1&&h.push(new Ce(t,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function Uu(n){return cl(Jn(n.value))?cs(yr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):fl(n)}function fl(n){const t=n.value,r=n.key;if(zt(t)!=="array")return[new Ce(r,t,`array expected, ${zt(t)} found`)];const a=n.styleSpec;let h,g=[];if(t.length<1)return[new Ce(r,t,"filter array must have at least 1 element")];switch(g=g.concat(Or({key:`${r}[0]`,value:t[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),ai(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&ai(t[1])==="$type"&&g.push(new Ce(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new Ce(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=zt(t[1]),h!=="string"&&g.push(new Ce(`${r}[1]`,t[1],`string expected, ${h} found`)));for(let _=2;_<t.length;_++)h=zt(t[_]),ai(t[1])==="$type"?g=g.concat(Or({key:`${r}[${_}]`,value:t[_],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new Ce(`${r}[${_}]`,t[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)g=g.concat(fl({key:`${r}[${_}]`,value:t[_],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=zt(t[1]),t.length!==2?g.push(new Ce(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new Ce(`${r}[1]`,t[1],`string expected, ${h} found`))}return g}function $u(n,t){const r=n.key,a=n.validateSpec,h=n.style,g=n.styleSpec,_=n.value,v=n.objectKey,b=g[`${t}_${n.layerType}`];if(!b)return[];const I=v.match(/^(.*)-transition$/);if(t==="paint"&&I&&b[I[1]]&&b[I[1]].transition)return a({key:r,value:_,valueSpec:g.transition,style:h,styleSpec:g});const E=n.valueSpec||b[v];if(!E)return[new Ce(r,_,`unknown property "${v}"`)];let P;if(zt(_)==="string"&&rs(E)&&!E.tokens&&(P=/^{([^}]+)}$/.exec(_)))return[new Ce(r,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const A=[];return n.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&A.push(new Ce(r,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&sl(Jn(_))&&ai(_.type)==="identity"&&A.push(new Ce(r,_,'"text-font" does not support identity functions'))),A.concat(a({key:n.key,value:_,valueSpec:E,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v}))}function ml(n){return $u(n,"paint")}function qu(n){return $u(n,"layout")}function Zu(n){let t=[];const r=n.value,a=n.key,h=n.style,g=n.styleSpec;r.type||r.ref||t.push(new Ce(a,r,'either "type" or "ref" is required'));let _=ai(r.type);const v=ai(r.ref);if(r.id){const b=ai(r.id);for(let I=0;I<n.arrayIndex;I++){const E=h.layers[I];ai(E.id)===b&&t.push(new Ce(a,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(I=>{I in r&&t.push(new Ce(a,r[I],`"${I}" is prohibited for ref layers`))}),h.layers.forEach(I=>{ai(I.id)===v&&(b=I)}),b?b.ref?t.push(new Ce(a,r.ref,"ref cannot reference another ref layer")):_=ai(b.type):t.push(new Ce(a,r.ref,`ref layer "${v}" not found`))}else if(_!=="background")if(r.source){const b=h.sources&&h.sources[r.source],I=b&&ai(b.type);b?I==="vector"&&_==="raster"?t.push(new Ce(a,r.source,`layer "${r.id}" requires a raster source`)):I!=="raster-dem"&&_==="hillshade"?t.push(new Ce(a,r.source,`layer "${r.id}" requires a raster-dem source`)):I==="raster"&&_!=="raster"?t.push(new Ce(a,r.source,`layer "${r.id}" requires a vector source`)):I!=="vector"||r["source-layer"]?I==="raster-dem"&&_!=="hillshade"?t.push(new Ce(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||I==="geojson"&&b.lineMetrics||t.push(new Ce(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ce(a,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Ce(a,r.source,`source "${r.source}" not found`))}else t.push(new Ce(a,r,'missing required property "source"'));return t=t.concat(wn({key:a,value:r,valueSpec:g.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${a}.type`,value:r.type,valueSpec:g.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:Uu,layout:b=>wn({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":I=>qu(yr({layerType:_},I))}}),paint:b=>wn({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":I=>ml(yr({layerType:_},I))}})}})),t}function Po(n){const t=n.value,r=n.key,a=zt(t);return a!=="string"?[new Ce(r,t,`string expected, ${a} found`)]:[]}const gl={promoteId:function({key:n,value:t}){if(zt(t)==="string")return Po({key:n,value:t});{const r=[];for(const a in t)r.push(...Po({key:`${n}.${a}`,value:t[a]}));return r}}};function ma(n){const t=n.value,r=n.key,a=n.styleSpec,h=n.style,g=n.validateSpec;if(!t.type)return[new Ce(r,t,'"type" is required')];const _=ai(t.type);let v;switch(_){case"vector":case"raster":return v=wn({key:r,value:t,valueSpec:a[`source_${_.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:gl,validateSpec:g}),v;case"raster-dem":return v=function(b){var I;const E=(I=b.sourceName)!==null&&I!==void 0?I:"",P=b.value,A=b.styleSpec,R=A.source_raster_dem,B=b.style;let N=[];const Z=zt(P);if(P===void 0)return N;if(Z!=="object")return N.push(new Ce("source_raster_dem",P,`object expected, ${Z} found`)),N;const Y=ai(P.encoding)==="custom",pe=["redFactor","greenFactor","blueFactor","baseShift"],ne=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const he in P)!Y&&pe.includes(he)?N.push(new Ce(he,P[he],`In "${E}": "${he}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):R[he]?N=N.concat(b.validateSpec({key:he,value:P[he],valueSpec:R[he],validateSpec:b.validateSpec,style:B,styleSpec:A})):N.push(new Ce(he,P[he],`unknown property "${he}"`));return N}({sourceName:r,value:t,style:n.style,styleSpec:a,validateSpec:g}),v;case"geojson":if(v=wn({key:r,value:t,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:g,objectElementValidators:gl}),t.cluster)for(const b in t.clusterProperties){const[I,E]=t.clusterProperties[b],P=typeof I=="string"?[I,["accumulated"],["get",b]]:I;v.push(...cs({key:`${r}.${b}.map`,value:E,validateSpec:g,expressionContext:"cluster-map"})),v.push(...cs({key:`${r}.${b}.reduce`,value:P,validateSpec:g,expressionContext:"cluster-reduce"}))}return v;case"video":return wn({key:r,value:t,valueSpec:a.source_video,style:h,validateSpec:g,styleSpec:a});case"image":return wn({key:r,value:t,valueSpec:a.source_image,style:h,validateSpec:g,styleSpec:a});case"canvas":return[new Ce(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Or({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:g,styleSpec:a})}}function Gu(n){const t=n.value,r=n.styleSpec,a=r.light,h=n.style;let g=[];const _=zt(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new Ce("light",t,`object expected, ${_} found`)]),g;for(const v in t){const b=v.match(/^(.*)-transition$/);g=g.concat(b&&a[b[1]]&&a[b[1]].transition?n.validateSpec({key:v,value:t[v],valueSpec:r.transition,validateSpec:n.validateSpec,style:h,styleSpec:r}):a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new Ce(v,t[v],`unknown property "${v}"`)])}return g}function Hu(n){const t=n.value,r=n.styleSpec,a=r.sky,h=n.style,g=zt(t);if(t===void 0)return[];if(g!=="object")return[new Ce("sky",t,`object expected, ${g} found`)];let _=[];for(const v in t)_=_.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],style:h,styleSpec:r}):[new Ce(v,t[v],`unknown property "${v}"`)]);return _}function Wu(n){const t=n.value,r=n.styleSpec,a=r.terrain,h=n.style;let g=[];const _=zt(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new Ce("terrain",t,`object expected, ${_} found`)]),g;for(const v in t)g=g.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new Ce(v,t[v],`unknown property "${v}"`)]);return g}function Xu(n){let t=[];const r=n.value,a=n.key;if(Array.isArray(r)){const h=[],g=[];for(const _ in r)r[_].id&&h.includes(r[_].id)&&t.push(new Ce(a,r,`all the sprites' ids must be unique, but ${r[_].id} is duplicated`)),h.push(r[_].id),r[_].url&&g.includes(r[_].url)&&t.push(new Ce(a,r,`all the sprites' URLs must be unique, but ${r[_].url} is duplicated`)),g.push(r[_].url),t=t.concat(wn({key:`${a}[${_}]`,value:r[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return t}return Po({key:a,value:r})}const _l={"*":()=>[],array:fa,boolean:function(n){const t=n.value,r=n.key,a=zt(t);return a!=="boolean"?[new Ce(r,t,`boolean expected, ${a} found`)]:[]},number:ju,color:function(n){const t=n.key,r=n.value,a=zt(r);return a!=="string"?[new Ce(t,r,`color expected, ${a} found`)]:Nt.parse(String(r))?[]:[new Ce(t,r,`color expected, "${r}" found`)]},constants:Zh,enum:Or,filter:Uu,function:pl,layer:Zu,object:wn,source:ma,light:Gu,sky:Hu,terrain:Wu,projection:function(n){const t=n.value,r=n.styleSpec,a=r.projection,h=n.style,g=zt(t);if(t===void 0)return[];if(g!=="object")return[new Ce("projection",t,`object expected, ${g} found`)];let _=[];for(const v in t)_=_.concat(a[v]?n.validateSpec({key:v,value:t[v],valueSpec:a[v],style:h,styleSpec:r}):[new Ce(v,t[v],`unknown property "${v}"`)]);return _},string:Po,formatted:function(n){return Po(n).length===0?[]:cs(n)},resolvedImage:function(n){return Po(n).length===0?[]:cs(n)},padding:function(n){const t=n.key,r=n.value;if(zt(r)==="array"){if(r.length<1||r.length>4)return[new Ce(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let h=[];for(let g=0;g<r.length;g++)h=h.concat(n.validateSpec({key:`${t}[${g}]`,value:r[g],validateSpec:n.validateSpec,valueSpec:a}));return h}return ju({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(n){const t=n.key,r=n.value,a=zt(r),h=n.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new Ce(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<r.length;_+=2)g=g.concat(Or({key:`${t}[${_}]`,value:r[_],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(fa({key:`${t}[${_+1}]`,value:r[_+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:h}));return g},sprite:Xu};function hs(n){const t=n.value,r=n.valueSpec,a=n.styleSpec;return n.validateSpec=hs,r.expression&&sl(ai(t))?pl(n):r.expression&&ul(Jn(t))?cs(n):r.type&&_l[r.type]?_l[r.type](n):wn(yr({},n,{valueSpec:r.type?a[r.type]:r}))}function Gh(n){const t=n.value,r=n.key,a=Po(n);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Ce(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Ce(r,t,'"glyphs" url must include a "{range}" token'))),a}function Dn(n,t=ge){let r=[];return r=r.concat(hs({key:"",value:n,valueSpec:t.$root,styleSpec:t,style:n,validateSpec:hs,objectElementValidators:{glyphs:Gh,"*":()=>[]}})),n.constants&&(r=r.concat(Zh({key:"constants",value:n.constants,style:n,styleSpec:t,validateSpec:hs}))),Ku(r)}function Sr(n){return function(t){return n({...t,validateSpec:hs})}}function Ku(n){return[].concat(n).sort((t,r)=>t.line-r.line)}function Qn(n){return function(...t){return Ku(n.apply(this,t))}}Dn.source=Qn(Sr(ma)),Dn.sprite=Qn(Sr(Xu)),Dn.glyphs=Qn(Sr(Gh)),Dn.light=Qn(Sr(Gu)),Dn.sky=Qn(Sr(Hu)),Dn.terrain=Qn(Sr(Wu)),Dn.layer=Qn(Sr(Zu)),Dn.filter=Qn(Sr(Uu)),Dn.paintProperty=Qn(Sr(ml)),Dn.layoutProperty=Qn(Sr(qu));const Mo=Dn,mf=Mo.light,gf=Mo.sky,Hh=Mo.paintProperty,Wh=Mo.layoutProperty;function Yu(n,t){let r=!1;if(t&&t.length)for(const a of t)n.fire(new Yr(new Error(a.message))),r=!0;return r}class ds{constructor(t,r,a){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(r=_[1])+2*(a=_[2]);for(let b=0;b<this.d*this.d;b++){const I=_[3+b],E=_[3+b+1];h.push(I===E?null:_.subarray(I,E))}const v=_[3+h.length+1];this.keys=_.subarray(_[3+h.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let _=0;_<this.d*this.d;_++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=a,this.scale=r/t,this.uid=0;const g=a/r*t;this.min=-g,this.max=t+g}insert(t,r,a,h,g){this._forEachCell(r,a,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,a,h,g,_){this.cells[g].push(_)}query(t,r,a,h,g){const _=this.min,v=this.max;if(t<=_&&r<=_&&v<=a&&v<=h&&!g)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(t,r,a,h,this._queryCell,b,{},g),b}}_queryCell(t,r,a,h,g,_,v,b){const I=this.cells[g];if(I!==null){const E=this.keys,P=this.bboxes;for(let A=0;A<I.length;A++){const R=I[A];if(v[R]===void 0){const B=4*R;(b?b(P[B+0],P[B+1],P[B+2],P[B+3]):t<=P[B+2]&&r<=P[B+3]&&a>=P[B+0]&&h>=P[B+1])?(v[R]=!0,_.push(E[R])):v[R]=!1}}}}_forEachCell(t,r,a,h,g,_,v,b){const I=this._convertToCellCoord(t),E=this._convertToCellCoord(r),P=this._convertToCellCoord(a),A=this._convertToCellCoord(h);for(let R=I;R<=P;R++)for(let B=E;B<=A;B++){const N=this.d*B+R;if((!b||b(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&g.call(this,t,r,a,h,N,_,v,b))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let a=0;for(let _=0;_<this.cells.length;_++)a+=this.cells[_].length;const h=new Int32Array(r+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=r;for(let _=0;_<t.length;_++){const v=t[_];h[3+_]=g,h.set(v,g),g+=v.length}return h[3+t.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+t.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(t,r){const a=t.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(t){return new ds(t.buffer)}}const Ln={};function Ze(n,t,r={}){if(Ln[n])throw new Error(`${n} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:n,writeable:!1}),Ln[n]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Ze("Object",Object),Ze("TransferableGridIndex",ds),Ze("Color",Nt),Ze("Error",Error),Ze("AJAXError",bi),Ze("ResolvedImage",xn),Ze("StylePropertyFunction",us),Ze("StyleExpression",ll,{omit:["_evaluator"]}),Ze("ZoomDependentExpression",ls),Ze("ZoomConstantExpression",as),Ze("CompoundExpression",An,{omit:["_evaluate"]});for(const n in ts)ts[n]._classRegistryKey||Ze(`Expression_${n}`,ts[n]);function yl(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Ju(n){return n.$name||n.constructor._classRegistryKey}function Xh(n){return!function(t){if(t===null||typeof t!="object")return!1;const r=Ju(t);return!(!r||r==="Object")}(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||yl(n)||en(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function ps(n,t){if(Xh(n))return(yl(n)||en(n))&&t&&t.push(n),ArrayBuffer.isView(n)&&t&&t.push(n.buffer),n instanceof ImageData&&t&&t.push(n.data.buffer),n;if(Array.isArray(n)){const g=[];for(const _ of n)g.push(ps(_,t));return g}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const r=Ju(n);if(!r)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!Ln[r])throw new Error(`${r} is not registered.`);const{klass:a}=Ln[r],h=a.serialize?a.serialize(n,t):{};if(a.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in n){if(!n.hasOwnProperty(g)||Ln[r].omit.indexOf(g)>=0)continue;const _=n[g];h[g]=Ln[r].shallow.indexOf(g)>=0?_:ps(_,t)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(h.$name=r),h}function fs(n){if(Xh(n))return n;if(Array.isArray(n))return n.map(fs);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const t=Ju(n)||"Object";if(!Ln[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=Ln[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(n);const a=Object.create(r.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const g=n[h];a[h]=Ln[t].shallow.indexOf(h)>=0?g:fs(g)}return a}class Qu{constructor(){this.first=!0}update(t,r){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const St={"Latin-1 Supplement":n=>n>=128&&n<=255,"Hangul Jamo":n=>n>=4352&&n<=4607,Khmer:n=>n>=6016&&n<=6143,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Katakana:n=>n>=12448&&n<=12543,Kanbun:n=>n>=12688&&n<=12703,"CJK Strokes":n=>n>=12736&&n<=12783,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"Private Use Area":n=>n>=57344&&n<=63743,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function ec(n){for(const t of n)if(ic(t.charCodeAt(0)))return!0;return!1}function _f(n){for(const t of n)if(!ms(t.charCodeAt(0)))return!1;return!0}function tc(n){const t=n.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const yf=tc(["Arab","Dupl","Mong","Ougr","Syrc"]);function ms(n){return!yf.test(String.fromCodePoint(n))}const Kh=tc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ic(n){return!(n!==746&&n!==747&&(n<4352||!(St["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||St["CJK Compatibility"](n)||St["CJK Strokes"](n)||!(!St["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||St["Enclosed CJK Letters and Months"](n)||St["Ideographic Description Characters"](n)||St.Kanbun(n)||St.Katakana(n)&&n!==12540||!(!St["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!St["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||St["Vertical Forms"](n)||St["Yijing Hexagram Symbols"](n)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(n))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(n))||Kh.test(String.fromCodePoint(n)))))}function Yh(n){return!(ic(n)||function(t){return!!(St["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||St["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||St["Letterlike Symbols"](t)||St["Number Forms"](t)||St["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||St["Control Pictures"](t)&&t!==9251||St["Optical Character Recognition"](t)||St["Enclosed Alphanumerics"](t)||St["Geometric Shapes"](t)||St["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||St["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||St["CJK Symbols and Punctuation"](t)||St.Katakana(t)||St["Private Use Area"](t)||St["CJK Compatibility Forms"](t)||St["Small Form Variants"](t)||St["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(n))}const vf=tc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function nc(n){return vf.test(String.fromCodePoint(n))}function xf(n,t){return!(!t&&nc(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||St.Khmer(n))}function wf(n){for(const t of n)if(nc(t.charCodeAt(0)))return!0;return!1}const bn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ht{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Qu,this.transition={})}isSupportedScript(t){return function(r,a){for(const h of r)if(!xf(h.charCodeAt(0),a))return!1;return!0}(t,bn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class gs{constructor(t,r){this.property=t,this.value=r,this.expression=function(a,h){if(sl(a))return new us(a,h);if(ul(a)){const g=Ou(a,h);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=a;return h.type==="color"&&typeof a=="string"?g=Nt.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(g=zn.parse(a)):g=vn.parse(a),{kind:"constant",evaluate:()=>g}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,a){return this.property.possiblyEvaluate(this,t,r,a)}}class vl{constructor(t){this.property=t,this.value=new gs(t,void 0)}transitioned(t,r){return new Jh(this.property,this.value,r,Ve({},t.transition,this.transition),t.now)}untransitioned(){return new Jh(this.property,this.value,null,{},0)}}class xl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return gt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new vl(this._values[t].property)),this._values[t].value=new gs(this._values[t].property,r===null?void 0:gt(r))}getTransition(t){return gt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new vl(this._values[t].property)),this._values[t].transition=gt(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(t[r]=a);const h=this.getTransition(r);h!==void 0&&(t[`${r}-transition`]=h)}return t}transitioned(t,r){const a=new ga(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(t,r._values[h]);return a}untransitioned(){const t=new ga(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Jh{constructor(t,r,a,h,g){this.property=t,this.value=r,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(t,r,a){const h=t.now||0,g=this.value.possiblyEvaluate(t,r,a),_=this.prior;if(_){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return _.possiblyEvaluate(t,r,a);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,r,a),g,function(b){if(b<=0)return 0;if(b>=1)return 1;const I=b*b,E=I*b;return 4*(b<.5?E:3*(b-I)+E-.75)}(v))}}return g}}class ga{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,a){const h=new ya(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,r,a);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class _a{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return gt(this._values[t].value)}setValue(t,r){this._values[t]=new gs(this._values[t].property,r===null?void 0:gt(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(t[r]=a)}return t}possiblyEvaluate(t,r,a){const h=new ya(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,r,a);return h}}class Tr{constructor(t,r,a){this.property=t,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,a,h){return this.property.evaluate(this.value,this.parameters,t,r,a,h)}}class ya{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Xe{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,a){const h=on[this.specification.type];return h?h(t,r,a):t}}class ot{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,a,h){return new Tr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},a,h)}:t.expression,r)}interpolate(t,r,a){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Tr(this,{kind:"constant",value:void 0},t.parameters);const h=on[this.specification.type];if(h){const g=h(t.value.value,r.value.value,a);return new Tr(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,r,a,h,g,_){return t.kind==="constant"?t.value:t.evaluate(r,a,h,g,_)}}class wl extends ot{possiblyEvaluate(t,r,a,h){if(t.value===void 0)return new Tr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const g=t.expression.evaluate(r,null,{},a,h),_=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(_,_,_,r);return new Tr(this,{kind:"constant",value:v},r)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Tr(this,{kind:"constant",value:g},r)}return new Tr(this,t.expression,r)}evaluate(t,r,a,h,g,_){if(t.kind==="source"){const v=t.evaluate(r,a,h,g,_);return this._calculate(v,v,v,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},a,h),t.evaluate({zoom:Math.floor(r.zoom)},a,h),t.evaluate({zoom:Math.floor(r.zoom)+1},a,h),r):t.value}_calculate(t,r,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class bl{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(r,null,{},a,h);return this._calculate(g,g,g,r)}return this._calculate(t.expression.evaluate(new Ht(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Ht(Math.floor(r.zoom),r)),t.expression.evaluate(new Ht(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class rc{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,h){return!!t.expression.evaluate(r,null,{},a,h)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const a=t[r];a.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new gs(a,void 0),g=this.defaultTransitionablePropertyValues[r]=new vl(a);this.defaultTransitioningPropertyValues[r]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}Ze("DataDrivenProperty",ot),Ze("DataConstantProperty",Xe),Ze("CrossFadedDataDrivenProperty",wl),Ze("CrossFadedProperty",bl),Ze("ColorRampProperty",rc);const e="-transition";class s extends Ho{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new _a(r.layout)),r.paint)){this._transitionablePaint=new xl(r.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ya(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,a={}){r!=null&&this._validate(Wh,`layers.${this.id}.layout.${t}`,t,r,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,a={}){if(r!=null&&this._validate(Hh,`layers.${this.id}.paint.${t}`,t,r,a))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const h=this._transitionablePaint._values[t],g=h.property.specification["property-type"]==="cross-faded-data-driven",_=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const b=this._transitionablePaint._values[t].value;return b.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(t,v,b)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),mt(t,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(t,r,a,h,g={}){return(!g||g.validate!==!1)&&Yu(this,t.call(Mo,{key:r,layerType:this.type,objectKey:a,value:h,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Tr&&rs(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class c{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function x(n,t=1){let r=0,a=0;return{members:n.map(h=>{const g=u[h.type].BYTES_PER_ELEMENT,_=r=S(r,Math.max(t,g)),v=h.components||1;return a=Math.max(a,g),r+=g*v,{name:h.name,type:h.type,components:v,offset:_}}),size:S(r,Math.max(a,t)),alignment:t}}function S(n,t){return Math.ceil(n/t)*t}class k extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const h=2*t;return this.int16[h+0]=r,this.int16[h+1]=a,t}}k.prototype.bytesPerElement=4,Ze("StructArrayLayout2i4",k);class C extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,a)}emplace(t,r,a,h){const g=3*t;return this.int16[g+0]=r,this.int16[g+1]=a,this.int16[g+2]=h,t}}C.prototype.bytesPerElement=6,Ze("StructArrayLayout3i6",C);class M extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,a,h)}emplace(t,r,a,h,g){const _=4*t;return this.int16[_+0]=r,this.int16[_+1]=a,this.int16[_+2]=h,this.int16[_+3]=g,t}}M.prototype.bytesPerElement=8,Ze("StructArrayLayout4i8",M);class z extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,a,h,g,_)}emplace(t,r,a,h,g,_,v){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=_,this.int16[b+5]=v,t}}z.prototype.bytesPerElement=12,Ze("StructArrayLayout2i4i12",z);class F extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,a,h,g,_)}emplace(t,r,a,h,g,_,v){const b=4*t,I=8*t;return this.int16[b+0]=r,this.int16[b+1]=a,this.uint8[I+4]=h,this.uint8[I+5]=g,this.uint8[I+6]=_,this.uint8[I+7]=v,t}}F.prototype.bytesPerElement=8,Ze("StructArrayLayout2i4ub8",F);class V extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const h=2*t;return this.float32[h+0]=r,this.float32[h+1]=a,t}}V.prototype.bytesPerElement=8,Ze("StructArrayLayout2f8",V);class U extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,g,_,v,b,I,E){const P=this.length;return this.resize(P+1),this.emplace(P,t,r,a,h,g,_,v,b,I,E)}emplace(t,r,a,h,g,_,v,b,I,E,P){const A=10*t;return this.uint16[A+0]=r,this.uint16[A+1]=a,this.uint16[A+2]=h,this.uint16[A+3]=g,this.uint16[A+4]=_,this.uint16[A+5]=v,this.uint16[A+6]=b,this.uint16[A+7]=I,this.uint16[A+8]=E,this.uint16[A+9]=P,t}}U.prototype.bytesPerElement=20,Ze("StructArrayLayout10ui20",U);class H extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,g,_,v,b,I,E,P,A){const R=this.length;return this.resize(R+1),this.emplace(R,t,r,a,h,g,_,v,b,I,E,P,A)}emplace(t,r,a,h,g,_,v,b,I,E,P,A,R){const B=12*t;return this.int16[B+0]=r,this.int16[B+1]=a,this.int16[B+2]=h,this.int16[B+3]=g,this.uint16[B+4]=_,this.uint16[B+5]=v,this.uint16[B+6]=b,this.uint16[B+7]=I,this.int16[B+8]=E,this.int16[B+9]=P,this.int16[B+10]=A,this.int16[B+11]=R,t}}H.prototype.bytesPerElement=24,Ze("StructArrayLayout4i4ui4i24",H);class J extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,a)}emplace(t,r,a,h){const g=3*t;return this.float32[g+0]=r,this.float32[g+1]=a,this.float32[g+2]=h,t}}J.prototype.bytesPerElement=12,Ze("StructArrayLayout3f12",J);class Q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}Q.prototype.bytesPerElement=4,Ze("StructArrayLayout1ul4",Q);class te extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,g,_,v,b,I){const E=this.length;return this.resize(E+1),this.emplace(E,t,r,a,h,g,_,v,b,I)}emplace(t,r,a,h,g,_,v,b,I,E){const P=10*t,A=5*t;return this.int16[P+0]=r,this.int16[P+1]=a,this.int16[P+2]=h,this.int16[P+3]=g,this.int16[P+4]=_,this.int16[P+5]=v,this.uint32[A+3]=b,this.uint16[P+8]=I,this.uint16[P+9]=E,t}}te.prototype.bytesPerElement=20,Ze("StructArrayLayout6i1ul2ui20",te);class q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,a,h,g,_)}emplace(t,r,a,h,g,_,v){const b=6*t;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=_,this.int16[b+5]=v,t}}q.prototype.bytesPerElement=12,Ze("StructArrayLayout2i2i2i12",q);class ae extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,a,h,g)}emplace(t,r,a,h,g,_){const v=4*t,b=8*t;return this.float32[v+0]=r,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[b+6]=g,this.int16[b+7]=_,t}}ae.prototype.bytesPerElement=16,Ze("StructArrayLayout2f1f2i16",ae);class ce extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,a,h,g,_)}emplace(t,r,a,h,g,_,v){const b=16*t,I=4*t,E=8*t;return this.uint8[b+0]=r,this.uint8[b+1]=a,this.float32[I+1]=h,this.float32[I+2]=g,this.int16[E+6]=_,this.int16[E+7]=v,t}}ce.prototype.bytesPerElement=16,Ze("StructArrayLayout2ub2f2i16",ce);class fe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,a)}emplace(t,r,a,h){const g=3*t;return this.uint16[g+0]=r,this.uint16[g+1]=a,this.uint16[g+2]=h,t}}fe.prototype.bytesPerElement=6,Ze("StructArrayLayout3ui6",fe);class we extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,h,g,_,v,b,I,E,P,A,R,B,N,Z,Y){const pe=this.length;return this.resize(pe+1),this.emplace(pe,t,r,a,h,g,_,v,b,I,E,P,A,R,B,N,Z,Y)}emplace(t,r,a,h,g,_,v,b,I,E,P,A,R,B,N,Z,Y,pe){const ne=24*t,he=12*t,_e=48*t;return this.int16[ne+0]=r,this.int16[ne+1]=a,this.uint16[ne+2]=h,this.uint16[ne+3]=g,this.uint32[he+2]=_,this.uint32[he+3]=v,this.uint32[he+4]=b,this.uint16[ne+10]=I,this.uint16[ne+11]=E,this.uint16[ne+12]=P,this.float32[he+7]=A,this.float32[he+8]=R,this.uint8[_e+36]=B,this.uint8[_e+37]=N,this.uint8[_e+38]=Z,this.uint32[he+10]=Y,this.int16[ne+22]=pe,t}}we.prototype.bytesPerElement=48,Ze("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",we);class Ee extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,h,g,_,v,b,I,E,P,A,R,B,N,Z,Y,pe,ne,he,_e,ke,je,rt,Oe,Fe,Je,He){const qe=this.length;return this.resize(qe+1),this.emplace(qe,t,r,a,h,g,_,v,b,I,E,P,A,R,B,N,Z,Y,pe,ne,he,_e,ke,je,rt,Oe,Fe,Je,He)}emplace(t,r,a,h,g,_,v,b,I,E,P,A,R,B,N,Z,Y,pe,ne,he,_e,ke,je,rt,Oe,Fe,Je,He,qe){const ve=32*t,et=16*t;return this.int16[ve+0]=r,this.int16[ve+1]=a,this.int16[ve+2]=h,this.int16[ve+3]=g,this.int16[ve+4]=_,this.int16[ve+5]=v,this.int16[ve+6]=b,this.int16[ve+7]=I,this.uint16[ve+8]=E,this.uint16[ve+9]=P,this.uint16[ve+10]=A,this.uint16[ve+11]=R,this.uint16[ve+12]=B,this.uint16[ve+13]=N,this.uint16[ve+14]=Z,this.uint16[ve+15]=Y,this.uint16[ve+16]=pe,this.uint16[ve+17]=ne,this.uint16[ve+18]=he,this.uint16[ve+19]=_e,this.uint16[ve+20]=ke,this.uint16[ve+21]=je,this.uint16[ve+22]=rt,this.uint32[et+12]=Oe,this.float32[et+13]=Fe,this.float32[et+14]=Je,this.uint16[ve+30]=He,this.uint16[ve+31]=qe,t}}Ee.prototype.bytesPerElement=64,Ze("StructArrayLayout8i15ui1ul2f2ui64",Ee);class Be extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Be.prototype.bytesPerElement=4,Ze("StructArrayLayout1f4",Be);class Ue extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,a)}emplace(t,r,a,h){const g=3*t;return this.uint16[6*t+0]=r,this.float32[g+1]=a,this.float32[g+2]=h,t}}Ue.prototype.bytesPerElement=12,Ze("StructArrayLayout1ui2f12",Ue);class De extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,t,r,a)}emplace(t,r,a,h){const g=4*t;return this.uint32[2*t+0]=r,this.uint16[g+2]=a,this.uint16[g+3]=h,t}}De.prototype.bytesPerElement=8,Ze("StructArrayLayout1ul2ui8",De);class Ae extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const h=2*t;return this.uint16[h+0]=r,this.uint16[h+1]=a,t}}Ae.prototype.bytesPerElement=4,Ze("StructArrayLayout2ui4",Ae);class Ke extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Ke.prototype.bytesPerElement=2,Ze("StructArrayLayout1ui2",Ke);class ut extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,a,h)}emplace(t,r,a,h,g){const _=4*t;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=h,this.float32[_+3]=g,t}}ut.prototype.bytesPerElement=16,Ze("StructArrayLayout4f16",ut);class Re extends c{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new X(this.anchorPointX,this.anchorPointY)}}Re.prototype.size=20;class Ne extends te{get(t){return new Re(this,t)}}Ze("CollisionBoxArray",Ne);class at extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}at.prototype.size=48;class Wt extends we{get(t){return new at(this,t)}}Ze("PlacedSymbolArray",Wt);class ft extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ft.prototype.size=64;class wt extends Ee{get(t){return new ft(this,t)}}Ze("SymbolInstanceArray",wt);class Xt extends Be{getoffsetX(t){return this.float32[1*t+0]}}Ze("GlyphOffsetArray",Xt);class Ri extends C{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ze("SymbolLineVertexArray",Ri);class er extends c{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}er.prototype.size=12;class Kt extends Ue{get(t){return new er(this,t)}}Ze("TextAnchorOffsetArray",Kt);class an extends c{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}an.prototype.size=8;class Gi extends De{get(t){return new an(this,t)}}Ze("FeatureIndexArray",Gi);class Fi extends k{}class Hi extends k{}class kr extends k{}class _s extends z{}class Sl extends F{}class ys extends V{}class Rn extends U{}class Tl extends H{}class oc extends J{}class Fn extends Q{}class Bn extends q{}class no extends ce{}class tr extends fe{}class Pi extends Ae{}const Bi=x([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sn}=Bi;class Tt{constructor(t=[]){this.segments=t}prepareSegment(t,r,a,h){let g=this.segments[this.segments.length-1];return t>Tt.MAX_VERTEX_ARRAY_LENGTH&&oi(`Max vertices per segment is ${Tt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>Tt.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,a,h){return new Tt([{vertexOffset:t,primitiveOffset:r,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function zo(n,t){return 256*(n=Pe(Math.floor(n),0,255))+Pe(Math.floor(t),0,255)}Tt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ze("SegmentVector",Tt);const vs=x([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var xs={exports:{}},Qh={exports:{}};Qh.exports=function(n,t){var r,a,h,g,_,v,b,I;for(a=n.length-(r=3&n.length),h=t,_=3432918353,v=461845907,I=0;I<a;)b=255&n.charCodeAt(I)|(255&n.charCodeAt(++I))<<8|(255&n.charCodeAt(++I))<<16|(255&n.charCodeAt(++I))<<24,++I,h=27492+(65535&(g=5*(65535&(h=(h^=b=(65535&(b=(b=(65535&b)*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&n.charCodeAt(I+2))<<16;case 2:b^=(255&n.charCodeAt(I+1))<<8;case 1:h^=b=(65535&(b=(b=(65535&(b^=255&n.charCodeAt(I)))*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var bf=Qh.exports,ed={exports:{}};ed.exports=function(n,t){for(var r,a=n.length,h=t^a,g=0;a>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(g)|(255&n.charCodeAt(++g))<<8|(255&n.charCodeAt(++g))<<16|(255&n.charCodeAt(++g))<<24))+((1540483477*(r>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++g;switch(a){case 3:h^=(255&n.charCodeAt(g+2))<<16;case 2:h^=(255&n.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var ro=bf,td=ed.exports;xs.exports=ro,xs.exports.murmur3=ro,xs.exports.murmur2=td;var kl=O(xs.exports);class va{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,a,h){this.ids.push(Il(t)),this.positions.push(r,a,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Il(t);let a=0,h=this.ids.length-1;for(;a<h;){const _=a+h>>1;this.ids[_]>=r?h=_:a=_+1}const g=[];for(;this.ids[a]===r;)g.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return g}static serialize(t,r){const a=new Float64Array(t.ids),h=new Uint32Array(t.positions);return El(a,h,0,a.length-1),r&&r.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(t){const r=new va;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Il(n){const t=+n;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:kl(String(n))}function El(n,t,r,a){for(;r<a;){const h=n[r+a>>1];let g=r-1,_=a+1;for(;;){do g++;while(n[g]<h);do _--;while(n[_]>h);if(g>=_)break;ws(n,g,_),ws(t,3*g,3*_),ws(t,3*g+1,3*_+1),ws(t,3*g+2,3*_+2)}_-r<a-_?(El(n,t,r,_),r=_+1):(El(n,t,_+1,a),a=_)}}function ws(n,t,r){const a=n[t];n[t]=n[r],n[r]=a}Ze("FeaturePositionMap",va);class xa{constructor(t,r){this.gl=t.gl,this.location=r}}class id extends xa{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class $_ extends xa{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class q_ extends xa{constructor(t,r){super(t,r),this.current=Nt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Vw=new Float32Array(16);function Sf(n){return[zo(255*n.r,255*n.g),zo(255*n.b,255*n.a)]}class sc{constructor(t,r,a){this.value=t,this.uniformNames=r.map(h=>`u_${h}`),this.type=a}setUniform(t,r,a){t.set(a.constantOr(this.value))}getBinding(t,r,a){return this.type==="color"?new q_(t,r):new id(t,r)}}class Cl{constructor(t,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,a,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,r,a){return a.substr(0,9)==="u_pattern"?new $_(t,r):new id(t,r)}}class Ao{constructor(t,r,a,h){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,r,a,h,g){const _=this.paintVertexArray.length,v=this.expression.evaluate(new Ht(0),r,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(_,t,v)}updatePaintArray(t,r,a,h){const g=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(t,r,g)}_setPaintValue(t,r,a){if(this.type==="color"){const h=Sf(a);for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<r;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nr{constructor(t,r,a,h,g,_){this.expression=t,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,r,a,h,g){const _=this.expression.evaluate(new Ht(this.zoom),r,{},h,[],g),v=this.expression.evaluate(new Ht(this.zoom+1),r,{},h,[],g),b=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(b,t,_,v)}updatePaintArray(t,r,a,h){const g=this.expression.evaluate({zoom:this.zoom},a,h),_=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(t,r,g,_)}_setPaintValue(t,r,a,h){if(this.type==="color"){const g=Sf(a),_=Sf(h);for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,g[0],g[1],_[0],_[1])}else{for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=Pe(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,r,a){return new id(t,r)}}class bs{constructor(t,r,a,h,g,_){this.expression=t,this.type=r,this.useIntegerZoom=a,this.zoom=h,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,r,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(t,r,a,h,g){this._setPaintValues(t,r,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(t,r,a,h){if(!h||!a)return;const{min:g,mid:_,max:v}=a,b=h[g],I=h[_],E=h[v];if(b&&I&&E)for(let P=t;P<r;P++)this.zoomInPaintVertexArray.emplace(P,I.tl[0],I.tl[1],I.br[0],I.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],I.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,I.tl[0],I.tl[1],I.br[0],I.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],I.pixelRatio,E.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,vs.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,vs.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Z_{constructor(t,r,a){this.binders={},this._buffers=[];const h=[];for(const g in t.paint._values){if(!a(g))continue;const _=t.paint.get(g);if(!(_ instanceof Tr&&rs(_.property.specification)))continue;const v=jw(g,t.type),b=_.value,I=_.property.specification.type,E=_.property.useIntegerZoom,P=_.property.specification["property-type"],A=P==="cross-faded"||P==="cross-faded-data-driven";if(b.kind==="constant")this.binders[g]=A?new Cl(b.value,v):new sc(b.value,v,I),h.push(`/u_${g}`);else if(b.kind==="source"||A){const R=G_(g,I,"source");this.binders[g]=A?new bs(b,I,E,r,R,t.id):new Ao(b,v,I,R),h.push(`/a_${g}`)}else{const R=G_(g,I,"composite");this.binders[g]=new Nr(b,v,I,E,r,R),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Ao||r instanceof Nr?r.maxValue:0}populatePaintArrays(t,r,a,h,g){for(const _ in this.binders){const v=this.binders[_];(v instanceof Ao||v instanceof Nr||v instanceof bs)&&v.populatePaintArray(t,r,a,h,g)}}setConstantPatternPositions(t,r){for(const a in this.binders){const h=this.binders[a];h instanceof Cl&&h.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,a,h,g){let _=!1;for(const v in t){const b=r.getPositions(v);for(const I of b){const E=a.feature(I.index);for(const P in this.binders){const A=this.binders[P];if((A instanceof Ao||A instanceof Nr||A instanceof bs)&&A.expression.isStateDependent===!0){const R=h.paint.get(P);A.expression=R.value,A.updatePaintArray(I.start,I.end,E,t[v],g),_=!0}}}}return _}defines(){const t=[];for(const r in this.binders){const a=this.binders[r];(a instanceof sc||a instanceof Cl)&&t.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Ao||a instanceof Nr)for(let h=0;h<a.paintVertexAttributes.length;h++)t.push(a.paintVertexAttributes[h].name);else if(a instanceof bs)for(let h=0;h<vs.members.length;h++)t.push(vs.members[h].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof sc||a instanceof Cl||a instanceof Nr)for(const h of a.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const a=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof sc||g instanceof Cl||g instanceof Nr){for(const _ of g.uniformNames)if(r[_]){const v=g.getBinding(t,r[_],_);a.push({name:_,property:h,binding:v})}}}return a}setUniforms(t,r,a,h){for(const{name:g,property:_,binding:v}of r)this.binders[_].setUniform(v,h,a.get(_),g)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(t&&a instanceof bs){const h=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof Ao||a instanceof Nr)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const r in this.binders){const a=this.binders[r];(a instanceof Ao||a instanceof Nr||a instanceof bs)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Ao||r instanceof Nr||r instanceof bs)&&r.destroy()}}}class wa{constructor(t,r,a=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Z_(h,r,a);this.needsUpload=!1,this._featureMap=new va,this._bufferOffset=0}populatePaintArrays(t,r,a,h,g,_){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,r,h,g,_);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,a,h){for(const g of a)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,r,g,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function jw(n,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${t}-`,"").replace(/-/g,"_")]}function G_(n,t,r){const a={color:{source:V,composite:ut},number:{source:Be,composite:V}},h=function(g){return{"line-pattern":{source:Rn,composite:Rn},"fill-pattern":{source:Rn,composite:Rn},"fill-extrusion-pattern":{source:Rn,composite:Rn}}[g]}(n);return h&&h[r]||a[t][r]}Ze("ConstantBinder",sc),Ze("CrossFadedConstantBinder",Cl),Ze("SourceExpressionBinder",Ao),Ze("CrossFadedCompositeBinder",bs),Ze("CompositeExpressionBinder",Nr),Ze("ProgramConfiguration",Z_,{omit:["_buffers"]}),Ze("ProgramConfigurationSet",wa);const _i=8192,Tf=Math.pow(2,14)-1,H_=-Tf-1;function ba(n){const t=_i/n.extent,r=n.loadGeometry();for(let a=0;a<r.length;a++){const h=r[a];for(let g=0;g<h.length;g++){const _=h[g],v=Math.round(_.x*t),b=Math.round(_.y*t);_.x=Pe(v,H_,Tf),_.y=Pe(b,H_,Tf),(v<_.x||v>_.x+1||b<_.y||b>_.y+1)&&oi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Sa(n,t){return{type:n.type,id:n.id,properties:n.properties,geometry:t?ba(n):[]}}function nd(n,t,r,a,h){n.emplaceBack(2*t+(a+1)/2,2*r+(h+1)/2)}class kf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Hi,this.indexArray=new tr,this.segments=new Tt,this.programConfigurations=new wa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){const h=this.layers[0],g=[];let _=null,v=!1;h.type==="circle"&&(_=h.layout.get("circle-sort-key"),v=!_.isConstant());for(const{feature:b,id:I,index:E,sourceLayerIndex:P}of t){const A=this.layers[0]._featureFilter.needGeometry,R=Sa(b,A);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),R,a))continue;const B=v?_.evaluate(R,{},a):void 0,N={id:I,properties:b.properties,type:b.type,sourceLayerIndex:P,index:E,geometry:A?R.geometry:ba(b),patterns:{},sortKey:B};g.push(N)}v&&g.sort((b,I)=>b.sortKey-I.sortKey);for(const b of g){const{geometry:I,index:E,sourceLayerIndex:P}=b,A=t[E].feature;this.addFeature(b,I,E,a),r.featureIndex.insert(A,I,E,P,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,a,h){for(const g of r)for(const _ of g){const v=_.x,b=_.y;if(v<0||v>=_i||b<0||b>=_i)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=I.vertexLength;nd(this.layoutVertexArray,v,b,-1,-1),nd(this.layoutVertexArray,v,b,1,-1),nd(this.layoutVertexArray,v,b,1,1),nd(this.layoutVertexArray,v,b,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},h)}}function W_(n,t){for(let r=0;r<n.length;r++)if(Pl(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(Pl(n,t[r]))return!0;return!!If(n,t)}function Uw(n,t,r){return!!Pl(n,t)||!!Ef(t,n,r)}function X_(n,t){if(n.length===1)return Y_(t,n[0]);for(let r=0;r<t.length;r++){const a=t[r];for(let h=0;h<a.length;h++)if(Pl(n,a[h]))return!0}for(let r=0;r<n.length;r++)if(Y_(t,n[r]))return!0;for(let r=0;r<t.length;r++)if(If(n,t[r]))return!0;return!1}function $w(n,t,r){if(n.length>1){if(If(n,t))return!0;for(let a=0;a<t.length;a++)if(Ef(t[a],n,r))return!0}for(let a=0;a<n.length;a++)if(Ef(n[a],t,r))return!0;return!1}function If(n,t){if(n.length===0||t.length===0)return!1;for(let r=0;r<n.length-1;r++){const a=n[r],h=n[r+1];for(let g=0;g<t.length-1;g++)if(qw(a,h,t[g],t[g+1]))return!0}return!1}function qw(n,t,r,a){return wi(n,r,a)!==wi(t,r,a)&&wi(n,t,r)!==wi(n,t,a)}function Ef(n,t,r){const a=r*r;if(t.length===1)return n.distSqr(t[0])<a;for(let h=1;h<t.length;h++)if(K_(n,t[h-1],t[h])<a)return!0;return!1}function K_(n,t,r){const a=t.distSqr(r);if(a===0)return n.distSqr(t);const h=((n.x-t.x)*(r.x-t.x)+(n.y-t.y)*(r.y-t.y))/a;return n.distSqr(h<0?t:h>1?r:r.sub(t)._mult(h)._add(t))}function Y_(n,t){let r,a,h,g=!1;for(let _=0;_<n.length;_++){r=n[_];for(let v=0,b=r.length-1;v<r.length;b=v++)a=r[v],h=r[b],a.y>t.y!=h.y>t.y&&t.x<(h.x-a.x)*(t.y-a.y)/(h.y-a.y)+a.x&&(g=!g)}return g}function Pl(n,t){let r=!1;for(let a=0,h=n.length-1;a<n.length;h=a++){const g=n[a],_=n[h];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(r=!r)}return r}function Zw(n,t,r){const a=r[0],h=r[2];if(n.x<a.x&&t.x<a.x||n.x>h.x&&t.x>h.x||n.y<a.y&&t.y<a.y||n.y>h.y&&t.y>h.y)return!1;const g=wi(n,t,r[0]);return g!==wi(n,t,r[1])||g!==wi(n,t,r[2])||g!==wi(n,t,r[3])}function ac(n,t,r){const a=t.paint.get(n).value;return a.kind==="constant"?a.value:r.programConfigurations.get(t.id).getMaxValue(n)}function rd(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function od(n,t,r,a,h){if(!t[0]&&!t[1])return n;const g=X.convert(t)._mult(h);r==="viewport"&&g._rotate(-a);const _=[];for(let v=0;v<n.length;v++)_.push(n[v].sub(g));return _}let J_,Q_;Ze("CircleBucket",kf,{omit:["layers"]});var Gw={get paint(){return Q_=Q_||new f({"circle-radius":new ot(ge.paint_circle["circle-radius"]),"circle-color":new ot(ge.paint_circle["circle-color"]),"circle-blur":new ot(ge.paint_circle["circle-blur"]),"circle-opacity":new ot(ge.paint_circle["circle-opacity"]),"circle-translate":new Xe(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Xe(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xe(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xe(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ot(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ot(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ot(ge.paint_circle["circle-stroke-opacity"])})},get layout(){return J_=J_||new f({"circle-sort-key":new ot(ge.layout_circle["circle-sort-key"])})}},ln=1e-6,Ml=typeof Float32Array<"u"?Float32Array:Array;function Cf(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ey(n,t,r){var a=t[0],h=t[1],g=t[2],_=t[3],v=t[4],b=t[5],I=t[6],E=t[7],P=t[8],A=t[9],R=t[10],B=t[11],N=t[12],Z=t[13],Y=t[14],pe=t[15],ne=r[0],he=r[1],_e=r[2],ke=r[3];return n[0]=ne*a+he*v+_e*P+ke*N,n[1]=ne*h+he*b+_e*A+ke*Z,n[2]=ne*g+he*I+_e*R+ke*Y,n[3]=ne*_+he*E+_e*B+ke*pe,n[4]=(ne=r[4])*a+(he=r[5])*v+(_e=r[6])*P+(ke=r[7])*N,n[5]=ne*h+he*b+_e*A+ke*Z,n[6]=ne*g+he*I+_e*R+ke*Y,n[7]=ne*_+he*E+_e*B+ke*pe,n[8]=(ne=r[8])*a+(he=r[9])*v+(_e=r[10])*P+(ke=r[11])*N,n[9]=ne*h+he*b+_e*A+ke*Z,n[10]=ne*g+he*I+_e*R+ke*Y,n[11]=ne*_+he*E+_e*B+ke*pe,n[12]=(ne=r[12])*a+(he=r[13])*v+(_e=r[14])*P+(ke=r[15])*N,n[13]=ne*h+he*b+_e*A+ke*Z,n[14]=ne*g+he*I+_e*R+ke*Y,n[15]=ne*_+he*E+_e*B+ke*pe,n}Math.hypot||(Math.hypot=function(){for(var n=0,t=arguments.length;t--;)n+=arguments[t]*arguments[t];return Math.sqrt(n)});var lc,Hw=ey;function sd(n,t,r){var a=t[0],h=t[1],g=t[2],_=t[3];return n[0]=r[0]*a+r[4]*h+r[8]*g+r[12]*_,n[1]=r[1]*a+r[5]*h+r[9]*g+r[13]*_,n[2]=r[2]*a+r[6]*h+r[10]*g+r[14]*_,n[3]=r[3]*a+r[7]*h+r[11]*g+r[15]*_,n}lc=new Ml(4),Ml!=Float32Array&&(lc[0]=0,lc[1]=0,lc[2]=0,lc[3]=0);class Ww extends s{constructor(t){super(t,Gw)}createBucket(t){return new kf(t)}queryRadius(t){const r=t;return ac("circle-radius",this,r)+ac("circle-stroke-width",this,r)+rd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,a,h,g,_,v,b){const I=od(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,v),E=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),P=this.paint.get("circle-pitch-alignment")==="map",A=P?I:function(B,N){return B.map(Z=>ty(Z,N))}(I,b),R=P?E*v:E;for(const B of h)for(const N of B){const Z=P?N:ty(N,b);let Y=R;const pe=sd([],[N.x,N.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=pe[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=_.cameraToCenterDistance/pe[3]),Uw(A,Z,Y))return!0}return!1}}function ty(n,t){const r=sd([],[n.x,n.y,0,1],t);return new X(r[0]/r[3],r[1]/r[3])}class iy extends kf{}let ny;Ze("HeatmapBucket",iy,{omit:["layers"]});var Xw={get paint(){return ny=ny||new f({"heatmap-radius":new ot(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ot(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xe(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rc(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xe(ge.paint_heatmap["heatmap-opacity"])})}};function Pf(n,{width:t,height:r},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*r*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*r*a}`)}else h=new Uint8Array(t*r*a);return n.width=t,n.height=r,n.data=h,n}function ry(n,{width:t,height:r},a){if(t===n.width&&r===n.height)return;const h=Pf({},{width:t,height:r},a);Mf(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,t),height:Math.min(n.height,r)},a),n.width=t,n.height=r,n.data=h.data}function Mf(n,t,r,a,h,g){if(h.width===0||h.height===0)return t;if(h.width>n.width||h.height>n.height||r.x>n.width-h.width||r.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||a.x>t.width-h.width||a.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=n.data,v=t.data;if(_===v)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<h.height;b++){const I=((r.y+b)*n.width+r.x)*g,E=((a.y+b)*t.width+a.x)*g;for(let P=0;P<h.width*g;P++)v[E+P]=_[I+P]}return t}class uc{constructor(t,r){Pf(this,t,1,r)}resize(t){ry(this,t,1)}clone(){return new uc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,h,g){Mf(t,r,a,h,g,1)}}class ir{constructor(t,r){Pf(this,t,4,r)}resize(t){ry(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ir({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,h,g){Mf(t,r,a,h,g,4)}}function oy(n){const t={},r=n.resolution||256,a=n.clips?n.clips.length:1,h=n.image||new ir({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const g=(_,v,b)=>{t[n.evaluationKey]=b;const I=n.expression.evaluate(t);h.data[_+v+0]=Math.floor(255*I.r/I.a),h.data[_+v+1]=Math.floor(255*I.g/I.a),h.data[_+v+2]=Math.floor(255*I.b/I.a),h.data[_+v+3]=Math.floor(255*I.a)};if(n.clips)for(let _=0,v=0;_<a;++_,v+=4*r)for(let b=0,I=0;b<r;b++,I+=4){const E=b/(r-1),{start:P,end:A}=n.clips[_];g(v,I,P*(1-E)+A*E)}else for(let _=0,v=0;_<r;_++,v+=4)g(0,v,_/(r-1));return h}Ze("AlphaImage",uc),Ze("RGBAImage",ir);const zf="big-fb";class Kw extends s{createBucket(t){return new iy(t)}constructor(t){super(t,Xw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=oy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(zf)&&this.heatmapFbos.delete(zf)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let sy;var Yw={get paint(){return sy=sy||new f({"hillshade-illumination-direction":new Xe(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xe(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xe(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xe(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xe(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xe(ge.paint_hillshade["hillshade-accent-color"])})}};class Jw extends s{constructor(t){super(t,Yw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Qw=x([{name:"a_pos",components:2,type:"Int16"}],4),{members:eb}=Qw;function ay(n,t,r=2){const a=t&&t.length,h=a?t[0]*r:n.length;let g=ly(n,0,h,r,!0);const _=[];if(!g||g.next===g.prev)return _;let v,b,I;if(a&&(g=function(E,P,A,R){const B=[];for(let N=0,Z=P.length;N<Z;N++){const Y=ly(E,P[N]*R,N<Z-1?P[N+1]*R:E.length,R,!1);Y===Y.next&&(Y.steiner=!0),B.push(lb(Y))}B.sort(ob);for(let N=0;N<B.length;N++)A=sb(B[N],A);return A}(n,t,g,r)),n.length>80*r){v=1/0,b=1/0;let E=-1/0,P=-1/0;for(let A=r;A<h;A+=r){const R=n[A],B=n[A+1];R<v&&(v=R),B<b&&(b=B),R>E&&(E=R),B>P&&(P=B)}I=Math.max(E-v,P-b),I=I!==0?32767/I:0}return cc(g,_,r,v,b,I,0),_}function ly(n,t,r,a,h){let g;if(h===function(_,v,b,I){let E=0;for(let P=v,A=b-I;P<b;P+=I)E+=(_[A]-_[P])*(_[P+1]+_[A+1]),A=P;return E}(n,t,r,a)>0)for(let _=t;_<r;_+=a)g=hy(_/a|0,n[_],n[_+1],g);else for(let _=r-a;_>=t;_-=a)g=hy(_/a|0,n[_],n[_+1],g);return g&&ad(g,g.next)&&(dc(g),g=g.next),g}function Ta(n,t){if(!n)return n;t||(t=n);let r,a=n;do if(r=!1,a.steiner||!ad(a,a.next)&&hi(a.prev,a,a.next)!==0)a=a.next;else{if(dc(a),a=t=a.prev,a===a.next)break;r=!0}while(r||a!==t);return t}function cc(n,t,r,a,h,g,_){if(!n)return;!_&&g&&function(b,I,E,P){let A=b;do A.z===0&&(A.z=Af(A.x,A.y,I,E,P)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==b);A.prevZ.nextZ=null,A.prevZ=null,function(R){let B,N=1;do{let Z,Y=R;R=null;let pe=null;for(B=0;Y;){B++;let ne=Y,he=0;for(let ke=0;ke<N&&(he++,ne=ne.nextZ,ne);ke++);let _e=N;for(;he>0||_e>0&&ne;)he!==0&&(_e===0||!ne||Y.z<=ne.z)?(Z=Y,Y=Y.nextZ,he--):(Z=ne,ne=ne.nextZ,_e--),pe?pe.nextZ=Z:R=Z,Z.prevZ=pe,pe=Z;Y=ne}pe.nextZ=null,N*=2}while(B>1)}(A)}(n,a,h,g);let v=n;for(;n.prev!==n.next;){const b=n.prev,I=n.next;if(g?ib(n,a,h,g):tb(n))t.push(b.i,n.i,I.i),dc(n),n=I.next,v=I.next;else if((n=I)===v){_?_===1?cc(n=nb(Ta(n),t),t,r,a,h,g,2):_===2&&rb(n,t,r,a,h,g):cc(Ta(n),t,r,a,h,g,1);break}}}function tb(n){const t=n.prev,r=n,a=n.next;if(hi(t,r,a)>=0)return!1;const h=t.x,g=r.x,_=a.x,v=t.y,b=r.y,I=a.y,E=h<g?h<_?h:_:g<_?g:_,P=v<b?v<I?v:I:b<I?b:I,A=h>g?h>_?h:_:g>_?g:_,R=v>b?v>I?v:I:b>I?b:I;let B=a.next;for(;B!==t;){if(B.x>=E&&B.x<=A&&B.y>=P&&B.y<=R&&zl(h,v,g,b,_,I,B.x,B.y)&&hi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function ib(n,t,r,a){const h=n.prev,g=n,_=n.next;if(hi(h,g,_)>=0)return!1;const v=h.x,b=g.x,I=_.x,E=h.y,P=g.y,A=_.y,R=v<b?v<I?v:I:b<I?b:I,B=E<P?E<A?E:A:P<A?P:A,N=v>b?v>I?v:I:b>I?b:I,Z=E>P?E>A?E:A:P>A?P:A,Y=Af(R,B,t,r,a),pe=Af(N,Z,t,r,a);let ne=n.prevZ,he=n.nextZ;for(;ne&&ne.z>=Y&&he&&he.z<=pe;){if(ne.x>=R&&ne.x<=N&&ne.y>=B&&ne.y<=Z&&ne!==h&&ne!==_&&zl(v,E,b,P,I,A,ne.x,ne.y)&&hi(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,he.x>=R&&he.x<=N&&he.y>=B&&he.y<=Z&&he!==h&&he!==_&&zl(v,E,b,P,I,A,he.x,he.y)&&hi(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ne&&ne.z>=Y;){if(ne.x>=R&&ne.x<=N&&ne.y>=B&&ne.y<=Z&&ne!==h&&ne!==_&&zl(v,E,b,P,I,A,ne.x,ne.y)&&hi(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;he&&he.z<=pe;){if(he.x>=R&&he.x<=N&&he.y>=B&&he.y<=Z&&he!==h&&he!==_&&zl(v,E,b,P,I,A,he.x,he.y)&&hi(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function nb(n,t){let r=n;do{const a=r.prev,h=r.next.next;!ad(a,h)&&uy(a,r,r.next,h)&&hc(a,h)&&hc(h,a)&&(t.push(a.i,r.i,h.i),dc(r),dc(r.next),r=n=h),r=r.next}while(r!==n);return Ta(r)}function rb(n,t,r,a,h,g){let _=n;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&ub(_,v)){let b=cy(_,v);return _=Ta(_,_.next),b=Ta(b,b.next),cc(_,t,r,a,h,g,0),void cc(b,t,r,a,h,g,0)}v=v.next}_=_.next}while(_!==n)}function ob(n,t){return n.x-t.x}function sb(n,t){const r=function(h,g){let _=g;const v=h.x,b=h.y;let I,E=-1/0;do{if(b<=_.y&&b>=_.next.y&&_.next.y!==_.y){const N=_.x+(b-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(N<=v&&N>E&&(E=N,I=_.x<_.next.x?_:_.next,N===v))return I}_=_.next}while(_!==g);if(!I)return null;const P=I,A=I.x,R=I.y;let B=1/0;_=I;do{if(v>=_.x&&_.x>=A&&v!==_.x&&zl(b<R?v:E,b,A,R,b<R?E:v,b,_.x,_.y)){const N=Math.abs(b-_.y)/(v-_.x);hc(_,h)&&(N<B||N===B&&(_.x>I.x||_.x===I.x&&ab(I,_)))&&(I=_,B=N)}_=_.next}while(_!==P);return I}(n,t);if(!r)return t;const a=cy(r,n);return Ta(a,a.next),Ta(r,r.next)}function ab(n,t){return hi(n.prev,n,t.prev)<0&&hi(t.next,n,n.next)<0}function Af(n,t,r,a,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function lb(n){let t=n,r=n;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==n);return r}function zl(n,t,r,a,h,g,_,v){return(h-_)*(t-v)>=(n-_)*(g-v)&&(n-_)*(a-v)>=(r-_)*(t-v)&&(r-_)*(g-v)>=(h-_)*(a-v)}function ub(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!function(r,a){let h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==a.i&&h.next.i!==a.i&&uy(h,h.next,r,a))return!0;h=h.next}while(h!==r);return!1}(n,t)&&(hc(n,t)&&hc(t,n)&&function(r,a){let h=r,g=!1;const _=(r.x+a.x)/2,v=(r.y+a.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&_<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==r);return g}(n,t)&&(hi(n.prev,n,t.prev)||hi(n,t.prev,t))||ad(n,t)&&hi(n.prev,n,n.next)>0&&hi(t.prev,t,t.next)>0)}function hi(n,t,r){return(t.y-n.y)*(r.x-t.x)-(t.x-n.x)*(r.y-t.y)}function ad(n,t){return n.x===t.x&&n.y===t.y}function uy(n,t,r,a){const h=ud(hi(n,t,r)),g=ud(hi(n,t,a)),_=ud(hi(r,a,n)),v=ud(hi(r,a,t));return h!==g&&_!==v||!(h!==0||!ld(n,r,t))||!(g!==0||!ld(n,a,t))||!(_!==0||!ld(r,n,a))||!(v!==0||!ld(r,t,a))}function ld(n,t,r){return t.x<=Math.max(n.x,r.x)&&t.x>=Math.min(n.x,r.x)&&t.y<=Math.max(n.y,r.y)&&t.y>=Math.min(n.y,r.y)}function ud(n){return n>0?1:n<0?-1:0}function hc(n,t){return hi(n.prev,n,n.next)<0?hi(n,t,n.next)>=0&&hi(n,n.prev,t)>=0:hi(n,t,n.prev)<0||hi(n,n.next,t)<0}function cy(n,t){const r=Df(n.i,n.x,n.y),a=Df(t.i,t.x,t.y),h=n.next,g=t.prev;return n.next=t,t.prev=n,r.next=h,h.prev=r,a.next=r,r.prev=a,g.next=a,a.prev=g,a}function hy(n,t,r,a){const h=Df(n,t,r);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function dc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Df(n,t,r){return{i:n,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Lf(n,t,r){const a=r.patternDependencies;let h=!1;for(const g of t){const _=g.paint.get(`${n}-pattern`);_.isConstant()||(h=!0);const v=_.constantOr(null);v&&(h=!0,a[v.to]=!0,a[v.from]=!0)}return h}function Rf(n,t,r,a,h){const g=h.patternDependencies;for(const _ of t){const v=_.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:a-1},r,{},h.availableImages),I=v.evaluate({zoom:a},r,{},h.availableImages),E=v.evaluate({zoom:a+1},r,{},h.availableImages);b=b&&b.name?b.name:b,I=I&&I.name?I.name:I,E=E&&E.name?E.name:E,g[b]=!0,g[I]=!0,g[E]=!0,r.patterns[_.id]={min:b,mid:I,max:E}}}return r}class Ff{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new kr,this.indexArray=new tr,this.indexArray2=new Pi,this.programConfigurations=new wa(t.layers,t.zoom),this.segments=new Tt,this.segments2=new Tt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.hasPattern=Lf("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),_=[];for(const{feature:v,id:b,index:I,sourceLayerIndex:E}of t){const P=this.layers[0]._featureFilter.needGeometry,A=Sa(v,P);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),A,a))continue;const R=g?h.evaluate(A,{},a,r.availableImages):void 0,B={id:b,properties:v.properties,type:v.type,sourceLayerIndex:E,index:I,geometry:P?A.geometry:ba(v),patterns:{},sortKey:R};_.push(B)}g&&_.sort((v,b)=>v.sortKey-b.sortKey);for(const v of _){const{geometry:b,index:I,sourceLayerIndex:E}=v;if(this.hasPattern){const P=Rf("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(v,b,I,a,{});r.featureIndex.insert(t[I].feature,b,I,E,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,eb),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,a,h,g){for(const _ of tl(r,500)){let v=0;for(const R of _)v+=R.length;const b=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),I=b.vertexLength,E=[],P=[];for(const R of _){if(R.length===0)continue;R!==_[0]&&P.push(E.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),N=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(N+R.length-1,N),E.push(R[0].x),E.push(R[0].y);for(let Z=1;Z<R.length;Z++)this.layoutVertexArray.emplaceBack(R[Z].x,R[Z].y),this.indexArray2.emplaceBack(N+Z-1,N+Z),E.push(R[Z].x),E.push(R[Z].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const A=ay(E,P);for(let R=0;R<A.length;R+=3)this.indexArray.emplaceBack(I+A[R],I+A[R+1],I+A[R+2]);b.vertexLength+=v,b.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}let dy,py;Ze("FillBucket",Ff,{omit:["layers","patternFeatures"]});var cb={get paint(){return py=py||new f({"fill-antialias":new Xe(ge.paint_fill["fill-antialias"]),"fill-opacity":new ot(ge.paint_fill["fill-opacity"]),"fill-color":new ot(ge.paint_fill["fill-color"]),"fill-outline-color":new ot(ge.paint_fill["fill-outline-color"]),"fill-translate":new Xe(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Xe(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new wl(ge.paint_fill["fill-pattern"])})},get layout(){return dy=dy||new f({"fill-sort-key":new ot(ge.layout_fill["fill-sort-key"])})}};class hb extends s{constructor(t){super(t,cb)}recalculate(t,r){super.recalculate(t,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Ff(t)}queryRadius(){return rd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,a,h,g,_,v){return X_(od(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,v),h)}isTileClipped(){return!0}}const db=x([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),pb=x([{name:"a_centroid",components:2,type:"Int16"}],4),{members:fb}=db;var Ss={},mb=W,fy=Al;function Al(n,t,r,a,h){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=h,n.readFields(gb,this,t)}function gb(n,t,r){n==1?t.id=r.readVarint():n==2?function(a,h){for(var g=a.readVarint()+a.pos;a.pos<g;){var _=h._keys[a.readVarint()],v=h._values[a.readVarint()];h.properties[_]=v}}(r,t):n==3?t.type=r.readVarint():n==4&&(t._geometry=r.pos)}function _b(n){for(var t,r,a=0,h=0,g=n.length,_=g-1;h<g;_=h++)a+=((r=n[_]).x-(t=n[h]).x)*(t.y+r.y);return a}Al.types=["Unknown","Point","LineString","Polygon"],Al.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var t,r=n.readVarint()+n.pos,a=1,h=0,g=0,_=0,v=[];n.pos<r;){if(h<=0){var b=n.readVarint();a=7&b,h=b>>3}if(h--,a===1||a===2)g+=n.readSVarint(),_+=n.readSVarint(),a===1&&(t&&v.push(t),t=[]),t.push(new mb(g,_));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&v.push(t),v},Al.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var t=n.readVarint()+n.pos,r=1,a=0,h=0,g=0,_=1/0,v=-1/0,b=1/0,I=-1/0;n.pos<t;){if(a<=0){var E=n.readVarint();r=7&E,a=E>>3}if(a--,r===1||r===2)(h+=n.readSVarint())<_&&(_=h),h>v&&(v=h),(g+=n.readSVarint())<b&&(b=g),g>I&&(I=g);else if(r!==7)throw new Error("unknown command "+r)}return[_,b,v,I]},Al.prototype.toGeoJSON=function(n,t,r){var a,h,g=this.extent*Math.pow(2,r),_=this.extent*n,v=this.extent*t,b=this.loadGeometry(),I=Al.types[this.type];function E(R){for(var B=0;B<R.length;B++){var N=R[B];R[B]=[360*(N.x+_)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+v)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<b.length;a++)P[a]=b[a][0];E(b=P);break;case 2:for(a=0;a<b.length;a++)E(b[a]);break;case 3:for(b=function(R){var B=R.length;if(B<=1)return[R];for(var N,Z,Y=[],pe=0;pe<B;pe++){var ne=_b(R[pe]);ne!==0&&(Z===void 0&&(Z=ne<0),Z===ne<0?(N&&Y.push(N),N=[R[pe]]):N.push(R[pe]))}return N&&Y.push(N),Y}(b),a=0;a<b.length;a++)for(h=0;h<b[a].length;h++)E(b[a][h])}b.length===1?b=b[0]:I="Multi"+I;var A={type:"Feature",geometry:{type:I,coordinates:b},properties:this.properties};return"id"in this&&(A.id=this.id),A};var yb=fy,my=gy;function gy(n,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(vb,this,t),this.length=this._features.length}function vb(n,t,r){n===15?t.version=r.readVarint():n===1?t.name=r.readString():n===5?t.extent=r.readVarint():n===2?t._features.push(r.pos):n===3?t._keys.push(r.readString()):n===4&&t._values.push(function(a){for(var h=null,g=a.readVarint()+a.pos;a.pos<g;){var _=a.readVarint()>>3;h=_===1?a.readString():_===2?a.readFloat():_===3?a.readDouble():_===4?a.readVarint64():_===5?a.readVarint():_===6?a.readSVarint():_===7?a.readBoolean():null}return h}(r))}gy.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var t=this._pbf.readVarint()+this._pbf.pos;return new yb(this._pbf,t,this.extent,this._keys,this._values)};var xb=my;function wb(n,t,r){if(n===3){var a=new xb(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}Ss.VectorTile=function(n,t){this.layers=n.readFields(wb,{},t)},Ss.VectorTileFeature=fy,Ss.VectorTileLayer=my;const bb=Ss.VectorTileFeature.types,Bf=Math.pow(2,13);function pc(n,t,r,a,h,g,_,v){n.emplaceBack(t,r,2*Math.floor(a*Bf)+_,h*Bf*2,g*Bf*2,Math.round(v))}class Of{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new _s,this.centroidVertexArray=new Fi,this.indexArray=new tr,this.programConfigurations=new wa(t.layers,t.zoom),this.segments=new Tt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.features=[],this.hasPattern=Lf("fill-extrusion",this.layers,r);for(const{feature:h,id:g,index:_,sourceLayerIndex:v}of t){const b=this.layers[0]._featureFilter.needGeometry,I=Sa(h,b);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),I,a))continue;const E={id:g,sourceLayerIndex:v,index:_,geometry:b?I.geometry:ba(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Rf("fill-extrusion",this.layers,E,this.zoom,r)):this.addFeature(E,E.geometry,_,a,{}),r.featureIndex.insert(h,E.geometry,_,v,this.index,!0)}}addFeatures(t,r,a){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,r,a)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fb),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,pb.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,a,h,g){for(const _ of tl(r,500)){const v={x:0,y:0,vertexCount:0};let b=0;for(const B of _)b+=B.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of _){if(B.length===0||Tb(B))continue;let N=0;for(let Z=0;Z<B.length;Z++){const Y=B[Z];if(Z>=1){const pe=B[Z-1];if(!Sb(Y,pe)){I.vertexLength+4>Tt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ne=Y.sub(pe)._perp()._unit(),he=pe.dist(Y);N+he>32768&&(N=0),pc(this.layoutVertexArray,Y.x,Y.y,ne.x,ne.y,0,0,N),pc(this.layoutVertexArray,Y.x,Y.y,ne.x,ne.y,0,1,N),v.x+=2*Y.x,v.y+=2*Y.y,v.vertexCount+=2,N+=he,pc(this.layoutVertexArray,pe.x,pe.y,ne.x,ne.y,0,0,N),pc(this.layoutVertexArray,pe.x,pe.y,ne.x,ne.y,0,1,N),v.x+=2*pe.x,v.y+=2*pe.y,v.vertexCount+=2;const _e=I.vertexLength;this.indexArray.emplaceBack(_e,_e+2,_e+1),this.indexArray.emplaceBack(_e+1,_e+2,_e+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+b>Tt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),bb[t.type]!=="Polygon")continue;const E=[],P=[],A=I.vertexLength;for(const B of _)if(B.length!==0){B!==_[0]&&P.push(E.length/2);for(let N=0;N<B.length;N++){const Z=B[N];pc(this.layoutVertexArray,Z.x,Z.y,0,0,1,1,0),v.x+=Z.x,v.y+=Z.y,v.vertexCount+=1,E.push(Z.x),E.push(Z.y)}}const R=ay(E,P);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(A+R[B],A+R[B+2],A+R[B+1]);I.primitiveLength+=R.length/3,I.vertexLength+=b;for(let B=0;B<v.vertexCount;B++){const N=Math.floor(v.x/v.vertexCount),Z=Math.floor(v.y/v.vertexCount);this.centroidVertexArray.emplaceBack(N,Z)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}}function Sb(n,t){return n.x===t.x&&(n.x<0||n.x>_i)||n.y===t.y&&(n.y<0||n.y>_i)}function Tb(n){return n.every(t=>t.x<0)||n.every(t=>t.x>_i)||n.every(t=>t.y<0)||n.every(t=>t.y>_i)}let _y;Ze("FillExtrusionBucket",Of,{omit:["layers","features"]});var kb={get paint(){return _y=_y||new f({"fill-extrusion-opacity":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ot(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wl(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ot(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ot(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xe(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Ib extends s{constructor(t){super(t,kb)}createBucket(t){return new Of(t)}queryRadius(){return rd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,a,h,g,_,v,b){const I=od(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,v),E=this.paint.get("fill-extrusion-height").evaluate(r,a),P=this.paint.get("fill-extrusion-base").evaluate(r,a),A=function(B,N,Z,Y){const pe=[];for(const ne of B){const he=[ne.x,ne.y,0,1];sd(he,he,N),pe.push(new X(he[0]/he[3],he[1]/he[3]))}return pe}(I,b),R=function(B,N,Z,Y){const pe=[],ne=[],he=Y[8]*N,_e=Y[9]*N,ke=Y[10]*N,je=Y[11]*N,rt=Y[8]*Z,Oe=Y[9]*Z,Fe=Y[10]*Z,Je=Y[11]*Z;for(const He of B){const qe=[],ve=[];for(const et of He){const Ye=et.x,lt=et.y,$t=Y[0]*Ye+Y[4]*lt+Y[12],Ut=Y[1]*Ye+Y[5]*lt+Y[13],Ti=Y[2]*Ye+Y[6]*lt+Y[14],Ir=Y[3]*Ye+Y[7]*lt+Y[15],Ni=Ti+ke,ki=Ir+je,un=$t+rt,cn=Ut+Oe,hn=Ti+Fe,li=Ir+Je,Ii=new X(($t+he)/ki,(Ut+_e)/ki);Ii.z=Ni/ki,qe.push(Ii);const Wi=new X(un/li,cn/li);Wi.z=hn/li,ve.push(Wi)}pe.push(qe),ne.push(ve)}return[pe,ne]}(h,P,E,b);return function(B,N,Z){let Y=1/0;X_(Z,N)&&(Y=yy(Z,N[0]));for(let pe=0;pe<N.length;pe++){const ne=N[pe],he=B[pe];for(let _e=0;_e<ne.length-1;_e++){const ke=ne[_e],je=[ke,ne[_e+1],he[_e+1],he[_e],ke];W_(Z,je)&&(Y=Math.min(Y,yy(Z,je)))}}return Y!==1/0&&Y}(R[0],R[1],A)}}function fc(n,t){return n.x*t.x+n.y*t.y}function yy(n,t){if(n.length===1){let r=0;const a=t[r++];let h;for(;!h||a.equals(h);)if(h=t[r++],!h)return 1/0;for(;r<t.length;r++){const g=t[r],_=n[0],v=h.sub(a),b=g.sub(a),I=_.sub(a),E=fc(v,v),P=fc(v,b),A=fc(b,b),R=fc(I,v),B=fc(I,b),N=E*A-P*P,Z=(A*R-P*B)/N,Y=(E*B-P*R)/N,pe=a.z*(1-Z-Y)+h.z*Z+g.z*Y;if(isFinite(pe))return pe}return 1/0}{let r=1/0;for(const a of t)r=Math.min(r,a.z);return r}}const Eb=x([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Cb}=Eb,Pb=x([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Mb}=Pb,zb=Ss.VectorTileFeature.types,Ab=Math.cos(Math.PI/180*37.5),vy=Math.pow(2,14)/.5;class Nf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Sl,this.layoutVertexArray2=new ys,this.indexArray=new tr,this.programConfigurations=new wa(t.layers,t.zoom),this.segments=new Tt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.hasPattern=Lf("line",this.layers,r);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),_=[];for(const{feature:v,id:b,index:I,sourceLayerIndex:E}of t){const P=this.layers[0]._featureFilter.needGeometry,A=Sa(v,P);if(!this.layers[0]._featureFilter.filter(new Ht(this.zoom),A,a))continue;const R=g?h.evaluate(A,{},a):void 0,B={id:b,properties:v.properties,type:v.type,sourceLayerIndex:E,index:I,geometry:P?A.geometry:ba(v),patterns:{},sortKey:R};_.push(B)}g&&_.sort((v,b)=>v.sortKey-b.sortKey);for(const v of _){const{geometry:b,index:I,sourceLayerIndex:E}=v;if(this.hasPattern){const P=Rf("line",this.layers,v,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(v,b,I,a,{});r.featureIndex.insert(t[I].feature,b,I,E,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Mb)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cb),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,a,h,g){const _=this.layers[0].layout,v=_.get("line-join").evaluate(t,{}),b=_.get("line-cap"),I=_.get("line-miter-limit"),E=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const P of r)this.addLine(P,t,v,b,I,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,g,h)}addLine(t,r,a,h,g,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<t.length-1;Y++)this.totalDistance+=t[Y].dist(t[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=zb[r.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let I=0;for(;I<b-1&&t[I].equals(t[I+1]);)I++;if(b<(v?3:2))return;a==="bevel"&&(g=1.05);const E=this.overscaling<=16?15*_i/(512*this.overscaling):0,P=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let A,R,B,N,Z;this.e1=this.e2=-1,v&&(A=t[b-2],Z=t[I].sub(A)._unit()._perp());for(let Y=I;Y<b;Y++){if(B=Y===b-1?v?t[I+1]:void 0:t[Y+1],B&&t[Y].equals(B))continue;Z&&(N=Z),A&&(R=A),A=t[Y],Z=B?B.sub(A)._unit()._perp():N,N=N||Z;let pe=N.add(Z);pe.x===0&&pe.y===0||pe._unit();const ne=N.x*Z.x+N.y*Z.y,he=pe.x*Z.x+pe.y*Z.y,_e=he!==0?1/he:1/0,ke=2*Math.sqrt(2-2*he),je=he<Ab&&R&&B,rt=N.x*Z.y-N.y*Z.x>0;if(je&&Y>I){const Je=A.dist(R);if(Je>2*E){const He=A.sub(A.sub(R)._mult(E/Je)._round());this.updateDistance(R,He),this.addCurrentVertex(He,N,0,0,P),R=He}}const Oe=R&&B;let Fe=Oe?a:v?"butt":h;if(Oe&&Fe==="round"&&(_e<_?Fe="miter":_e<=2&&(Fe="fakeround")),Fe==="miter"&&_e>g&&(Fe="bevel"),Fe==="bevel"&&(_e>2&&(Fe="flipbevel"),_e<g&&(Fe="miter")),R&&this.updateDistance(R,A),Fe==="miter")pe._mult(_e),this.addCurrentVertex(A,pe,0,0,P);else if(Fe==="flipbevel"){if(_e>100)pe=Z.mult(-1);else{const Je=_e*N.add(Z).mag()/N.sub(Z).mag();pe._perp()._mult(Je*(rt?-1:1))}this.addCurrentVertex(A,pe,0,0,P),this.addCurrentVertex(A,pe.mult(-1),0,0,P)}else if(Fe==="bevel"||Fe==="fakeround"){const Je=-Math.sqrt(_e*_e-1),He=rt?Je:0,qe=rt?0:Je;if(R&&this.addCurrentVertex(A,N,He,qe,P),Fe==="fakeround"){const ve=Math.round(180*ke/Math.PI/20);for(let et=1;et<ve;et++){let Ye=et/ve;if(Ye!==.5){const $t=Ye-.5;Ye+=Ye*$t*(Ye-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*$t*$t+(.848013+ne*(.215638*ne-1.06021)))}const lt=Z.sub(N)._mult(Ye)._add(N)._unit()._mult(rt?-1:1);this.addHalfVertex(A,lt.x,lt.y,!1,rt,0,P)}}B&&this.addCurrentVertex(A,Z,-He,-qe,P)}else if(Fe==="butt")this.addCurrentVertex(A,pe,0,0,P);else if(Fe==="square"){const Je=R?1:-1;this.addCurrentVertex(A,pe,Je,Je,P)}else Fe==="round"&&(R&&(this.addCurrentVertex(A,N,0,0,P),this.addCurrentVertex(A,N,1,1,P,!0)),B&&(this.addCurrentVertex(A,Z,-1,-1,P,!0),this.addCurrentVertex(A,Z,0,0,P)));if(je&&Y<b-1){const Je=A.dist(B);if(Je>2*E){const He=A.add(B.sub(A)._mult(E/Je)._round());this.updateDistance(A,He),this.addCurrentVertex(He,Z,0,0,P),A=He}}}}addCurrentVertex(t,r,a,h,g,_=!1){const v=r.y*h-r.x,b=-r.y-r.x*h;this.addHalfVertex(t,r.x+r.y*a,r.y-r.x*a,_,!1,a,g),this.addHalfVertex(t,v,b,_,!0,-h,g),this.distance>vy/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,a,h,g,_))}addHalfVertex({x:t,y:r},a,h,g,_,v,b){const I=.5*(this.lineClips?this.scaledDistance*(vy-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(r<<1)+(_?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),b.primitiveLength++),_?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let xy,wy;Ze("LineBucket",Nf,{omit:["layers","patternFeatures"]});var by={get paint(){return wy=wy||new f({"line-opacity":new ot(ge.paint_line["line-opacity"]),"line-color":new ot(ge.paint_line["line-color"]),"line-translate":new Xe(ge.paint_line["line-translate"]),"line-translate-anchor":new Xe(ge.paint_line["line-translate-anchor"]),"line-width":new ot(ge.paint_line["line-width"]),"line-gap-width":new ot(ge.paint_line["line-gap-width"]),"line-offset":new ot(ge.paint_line["line-offset"]),"line-blur":new ot(ge.paint_line["line-blur"]),"line-dasharray":new bl(ge.paint_line["line-dasharray"]),"line-pattern":new wl(ge.paint_line["line-pattern"]),"line-gradient":new rc(ge.paint_line["line-gradient"])})},get layout(){return xy=xy||new f({"line-cap":new Xe(ge.layout_line["line-cap"]),"line-join":new ot(ge.layout_line["line-join"]),"line-miter-limit":new Xe(ge.layout_line["line-miter-limit"]),"line-round-limit":new Xe(ge.layout_line["line-round-limit"]),"line-sort-key":new ot(ge.layout_line["line-sort-key"])})}};class Db extends ot{possiblyEvaluate(t,r){return r=new Ht(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,a,h){return r=Ve({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,a,h)}}let cd;class Lb extends s{constructor(t){super(t,by),this.gradientVersion=0,cd||(cd=new Db(by.paint.properties["line-width"].specification),cd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Jo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=cd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Nf(t)}queryRadius(t){const r=t,a=Sy(ac("line-width",this,r),ac("line-gap-width",this,r)),h=ac("line-offset",this,r);return a/2+Math.abs(h)+rd(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,a,h,g,_,v){const b=od(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,v),I=v/2*Sy(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),E=this.paint.get("line-offset").evaluate(r,a);return E&&(h=function(P,A){const R=[];for(let B=0;B<P.length;B++){const N=P[B],Z=[];for(let Y=0;Y<N.length;Y++){const pe=N[Y-1],ne=N[Y],he=N[Y+1],_e=Y===0?new X(0,0):ne.sub(pe)._unit()._perp(),ke=Y===N.length-1?new X(0,0):he.sub(ne)._unit()._perp(),je=_e._add(ke)._unit(),rt=je.x*ke.x+je.y*ke.y;rt!==0&&je._mult(1/rt),Z.push(je._mult(A)._add(ne))}R.push(Z)}return R}(h,E*v)),function(P,A,R){for(let B=0;B<A.length;B++){const N=A[B];if(P.length>=3){for(let Z=0;Z<N.length;Z++)if(Pl(P,N[Z]))return!0}if($w(P,N,R))return!0}return!1}(b,h,I)}isTileClipped(){return!0}}function Sy(n,t){return t>0?t+2*n:n}const Rb=x([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Fb=x([{name:"a_projected_pos",components:3,type:"Float32"}],4);x([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Bb=x([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);x([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ty=x([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ob=x([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Nb(n,t,r){return n.sections.forEach(a=>{a.text=function(h,g,_){const v=g.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),bn.applyArabicShaping&&(h=bn.applyArabicShaping(h)),h}(a.text,t,r)}),n}x([{name:"triangle",components:3,type:"Uint16"}]),x([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),x([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),x([{type:"Float32",name:"offsetX"}]),x([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),x([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const mc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var vi=24,ky=jt,Iy=function(n,t,r,a,h){var g,_,v=8*h-a-1,b=(1<<v)-1,I=b>>1,E=-7,P=h-1,A=-1,R=n[t+P];for(P+=A,g=R&(1<<-E)-1,R>>=-E,E+=v;E>0;g=256*g+n[t+P],P+=A,E-=8);for(_=g&(1<<-E)-1,g>>=-E,E+=a;E>0;_=256*_+n[t+P],P+=A,E-=8);if(g===0)g=1-I;else{if(g===b)return _?NaN:1/0*(R?-1:1);_+=Math.pow(2,a),g-=I}return(R?-1:1)*_*Math.pow(2,g-a)},Ey=function(n,t,r,a,h,g){var _,v,b,I=8*g-h-1,E=(1<<I)-1,P=E>>1,A=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,B=1,N=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,_=E):(_=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-_))<1&&(_--,b*=2),(t+=_+P>=1?A/b:A*Math.pow(2,1-P))*b>=2&&(_++,b/=2),_+P>=E?(v=0,_=E):_+P>=1?(v=(t*b-1)*Math.pow(2,h),_+=P):(v=t*Math.pow(2,P-1)*Math.pow(2,h),_=0));h>=8;n[r+R]=255&v,R+=B,v/=256,h-=8);for(_=_<<h|v,I+=h;I>0;n[r+R]=255&_,R+=B,_/=256,I-=8);n[r+R-B]|=128*N};function jt(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}jt.Varint=0,jt.Fixed64=1,jt.Bytes=2,jt.Fixed32=5;var Vf=4294967296,Cy=1/Vf,Py=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Do(n){return n.type===jt.Bytes?n.readVarint()+n.pos:n.pos+1}function Dl(n,t,r){return r?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function My(n,t,r){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(a);for(var h=r.pos-1;h>=n;h--)r.buf[h+a]=r.buf[h]}function Vb(n,t){for(var r=0;r<n.length;r++)t.writeVarint(n[r])}function jb(n,t){for(var r=0;r<n.length;r++)t.writeSVarint(n[r])}function Ub(n,t){for(var r=0;r<n.length;r++)t.writeFloat(n[r])}function $b(n,t){for(var r=0;r<n.length;r++)t.writeDouble(n[r])}function qb(n,t){for(var r=0;r<n.length;r++)t.writeBoolean(n[r])}function Zb(n,t){for(var r=0;r<n.length;r++)t.writeFixed32(n[r])}function Gb(n,t){for(var r=0;r<n.length;r++)t.writeSFixed32(n[r])}function Hb(n,t){for(var r=0;r<n.length;r++)t.writeFixed64(n[r])}function Wb(n,t){for(var r=0;r<n.length;r++)t.writeSFixed64(n[r])}function hd(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function Ll(n,t,r){n[r]=t,n[r+1]=t>>>8,n[r+2]=t>>>16,n[r+3]=t>>>24}function zy(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}jt.prototype={destroy:function(){this.buf=null},readFields:function(n,t,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),h=a>>3,g=this.pos;this.type=7&a,n(h,t,this),this.pos===g&&this.skip(a)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=hd(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=zy(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=hd(this.buf,this.pos)+hd(this.buf,this.pos+4)*Vf;return this.pos+=8,n},readSFixed64:function(){var n=hd(this.buf,this.pos)+zy(this.buf,this.pos+4)*Vf;return this.pos+=8,n},readFloat:function(){var n=Iy(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Iy(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var t,r,a=this.buf;return t=127&(r=a[this.pos++]),r<128?t:(t|=(127&(r=a[this.pos++]))<<7,r<128?t:(t|=(127&(r=a[this.pos++]))<<14,r<128?t:(t|=(127&(r=a[this.pos++]))<<21,r<128?t:function(h,g,_){var v,b,I=_.buf;if(v=(112&(b=I[_.pos++]))>>4,b<128||(v|=(127&(b=I[_.pos++]))<<3,b<128)||(v|=(127&(b=I[_.pos++]))<<10,b<128)||(v|=(127&(b=I[_.pos++]))<<17,b<128)||(v|=(127&(b=I[_.pos++]))<<24,b<128)||(v|=(1&(b=I[_.pos++]))<<31,b<128))return Dl(h,v,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,t=this.pos;return this.pos=n,n-t>=12&&Py?function(r,a,h){return Py.decode(r.subarray(a,h))}(this.buf,t,n):function(r,a,h){for(var g="",_=a;_<h;){var v,b,I,E=r[_],P=null,A=E>239?4:E>223?3:E>191?2:1;if(_+A>h)break;A===1?E<128&&(P=E):A===2?(192&(v=r[_+1]))==128&&(P=(31&E)<<6|63&v)<=127&&(P=null):A===3?(b=r[_+2],(192&(v=r[_+1]))==128&&(192&b)==128&&((P=(15&E)<<12|(63&v)<<6|63&b)<=2047||P>=55296&&P<=57343)&&(P=null)):A===4&&(b=r[_+2],I=r[_+3],(192&(v=r[_+1]))==128&&(192&b)==128&&(192&I)==128&&((P=(15&E)<<18|(63&v)<<12|(63&b)<<6|63&I)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,A=1):P>65535&&(P-=65536,g+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),g+=String.fromCharCode(P),_+=A}return g}(this.buf,t,n)},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){if(this.type!==jt.Bytes)return n.push(this.readVarint(t));var r=Do(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){if(this.type!==jt.Bytes)return n.push(this.readSVarint());var t=Do(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==jt.Bytes)return n.push(this.readBoolean());var t=Do(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==jt.Bytes)return n.push(this.readFloat());var t=Do(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==jt.Bytes)return n.push(this.readDouble());var t=Do(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==jt.Bytes)return n.push(this.readFixed32());var t=Do(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==jt.Bytes)return n.push(this.readSFixed32());var t=Do(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==jt.Bytes)return n.push(this.readFixed64());var t=Do(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==jt.Bytes)return n.push(this.readSFixed64());var t=Do(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===jt.Varint)for(;this.buf[this.pos++]>127;);else if(t===jt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===jt.Fixed32)this.pos+=4;else{if(t!==jt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var t=this.length||16;t<this.pos+n;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),Ll(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),Ll(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),Ll(this.buf,-1&n,this.pos),Ll(this.buf,Math.floor(n*Cy),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),Ll(this.buf,-1&n,this.pos),Ll(this.buf,Math.floor(n*Cy),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(t,r){var a,h;if(t>=0?(a=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,_,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)}(a,0,r),function(g,_){var v=(7&g)<<4;_.buf[_.pos++]|=v|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(h,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var t=this.pos;this.pos=function(a,h,g){for(var _,v,b=0;b<h.length;b++){if((_=h.charCodeAt(b))>55295&&_<57344){if(!v){_>56319||b+1===h.length?(a[g++]=239,a[g++]=191,a[g++]=189):v=_;continue}if(_<56320){a[g++]=239,a[g++]=191,a[g++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(a[g++]=239,a[g++]=191,a[g++]=189,v=null);_<128?a[g++]=_:(_<2048?a[g++]=_>>6|192:(_<65536?a[g++]=_>>12|224:(a[g++]=_>>18|240,a[g++]=_>>12&63|128),a[g++]=_>>6&63|128),a[g++]=63&_|128)}return g}(this.buf,n,this.pos);var r=this.pos-t;r>=128&&My(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),Ey(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Ey(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var t=n.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,t){this.pos++;var r=this.pos;n(t,this);var a=this.pos-r;a>=128&&My(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,t,r){this.writeTag(n,jt.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(n,t){t.length&&this.writeMessage(n,Vb,t)},writePackedSVarint:function(n,t){t.length&&this.writeMessage(n,jb,t)},writePackedBoolean:function(n,t){t.length&&this.writeMessage(n,qb,t)},writePackedFloat:function(n,t){t.length&&this.writeMessage(n,Ub,t)},writePackedDouble:function(n,t){t.length&&this.writeMessage(n,$b,t)},writePackedFixed32:function(n,t){t.length&&this.writeMessage(n,Zb,t)},writePackedSFixed32:function(n,t){t.length&&this.writeMessage(n,Gb,t)},writePackedFixed64:function(n,t){t.length&&this.writeMessage(n,Hb,t)},writePackedSFixed64:function(n,t){t.length&&this.writeMessage(n,Wb,t)},writeBytesField:function(n,t){this.writeTag(n,jt.Bytes),this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,jt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,jt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,jt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,jt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,jt.Varint),this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,jt.Varint),this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,jt.Bytes),this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,jt.Fixed32),this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,jt.Fixed64),this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,!!t)}};var jf=O(ky);const Uf=3;function Xb(n,t,r){n===1&&r.readMessage(Kb,t)}function Kb(n,t,r){if(n===3){const{id:a,bitmap:h,width:g,height:_,left:v,top:b,advance:I}=r.readMessage(Yb,{});t.push({id:a,bitmap:new uc({width:g+2*Uf,height:_+2*Uf},h),metrics:{width:g,height:_,left:v,top:b,advance:I}})}}function Yb(n,t,r){n===1?t.id=r.readVarint():n===2?t.bitmap=r.readBytes():n===3?t.width=r.readVarint():n===4?t.height=r.readVarint():n===5?t.left=r.readSVarint():n===6?t.top=r.readSVarint():n===7&&(t.advance=r.readVarint())}const Ay=Uf;function Dy(n){let t=0,r=0;for(const _ of n)t+=_.w*_.h,r=Math.max(r,_.w);n.sort((_,v)=>v.h-_.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let h=0,g=0;for(const _ of n)for(let v=a.length-1;v>=0;v--){const b=a[v];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,g=Math.max(g,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===b.w&&_.h===b.h){const I=a.pop();v<a.length&&(a[v]=I)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(a.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}const Tn=1;class $f{constructor(t,{pixelRatio:r,version:a,stretchX:h,stretchY:g,content:_,textFitWidth:v,textFitHeight:b}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=h,this.stretchY=g,this.content=_,this.version=a,this.textFitWidth=v,this.textFitHeight=b}get tl(){return[this.paddedRect.x+Tn,this.paddedRect.y+Tn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Tn,this.paddedRect.y+this.paddedRect.h-Tn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Tn)/this.pixelRatio,(this.paddedRect.h-2*Tn)/this.pixelRatio]}}class Ly{constructor(t,r){const a={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,a,g),this.addImages(r,h,g);const{w:_,h:v}=Dy(g),b=new ir({width:_||1,height:v||1});for(const I in t){const E=t[I],P=a[I].paddedRect;ir.copy(E.data,b,{x:0,y:0},{x:P.x+Tn,y:P.y+Tn},E.data)}for(const I in r){const E=r[I],P=h[I].paddedRect,A=P.x+Tn,R=P.y+Tn,B=E.data.width,N=E.data.height;ir.copy(E.data,b,{x:0,y:0},{x:A,y:R},E.data),ir.copy(E.data,b,{x:0,y:N-1},{x:A,y:R-1},{width:B,height:1}),ir.copy(E.data,b,{x:0,y:0},{x:A,y:R+N},{width:B,height:1}),ir.copy(E.data,b,{x:B-1,y:0},{x:A-1,y:R},{width:1,height:N}),ir.copy(E.data,b,{x:0,y:0},{x:A+B,y:R},{width:1,height:N})}this.image=b,this.iconPositions=a,this.patternPositions=h}addImages(t,r,a){for(const h in t){const g=t[h],_={x:0,y:0,w:g.data.width+2*Tn,h:g.data.height+2*Tn};a.push(_),r[h]=new $f(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),r)}patchUpdatedImage(t,r,a){if(!t||!r||t.version===r.version)return;t.version=r.version;const[h,g]=t.tl;a.update(r.data,void 0,{x:h,y:g})}}var Ts;Ze("ImagePosition",$f),Ze("ImageAtlas",Ly),w.ah=void 0,(Ts=w.ah||(w.ah={}))[Ts.none=0]="none",Ts[Ts.horizontal=1]="horizontal",Ts[Ts.vertical=2]="vertical",Ts[Ts.horizontalOnly=3]="horizontalOnly";const gc=-17;class _c{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const a=new _c;return a.scale=t||1,a.fontStack=r,a}static forImage(t){const r=new _c;return r.imageName=t,r}}class Rl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const a=new Rl;for(let h=0;h<t.sections.length;h++){const g=t.sections[h];g.image?a.addImageSection(g):a.addTextSection(g,r)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let a=0;a<t.length;a++){const h=t.charCodeAt(a+1)||null,g=t.charCodeAt(a-1)||null;r+=h&&Yh(h)&&!mc[t[a+1]]||g&&Yh(g)&&!mc[t[a-1]]||!mc[t[a]]?t[a]:mc[t[a]]}return r}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&pd[this.text.charCodeAt(a)];a++)t++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&pd[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const a=new Rl;return a.text=this.text.substring(t,r),a.sectionIndex=this.sectionIndex.slice(t,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(_c.forText(t.scale,t.fontStack||r));const a=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(a)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void oi("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(_c.forImage(r)),this.sectionIndex.push(this.sections.length-1)):oi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function dd(n,t,r,a,h,g,_,v,b,I,E,P,A,R,B){const N=Rl.fromFeature(n,h);let Z;P===w.ah.vertical&&N.verticalizePunctuation();const{processBidirectionalText:Y,processStyledBidirectionalText:pe}=bn;if(Y&&N.sections.length===1){Z=[];const _e=Y(N.toString(),qf(N,I,g,t,a,R));for(const ke of _e){const je=new Rl;je.text=ke,je.sections=N.sections;for(let rt=0;rt<ke.length;rt++)je.sectionIndex.push(0);Z.push(je)}}else if(pe){Z=[];const _e=pe(N.text,N.sectionIndex,qf(N,I,g,t,a,R));for(const ke of _e){const je=new Rl;je.text=ke[0],je.sectionIndex=ke[1],je.sections=N.sections,Z.push(je)}}else Z=function(_e,ke){const je=[],rt=_e.text;let Oe=0;for(const Fe of ke)je.push(_e.substring(Oe,Fe)),Oe=Fe;return Oe<rt.length&&je.push(_e.substring(Oe,rt.length)),je}(N,qf(N,I,g,t,a,R));const ne=[],he={positionedLines:ne,text:N.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(_e,ke,je,rt,Oe,Fe,Je,He,qe,ve,et,Ye){let lt=0,$t=gc,Ut=0,Ti=0;const Ir=He==="right"?1:He==="left"?0:.5;let Ni=0;for(const li of Oe){li.trim();const Ii=li.getMaxScale(),Wi=(Ii-1)*vi,Vi={positionedGlyphs:[],lineOffset:0};_e.positionedLines[Ni]=Vi;const dn=Vi.positionedGlyphs;let ji=0;if(!li.length()){$t+=Fe,++Ni;continue}for(let kn=0;kn<li.length();kn++){const At=li.getSection(kn),Zt=li.getSectionIndex(kn),Yt=li.getCharCode(kn);let On=0,ii=null,Nl=null,so=null,ao=vi;const Er=!(qe===w.ah.horizontal||!et&&!ic(Yt)||et&&(pd[Yt]||(ki=Yt,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(ki)))));if(At.imageName){const or=rt[At.imageName];if(!or)continue;so=At.imageName,_e.iconsInText=_e.iconsInText||!0,Nl=or.paddedRect;const Mi=or.displaySize;At.scale=At.scale*vi/Ye,ii={width:Mi[0],height:Mi[1],left:Tn,top:-Ay,advance:Er?Mi[1]:Mi[0]},On=Wi+(vi-Mi[1]*At.scale),ao=ii.advance;const Lo=Er?Mi[0]*At.scale-vi*Ii:Mi[1]*At.scale-vi*Ii;Lo>0&&Lo>ji&&(ji=Lo)}else{const or=je[At.fontStack],Mi=or&&or[Yt];if(Mi&&Mi.rect)Nl=Mi.rect,ii=Mi.metrics;else{const Lo=ke[At.fontStack],Sc=Lo&&Lo[Yt];if(!Sc)continue;ii=Sc.metrics}On=(Ii-At.scale)*vi}Er?(_e.verticalizable=!0,dn.push({glyph:Yt,imageName:so,x:lt,y:$t+On,vertical:Er,scale:At.scale,fontStack:At.fontStack,sectionIndex:Zt,metrics:ii,rect:Nl}),lt+=ao*At.scale+ve):(dn.push({glyph:Yt,imageName:so,x:lt,y:$t+On,vertical:Er,scale:At.scale,fontStack:At.fontStack,sectionIndex:Zt,metrics:ii,rect:Nl}),lt+=ii.advance*At.scale+ve)}dn.length!==0&&(Ut=Math.max(lt-ve,Ut),t2(dn,0,dn.length-1,Ir,ji)),lt=0;const rr=Fe*Ii+ji;Vi.lineOffset=Math.max(ji,Wi),$t+=rr,Ti=Math.max(rr,Ti),++Ni}var ki;const un=$t-gc,{horizontalAlign:cn,verticalAlign:hn}=Zf(Je);(function(li,Ii,Wi,Vi,dn,ji,rr,kn,At){const Zt=(Ii-Wi)*dn;let Yt=0;Yt=ji!==rr?-kn*Vi-gc:(-Vi*At+.5)*rr;for(const On of li)for(const ii of On.positionedGlyphs)ii.x+=Zt,ii.y+=Yt})(_e.positionedLines,Ir,cn,hn,Ut,Ti,Fe,un,Oe.length),_e.top+=-hn*un,_e.bottom=_e.top+un,_e.left+=-cn*Ut,_e.right=_e.left+Ut}(he,t,r,a,Z,_,v,b,P,I,A,B),!function(_e){for(const ke of _e)if(ke.positionedGlyphs.length!==0)return!1;return!0}(ne)&&he}const pd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Jb={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Qb={40:!0};function Ry(n,t,r,a,h,g){if(t.imageName){const _=a[t.imageName];return _?_.displaySize[0]*t.scale*vi/g+h:0}{const _=r[t.fontStack],v=_&&_[n];return v?v.metrics.advance*t.scale+h:0}}function Fy(n,t,r,a){const h=Math.pow(n-t,2);return a?n<t?h/2:2*h:h+Math.abs(r)*r}function e2(n,t,r){let a=0;return n===10&&(a-=1e4),r&&(a+=150),n!==40&&n!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function By(n,t,r,a,h,g){let _=null,v=Fy(t,r,h,g);for(const b of a){const I=Fy(t-b.x,r,h,g)+b.badness;I<=v&&(_=b,v=I)}return{index:n,x:t,priorBreak:_,badness:v}}function Oy(n){return n?Oy(n.priorBreak).concat(n.index):[]}function qf(n,t,r,a,h,g){if(!n)return[];const _=[],v=function(P,A,R,B,N,Z){let Y=0;for(let pe=0;pe<P.length();pe++){const ne=P.getSection(pe);Y+=Ry(P.getCharCode(pe),ne,B,N,A,Z)}return Y/Math.max(1,Math.ceil(Y/R))}(n,t,r,a,h,g),b=n.text.indexOf("​")>=0;let I=0;for(let P=0;P<n.length();P++){const A=n.getSection(P),R=n.getCharCode(P);if(pd[R]||(I+=Ry(R,A,a,h,t,g)),P<n.length()-1){const B=!((E=R)<11904)&&(!!St["CJK Compatibility Forms"](E)||!!St["CJK Compatibility"](E)||!!St["CJK Strokes"](E)||!!St["CJK Symbols and Punctuation"](E)||!!St["Enclosed CJK Letters and Months"](E)||!!St["Halfwidth and Fullwidth Forms"](E)||!!St["Ideographic Description Characters"](E)||!!St["Vertical Forms"](E)||Kh.test(String.fromCodePoint(E)));(Jb[R]||B||A.imageName||P!==n.length()-2&&Qb[n.getCharCode(P+1)])&&_.push(By(P+1,I,v,_,e2(R,n.getCharCode(P+1),B&&b),!1))}}var E;return Oy(By(n.length(),I,v,_,0,!0))}function Zf(n){let t=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function t2(n,t,r,a,h){if(!a&&!h)return;const g=n[r],_=(n[r].x+g.metrics.advance*g.scale)*a;for(let v=t;v<=r;v++)n[v].x-=_,n[v].y+=h}function i2(n,t,r){const{horizontalAlign:a,verticalAlign:h}=Zf(r),g=t[0]-n.displaySize[0]*a,_=t[1]-n.displaySize[1]*h;return{image:n,top:_,bottom:_+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function Ny(n){var t,r;let a=n.left,h=n.top,g=n.right-a,_=n.bottom-h;const v=(t=n.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",b=(r=n.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",I=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(b==="proportional"){if(v==="stretchOnly"&&g/_<I||v==="proportional"){const E=Math.ceil(_*I);a*=E/g,g=E}}else if(v==="proportional"&&b==="stretchOnly"&&I!==0&&g/_>I){const E=Math.ceil(g/I);h*=E/_,_=E}return{x1:a,y1:h,x2:a+g,y2:h+_}}function Vy(n,t,r,a,h,g){const _=n.image;let v;if(_.content){const Z=_.content,Y=_.pixelRatio||1;v=[Z[0]/Y,Z[1]/Y,_.displaySize[0]-Z[2]/Y,_.displaySize[1]-Z[3]/Y]}const b=t.left*g,I=t.right*g;let E,P,A,R;r==="width"||r==="both"?(R=h[0]+b-a[3],P=h[0]+I+a[1]):(R=h[0]+(b+I-_.displaySize[0])/2,P=R+_.displaySize[0]);const B=t.top*g,N=t.bottom*g;return r==="height"||r==="both"?(E=h[1]+B-a[0],A=h[1]+N+a[2]):(E=h[1]+(B+N-_.displaySize[1])/2,A=E+_.displaySize[1]),{image:_,top:E,right:P,bottom:A,left:R,collisionPadding:v}}const yc=255,oo=128,ks=yc*oo;function jy(n,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ht(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=r;let g=0;for(;g<a.length&&a[g]<=n;)g++;g=Math.max(0,g-1);let _=g;for(;_<a.length&&a[_]<n+1;)_++;_=Math.min(a.length-1,_);const v=a[g],b=a[_];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:b,minSize:r.evaluate(new Ht(v)),maxSize:r.evaluate(new Ht(b)),interpolationType:h}}}function Gf(n,t,r){let a="never";const h=n.get(t);return h?a=h:n.get(r)&&(a="always"),a}const n2=Ss.VectorTileFeature.types,r2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fd(n,t,r,a,h,g,_,v,b,I,E,P,A){const R=v?Math.min(ks,Math.round(v[0])):0,B=v?Math.min(ks,Math.round(v[1])):0;n.emplaceBack(t,r,Math.round(32*a),Math.round(32*h),g,_,(R<<1)+(b?1:0),B,16*I,16*E,256*P,256*A)}function Hf(n,t,r){n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r),n.emplaceBack(t.x,t.y,r)}function o2(n){for(const t of n.sections)if(wf(t.text))return!0;return!1}class Wf{constructor(t){this.layoutVertexArray=new Tl,this.indexArray=new tr,this.programConfigurations=t,this.segments=new Tt,this.dynamicLayoutVertexArray=new oc,this.opacityVertexArray=new Fn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Wt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Rb.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Fb.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,r2,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ze("SymbolBuffers",Wf);class Xf{constructor(t,r,a){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new a,this.segments=new Tt,this.collisionVertexArray=new no}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Bb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ze("CollisionBuffers",Xf);class Fl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Cf([]),this.placementViewportMatrix=Cf([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jy(this.zoom,r["text-size"]),this.iconSizeData=jy(this.zoom,r["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=Gf(a,"text-overlap","text-allow-overlap")!=="never"||Gf(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(_=>w.ah[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new Wf(new wa(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Wf(new wa(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Xt,this.lineVertexArray=new Ri,this.symbolInstances=new wt,this.textAnchorOffsets=new Kt}calculateGlyphDependencies(t,r,a,h,g){for(let _=0;_<t.length;_++)if(r[t.charCodeAt(_)]=!0,(a||h)&&g){const v=mc[t.charAt(_)];v&&(r[v.charCodeAt(0)]=!0)}}populate(t,r,a){const h=this.layers[0],g=h.layout,_=g.get("text-font"),v=g.get("text-field"),b=g.get("icon-image"),I=(v.value.kind!=="constant"||v.value.value instanceof yn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),E=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,P=g.get("symbol-sort-key");if(this.features=[],!I&&!E)return;const A=r.iconDependencies,R=r.glyphDependencies,B=r.availableImages,N=new Ht(this.zoom);for(const{feature:Z,id:Y,index:pe,sourceLayerIndex:ne}of t){const he=h._featureFilter.needGeometry,_e=Sa(Z,he);if(!h._featureFilter.filter(N,_e,a))continue;let ke,je;if(he||(_e.geometry=ba(Z)),I){const Oe=h.getValueAndResolveTokens("text-field",_e,a,B),Fe=yn.factory(Oe),Je=this.hasRTLText=this.hasRTLText||o2(Fe);(!Je||bn.getRTLTextPluginStatus()==="unavailable"||Je&&bn.isParsed())&&(ke=Nb(Fe,h,_e))}if(E){const Oe=h.getValueAndResolveTokens("icon-image",_e,a,B);je=Oe instanceof xn?Oe:xn.fromString(Oe)}if(!ke&&!je)continue;const rt=this.sortFeaturesByKey?P.evaluate(_e,{},a):void 0;if(this.features.push({id:Y,text:ke,icon:je,index:pe,sourceLayerIndex:ne,geometry:_e.geometry,properties:Z.properties,type:n2[Z.type],sortKey:rt}),je&&(A[je.name]=!0),ke){const Oe=_.evaluate(_e,{},a).join(","),Fe=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.ah.vertical)>=0;for(const Je of ke.sections)if(Je.image)A[Je.image.name]=!0;else{const He=ec(ke.toString()),qe=Je.fontStack||Oe,ve=R[qe]=R[qe]||{};this.calculateGlyphDependencies(Je.text,ve,Fe,this.allowVerticalPlacement,He)}}}g.get("symbol-placement")==="line"&&(this.features=function(Z){const Y={},pe={},ne=[];let he=0;function _e(Oe){ne.push(Z[Oe]),he++}function ke(Oe,Fe,Je){const He=pe[Oe];return delete pe[Oe],pe[Fe]=He,ne[He].geometry[0].pop(),ne[He].geometry[0]=ne[He].geometry[0].concat(Je[0]),He}function je(Oe,Fe,Je){const He=Y[Fe];return delete Y[Fe],Y[Oe]=He,ne[He].geometry[0].shift(),ne[He].geometry[0]=Je[0].concat(ne[He].geometry[0]),He}function rt(Oe,Fe,Je){const He=Je?Fe[0][Fe[0].length-1]:Fe[0][0];return`${Oe}:${He.x}:${He.y}`}for(let Oe=0;Oe<Z.length;Oe++){const Fe=Z[Oe],Je=Fe.geometry,He=Fe.text?Fe.text.toString():null;if(!He){_e(Oe);continue}const qe=rt(He,Je),ve=rt(He,Je,!0);if(qe in pe&&ve in Y&&pe[qe]!==Y[ve]){const et=je(qe,ve,Je),Ye=ke(qe,ve,ne[et].geometry);delete Y[qe],delete pe[ve],pe[rt(He,ne[Ye].geometry,!0)]=Ye,ne[et].geometry=null}else qe in pe?ke(qe,ve,Je):ve in Y?je(qe,ve,Je):(_e(Oe),Y[qe]=he-1,pe[ve]=he-1)}return ne.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,Y)=>Z.sortKey-Y.sortKey)}update(t,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const a=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(r[t.segment+1]),g=t.dist(r[t.segment]);const _={};for(let v=t.segment+1;v<r.length;v++)_[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:h},v<r.length-1&&(h+=r[v+1].dist(r[v]));for(let v=t.segment||0;v>=0;v--)_[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const b=_[v];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,r,a,h,g,_,v,b,I,E,P,A){const R=t.indexArray,B=t.layoutVertexArray,N=t.segments.prepareSegment(4*r.length,B,R,this.canOverlap?_.sortKey:void 0),Z=this.glyphOffsetArray.length,Y=N.vertexLength,pe=this.allowVerticalPlacement&&v===w.ah.vertical?Math.PI/2:0,ne=_.text&&_.text.sections;for(let he=0;he<r.length;he++){const{tl:_e,tr:ke,bl:je,br:rt,tex:Oe,pixelOffsetTL:Fe,pixelOffsetBR:Je,minFontScaleX:He,minFontScaleY:qe,glyphOffset:ve,isSDF:et,sectionIndex:Ye}=r[he],lt=N.vertexLength,$t=ve[1];fd(B,b.x,b.y,_e.x,$t+_e.y,Oe.x,Oe.y,a,et,Fe.x,Fe.y,He,qe),fd(B,b.x,b.y,ke.x,$t+ke.y,Oe.x+Oe.w,Oe.y,a,et,Je.x,Fe.y,He,qe),fd(B,b.x,b.y,je.x,$t+je.y,Oe.x,Oe.y+Oe.h,a,et,Fe.x,Je.y,He,qe),fd(B,b.x,b.y,rt.x,$t+rt.y,Oe.x+Oe.w,Oe.y+Oe.h,a,et,Je.x,Je.y,He,qe),Hf(t.dynamicLayoutVertexArray,b,pe),R.emplaceBack(lt,lt+1,lt+2),R.emplaceBack(lt+1,lt+2,lt+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ve[0]),he!==r.length-1&&Ye===r[he+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,_,_.index,{},A,ne&&ne[Ye])}t.placedSymbolArray.emplaceBack(b.x,b.y,Z,this.glyphOffsetArray.length-Z,Y,I,E,b.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,!1,0,P)}_addCollisionDebugVertex(t,r,a,h,g,_){return r.emplaceBack(0,0),t.emplaceBack(a.x,a.y,h,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,r,a,h,g,_,v){const b=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),I=b.vertexLength,E=g.layoutVertexArray,P=g.collisionVertexArray,A=v.anchorX,R=v.anchorY;this._addCollisionDebugVertex(E,P,_,A,R,new X(t,r)),this._addCollisionDebugVertex(E,P,_,A,R,new X(a,r)),this._addCollisionDebugVertex(E,P,_,A,R,new X(a,h)),this._addCollisionDebugVertex(E,P,_,A,R,new X(t,h)),b.vertexLength+=4;const B=g.indexArray;B.emplaceBack(I,I+1),B.emplaceBack(I+1,I+2),B.emplaceBack(I+2,I+3),B.emplaceBack(I+3,I),b.primitiveLength+=4}addDebugCollisionBoxes(t,r,a,h){for(let g=t;g<r;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,h?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xf(Bn,Ty.members,Pi),this.iconCollisionBox=new Xf(Bn,Ty.members,Pi);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,a,h,g,_,v,b,I){const E={};for(let P=r;P<a;P++){const A=t.get(P);E.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.textFeatureIndex=A.featureIndex;break}for(let P=h;P<g;P++){const A=t.get(P);E.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.verticalTextFeatureIndex=A.featureIndex;break}for(let P=_;P<v;P++){const A=t.get(P);E.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.iconFeatureIndex=A.featureIndex;break}for(let P=b;P<I;P++){const A=t.get(P);E.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,anchorPointX:A.anchorPointX,anchorPointY:A.anchorPointY},E.verticalIconFeatureIndex=A.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const a=t.placedSymbolArray.get(r),h=a.vertexStartIndex+4*a.numGlyphs;for(let g=a.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),a=Math.cos(t),h=[],g=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const b=this.symbolInstances.get(v);h.push(0|Math.round(r*b.anchorX+a*b.anchorY)),g.push(b.featureIndex)}return _.sort((v,b)=>h[v]-h[b]||g[b]-g[v]),_}addToSortKeyRanges(t,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,g,_)=>{h>=0&&_.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Uy,$y;Ze("SymbolBucket",Fl,{omit:["layers","collisionBoxArray","features","compareText"]}),Fl.MAX_GLYPHS=65535,Fl.addDynamicAttributes=Hf;var Kf={get paint(){return $y=$y||new f({"icon-opacity":new ot(ge.paint_symbol["icon-opacity"]),"icon-color":new ot(ge.paint_symbol["icon-color"]),"icon-halo-color":new ot(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new ot(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ot(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Xe(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xe(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new ot(ge.paint_symbol["text-opacity"]),"text-color":new ot(ge.paint_symbol["text-color"],{runtimeType:rn,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new ot(ge.paint_symbol["text-halo-color"]),"text-halo-width":new ot(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new ot(ge.paint_symbol["text-halo-blur"]),"text-translate":new Xe(ge.paint_symbol["text-translate"]),"text-translate-anchor":new Xe(ge.paint_symbol["text-translate-anchor"])})},get layout(){return Uy=Uy||new f({"symbol-placement":new Xe(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Xe(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xe(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ot(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xe(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xe(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Xe(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Xe(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xe(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xe(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new ot(ge.layout_symbol["icon-size"]),"icon-text-fit":new Xe(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xe(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new ot(ge.layout_symbol["icon-image"]),"icon-rotate":new ot(ge.layout_symbol["icon-rotate"]),"icon-padding":new ot(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Xe(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new ot(ge.layout_symbol["icon-offset"]),"icon-anchor":new ot(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xe(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xe(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xe(ge.layout_symbol["text-rotation-alignment"]),"text-field":new ot(ge.layout_symbol["text-field"]),"text-font":new ot(ge.layout_symbol["text-font"]),"text-size":new ot(ge.layout_symbol["text-size"]),"text-max-width":new ot(ge.layout_symbol["text-max-width"]),"text-line-height":new Xe(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new ot(ge.layout_symbol["text-letter-spacing"]),"text-justify":new ot(ge.layout_symbol["text-justify"]),"text-radial-offset":new ot(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xe(ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ot(ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ot(ge.layout_symbol["text-anchor"]),"text-max-angle":new Xe(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Xe(ge.layout_symbol["text-writing-mode"]),"text-rotate":new ot(ge.layout_symbol["text-rotate"]),"text-padding":new Xe(ge.layout_symbol["text-padding"]),"text-keep-upright":new Xe(ge.layout_symbol["text-keep-upright"]),"text-transform":new ot(ge.layout_symbol["text-transform"]),"text-offset":new ot(ge.layout_symbol["text-offset"]),"text-allow-overlap":new Xe(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new Xe(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new Xe(ge.layout_symbol["text-ignore-placement"]),"text-optional":new Xe(ge.layout_symbol["text-optional"])})}};class qy{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Qr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ze("FormatSectionOverride",qy,{omit:["defaultValue"]});class md extends s{constructor(t){super(t,Kf)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const g of a)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,a,h){const g=this.layout.get(t).evaluate(r,{},a,h),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||ul(_.value)||!g?g:function(v,b){return b.replace(/{([^{}]+)}/g,(I,E)=>v&&E in v?String(v[E]):"")}(r.properties,g)}createBucket(t){return new Fl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Kf.paint.overridableProperties){if(!md.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),a=new qy(r),h=new ll(a,r.property.specification);let g=null;g=r.value.kind==="constant"||r.value.kind==="source"?new as("source",h):new ls("composite",h,r.value.zoomStops),this.paint._values[t]=new Tr(r.property,g,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&md.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const a=t.get("text-field"),h=Kf.paint.properties[r];let g=!1;const _=v=>{for(const b of v)if(h.overrides&&h.overrides.hasOverride(b))return void(g=!0)};if(a.value.kind==="constant"&&a.value.value instanceof yn)_(a.value.value.sections);else if(a.value.kind==="source"){const v=I=>{g||(I instanceof Xn&&gi(I.value)===Fr?_(I.value.sections):I instanceof Qa?_(I.sections):I.eachChild(v))},b=a.value;b._styleExpression&&v(b._styleExpression.expression)}return g}}let Zy;var s2={get paint(){return Zy=Zy||new f({"background-color":new Xe(ge.paint_background["background-color"]),"background-pattern":new bl(ge.paint_background["background-pattern"]),"background-opacity":new Xe(ge.paint_background["background-opacity"])})}};class a2 extends s{constructor(t){super(t,s2)}}let Gy;var l2={get paint(){return Gy=Gy||new f({"raster-opacity":new Xe(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xe(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xe(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xe(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Xe(ge.paint_raster["raster-saturation"]),"raster-contrast":new Xe(ge.paint_raster["raster-contrast"]),"raster-resampling":new Xe(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Xe(ge.paint_raster["raster-fade-duration"])})}};class u2 extends s{constructor(t){super(t,l2)}}class c2 extends s{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class h2{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Yf=63710088e-1;class Is{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Is($e(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,a=this.lat*r,h=t.lat*r,g=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((t.lng-this.lng)*r);return Yf*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof Is)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Is(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Is(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Hy=2*Math.PI*Yf;function Wy(n){return Hy*Math.cos(n*Math.PI/180)}function Xy(n){return(180+n)/360}function Ky(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Yy(n,t){return n/Wy(t)}function Jf(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class vc{constructor(t,r,a=0){this.x=+t,this.y=+r,this.z=+a}static fromLngLat(t,r=0){const a=Is.convert(t);return new vc(Xy(a.lng),Ky(a.lat),Yy(r,a.lat))}toLngLat(){return new Is(360*this.x-180,Jf(this.y))}toAltitude(){return this.z*Wy(Jf(this.y))}meterInMercatorCoordinateUnits(){return 1/Hy*(t=Jf(this.y),1/Math.cos(t*Math.PI/180));var t}}function Jy(n,t,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[n*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Qf{constructor(t,r,a){if(!function(h,g,_){return!(h<0||h>25||_<0||_>=Math.pow(2,h)||g<0||g>=Math.pow(2,h))}(t,r,a))throw new Error(`x=${r}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=a,this.key=xc(0,t,t,r,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,a){const h=(_=this.y,v=this.z,b=Jy(256*(g=this.x),256*(_=Math.pow(2,v)-_-1),v),I=Jy(256*(g+1),256*(_+1),v),b[0]+","+b[1]+","+I[0]+","+I[1]);var g,_,v,b,I;const E=function(P,A,R){let B,N="";for(let Z=P;Z>0;Z--)B=1<<Z-1,N+=(A&B?1:0)+(R&B?2:0);return N}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new X((t.x*r-this.x)*_i,(t.y*r-this.y)*_i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qy{constructor(t,r){this.wrap=t,this.canonical=r,this.key=xc(t,r.z,r.z,r.x,r.y)}}class nr{constructor(t,r,a,h,g){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Qf(a,+h,+g),this.key=xc(r,t,a,h,g)}clone(){return new nr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new nr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nr(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?xc(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):xc(this.wrap*+r,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new nr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new nr(r,this.wrap,r,a,h),new nr(r,this.wrap,r,a+1,h),new nr(r,this.wrap,r,a,h+1),new nr(r,this.wrap,r,a+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new nr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new nr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new vc(t.x-this.wrap,t.y))}}function xc(n,t,r,a,h){(n*=2)<0&&(n=-1*n-1);const g=1<<r;return(g*g*n+g*h+a).toString(36)+r.toString(36)+t.toString(36)}Ze("CanonicalTileID",Qf),Ze("OverscaledTileID",nr,{omit:["posMatrix"]});class e0{constructor(t,r,a,h=1,g=1,_=1,v=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void oi(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const b=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=_,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<b;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(b,I)]=this.data[this._idx(b-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,b)]=this.data[this._idx(I,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<b;I++)for(let E=0;E<b;E++){const P=this.get(I,E);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,r){const a=new Uint8Array(this.data.buffer),h=4*this._idx(t,r);return this.unpack(a[h],a[h+1],a[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,a){return t*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new ir({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,g=r*this.dim+this.dim,_=a*this.dim,v=a*this.dim+this.dim;switch(r){case-1:h=g-1;break;case 1:g=h+1}switch(a){case-1:_=v-1;break;case 1:v=_+1}const b=-r*this.dim,I=-a*this.dim;for(let E=_;E<v;E++)for(let P=h;P<g;P++)this.data[this._idx(P,E)]=t.data[this._idx(P+b,E+I)]}}Ze("DEMData",e0);class t0{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const a=t[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class i0{constructor(t,r,a,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=a,t._y=h,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class n0{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ds(_i,16,0),this.grid3D=new ds(_i,16,0),this.featureIndexArray=new Gi,this.promoteId=r}insert(t,r,a,h,g,_){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,g);const b=_?this.grid3D:this.grid;for(let I=0;I<r.length;I++){const E=r[I],P=[1/0,1/0,-1/0,-1/0];for(let A=0;A<E.length;A++){const R=E[A];P[0]=Math.min(P[0],R.x),P[1]=Math.min(P[1],R.y),P[2]=Math.max(P[2],R.x),P[3]=Math.max(P[3],R.y)}P[0]<_i&&P[1]<_i&&P[2]>=0&&P[3]>=0&&b.insert(v,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ss.VectorTile(new jf(this.rawTileData)).layers,this.sourceLayerCoder=new t0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,a,h){this.loadVTLayers();const g=t.params||{},_=_i/t.tileSize/t.scale,v=Nu(g.filter),b=t.queryGeometry,I=t.queryPadding*_,E=o0(b),P=this.grid.query(E.minX-I,E.minY-I,E.maxX+I,E.maxY+I),A=o0(t.cameraQueryGeometry),R=this.grid3D.query(A.minX-I,A.minY-I,A.maxX+I,A.maxY+I,(Z,Y,pe,ne)=>function(he,_e,ke,je,rt){for(const Fe of he)if(_e<=Fe.x&&ke<=Fe.y&&je>=Fe.x&&rt>=Fe.y)return!0;const Oe=[new X(_e,ke),new X(_e,rt),new X(je,rt),new X(je,ke)];if(he.length>2){for(const Fe of Oe)if(Pl(he,Fe))return!0}for(let Fe=0;Fe<he.length-1;Fe++)if(Zw(he[Fe],he[Fe+1],Oe))return!0;return!1}(t.cameraQueryGeometry,Z-I,Y-I,pe+I,ne+I));for(const Z of R)P.push(Z);P.sort(d2);const B={};let N;for(let Z=0;Z<P.length;Z++){const Y=P[Z];if(Y===N)continue;N=Y;const pe=this.featureIndexArray.get(Y);let ne=null;this.loadMatchingFeature(B,pe.bucketIndex,pe.sourceLayerIndex,pe.featureIndex,v,g.layers,g.availableImages,r,a,h,(he,_e,ke)=>(ne||(ne=ba(he)),_e.queryIntersectsFeature(b,he,ke,ne,this.z,t.transform,_,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,r,a,h,g,_,v,b,I,E,P){const A=this.bucketLayerIDs[r];if(_&&!function(Z,Y){for(let pe=0;pe<Z.length;pe++)if(Y.indexOf(Z[pe])>=0)return!0;return!1}(_,A))return;const R=this.sourceLayerCoder.decode(a),B=this.vtLayers[R].feature(h);if(g.needGeometry){const Z=Sa(B,!0);if(!g.filter(new Ht(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!g.filter(new Ht(this.tileID.overscaledZ),B))return;const N=this.getId(B,R);for(let Z=0;Z<A.length;Z++){const Y=A[Z];if(_&&_.indexOf(Y)<0)continue;const pe=b[Y];if(!pe)continue;let ne={};N&&E&&(ne=E.getState(pe.sourceLayer||"_geojsonTileLayer",N));const he=Ve({},I[Y]);he.paint=r0(he.paint,pe.paint,B,ne,v),he.layout=r0(he.layout,pe.layout,B,ne,v);const _e=!P||P(B,pe,ne);if(!_e)continue;const ke=new i0(B,this.z,this.x,this.y,N);ke.layer=he;let je=t[Y];je===void 0&&(je=t[Y]=[]),je.push({featureIndex:h,feature:ke,intersectionZ:_e})}}lookupSymbolFeatures(t,r,a,h,g,_,v,b){const I={};this.loadVTLayers();const E=Nu(g);for(const P of t)this.loadMatchingFeature(I,a,h,P,E,_,v,b,r);return I}hasLayer(t){for(const r of this.bucketLayerIDs)for(const a of r)if(t===a)return!0;return!1}getId(t,r){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function r0(n,t,r,a,h){return Et(n,(g,_)=>{const v=t instanceof ya?t.get(_):null;return v&&v.evaluate?v.evaluate(r,a,h):v})}function o0(n){let t=1/0,r=1/0,a=-1/0,h=-1/0;for(const g of n)t=Math.min(t,g.x),r=Math.min(r,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return{minX:t,minY:r,maxX:a,maxY:h}}function d2(n,t){return t-n}function s0(n,t,r,a,h){const g=[];for(let _=0;_<n.length;_++){const v=n[_];let b;for(let I=0;I<v.length-1;I++){let E=v[I],P=v[I+1];E.x<t&&P.x<t||(E.x<t?E=new X(t,E.y+(t-E.x)/(P.x-E.x)*(P.y-E.y))._round():P.x<t&&(P=new X(t,E.y+(t-E.x)/(P.x-E.x)*(P.y-E.y))._round()),E.y<r&&P.y<r||(E.y<r?E=new X(E.x+(r-E.y)/(P.y-E.y)*(P.x-E.x),r)._round():P.y<r&&(P=new X(E.x+(r-E.y)/(P.y-E.y)*(P.x-E.x),r)._round()),E.x>=a&&P.x>=a||(E.x>=a?E=new X(a,E.y+(a-E.x)/(P.x-E.x)*(P.y-E.y))._round():P.x>=a&&(P=new X(a,E.y+(a-E.x)/(P.x-E.x)*(P.y-E.y))._round()),E.y>=h&&P.y>=h||(E.y>=h?E=new X(E.x+(h-E.y)/(P.y-E.y)*(P.x-E.x),h)._round():P.y>=h&&(P=new X(E.x+(h-E.y)/(P.y-E.y)*(P.x-E.x),h)._round()),b&&E.equals(b[b.length-1])||(b=[E],g.push(b)),b.push(P)))))}}return g}Ze("FeatureIndex",n0,{omit:["rawTileData","sourceLayerCoder"]});class Es extends X{constructor(t,r,a,h){super(t,r),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new Es(this.x,this.y,this.angle,this.segment)}}function a0(n,t,r,a,h){if(t.segment===void 0||r===0)return!0;let g=t,_=t.segment+1,v=0;for(;v>-r/2;){if(_--,_<0)return!1;v-=n[_].dist(g),g=n[_]}v+=n[_].dist(n[_+1]),_++;const b=[];let I=0;for(;v<r/2;){const E=n[_],P=n[_+1];if(!P)return!1;let A=n[_-1].angleTo(E)-E.angleTo(P);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:A}),I+=A;v-b[0].distance>a;)I-=b.shift().angleDelta;if(I>h)return!1;_++,v+=E.dist(P)}return!0}function l0(n){let t=0;for(let r=0;r<n.length-1;r++)t+=n[r].dist(n[r+1]);return t}function u0(n,t,r){return n?.6*t*r:0}function c0(n,t){return Math.max(n?n.right-n.left:0,t?t.right-t.left:0)}function p2(n,t,r,a,h,g){const _=u0(r,h,g),v=c0(r,a)*g;let b=0;const I=l0(n)/2;for(let E=0;E<n.length-1;E++){const P=n[E],A=n[E+1],R=P.dist(A);if(b+R>I){const B=(I-b)/R,N=on.number(P.x,A.x,B),Z=on.number(P.y,A.y,B),Y=new Es(N,Z,A.angleTo(P),E);return Y._round(),!_||a0(n,Y,v,_,t)?Y:void 0}b+=R}}function f2(n,t,r,a,h,g,_,v,b){const I=u0(a,g,_),E=c0(a,h),P=E*_,A=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return t-P<t/4&&(t=P+t/4),h0(n,A?t/2*v%t:(E/2+2*g)*_*v%t,t,I,r,P,A,!1,b)}function h0(n,t,r,a,h,g,_,v,b){const I=g/2,E=l0(n);let P=0,A=t-r,R=[];for(let B=0;B<n.length-1;B++){const N=n[B],Z=n[B+1],Y=N.dist(Z),pe=Z.angleTo(N);for(;A+r<P+Y;){A+=r;const ne=(A-P)/Y,he=on.number(N.x,Z.x,ne),_e=on.number(N.y,Z.y,ne);if(he>=0&&he<b&&_e>=0&&_e<b&&A-I>=0&&A+I<=E){const ke=new Es(he,_e,pe,B);ke._round(),a&&!a0(n,ke,g,a,h)||R.push(ke)}}P+=Y}return v||R.length||_||(R=h0(n,P/2,r,a,h,g,_,!0,b)),R}Ze("Anchor",Es);const Bl=Tn;function d0(n,t,r,a){const h=[],g=n.image,_=g.pixelRatio,v=g.paddedRect.w-2*Bl,b=g.paddedRect.h-2*Bl;let I={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const E=g.stretchX||[[0,v]],P=g.stretchY||[[0,b]],A=(ve,et)=>ve+et[1]-et[0],R=E.reduce(A,0),B=P.reduce(A,0),N=v-R,Z=b-B;let Y=0,pe=R,ne=0,he=B,_e=0,ke=N,je=0,rt=Z;if(g.content&&a){const ve=g.content,et=ve[2]-ve[0],Ye=ve[3]-ve[1];(g.textFitWidth||g.textFitHeight)&&(I=Ny(n)),Y=gd(E,0,ve[0]),ne=gd(P,0,ve[1]),pe=gd(E,ve[0],ve[2]),he=gd(P,ve[1],ve[3]),_e=ve[0]-Y,je=ve[1]-ne,ke=et-pe,rt=Ye-he}const Oe=I.x1,Fe=I.y1,Je=I.x2-Oe,He=I.y2-Fe,qe=(ve,et,Ye,lt)=>{const $t=_d(ve.stretch-Y,pe,Je,Oe),Ut=yd(ve.fixed-_e,ke,ve.stretch,R),Ti=_d(et.stretch-ne,he,He,Fe),Ir=yd(et.fixed-je,rt,et.stretch,B),Ni=_d(Ye.stretch-Y,pe,Je,Oe),ki=yd(Ye.fixed-_e,ke,Ye.stretch,R),un=_d(lt.stretch-ne,he,He,Fe),cn=yd(lt.fixed-je,rt,lt.stretch,B),hn=new X($t,Ti),li=new X(Ni,Ti),Ii=new X(Ni,un),Wi=new X($t,un),Vi=new X(Ut/_,Ir/_),dn=new X(ki/_,cn/_),ji=t*Math.PI/180;if(ji){const At=Math.sin(ji),Zt=Math.cos(ji),Yt=[Zt,-At,At,Zt];hn._matMult(Yt),li._matMult(Yt),Wi._matMult(Yt),Ii._matMult(Yt)}const rr=ve.stretch+ve.fixed,kn=et.stretch+et.fixed;return{tl:hn,tr:li,bl:Wi,br:Ii,tex:{x:g.paddedRect.x+Bl+rr,y:g.paddedRect.y+Bl+kn,w:Ye.stretch+Ye.fixed-rr,h:lt.stretch+lt.fixed-kn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vi,pixelOffsetBR:dn,minFontScaleX:ke/_/Je,minFontScaleY:rt/_/He,isSDF:r}};if(a&&(g.stretchX||g.stretchY)){const ve=p0(E,N,R),et=p0(P,Z,B);for(let Ye=0;Ye<ve.length-1;Ye++){const lt=ve[Ye],$t=ve[Ye+1];for(let Ut=0;Ut<et.length-1;Ut++)h.push(qe(lt,et[Ut],$t,et[Ut+1]))}}else h.push(qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return h}function gd(n,t,r){let a=0;for(const h of n)a+=Math.max(t,Math.min(r,h[1]))-Math.max(t,Math.min(r,h[0]));return a}function p0(n,t,r){const a=[{fixed:-Bl,stretch:0}];for(const[h,g]of n){const _=a[a.length-1];a.push({fixed:h-_.stretch,stretch:_.stretch}),a.push({fixed:h-_.stretch,stretch:_.stretch+(g-h)})}return a.push({fixed:t+Bl,stretch:r}),a}function _d(n,t,r,a){return n/t*r+a}function yd(n,t,r,a){return n-t*r/a}class vd{constructor(t,r,a,h,g,_,v,b,I,E){var P;if(this.boxStartIndex=t.length,I){let A=_.top,R=_.bottom;const B=_.collisionPadding;B&&(A-=B[1],R+=B[3]);let N=R-A;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{const A=!((P=_.image)===null||P===void 0)&&P.content&&(_.image.textFitWidth||_.image.textFitHeight)?Ny(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};A.y1=A.y1*v-b[0],A.y2=A.y2*v+b[2],A.x1=A.x1*v-b[3],A.x2=A.x2*v+b[1];const R=_.collisionPadding;if(R&&(A.x1-=R[0]*v,A.y1-=R[1]*v,A.x2+=R[2]*v,A.y2+=R[3]*v),E){const B=new X(A.x1,A.y1),N=new X(A.x2,A.y1),Z=new X(A.x1,A.y2),Y=new X(A.x2,A.y2),pe=E*Math.PI/180;B._rotate(pe),N._rotate(pe),Z._rotate(pe),Y._rotate(pe),A.x1=Math.min(B.x,N.x,Z.x,Y.x),A.x2=Math.max(B.x,N.x,Z.x,Y.x),A.y1=Math.min(B.y,N.y,Z.y,Y.y),A.y2=Math.max(B.y,N.y,Z.y,Y.y)}t.emplaceBack(r.x,r.y,A.x1,A.y1,A.x2,A.y2,a,h,g)}this.boxEndIndex=t.length}}class m2{constructor(t=[],r=(a,h)=>a<h?-1:a>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:a}=this,h=r[t];for(;t>0;){const g=t-1>>1,_=r[g];if(a(h,_)>=0)break;r[t]=_,t=g}r[t]=h}_down(t){const{data:r,compare:a}=this,h=this.length>>1,g=r[t];for(;t<h;){let _=1+(t<<1);const v=_+1;if(v<this.length&&a(r[v],r[_])<0&&(_=v),a(r[_],g)>=0)break;r[t]=r[_],t=_}r[t]=g}}function g2(n,t=1,r=!1){let a=1/0,h=1/0,g=-1/0,_=-1/0;const v=n[0];for(let R=0;R<v.length;R++){const B=v[R];(!R||B.x<a)&&(a=B.x),(!R||B.y<h)&&(h=B.y),(!R||B.x>g)&&(g=B.x),(!R||B.y>_)&&(_=B.y)}const b=Math.min(g-a,_-h);let I=b/2;const E=new m2([],_2);if(b===0)return new X(a,h);for(let R=a;R<g;R+=b)for(let B=h;B<_;B+=b)E.push(new Ol(R+I,B+I,I,n));let P=function(R){let B=0,N=0,Z=0;const Y=R[0];for(let pe=0,ne=Y.length,he=ne-1;pe<ne;he=pe++){const _e=Y[pe],ke=Y[he],je=_e.x*ke.y-ke.x*_e.y;N+=(_e.x+ke.x)*je,Z+=(_e.y+ke.y)*je,B+=3*je}return new Ol(N/B,Z/B,0,R)}(n),A=E.length;for(;E.length;){const R=E.pop();(R.d>P.d||!P.d)&&(P=R,r&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,A)),R.max-P.d<=t||(I=R.h/2,E.push(new Ol(R.p.x-I,R.p.y-I,I,n)),E.push(new Ol(R.p.x+I,R.p.y-I,I,n)),E.push(new Ol(R.p.x-I,R.p.y+I,I,n)),E.push(new Ol(R.p.x+I,R.p.y+I,I,n)),A+=4)}return r&&(console.log(`num probes: ${A}`),console.log(`best distance: ${P.d}`)),P.p}function _2(n,t){return t.max-n.max}function Ol(n,t,r,a){this.p=new X(n,t),this.h=r,this.d=function(h,g){let _=!1,v=1/0;for(let b=0;b<g.length;b++){const I=g[b];for(let E=0,P=I.length,A=P-1;E<P;A=E++){const R=I[E],B=I[A];R.y>h.y!=B.y>h.y&&h.x<(B.x-R.x)*(h.y-R.y)/(B.y-R.y)+R.x&&(_=!_),v=Math.min(v,K_(h,R,B))}}return(_?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Oi;w.aq=void 0,(Oi=w.aq||(w.aq={}))[Oi.center=1]="center",Oi[Oi.left=2]="left",Oi[Oi.right=3]="right",Oi[Oi.top=4]="top",Oi[Oi.bottom=5]="bottom",Oi[Oi["top-left"]=6]="top-left",Oi[Oi["top-right"]=7]="top-right",Oi[Oi["bottom-left"]=8]="bottom-left",Oi[Oi["bottom-right"]=9]="bottom-right";const Cs=7,em=Number.POSITIVE_INFINITY;function f0(n,t){return t[1]!==em?function(r,a,h){let g=0,_=0;switch(a=Math.abs(a),h=Math.abs(h),r){case"top-right":case"top-left":case"top":_=h-Cs;break;case"bottom-right":case"bottom-left":case"bottom":_=-h+Cs}switch(r){case"top-right":case"bottom-right":case"right":g=-a;break;case"top-left":case"bottom-left":case"left":g=a}return[g,_]}(n,t[0],t[1]):function(r,a){let h=0,g=0;a<0&&(a=0);const _=a/Math.SQRT2;switch(r){case"top-right":case"top-left":g=_-Cs;break;case"bottom-right":case"bottom-left":g=-_+Cs;break;case"bottom":g=-a+Cs;break;case"top":g=a-Cs}switch(r){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=a;break;case"right":h=-a}return[h,g]}(n,t[0])}function m0(n,t,r){var a;const h=n.layout,g=(a=h.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},r);if(g){const v=g.values,b=[];for(let I=0;I<v.length;I+=2){const E=b[I]=v[I],P=v[I+1].map(A=>A*vi);E.startsWith("top")?P[1]-=Cs:E.startsWith("bottom")&&(P[1]+=Cs),b[I+1]=P}return new zn(b)}const _=h.get("text-variable-anchor");if(_){let v;v=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},r)*vi,em]:h.get("text-offset").evaluate(t,{},r).map(I=>I*vi);const b=[];for(const I of _)b.push(I,f0(I,v));return new zn(b)}return null}function tm(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function y2(n,t,r,a,h,g,_,v,b,I,E){let P=g.textMaxSize.evaluate(t,{});P===void 0&&(P=_);const A=n.layers[0].layout,R=A.get("icon-offset").evaluate(t,{},E),B=_0(r.horizontal),N=_/24,Z=n.tilePixelRatio*N,Y=n.tilePixelRatio*P/24,pe=n.tilePixelRatio*v,ne=n.tilePixelRatio*A.get("symbol-spacing"),he=A.get("text-padding")*n.tilePixelRatio,_e=function(ve,et,Ye,lt=1){const $t=ve.get("icon-padding").evaluate(et,{},Ye),Ut=$t&&$t.values;return[Ut[0]*lt,Ut[1]*lt,Ut[2]*lt,Ut[3]*lt]}(A,t,E,n.tilePixelRatio),ke=A.get("text-max-angle")/180*Math.PI,je=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point",rt=A.get("icon-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",Oe=A.get("symbol-placement"),Fe=ne/2,Je=A.get("icon-text-fit");let He;a&&Je!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(He=Vy(a,r.vertical,Je,A.get("icon-text-fit-padding"),R,N)),B&&(a=Vy(a,B,Je,A.get("icon-text-fit-padding"),R,N)));const qe=(ve,et)=>{et.x<0||et.x>=_i||et.y<0||et.y>=_i||function(Ye,lt,$t,Ut,Ti,Ir,Ni,ki,un,cn,hn,li,Ii,Wi,Vi,dn,ji,rr,kn,At,Zt,Yt,On,ii,Nl){const so=Ye.addToLineVertexArray(lt,$t);let ao,Er,or,Mi,Lo=0,Sc=0,w0=0,b0=0,um=-1,cm=-1;const Ro={};let S0=kl("");if(Ye.allowVerticalPlacement&&Ut.vertical){const Xi=ki.layout.get("text-rotate").evaluate(Zt,{},ii)+90;or=new vd(un,lt,cn,hn,li,Ut.vertical,Ii,Wi,Vi,Xi),Ni&&(Mi=new vd(un,lt,cn,hn,li,Ni,ji,rr,Vi,Xi))}if(Ti){const Xi=ki.layout.get("icon-rotate").evaluate(Zt,{}),sr=ki.layout.get("icon-text-fit")!=="none",ka=d0(Ti,Xi,On,sr),jr=Ni?d0(Ni,Xi,On,sr):void 0;Er=new vd(un,lt,cn,hn,li,Ti,ji,rr,!1,Xi),Lo=4*ka.length;const Ia=Ye.iconSizeData;let lo=null;Ia.kind==="source"?(lo=[oo*ki.layout.get("icon-size").evaluate(Zt,{})],lo[0]>ks&&oi(`${Ye.layerIds[0]}: Value for "icon-size" is >= ${yc}. Reduce your "icon-size".`)):Ia.kind==="composite"&&(lo=[oo*Yt.compositeIconSizes[0].evaluate(Zt,{},ii),oo*Yt.compositeIconSizes[1].evaluate(Zt,{},ii)],(lo[0]>ks||lo[1]>ks)&&oi(`${Ye.layerIds[0]}: Value for "icon-size" is >= ${yc}. Reduce your "icon-size".`)),Ye.addSymbols(Ye.icon,ka,lo,At,kn,Zt,w.ah.none,lt,so.lineStartIndex,so.lineLength,-1,ii),um=Ye.icon.placedSymbolArray.length-1,jr&&(Sc=4*jr.length,Ye.addSymbols(Ye.icon,jr,lo,At,kn,Zt,w.ah.vertical,lt,so.lineStartIndex,so.lineLength,-1,ii),cm=Ye.icon.placedSymbolArray.length-1)}const T0=Object.keys(Ut.horizontal);for(const Xi of T0){const sr=Ut.horizontal[Xi];if(!ao){S0=kl(sr.text);const jr=ki.layout.get("text-rotate").evaluate(Zt,{},ii);ao=new vd(un,lt,cn,hn,li,sr,Ii,Wi,Vi,jr)}const ka=sr.positionedLines.length===1;if(w0+=g0(Ye,lt,sr,Ir,ki,Vi,Zt,dn,so,Ut.vertical?w.ah.horizontal:w.ah.horizontalOnly,ka?T0:[Xi],Ro,um,Yt,ii),ka)break}Ut.vertical&&(b0+=g0(Ye,lt,Ut.vertical,Ir,ki,Vi,Zt,dn,so,w.ah.vertical,["vertical"],Ro,cm,Yt,ii));const w2=ao?ao.boxStartIndex:Ye.collisionBoxArray.length,b2=ao?ao.boxEndIndex:Ye.collisionBoxArray.length,S2=or?or.boxStartIndex:Ye.collisionBoxArray.length,T2=or?or.boxEndIndex:Ye.collisionBoxArray.length,k2=Er?Er.boxStartIndex:Ye.collisionBoxArray.length,I2=Er?Er.boxEndIndex:Ye.collisionBoxArray.length,E2=Mi?Mi.boxStartIndex:Ye.collisionBoxArray.length,C2=Mi?Mi.boxEndIndex:Ye.collisionBoxArray.length;let Vr=-1;const wd=(Xi,sr)=>Xi&&Xi.circleDiameter?Math.max(Xi.circleDiameter,sr):sr;Vr=wd(ao,Vr),Vr=wd(or,Vr),Vr=wd(Er,Vr),Vr=wd(Mi,Vr);const k0=Vr>-1?1:0;k0&&(Vr*=Nl/vi),Ye.glyphOffsetArray.length>=Fl.MAX_GLYPHS&&oi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&Ye.addToSortKeyRanges(Ye.symbolInstances.length,Zt.sortKey);const P2=m0(ki,Zt,ii),[M2,z2]=function(Xi,sr){const ka=Xi.length,jr=sr==null?void 0:sr.values;if((jr==null?void 0:jr.length)>0)for(let Ia=0;Ia<jr.length;Ia+=2){const lo=jr[Ia+1];Xi.emplaceBack(w.aq[jr[Ia]],lo[0],lo[1])}return[ka,Xi.length]}(Ye.textAnchorOffsets,P2);Ye.symbolInstances.emplaceBack(lt.x,lt.y,Ro.right>=0?Ro.right:-1,Ro.center>=0?Ro.center:-1,Ro.left>=0?Ro.left:-1,Ro.vertical||-1,um,cm,S0,w2,b2,S2,T2,k2,I2,E2,C2,cn,w0,b0,Lo,Sc,k0,0,Ii,Vr,M2,z2)}(n,et,ve,r,a,h,He,n.layers[0],n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,Z,[he,he,he,he],je,b,pe,_e,rt,R,t,g,I,E,_)};if(Oe==="line")for(const ve of s0(t.geometry,0,0,_i,_i)){const et=f2(ve,ne,ke,r.vertical||B,a,24,Y,n.overscaling,_i);for(const Ye of et)B&&v2(n,B.text,Fe,Ye)||qe(ve,Ye)}else if(Oe==="line-center"){for(const ve of t.geometry)if(ve.length>1){const et=p2(ve,ke,r.vertical||B,a,24,Y);et&&qe(ve,et)}}else if(t.type==="Polygon")for(const ve of tl(t.geometry,0)){const et=g2(ve,16);qe(ve[0],new Es(et.x,et.y,0))}else if(t.type==="LineString")for(const ve of t.geometry)qe(ve,new Es(ve[0].x,ve[0].y,0));else if(t.type==="Point")for(const ve of t.geometry)for(const et of ve)qe([et],new Es(et.x,et.y,0))}function g0(n,t,r,a,h,g,_,v,b,I,E,P,A,R,B){const N=function(pe,ne,he,_e,ke,je,rt,Oe){const Fe=_e.layout.get("text-rotate").evaluate(je,{})*Math.PI/180,Je=[];for(const He of ne.positionedLines)for(const qe of He.positionedGlyphs){if(!qe.rect)continue;const ve=qe.rect||{};let et=Ay+1,Ye=!0,lt=1,$t=0;const Ut=(ke||Oe)&&qe.vertical,Ti=qe.metrics.advance*qe.scale/2;if(Oe&&ne.verticalizable&&($t=He.lineOffset/2-(qe.imageName?-(vi-qe.metrics.width*qe.scale)/2:(qe.scale-1)*vi)),qe.imageName){const At=rt[qe.imageName];Ye=At.sdf,lt=At.pixelRatio,et=Tn/lt}const Ir=ke?[qe.x+Ti,qe.y]:[0,0];let Ni=ke?[0,0]:[qe.x+Ti+he[0],qe.y+he[1]-$t],ki=[0,0];Ut&&(ki=Ni,Ni=[0,0]);const un=qe.metrics.isDoubleResolution?2:1,cn=(qe.metrics.left-et)*qe.scale-Ti+Ni[0],hn=(-qe.metrics.top-et)*qe.scale+Ni[1],li=cn+ve.w/un*qe.scale/lt,Ii=hn+ve.h/un*qe.scale/lt,Wi=new X(cn,hn),Vi=new X(li,hn),dn=new X(cn,Ii),ji=new X(li,Ii);if(Ut){const At=new X(-Ti,Ti-gc),Zt=-Math.PI/2,Yt=vi/2-Ti,On=new X(5-gc-Yt,-(qe.imageName?Yt:0)),ii=new X(...ki);Wi._rotateAround(Zt,At)._add(On)._add(ii),Vi._rotateAround(Zt,At)._add(On)._add(ii),dn._rotateAround(Zt,At)._add(On)._add(ii),ji._rotateAround(Zt,At)._add(On)._add(ii)}if(Fe){const At=Math.sin(Fe),Zt=Math.cos(Fe),Yt=[Zt,-At,At,Zt];Wi._matMult(Yt),Vi._matMult(Yt),dn._matMult(Yt),ji._matMult(Yt)}const rr=new X(0,0),kn=new X(0,0);Je.push({tl:Wi,tr:Vi,bl:dn,br:ji,tex:ve,writingMode:ne.writingMode,glyphOffset:Ir,sectionIndex:qe.sectionIndex,isSDF:Ye,pixelOffsetTL:rr,pixelOffsetBR:kn,minFontScaleX:0,minFontScaleY:0})}return Je}(0,r,v,h,g,_,a,n.allowVerticalPlacement),Z=n.textSizeData;let Y=null;Z.kind==="source"?(Y=[oo*h.layout.get("text-size").evaluate(_,{})],Y[0]>ks&&oi(`${n.layerIds[0]}: Value for "text-size" is >= ${yc}. Reduce your "text-size".`)):Z.kind==="composite"&&(Y=[oo*R.compositeTextSizes[0].evaluate(_,{},B),oo*R.compositeTextSizes[1].evaluate(_,{},B)],(Y[0]>ks||Y[1]>ks)&&oi(`${n.layerIds[0]}: Value for "text-size" is >= ${yc}. Reduce your "text-size".`)),n.addSymbols(n.text,N,Y,v,g,_,I,t,b.lineStartIndex,b.lineLength,A,B);for(const pe of E)P[pe]=n.text.placedSymbolArray.length-1;return 4*N.length}function _0(n){for(const t in n)return n[t];return null}function v2(n,t,r,a){const h=n.compareText;if(t in h){const g=h[t];for(let _=g.length-1;_>=0;_--)if(a.dist(g[_])<r)return!0}else h[t]=[];return h[t].push(a),!1}const y0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class im{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=y0[15&a];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new im(v,_,g,t)}constructor(t,r=64,a=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=y0.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=r,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return nm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:v}=this,b=[0,g.length-1,0],I=[];for(;b.length;){const E=b.pop()||0,P=b.pop()||0,A=b.pop()||0;if(P-A<=v){for(let Z=A;Z<=P;Z++){const Y=_[2*Z],pe=_[2*Z+1];Y>=t&&Y<=a&&pe>=r&&pe<=h&&I.push(g[Z])}continue}const R=A+P>>1,B=_[2*R],N=_[2*R+1];B>=t&&B<=a&&N>=r&&N<=h&&I.push(g[R]),(E===0?t<=B:r<=N)&&(b.push(A),b.push(R-1),b.push(1-E)),(E===0?a>=B:h>=N)&&(b.push(R+1),b.push(P),b.push(1-E))}return I}within(t,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:_}=this,v=[0,h.length-1,0],b=[],I=a*a;for(;v.length;){const E=v.pop()||0,P=v.pop()||0,A=v.pop()||0;if(P-A<=_){for(let Z=A;Z<=P;Z++)x0(g[2*Z],g[2*Z+1],t,r)<=I&&b.push(h[Z]);continue}const R=A+P>>1,B=g[2*R],N=g[2*R+1];x0(B,N,t,r)<=I&&b.push(h[R]),(E===0?t-a<=B:r-a<=N)&&(v.push(A),v.push(R-1),v.push(1-E)),(E===0?t+a>=B:r+a>=N)&&(v.push(R+1),v.push(P),v.push(1-E))}return b}}function nm(n,t,r,a,h,g){if(h-a<=r)return;const _=a+h>>1;v0(n,t,_,a,h,g),nm(n,t,r,a,_-1,1-g),nm(n,t,r,_+1,h,1-g)}function v0(n,t,r,a,h,g){for(;h>a;){if(h-a>600){const I=h-a+1,E=r-a+1,P=Math.log(I),A=.5*Math.exp(2*P/3),R=.5*Math.sqrt(P*A*(I-A)/I)*(E-I/2<0?-1:1);v0(n,t,r,Math.max(a,Math.floor(r-E*A/I+R)),Math.min(h,Math.floor(r+(I-E)*A/I+R)),g)}const _=t[2*r+g];let v=a,b=h;for(wc(n,t,a,r),t[2*h+g]>_&&wc(n,t,a,h);v<b;){for(wc(n,t,v,b),v++,b--;t[2*v+g]<_;)v++;for(;t[2*b+g]>_;)b--}t[2*a+g]===_?wc(n,t,a,b):(b++,wc(n,t,b,h)),b<=r&&(a=b+1),r<=b&&(h=b-1)}}function wc(n,t,r,a){rm(n,r,a),rm(t,2*r,2*a),rm(t,2*r+1,2*a+1)}function rm(n,t,r){const a=n[t];n[t]=n[r],n[r]=a}function x0(n,t,r,a){const h=n-r,g=t-a;return h*h+g*g}var om;w.bg=void 0,(om=w.bg||(w.bg={})).create="create",om.load="load",om.fullLoad="fullLoad";let xd=null,bc=[];const sm=1e3/60,am="loadTime",lm="fullLoadTime",x2={mark(n){performance.mark(n)},frame(n){const t=n;xd!=null&&bc.push(t-xd),xd=t},clearMetrics(){xd=null,bc=[],performance.clearMeasures(am),performance.clearMeasures(lm);for(const n in w.bg)performance.clearMarks(w.bg[n])},getPerformanceMetrics(){performance.measure(am,w.bg.create,w.bg.load),performance.measure(lm,w.bg.create,w.bg.fullLoad);const n=performance.getEntriesByName(am)[0].duration,t=performance.getEntriesByName(lm)[0].duration,r=bc.length,a=1/(bc.reduce((g,_)=>g+_,0)/r/1e3),h=bc.filter(g=>g>sm).reduce((g,_)=>g+(_-sm)/sm,0);return{loadTime:n,fullLoadTime:t,fps:a,percentDroppedFrames:h/(r+h)*100,totalFrames:r}}};w.$=class extends M{},w.A=Ml,w.B=gf,w.C=function(n){if(_r==null){const t=n.navigator?n.navigator.userAgent:null;_r=!!n.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return _r},w.D=Xe,w.E=Ho,w.F=class{constructor(n,t){this.target=n,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new h2(()=>this.process()),this.subscription=function(r,a,h,g){return r.addEventListener(a,h,!1),{unsubscribe:()=>{r.removeEventListener(a,h,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Zn(self)?n:window}registerMessageHandler(n,t){this.messageHandlers[n]=t}sendAsync(n,t){return new Promise((r,a)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[h]={resolve:r,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[h];const v={id:h,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)},{once:!0});const g=[],_=Object.assign(Object.assign({},n),{id:h,sourceMapId:this.mapId,origin:location.origin,data:ps(n.data,g)});this.target.postMessage(_,{transfer:g})})}receive(n){const t=n.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const a=this.abortControllers[r];return delete this.abortControllers[r],void(a&&a.abort())}if(Zn(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),t=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(n,t)}processTask(n,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[n];return delete this.resolveRejects[n],h?void(t.error?h.reject(fs(t.error)):h.resolve(fs(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=fs(t.data),a=new AbortController;this.abortControllers[n]=a;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,r,a);this.completeTask(n,null,h)}catch(h){this.completeTask(n,h)}})}completeTask(n,t,r){const a=[];delete this.abortControllers[n];const h={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ps(t):null,data:ps(r,a)};this.target.postMessage(h,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.G=nn,w.H=function(){var n=new Ml(16);return Ml!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},w.I=$f,w.J=function(n,t,r){var a,h,g,_,v,b,I,E,P,A,R,B,N=r[0],Z=r[1],Y=r[2];return t===n?(n[12]=t[0]*N+t[4]*Z+t[8]*Y+t[12],n[13]=t[1]*N+t[5]*Z+t[9]*Y+t[13],n[14]=t[2]*N+t[6]*Z+t[10]*Y+t[14],n[15]=t[3]*N+t[7]*Z+t[11]*Y+t[15]):(h=t[1],g=t[2],_=t[3],v=t[4],b=t[5],I=t[6],E=t[7],P=t[8],A=t[9],R=t[10],B=t[11],n[0]=a=t[0],n[1]=h,n[2]=g,n[3]=_,n[4]=v,n[5]=b,n[6]=I,n[7]=E,n[8]=P,n[9]=A,n[10]=R,n[11]=B,n[12]=a*N+v*Z+P*Y+t[12],n[13]=h*N+b*Z+A*Y+t[13],n[14]=g*N+I*Z+R*Y+t[14],n[15]=_*N+E*Z+B*Y+t[15]),n},w.K=function(n,t,r){var a=r[0],h=r[1],g=r[2];return n[0]=t[0]*a,n[1]=t[1]*a,n[2]=t[2]*a,n[3]=t[3]*a,n[4]=t[4]*h,n[5]=t[5]*h,n[6]=t[6]*h,n[7]=t[7]*h,n[8]=t[8]*g,n[9]=t[9]*g,n[10]=t[10]*g,n[11]=t[11]*g,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},w.L=ey,w.M=function(n,t){const r={};for(let a=0;a<t.length;a++){const h=t[a];h in n&&(r[h]=n[h])}return r},w.N=Is,w.O=Xy,w.P=X,w.Q=Ky,w.R=ir,w.S=nr,w.T=xl,w.U=ue,w.V=ie,w.W=ct,w.X=_i,w.Y=x,w.Z=vc,w._=d,w.a=Di,w.a$=function(n,t){var r=n[0],a=n[1],h=n[2],g=n[3],_=n[4],v=n[5],b=n[6],I=n[7],E=n[8],P=n[9],A=n[10],R=n[11],B=n[12],N=n[13],Z=n[14],Y=n[15],pe=t[0],ne=t[1],he=t[2],_e=t[3],ke=t[4],je=t[5],rt=t[6],Oe=t[7],Fe=t[8],Je=t[9],He=t[10],qe=t[11],ve=t[12],et=t[13],Ye=t[14],lt=t[15];return Math.abs(r-pe)<=ln*Math.max(1,Math.abs(r),Math.abs(pe))&&Math.abs(a-ne)<=ln*Math.max(1,Math.abs(a),Math.abs(ne))&&Math.abs(h-he)<=ln*Math.max(1,Math.abs(h),Math.abs(he))&&Math.abs(g-_e)<=ln*Math.max(1,Math.abs(g),Math.abs(_e))&&Math.abs(_-ke)<=ln*Math.max(1,Math.abs(_),Math.abs(ke))&&Math.abs(v-je)<=ln*Math.max(1,Math.abs(v),Math.abs(je))&&Math.abs(b-rt)<=ln*Math.max(1,Math.abs(b),Math.abs(rt))&&Math.abs(I-Oe)<=ln*Math.max(1,Math.abs(I),Math.abs(Oe))&&Math.abs(E-Fe)<=ln*Math.max(1,Math.abs(E),Math.abs(Fe))&&Math.abs(P-Je)<=ln*Math.max(1,Math.abs(P),Math.abs(Je))&&Math.abs(A-He)<=ln*Math.max(1,Math.abs(A),Math.abs(He))&&Math.abs(R-qe)<=ln*Math.max(1,Math.abs(R),Math.abs(qe))&&Math.abs(B-ve)<=ln*Math.max(1,Math.abs(B),Math.abs(ve))&&Math.abs(N-et)<=ln*Math.max(1,Math.abs(N),Math.abs(et))&&Math.abs(Z-Ye)<=ln*Math.max(1,Math.abs(Z),Math.abs(Ye))&&Math.abs(Y-lt)<=ln*Math.max(1,Math.abs(Y),Math.abs(lt))},w.a0=Tt,w.a1=Qf,w.a2=Ce,w.a3=n=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const a of n){const h=window.document.createElement("source");_o(a)||(t.crossOrigin="Anonymous"),h.src=a,t.appendChild(h)}})},w.a4=function(){return Ge++},w.a5=Ne,w.a6=Fl,w.a7=Nu,w.a8=Sa,w.a9=i0,w.aA=function(n){if(n.type==="custom")return new c2(n);switch(n.type){case"background":return new a2(n);case"circle":return new Ww(n);case"fill":return new hb(n);case"fill-extrusion":return new Ib(n);case"heatmap":return new Kw(n);case"hillshade":return new Jw(n);case"line":return new Lb(n);case"raster":return new u2(n);case"symbol":return new md(n)}},w.aB=gt,w.aC=function(n,t){if(!n)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Dt(n.version,t.version))return[{command:"setStyle",args:[t]}];Dt(n.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Dt(n.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Dt(n.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Dt(n.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Dt(n.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Dt(n.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Dt(n.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Dt(n.light,t.light)||r.push({command:"setLight",args:[t.light]}),Dt(n.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Dt(n.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Dt(n.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const a={},h=[];(function(_,v,b,I){let E;for(E in v=v||{},_=_||{})Object.prototype.hasOwnProperty.call(_,E)&&(Object.prototype.hasOwnProperty.call(v,E)||Jr(E,b,I));for(E in v)Object.prototype.hasOwnProperty.call(v,E)&&(Object.prototype.hasOwnProperty.call(_,E)?Dt(_[E],v[E])||(_[E].type==="geojson"&&v[E].type==="geojson"&&Wo(_,v,E)?ei(b,{command:"setGeoJSONSourceData",args:[E,v[E].data]}):Rr(E,v,b,I)):Js(E,v,b))})(n.sources,t.sources,h,a);const g=[];n.layers&&n.layers.forEach(_=>{"source"in _&&a[_.source]?r.push({command:"removeLayer",args:[_.id]}):g.push(_)}),r=r.concat(h),function(_,v,b){v=v||[];const I=(_=_||[]).map(Qs),E=v.map(Qs),P=_.reduce(ea,{}),A=v.reduce(ea,{}),R=I.slice(),B=Object.create(null);let N,Z,Y,pe,ne;for(let he=0,_e=0;he<I.length;he++)N=I[he],Object.prototype.hasOwnProperty.call(A,N)?_e++:(ei(b,{command:"removeLayer",args:[N]}),R.splice(R.indexOf(N,_e),1));for(let he=0,_e=0;he<E.length;he++)N=E[E.length-1-he],R[R.length-1-he]!==N&&(Object.prototype.hasOwnProperty.call(P,N)?(ei(b,{command:"removeLayer",args:[N]}),R.splice(R.lastIndexOf(N,R.length-_e),1)):_e++,pe=R[R.length-he],ei(b,{command:"addLayer",args:[A[N],pe]}),R.splice(R.length-he,0,N),B[N]=!0);for(let he=0;he<E.length;he++)if(N=E[he],Z=P[N],Y=A[N],!B[N]&&!Dt(Z,Y))if(Dt(Z.source,Y.source)&&Dt(Z["source-layer"],Y["source-layer"])&&Dt(Z.type,Y.type)){for(ne in Mn(Z.layout,Y.layout,b,N,null,"setLayoutProperty"),Mn(Z.paint,Y.paint,b,N,null,"setPaintProperty"),Dt(Z.filter,Y.filter)||ei(b,{command:"setFilter",args:[N,Y.filter]}),Dt(Z.minzoom,Y.minzoom)&&Dt(Z.maxzoom,Y.maxzoom)||ei(b,{command:"setLayerZoomRange",args:[N,Y.minzoom,Y.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?Mn(Z[ne],Y[ne],b,N,ne.slice(6),"setPaintProperty"):Dt(Z[ne],Y[ne])||ei(b,{command:"setLayerProperty",args:[N,ne,Y[ne]]}));for(ne in Y)Object.prototype.hasOwnProperty.call(Y,ne)&&!Object.prototype.hasOwnProperty.call(Z,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?Mn(Z[ne],Y[ne],b,N,ne.slice(6),"setPaintProperty"):Dt(Z[ne],Y[ne])||ei(b,{command:"setLayerProperty",args:[N,ne,Y[ne]]}))}else ei(b,{command:"removeLayer",args:[N]}),pe=R[R.lastIndexOf(N)+1],ei(b,{command:"addLayer",args:[Y,pe]})}(g,t.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:"setStyle",args:[t]}]}return r},w.aD=function(n){const t=[],r=n.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},w.aE=function n(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(!n(t[a],r[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const a in t)if(!n(t[a],r[a]))return!1;return!0}return t===r},w.aF=Et,w.aG=mt,w.aH=class extends xa{constructor(n,t){super(n,t),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},w.aI=id,w.aJ=class extends xa{constructor(n,t){super(n,t),this.current=Vw}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let t=1;t<16;t++)if(n[t]!==this.current[t]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},w.aK=$_,w.aL=q_,w.aM=Nt,w.aN=class extends xa{constructor(n,t){super(n,t),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},w.aO=class extends xa{constructor(n,t){super(n,t),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},w.aP=function(n,t,r,a,h,g,_){var v=1/(t-r),b=1/(a-h),I=1/(g-_);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*I,n[11]=0,n[12]=(t+r)*v,n[13]=(h+a)*b,n[14]=(_+g)*I,n[15]=1,n},w.aQ=Hw,w.aR=class extends ae{},w.aS=Ob,w.aT=class extends fe{},w.aU=zf,w.aV=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},w.aW=oy,w.aX=Fi,w.aY=tr,w.aZ=class extends Ke{},w.a_=function(n,t){return n[0]===t[0]&&n[1]===t[1]&&n[2]===t[2]&&n[3]===t[3]&&n[4]===t[4]&&n[5]===t[5]&&n[6]===t[6]&&n[7]===t[7]&&n[8]===t[8]&&n[9]===t[9]&&n[10]===t[10]&&n[11]===t[11]&&n[12]===t[12]&&n[13]===t[13]&&n[14]===t[14]&&n[15]===t[15]},w.aa=function(n){const t={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,h,g)=>{const _=h||g;return t[a]=!_||_.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},w.ab=function(n,t){const r=[];for(const a in n)a in t||r.push(a);return r},w.ac=Pe,w.ad=function(n,t,r){var a=Math.sin(r),h=Math.cos(r),g=t[0],_=t[1],v=t[2],b=t[3],I=t[4],E=t[5],P=t[6],A=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=g*h+I*a,n[1]=_*h+E*a,n[2]=v*h+P*a,n[3]=b*h+A*a,n[4]=I*h-g*a,n[5]=E*h-_*a,n[6]=P*h-v*a,n[7]=A*h-b*a,n},w.ae=function(n){var t=new Ml(16);return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t},w.af=sd,w.ag=function(n,t){let r=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:_}=n,v=h?Pe(sn.interpolationFactor(h,t,g,_),0,1):0;n.kind==="camera"?a=on.number(n.minSize,n.maxSize,v):r=v}return{uSizeT:r,uSize:a}},w.ai=function(n,{uSize:t,uSizeT:r},{lowerSize:a,upperSize:h}){return n.kind==="source"?a/oo:n.kind==="composite"?on.number(a/oo,h/oo,r):t},w.aj=Hf,w.ak=function(n,t,r,a){const h=t.y-n.y,g=t.x-n.x,_=a.y-r.y,v=a.x-r.x,b=_*g-v*h;if(b===0)return null;const I=(v*(n.y-r.y)-_*(n.x-r.x))/b;return new X(n.x+I*g,n.y+I*h)},w.al=s0,w.am=W_,w.an=Cf,w.ao=function(n){let t=1/0,r=1/0,a=-1/0,h=-1/0;for(const g of n)t=Math.min(t,g.x),r=Math.min(r,g.y),a=Math.max(a,g.x),h=Math.max(h,g.y);return[t,r,a,h]},w.ap=vi,w.ar=Gf,w.as=function(n,t){var r=t[0],a=t[1],h=t[2],g=t[3],_=t[4],v=t[5],b=t[6],I=t[7],E=t[8],P=t[9],A=t[10],R=t[11],B=t[12],N=t[13],Z=t[14],Y=t[15],pe=r*v-a*_,ne=r*b-h*_,he=r*I-g*_,_e=a*b-h*v,ke=a*I-g*v,je=h*I-g*b,rt=E*N-P*B,Oe=E*Z-A*B,Fe=E*Y-R*B,Je=P*Z-A*N,He=P*Y-R*N,qe=A*Y-R*Z,ve=pe*qe-ne*He+he*Je+_e*Fe-ke*Oe+je*rt;return ve?(n[0]=(v*qe-b*He+I*Je)*(ve=1/ve),n[1]=(h*He-a*qe-g*Je)*ve,n[2]=(N*je-Z*ke+Y*_e)*ve,n[3]=(A*ke-P*je-R*_e)*ve,n[4]=(b*Fe-_*qe-I*Oe)*ve,n[5]=(r*qe-h*Fe+g*Oe)*ve,n[6]=(Z*he-B*je-Y*ne)*ve,n[7]=(E*je-A*he+R*ne)*ve,n[8]=(_*He-v*Fe+I*rt)*ve,n[9]=(a*Fe-r*He-g*rt)*ve,n[10]=(B*ke-N*he+Y*pe)*ve,n[11]=(P*he-E*ke-R*pe)*ve,n[12]=(v*Oe-_*Je-b*rt)*ve,n[13]=(r*Je-a*Oe+h*rt)*ve,n[14]=(N*ne-B*_e-Z*pe)*ve,n[15]=(E*_e-P*ne+A*pe)*ve,n):null},w.at=tm,w.au=Zf,w.av=im,w.aw=function(){const n={},t=ge.$version;for(const r in ge.$root){const a=ge.$root[r];if(a.required){let h=null;h=r==="version"?t:a.type==="array"?[]:{},h!=null&&(n[r]=h)}}return n},w.ax=Qu,w.ay=Hn,w.az=function(n){n=n.slice();const t=Object.create(null);for(let r=0;r<n.length;r++)t[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=Ys(n[r],t[n[r].ref]));return n},w.b=en,w.b0=function(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n},w.b1=function(n,t,r){return n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},w.b2=function(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]},w.b3=$e,w.b4=Qy,w.b5=Yy,w.b6=function(n,t,r,a,h){var g,_=1/Math.tan(t/2);return n[0]=_/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+a)*(g=1/(a-h)),n[14]=2*h*a*g):(n[10]=-1,n[14]=-2*a),n},w.b7=function(n,t,r){var a=Math.sin(r),h=Math.cos(r),g=t[4],_=t[5],v=t[6],b=t[7],I=t[8],E=t[9],P=t[10],A=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=g*h+I*a,n[5]=_*h+E*a,n[6]=v*h+P*a,n[7]=b*h+A*a,n[8]=I*h-g*a,n[9]=E*h-_*a,n[10]=P*h-v*a,n[11]=A*h-b*a,n},w.b8=se,w.b9=xe,w.bA=ky,w.bB=function(n){return n.message===Bt},w.bC=ss,w.bD=bn,w.ba=function(n){return n*Math.PI/180},w.bb=function(n,t){const{x:r,y:a}=vc.fromLngLat(t);return!(n<0||n>25||a<0||a>=1||r<0||r>=1)},w.bc=function(n,t){return n[0]=t[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=t[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},w.bd=class extends C{},w.be=Yf,w.bf=x2,w.bh=bi,w.bi=function(n,t){Di.REGISTERED_PROTOCOLS[n]=t},w.bj=function(n){delete Di.REGISTERED_PROTOCOLS[n]},w.bk=function(n,t){const r={};for(let h=0;h<n.length;h++){const g=t&&t[n[h].id]||qh(n[h]);t&&(t[n[h].id]=g);let _=r[g];_||(_=r[g]=[]),_.push(n[h])}const a=[];for(const h in r)a.push(r[h]);return a},w.bl=Ze,w.bm=t0,w.bn=n0,w.bo=Ly,w.bp=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=_i/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const t=n.bucket.layers[0],r=t.layout,a=t._unevaluatedLayout._values,h={layoutIconSize:a["icon-size"].possiblyEvaluate(new Ht(n.bucket.zoom+1),n.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Ht(n.bucket.zoom+1),n.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Ht(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:E}=n.bucket.textSizeData;h.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Ht(I),n.canonical),a["text-size"].possiblyEvaluate(new Ht(E),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:E}=n.bucket.iconSizeData;h.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Ht(I),n.canonical),a["icon-size"].possiblyEvaluate(new Ht(E),n.canonical)]}const g=r.get("text-line-height")*vi,_=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",v=r.get("text-keep-upright"),b=r.get("text-size");for(const I of n.bucket.features){const E=r.get("text-font").evaluate(I,{},n.canonical).join(","),P=b.evaluate(I,{},n.canonical),A=h.layoutTextSize.evaluate(I,{},n.canonical),R=h.layoutIconSize.evaluate(I,{},n.canonical),B={horizontal:{},vertical:void 0},N=I.text;let Z,Y=[0,0];if(N){const he=N.toString(),_e=r.get("text-letter-spacing").evaluate(I,{},n.canonical)*vi,ke=_f(he)?_e:0,je=r.get("text-anchor").evaluate(I,{},n.canonical),rt=m0(t,I,n.canonical);if(!rt){const He=r.get("text-radial-offset").evaluate(I,{},n.canonical);Y=He?f0(je,[He*vi,em]):r.get("text-offset").evaluate(I,{},n.canonical).map(qe=>qe*vi)}let Oe=_?"center":r.get("text-justify").evaluate(I,{},n.canonical);const Fe=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(I,{},n.canonical)*vi:1/0,Je=()=>{n.bucket.allowVerticalPlacement&&ec(he)&&(B.vertical=dd(N,n.glyphMap,n.glyphPositions,n.imagePositions,E,Fe,g,je,"left",ke,Y,w.ah.vertical,!0,A,P))};if(!_&&rt){const He=new Set;if(Oe==="auto")for(let ve=0;ve<rt.values.length;ve+=2)He.add(tm(rt.values[ve]));else He.add(Oe);let qe=!1;for(const ve of He)if(!B.horizontal[ve])if(qe)B.horizontal[ve]=B.horizontal[0];else{const et=dd(N,n.glyphMap,n.glyphPositions,n.imagePositions,E,Fe,g,"center",ve,ke,Y,w.ah.horizontal,!1,A,P);et&&(B.horizontal[ve]=et,qe=et.positionedLines.length===1)}Je()}else{Oe==="auto"&&(Oe=tm(je));const He=dd(N,n.glyphMap,n.glyphPositions,n.imagePositions,E,Fe,g,je,Oe,ke,Y,w.ah.horizontal,!1,A,P);He&&(B.horizontal[Oe]=He),Je(),ec(he)&&_&&v&&(B.vertical=dd(N,n.glyphMap,n.glyphPositions,n.imagePositions,E,Fe,g,je,Oe,ke,Y,w.ah.vertical,!1,A,P))}}let pe=!1;if(I.icon&&I.icon.name){const he=n.imageMap[I.icon.name];he&&(Z=i2(n.imagePositions[I.icon.name],r.get("icon-offset").evaluate(I,{},n.canonical),r.get("icon-anchor").evaluate(I,{},n.canonical)),pe=!!he.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=pe:n.bucket.sdfIcons!==pe&&oi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(he.pixelRatio!==n.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const ne=_0(B.horizontal)||B.vertical;n.bucket.iconsInText=!!ne&&ne.iconsInText,(ne||Z)&&y2(n.bucket,I,B,Z,n.imageMap,h,A,R,Y,pe,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},w.bq=Nf,w.br=Ff,w.bs=Of,w.bt=Ss,w.bu=jf,w.bv=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},w.bw=function(n,t,r,a,h){return d(this,void 0,void 0,function*(){if(ie())try{return yield ct(n,t,r,a,h)}catch{}return function(g,_,v,b,I){const E=g.width,P=g.height;ht&&It||(ht=new OffscreenCanvas(E,P),It=ht.getContext("2d",{willReadFrequently:!0})),ht.width=E,ht.height=P,It.drawImage(g,0,0,E,P);const A=It.getImageData(_,v,b,I);return It.clearRect(0,0,E,P),A.data}(n,t,r,a,h)})},w.bx=e0,w.by=O,w.bz=W,w.c=Gn,w.d=n=>d(void 0,void 0,void 0,function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.e=Ve,w.f=n=>new Promise((t,r)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=We})},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(n)],{type:"image/png"});a.src=n.byteLength?URL.createObjectURL(h):We}),w.g=tn,w.h=(n,t)=>go(Ve(n,{type:"json"}),t),w.i=Zn,w.j=Yr,w.k=Kr,w.l=(n,t)=>go(Ve(n,{type:"arrayBuffer"}),t),w.m=go,w.n=function(n){return new jf(n).readFields(Xb,[])},w.o=uc,w.p=Dy,w.q=f,w.r=mf,w.s=_o,w.t=Yu,w.u=Mo,w.v=ge,w.w=oi,w.x=function([n,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(t)*Math.sin(r),y:n*Math.sin(t)*Math.sin(r),z:n*Math.cos(r)}},w.y=on,w.z=Ht}),y("worker",["./shared"],function(w){class d{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,D){for(const G of L){this._layerConfigs[G.id]=G;const re=this._layers[G.id]=w.aA(G);re._featureFilter=w.a7(re.filter),this.keyCache[G.id]&&delete this.keyCache[G.id]}for(const G of D)delete this.keyCache[G],delete this._layerConfigs[G],delete this._layers[G];this.familiesBySource={};const j=w.bk(Object.values(this._layerConfigs),this.keyCache);for(const G of j){const re=G.map(me=>this._layers[me.id]),le=re[0];if(le.visibility==="none")continue;const de=le.source||"";let ee=this.familiesBySource[de];ee||(ee=this.familiesBySource[de]={});const ye=le.sourceLayer||"_geojsonTileLayer";let Se=ee[ye];Se||(Se=ee[ye]=[]),Se.push(re)}}}class O{constructor(L){const D={},j=[];for(const de in L){const ee=L[de],ye=D[de]={};for(const Se in ee){const me=ee[+Se];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;const ze={x:0,y:0,w:me.bitmap.width+2,h:me.bitmap.height+2};j.push(ze),ye[Se]={rect:ze,metrics:me.metrics}}}const{w:G,h:re}=w.p(j),le=new w.o({width:G||1,height:re||1});for(const de in L){const ee=L[de];for(const ye in ee){const Se=ee[+ye];if(!Se||Se.bitmap.width===0||Se.bitmap.height===0)continue;const me=D[de][ye].rect;w.o.copy(Se.bitmap,le,{x:0,y:0},{x:me.x+1,y:me.y+1},Se.bitmap)}}this.image=le,this.positions=D}}w.bl("GlyphAtlas",O);class W{constructor(L){this.tileID=new w.S(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[]}parse(L,D,j,G){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=L,this.collisionBoxArray=new w.a5;const re=new w.bm(Object.keys(L.layers).sort()),le=new w.bn(this.tileID,this.promoteId);le.bucketLayerIDs=[];const de={},ee={featureIndex:le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},ye=D.familiesBySource[this.source];for(const yt in ye){const Ot=L.layers[yt];if(!Ot)continue;Ot.version===1&&w.w(`Vector tile source "${this.source}" layer "${yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Jt=re.encode(yt),Si=[];for(let Ci=0;Ci<Ot.length;Ci++){const Zi=Ot.feature(Ci),Xo=le.getId(Zi,yt);Si.push({feature:Zi,id:Xo,index:Ci,sourceLayerIndex:Jt})}for(const Ci of ye[yt]){const Zi=Ci[0];Zi.source!==this.source&&w.w(`layer.source = ${Zi.source} does not equal this.source = ${this.source}`),Zi.minzoom&&this.zoom<Math.floor(Zi.minzoom)||Zi.maxzoom&&this.zoom>=Zi.maxzoom||Zi.visibility!=="none"&&(oe(Ci,this.zoom,j),(de[Zi.id]=Zi.createBucket({index:le.bucketLayerIDs.length,layers:Ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Jt,sourceID:this.source})).populate(Si,ee,this.tileID.canonical),le.bucketLayerIDs.push(Ci.map(Xo=>Xo.id)))}}const Se=w.aF(ee.glyphDependencies,yt=>Object.keys(yt).map(Number));this.inFlightDependencies.forEach(yt=>yt==null?void 0:yt.abort()),this.inFlightDependencies=[];let me=Promise.resolve({});if(Object.keys(Se).length){const yt=new AbortController;this.inFlightDependencies.push(yt),me=G.sendAsync({type:"GG",data:{stacks:Se,source:this.source,tileID:this.tileID,type:"glyphs"}},yt)}const ze=Object.keys(ee.iconDependencies);let tt=Promise.resolve({});if(ze.length){const yt=new AbortController;this.inFlightDependencies.push(yt),tt=G.sendAsync({type:"GI",data:{icons:ze,source:this.source,tileID:this.tileID,type:"icons"}},yt)}const nt=Object.keys(ee.patternDependencies);let Ct=Promise.resolve({});if(nt.length){const yt=new AbortController;this.inFlightDependencies.push(yt),Ct=G.sendAsync({type:"GI",data:{icons:nt,source:this.source,tileID:this.tileID,type:"patterns"}},yt)}const[pt,Pt,xt]=yield Promise.all([me,tt,Ct]),mi=new O(pt),ti=new w.bo(Pt,xt);for(const yt in de){const Ot=de[yt];Ot instanceof w.a6?(oe(Ot.layers,this.zoom,j),w.bp({bucket:Ot,glyphMap:pt,glyphPositions:mi.positions,imageMap:Pt,imagePositions:ti.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ot.hasPattern&&(Ot instanceof w.bq||Ot instanceof w.br||Ot instanceof w.bs)&&(oe(Ot.layers,this.zoom,j),Ot.addFeatures(ee,this.tileID.canonical,ti.patternPositions))}return this.status="done",{buckets:Object.values(de).filter(yt=>!yt.isEmpty()),featureIndex:le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mi.image,imageAtlas:ti,glyphMap:this.returnDependencies?pt:null,iconMap:this.returnDependencies?Pt:null,glyphPositions:this.returnDependencies?mi.positions:null}})}}function oe(K,L,D){const j=new w.z(L);for(const G of K)G.recalculate(j,D)}class X{constructor(L,D,j){this.actor=L,this.layerIndex=D,this.availableImages=j,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(L,D){return w._(this,void 0,void 0,function*(){const j=yield w.l(L.request,D);try{return{vectorTile:new w.bt.VectorTile(new w.bu(j.data)),rawData:j.data,cacheControl:j.cacheControl,expires:j.expires}}catch(G){const re=new Uint8Array(j.data);let le=`Unable to parse the tile at ${L.request.url}, `;throw le+=re[0]===31&&re[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${G.message}`,new Error(le)}})}loadTile(L){return w._(this,void 0,void 0,function*(){const D=L.uid,j=!!(L&&L.request&&L.request.collectResourceTiming)&&new w.bv(L.request),G=new W(L);this.loading[D]=G;const re=new AbortController;G.abort=re;try{const le=yield this.loadVectorTile(L,re);if(delete this.loading[D],!le)return null;const de=le.rawData,ee={};le.expires&&(ee.expires=le.expires),le.cacheControl&&(ee.cacheControl=le.cacheControl);const ye={};if(j){const me=j.finish();me&&(ye.resourceTiming=JSON.parse(JSON.stringify(me)))}G.vectorTile=le.vectorTile;const Se=G.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=G,this.fetching[D]={rawTileData:de,cacheControl:ee,resourceTiming:ye};try{const me=yield Se;return w.e({rawTileData:de.slice(0)},me,ee,ye)}finally{delete this.fetching[D]}}catch(le){throw delete this.loading[D],G.status="done",this.loaded[D]=G,le}})}reloadTile(L){return w._(this,void 0,void 0,function*(){const D=L.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const j=this.loaded[D];if(j.showCollisionBoxes=L.showCollisionBoxes,j.status==="parsing"){const G=yield j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor);let re;if(this.fetching[D]){const{rawTileData:le,cacheControl:de,resourceTiming:ee}=this.fetching[D];delete this.fetching[D],re=w.e({rawTileData:le.slice(0)},G,de,ee)}else re=G;return re}if(j.status==="done"&&j.vectorTile)return j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(L){return w._(this,void 0,void 0,function*(){const D=this.loading,j=L.uid;D&&D[j]&&D[j].abort&&(D[j].abort.abort(),delete D[j])})}removeTile(L){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[L.uid]&&delete this.loaded[L.uid]})}}class ${constructor(){this.loaded={}}loadTile(L){return w._(this,void 0,void 0,function*(){const{uid:D,encoding:j,rawImageData:G,redFactor:re,greenFactor:le,blueFactor:de,baseShift:ee}=L,ye=G.width+2,Se=G.height+2,me=w.b(G)?new w.R({width:ye,height:Se},yield w.bw(G,-1,-1,ye,Se)):G,ze=new w.bx(D,me,j,re,le,de,ee);return this.loaded=this.loaded||{},this.loaded[D]=ze,ze})}removeTile(L){const D=this.loaded,j=L.uid;D&&D[j]&&delete D[j]}}function be(K,L){if(K.length!==0){Te(K[0],L);for(var D=1;D<K.length;D++)Te(K[D],!L)}}function Te(K,L){for(var D=0,j=0,G=0,re=K.length,le=re-1;G<re;le=G++){var de=(K[G][0]-K[le][0])*(K[le][1]+K[G][1]),ee=D+de;j+=Math.abs(D)>=Math.abs(de)?D-ee+de:de-ee+D,D=ee}D+j>=0!=!!L&&K.reverse()}var Ie=w.by(function K(L,D){var j,G=L&&L.type;if(G==="FeatureCollection")for(j=0;j<L.features.length;j++)K(L.features[j],D);else if(G==="GeometryCollection")for(j=0;j<L.geometries.length;j++)K(L.geometries[j],D);else if(G==="Feature")K(L.geometry,D);else if(G==="Polygon")be(L.coordinates,D);else if(G==="MultiPolygon")for(j=0;j<L.coordinates.length;j++)be(L.coordinates[j],D);return L});const Qe=w.bt.VectorTileFeature.prototype.toGeoJSON;var ue={exports:{}},ie=w.bz,se=w.bt.VectorTileFeature,xe=Pe;function Pe(K,L){this.options=L||{},this.features=K,this.length=K.length}function $e(K,L){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=L||4096}Pe.prototype.feature=function(K){return new $e(this.features[K],this.options.extent)},$e.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var L=0;L<K.length;L++){for(var D=K[L],j=[],G=0;G<D.length;G++)j.push(new ie(D[G][0],D[G][1]));this.geometry.push(j)}return this.geometry},$e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,L=1/0,D=-1/0,j=1/0,G=-1/0,re=0;re<K.length;re++)for(var le=K[re],de=0;de<le.length;de++){var ee=le[de];L=Math.min(L,ee.x),D=Math.max(D,ee.x),j=Math.min(j,ee.y),G=Math.max(G,ee.y)}return[L,j,D,G]},$e.prototype.toGeoJSON=se.prototype.toGeoJSON;var Ve=w.bA,Ge=xe;function Et(K){var L=new Ve;return function(D,j){for(var G in D.layers)j.writeMessage(3,mt,D.layers[G])}(K,L),L.finish()}function mt(K,L){var D;L.writeVarintField(15,K.version||1),L.writeStringField(1,K.name||""),L.writeVarintField(5,K.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<K.length;D++)j.feature=K.feature(D),L.writeMessage(2,gt,j);var G=j.keys;for(D=0;D<G.length;D++)L.writeStringField(3,G[D]);var re=j.values;for(D=0;D<re.length;D++)L.writeMessage(4,_r,re[D])}function gt(K,L){var D=K.feature;D.id!==void 0&&L.writeVarintField(1,D.id),L.writeMessage(2,gr,K),L.writeVarintField(3,D.type),L.writeMessage(4,Zn,D)}function gr(K,L){var D=K.feature,j=K.keys,G=K.values,re=K.keycache,le=K.valuecache;for(var de in D.properties){var ee=D.properties[de],ye=re[de];if(ee!==null){ye===void 0&&(j.push(de),re[de]=ye=j.length-1),L.writeVarint(ye);var Se=typeof ee;Se!=="string"&&Se!=="boolean"&&Se!=="number"&&(ee=JSON.stringify(ee));var me=Se+":"+ee,ze=le[me];ze===void 0&&(G.push(ee),le[me]=ze=G.length-1),L.writeVarint(ze)}}}function oi(K,L){return(L<<3)+(7&K)}function wi(K){return K<<1^K>>31}function Zn(K,L){for(var D=K.loadGeometry(),j=K.type,G=0,re=0,le=D.length,de=0;de<le;de++){var ee=D[de],ye=1;j===1&&(ye=ee.length),L.writeVarint(oi(1,ye));for(var Se=j===3?ee.length-1:ee.length,me=0;me<Se;me++){me===1&&j!==1&&L.writeVarint(oi(2,Se-1));var ze=ee[me].x-G,tt=ee[me].y-re;L.writeVarint(wi(ze)),L.writeVarint(wi(tt)),G+=ze,re+=tt}j===3&&L.writeVarint(oi(7,1))}}function _r(K,L){var D=typeof K;D==="string"?L.writeStringField(1,K):D==="boolean"?L.writeBooleanField(7,K):D==="number"&&(K%1!=0?L.writeDoubleField(3,K):K<0?L.writeSVarintField(6,K):L.writeVarintField(5,K))}ue.exports=Et,ue.exports.fromVectorTileJs=Et,ue.exports.fromGeojsonVt=function(K,L){L=L||{};var D={};for(var j in K)D[j]=new Ge(K[j].features,L),D[j].name=j,D[j].version=L.version,D[j].extent=L.extent;return Et({layers:D})},ue.exports.GeoJSONWrapper=Ge;var en=w.by(ue.exports);const We={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},ct=Math.fround||(ht=new Float32Array(1),K=>(ht[0]=+K,ht[0]));var ht;const It=3,Bt=5,Gn=6;class Di{constructor(L){this.options=Object.assign(Object.create(We),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:D,minZoom:j,maxZoom:G}=this.options;D&&console.time("total time");const re=`prepare ${L.length} points`;D&&console.time(re),this.points=L;const le=[];for(let ee=0;ee<L.length;ee++){const ye=L[ee];if(!ye.geometry)continue;const[Se,me]=ye.geometry.coordinates,ze=ct(bi(Se)),tt=ct(Hn(me));le.push(ze,tt,1/0,ee,-1,1),this.options.reduce&&le.push(0)}let de=this.trees[G+1]=this._createTree(le);D&&console.timeEnd(re);for(let ee=G;ee>=j;ee--){const ye=+Date.now();de=this.trees[ee]=this._createTree(this._cluster(de,ee)),D&&console.log("z%d: %d clusters in %dms",ee,de.numItems,+Date.now()-ye)}return D&&console.timeEnd("total time"),this}getClusters(L,D){let j=((L[0]+180)%360+360)%360-180;const G=Math.max(-90,Math.min(90,L[1]));let re=L[2]===180?180:((L[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)j=-180,re=180;else if(j>re){const me=this.getClusters([j,G,180,le],D),ze=this.getClusters([-180,G,re,le],D);return me.concat(ze)}const de=this.trees[this._limitZoom(D)],ee=de.range(bi(j),Hn(le),bi(re),Hn(G)),ye=de.data,Se=[];for(const me of ee){const ze=this.stride*me;Se.push(ye[ze+Bt]>1?tn(ye,ze,this.clusterProps):this.points[ye[ze+It]])}return Se}getChildren(L){const D=this._getOriginId(L),j=this._getOriginZoom(L),G="No cluster with the specified id.",re=this.trees[j];if(!re)throw new Error(G);const le=re.data;if(D*this.stride>=le.length)throw new Error(G);const de=this.options.radius/(this.options.extent*Math.pow(2,j-1)),ee=re.within(le[D*this.stride],le[D*this.stride+1],de),ye=[];for(const Se of ee){const me=Se*this.stride;le[me+4]===L&&ye.push(le[me+Bt]>1?tn(le,me,this.clusterProps):this.points[le[me+It]])}if(ye.length===0)throw new Error(G);return ye}getLeaves(L,D,j){const G=[];return this._appendLeaves(G,L,D=D||10,j=j||0,0),G}getTile(L,D,j){const G=this.trees[this._limitZoom(L)],re=Math.pow(2,L),{extent:le,radius:de}=this.options,ee=de/le,ye=(j-ee)/re,Se=(j+1+ee)/re,me={features:[]};return this._addTileFeatures(G.range((D-ee)/re,ye,(D+1+ee)/re,Se),G.data,D,j,re,me),D===0&&this._addTileFeatures(G.range(1-ee/re,ye,1,Se),G.data,re,j,re,me),D===re-1&&this._addTileFeatures(G.range(0,ye,ee/re,Se),G.data,-1,j,re,me),me.features.length?me:null}getClusterExpansionZoom(L){let D=this._getOriginZoom(L)-1;for(;D<=this.options.maxZoom;){const j=this.getChildren(L);if(D++,j.length!==1)break;L=j[0].properties.cluster_id}return D}_appendLeaves(L,D,j,G,re){const le=this.getChildren(D);for(const de of le){const ee=de.properties;if(ee&&ee.cluster?re+ee.point_count<=G?re+=ee.point_count:re=this._appendLeaves(L,ee.cluster_id,j,G,re):re<G?re++:L.push(de),L.length===j)break}return re}_createTree(L){const D=new w.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<L.length;j+=this.stride)D.add(L[j],L[j+1]);return D.finish(),D.data=L,D}_addTileFeatures(L,D,j,G,re,le){for(const de of L){const ee=de*this.stride,ye=D[ee+Bt]>1;let Se,me,ze;if(ye)Se=nn(D,ee,this.clusterProps),me=D[ee],ze=D[ee+1];else{const Ct=this.points[D[ee+It]];Se=Ct.properties;const[pt,Pt]=Ct.geometry.coordinates;me=bi(pt),ze=Hn(Pt)}const tt={type:1,geometry:[[Math.round(this.options.extent*(me*re-j)),Math.round(this.options.extent*(ze*re-G))]],tags:Se};let nt;nt=ye||this.options.generateId?D[ee+It]:this.points[D[ee+It]].id,nt!==void 0&&(tt.id=nt),le.features.push(tt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,D){const{radius:j,extent:G,reduce:re,minPoints:le}=this.options,de=j/(G*Math.pow(2,D)),ee=L.data,ye=[],Se=this.stride;for(let me=0;me<ee.length;me+=Se){if(ee[me+2]<=D)continue;ee[me+2]=D;const ze=ee[me],tt=ee[me+1],nt=L.within(ee[me],ee[me+1],de),Ct=ee[me+Bt];let pt=Ct;for(const Pt of nt){const xt=Pt*Se;ee[xt+2]>D&&(pt+=ee[xt+Bt])}if(pt>Ct&&pt>=le){let Pt,xt=ze*Ct,mi=tt*Ct,ti=-1;const yt=((me/Se|0)<<5)+(D+1)+this.points.length;for(const Ot of nt){const Jt=Ot*Se;if(ee[Jt+2]<=D)continue;ee[Jt+2]=D;const Si=ee[Jt+Bt];xt+=ee[Jt]*Si,mi+=ee[Jt+1]*Si,ee[Jt+4]=yt,re&&(Pt||(Pt=this._map(ee,me,!0),ti=this.clusterProps.length,this.clusterProps.push(Pt)),re(Pt,this._map(ee,Jt)))}ee[me+4]=yt,ye.push(xt/pt,mi/pt,1/0,yt,-1,pt),re&&ye.push(ti)}else{for(let Pt=0;Pt<Se;Pt++)ye.push(ee[me+Pt]);if(pt>1)for(const Pt of nt){const xt=Pt*Se;if(!(ee[xt+2]<=D)){ee[xt+2]=D;for(let mi=0;mi<Se;mi++)ye.push(ee[xt+mi])}}}}return ye}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,D,j){if(L[D+Bt]>1){const le=this.clusterProps[L[D+Gn]];return j?Object.assign({},le):le}const G=this.points[L[D+It]].properties,re=this.options.map(G);return j&&re===G?Object.assign({},re):re}}function tn(K,L,D){return{type:"Feature",id:K[L+It],properties:nn(K,L,D),geometry:{type:"Point",coordinates:[(j=K[L],360*(j-.5)),go(K[L+1])]}};var j}function nn(K,L,D){const j=K[L+Bt],G=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,re=K[L+Gn],le=re===-1?{}:Object.assign({},D[re]);return Object.assign(le,{cluster:!0,cluster_id:K[L+It],point_count:j,point_count_abbreviated:G})}function bi(K){return K/360+.5}function Hn(K){const L=Math.sin(K*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function go(K){const L=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function _o(K,L,D,j){let G=j;const re=L+(D-L>>1);let le,de=D-L;const ee=K[L],ye=K[L+1],Se=K[D],me=K[D+1];for(let ze=L+3;ze<D;ze+=3){const tt=Ks(K[ze],K[ze+1],ee,ye,Se,me);if(tt>G)le=ze,G=tt;else if(tt===G){const nt=Math.abs(ze-re);nt<de&&(le=ze,de=nt)}}G>j&&(le-L>3&&_o(K,L,le,j),K[le+2]=G,D-le>3&&_o(K,le,D,j))}function Ks(K,L,D,j,G,re){let le=G-D,de=re-j;if(le!==0||de!==0){const ee=((K-D)*le+(L-j)*de)/(le*le+de*de);ee>1?(D=G,j=re):ee>0&&(D+=le*ee,j+=de*ee)}return le=K-D,de=L-j,le*le+de*de}function Lr(K,L,D,j){const G={id:K??null,type:L,geometry:D,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(L==="Point"||L==="MultiPoint"||L==="LineString")Kr(G,D);else if(L==="Polygon")Kr(G,D[0]);else if(L==="MultiLineString")for(const re of D)Kr(G,re);else if(L==="MultiPolygon")for(const re of D)Kr(G,re[0]);return G}function Kr(K,L){for(let D=0;D<L.length;D+=3)K.minX=Math.min(K.minX,L[D]),K.minY=Math.min(K.minY,L[D+1]),K.maxX=Math.max(K.maxX,L[D]),K.maxY=Math.max(K.maxY,L[D+1])}function Yr(K,L,D,j){if(!L.geometry)return;const G=L.geometry.coordinates;if(G&&G.length===0)return;const re=L.geometry.type,le=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let de=[],ee=L.id;if(D.promoteId?ee=L.properties[D.promoteId]:D.generateId&&(ee=j||0),re==="Point")Ho(G,de);else if(re==="MultiPoint")for(const ye of G)Ho(ye,de);else if(re==="LineString")ge(G,de,le,!1);else if(re==="MultiLineString"){if(D.lineMetrics){for(const ye of G)de=[],ge(ye,de,le,!1),K.push(Lr(ee,"LineString",de,L.properties));return}yo(G,de,le,!1)}else if(re==="Polygon")yo(G,de,le,!0);else{if(re!=="MultiPolygon"){if(re==="GeometryCollection"){for(const ye of L.geometry.geometries)Yr(K,{id:ee,geometry:ye,properties:L.properties},D,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ye of G){const Se=[];yo(ye,Se,le,!0),de.push(Se)}}K.push(Lr(ee,re,de,L.properties))}function Ho(K,L){L.push(Ys(K[0]),Dt(K[1]),0)}function ge(K,L,D,j){let G,re,le=0;for(let ee=0;ee<K.length;ee++){const ye=Ys(K[ee][0]),Se=Dt(K[ee][1]);L.push(ye,Se,0),ee>0&&(le+=j?(G*Se-ye*re)/2:Math.sqrt(Math.pow(ye-G,2)+Math.pow(Se-re,2))),G=ye,re=Se}const de=L.length-3;L[2]=1,_o(L,0,de,D),L[de+2]=1,L.size=Math.abs(le),L.start=0,L.end=L.size}function yo(K,L,D,j){for(let G=0;G<K.length;G++){const re=[];ge(K[G],re,D,j),L.push(re)}}function Ys(K){return K/360+.5}function Dt(K){const L=Math.sin(K*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function ei(K,L,D,j,G,re,le,de){if(j/=L,re>=(D/=L)&&le<j)return K;if(le<D||re>=j)return null;const ee=[];for(const ye of K){const Se=ye.geometry;let me=ye.type;const ze=G===0?ye.minX:ye.minY,tt=G===0?ye.maxX:ye.maxY;if(ze>=D&&tt<j){ee.push(ye);continue}if(tt<D||ze>=j)continue;let nt=[];if(me==="Point"||me==="MultiPoint")Js(Se,nt,D,j,G);else if(me==="LineString")Jr(Se,nt,D,j,G,!1,de.lineMetrics);else if(me==="MultiLineString")Wo(Se,nt,D,j,G,!1);else if(me==="Polygon")Wo(Se,nt,D,j,G,!0);else if(me==="MultiPolygon")for(const Ct of Se){const pt=[];Wo(Ct,pt,D,j,G,!0),pt.length&&nt.push(pt)}if(nt.length){if(de.lineMetrics&&me==="LineString"){for(const Ct of nt)ee.push(Lr(ye.id,me,Ct,ye.tags));continue}me!=="LineString"&&me!=="MultiLineString"||(nt.length===1?(me="LineString",nt=nt[0]):me="MultiLineString"),me!=="Point"&&me!=="MultiPoint"||(me=nt.length===3?"Point":"MultiPoint"),ee.push(Lr(ye.id,me,nt,ye.tags))}}return ee.length?ee:null}function Js(K,L,D,j,G){for(let re=0;re<K.length;re+=3){const le=K[re+G];le>=D&&le<=j&&Mn(L,K[re],K[re+1],K[re+2])}}function Jr(K,L,D,j,G,re,le){let de=Rr(K);const ee=G===0?Qs:ea;let ye,Se,me=K.start;for(let pt=0;pt<K.length-3;pt+=3){const Pt=K[pt],xt=K[pt+1],mi=K[pt+2],ti=K[pt+3],yt=K[pt+4],Ot=G===0?Pt:xt,Jt=G===0?ti:yt;let Si=!1;le&&(ye=Math.sqrt(Math.pow(Pt-ti,2)+Math.pow(xt-yt,2))),Ot<D?Jt>D&&(Se=ee(de,Pt,xt,ti,yt,D),le&&(de.start=me+ye*Se)):Ot>j?Jt<j&&(Se=ee(de,Pt,xt,ti,yt,j),le&&(de.start=me+ye*Se)):Mn(de,Pt,xt,mi),Jt<D&&Ot>=D&&(Se=ee(de,Pt,xt,ti,yt,D),Si=!0),Jt>j&&Ot<=j&&(Se=ee(de,Pt,xt,ti,yt,j),Si=!0),!re&&Si&&(le&&(de.end=me+ye*Se),L.push(de),de=Rr(K)),le&&(me+=ye)}let ze=K.length-3;const tt=K[ze],nt=K[ze+1],Ct=G===0?tt:nt;Ct>=D&&Ct<=j&&Mn(de,tt,nt,K[ze+2]),ze=de.length-3,re&&ze>=3&&(de[ze]!==de[0]||de[ze+1]!==de[1])&&Mn(de,de[0],de[1],de[2]),de.length&&L.push(de)}function Rr(K){const L=[];return L.size=K.size,L.start=K.start,L.end=K.end,L}function Wo(K,L,D,j,G,re){for(const le of K)Jr(le,L,D,j,G,re,!1)}function Mn(K,L,D,j){K.push(L,D,j)}function Qs(K,L,D,j,G,re){const le=(re-L)/(j-L);return Mn(K,re,D+(G-D)*le,1),le}function ea(K,L,D,j,G,re){const le=(re-D)/(G-D);return Mn(K,L+(j-L)*le,re,1),le}function Ce(K,L){const D=[];for(let j=0;j<K.length;j++){const G=K[j],re=G.type;let le;if(re==="Point"||re==="MultiPoint"||re==="LineString")le=yr(G.geometry,L);else if(re==="MultiLineString"||re==="Polygon"){le=[];for(const de of G.geometry)le.push(yr(de,L))}else if(re==="MultiPolygon"){le=[];for(const de of G.geometry){const ee=[];for(const ye of de)ee.push(yr(ye,L));le.push(ee)}}D.push(Lr(G.id,re,le,G.tags))}return D}function yr(K,L){const D=[];D.size=K.size,K.start!==void 0&&(D.start=K.start,D.end=K.end);for(let j=0;j<K.length;j+=3)D.push(K[j]+L,K[j+1],K[j+2]);return D}function qi(K,L){if(K.transformed)return K;const D=1<<K.z,j=K.x,G=K.y;for(const re of K.features){const le=re.geometry,de=re.type;if(re.geometry=[],de===1)for(let ee=0;ee<le.length;ee+=2)re.geometry.push(vr(le[ee],le[ee+1],L,D,j,G));else for(let ee=0;ee<le.length;ee++){const ye=[];for(let Se=0;Se<le[ee].length;Se+=2)ye.push(vr(le[ee][Se],le[ee][Se+1],L,D,j,G));re.geometry.push(ye)}}return K.transformed=!0,K}function vr(K,L,D,j,G,re){return[Math.round(D*(K*j-G)),Math.round(D*(L*j-re))]}function Qr(K,L,D,j,G){const re=L===G.maxZoom?0:G.tolerance/((1<<L)*G.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:K.length,source:null,x:D,y:j,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const de of K)Le(le,de,re,G);return le}function Le(K,L,D,j){const G=L.geometry,re=L.type,le=[];if(K.minX=Math.min(K.minX,L.minX),K.minY=Math.min(K.minY,L.minY),K.maxX=Math.max(K.maxX,L.maxX),K.maxY=Math.max(K.maxY,L.maxY),re==="Point"||re==="MultiPoint")for(let de=0;de<G.length;de+=3)le.push(G[de],G[de+1]),K.numPoints++,K.numSimplified++;else if(re==="LineString")_t(le,G,K,D,!1,!1);else if(re==="MultiLineString"||re==="Polygon")for(let de=0;de<G.length;de++)_t(le,G[de],K,D,re==="Polygon",de===0);else if(re==="MultiPolygon")for(let de=0;de<G.length;de++){const ee=G[de];for(let ye=0;ye<ee.length;ye++)_t(le,ee[ye],K,D,!0,ye===0)}if(le.length){let de=L.tags||null;if(re==="LineString"&&j.lineMetrics){de={};for(const ye in L.tags)de[ye]=L.tags[ye];de.mapbox_clip_start=G.start/G.size,de.mapbox_clip_end=G.end/G.size}const ee={geometry:le,type:re==="Polygon"||re==="MultiPolygon"?3:re==="LineString"||re==="MultiLineString"?2:1,tags:de};L.id!==null&&(ee.id=L.id),K.features.push(ee)}}function _t(K,L,D,j,G,re){const le=j*j;if(j>0&&L.size<(G?le:j))return void(D.numPoints+=L.length/3);const de=[];for(let ee=0;ee<L.length;ee+=3)(j===0||L[ee+2]>le)&&(D.numSimplified++,de.push(L[ee],L[ee+1])),D.numPoints++;G&&function(ee,ye){let Se=0;for(let me=0,ze=ee.length,tt=ze-2;me<ze;tt=me,me+=2)Se+=(ee[me]-ee[tt])*(ee[me+1]+ee[tt+1]);if(Se>0===ye)for(let me=0,ze=ee.length;me<ze/2;me+=2){const tt=ee[me],nt=ee[me+1];ee[me]=ee[ze-2-me],ee[me+1]=ee[ze-1-me],ee[ze-2-me]=tt,ee[ze-1-me]=nt}}(de,re),K.push(de)}const st={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class rn{constructor(L,D){const j=(D=this.options=function(re,le){for(const de in le)re[de]=le[de];return re}(Object.create(st),D)).debug;if(j&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let G=function(re,le){const de=[];if(re.type==="FeatureCollection")for(let ee=0;ee<re.features.length;ee++)Yr(de,re.features[ee],le,ee);else Yr(de,re.type==="Feature"?re:{geometry:re},le);return de}(L,D);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),G=function(re,le){const de=le.buffer/le.extent;let ee=re;const ye=ei(re,1,-1-de,de,0,-1,2,le),Se=ei(re,1,1-de,2+de,0,-1,2,le);return(ye||Se)&&(ee=ei(re,1,-de,1+de,0,-1,2,le)||[],ye&&(ee=Ce(ye,1).concat(ee)),Se&&(ee=ee.concat(Ce(Se,-1)))),ee}(G,D),G.length&&this.splitTile(G,0,0,0),j&&(G.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(L,D,j,G,re,le,de){const ee=[L,D,j,G],ye=this.options,Se=ye.debug;for(;ee.length;){G=ee.pop(),j=ee.pop(),D=ee.pop(),L=ee.pop();const me=1<<D,ze=Wn(D,j,G);let tt=this.tiles[ze];if(!tt&&(Se>1&&console.time("creation"),tt=this.tiles[ze]=Qr(L,D,j,G,ye),this.tileCoords.push({z:D,x:j,y:G}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,j,G,tt.numFeatures,tt.numPoints,tt.numSimplified),console.timeEnd("creation"));const Si=`z${D}`;this.stats[Si]=(this.stats[Si]||0)+1,this.total++}if(tt.source=L,re==null){if(D===ye.indexMaxZoom||tt.numPoints<=ye.indexMaxPoints)continue}else{if(D===ye.maxZoom||D===re)continue;if(re!=null){const Si=re-D;if(j!==le>>Si||G!==de>>Si)continue}}if(tt.source=null,L.length===0)continue;Se>1&&console.time("clipping");const nt=.5*ye.buffer/ye.extent,Ct=.5-nt,pt=.5+nt,Pt=1+nt;let xt=null,mi=null,ti=null,yt=null,Ot=ei(L,me,j-nt,j+pt,0,tt.minX,tt.maxX,ye),Jt=ei(L,me,j+Ct,j+Pt,0,tt.minX,tt.maxX,ye);L=null,Ot&&(xt=ei(Ot,me,G-nt,G+pt,1,tt.minY,tt.maxY,ye),mi=ei(Ot,me,G+Ct,G+Pt,1,tt.minY,tt.maxY,ye),Ot=null),Jt&&(ti=ei(Jt,me,G-nt,G+pt,1,tt.minY,tt.maxY,ye),yt=ei(Jt,me,G+Ct,G+Pt,1,tt.minY,tt.maxY,ye),Jt=null),Se>1&&console.timeEnd("clipping"),ee.push(xt||[],D+1,2*j,2*G),ee.push(mi||[],D+1,2*j,2*G+1),ee.push(ti||[],D+1,2*j+1,2*G),ee.push(yt||[],D+1,2*j+1,2*G+1)}}getTile(L,D,j){L=+L,D=+D,j=+j;const G=this.options,{extent:re,debug:le}=G;if(L<0||L>24)return null;const de=1<<L,ee=Wn(L,D=D+de&de-1,j);if(this.tiles[ee])return qi(this.tiles[ee],re);le>1&&console.log("drilling down to z%d-%d-%d",L,D,j);let ye,Se=L,me=D,ze=j;for(;!ye&&Se>0;)Se--,me>>=1,ze>>=1,ye=this.tiles[Wn(Se,me,ze)];return ye&&ye.source?(le>1&&(console.log("found parent tile z%d-%d-%d",Se,me,ze),console.time("drilling down")),this.splitTile(ye.source,Se,me,ze,L,D,j),le>1&&console.timeEnd("drilling down"),this.tiles[ee]?qi(this.tiles[ee],re):null):null}}function Wn(K,L,D){return 32*((1<<K)*D+L)+K}function dt(K,L){return L?K.properties[L]:K.id}function xr(K,L){if(K==null)return!0;if(K.type==="Feature")return dt(K,L)!=null;if(K.type==="FeatureCollection"){const D=new Set;for(const j of K.features){const G=dt(j,L);if(G==null||D.has(G))return!1;D.add(G)}return!0}return!1}function Fr(K,L){const D=new Map;if(K!=null)if(K.type==="Feature")D.set(dt(K,L),K);else for(const j of K.features)D.set(dt(j,L),j);return D}class eo extends X{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(L,D){return w._(this,void 0,void 0,function*(){const j=L.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const G=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!G)return null;const re=new class{constructor(de){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.X,this.length=de.length,this._features=de}feature(de){return new class{constructor(ee){this._feature=ee,this.extent=w.X,this.type=ee.type,this.properties=ee.tags,"id"in ee&&!isNaN(ee.id)&&(this.id=parseInt(ee.id,10))}loadGeometry(){if(this._feature.type===1){const ee=[];for(const ye of this._feature.geometry)ee.push([new w.P(ye[0],ye[1])]);return ee}{const ee=[];for(const ye of this._feature.geometry){const Se=[];for(const me of ye)Se.push(new w.P(me[0],me[1]));ee.push(Se)}return ee}}toGeoJSON(ee,ye,Se){return Qe.call(this,ee,ye,Se)}}(this._features[de])}}(G.features);let le=en(re);return le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),{vectorTile:re,rawData:le.buffer}})}loadData(L){return w._(this,void 0,void 0,function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const j=!!(L&&L.request&&L.request.collectResourceTiming)&&new w.bv(L.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(L,this._pendingRequest),this._geoJSONIndex=L.cluster?new Di(function({superclusterOptions:le,clusterProperties:de}){if(!de||!le)return le;const ee={},ye={},Se={accumulated:null,zoom:0},me={properties:null},ze=Object.keys(de);for(const tt of ze){const[nt,Ct]=de[tt],pt=w.bC(Ct),Pt=w.bC(typeof nt=="string"?[nt,["accumulated"],["get",tt]]:nt);ee[tt]=pt.value,ye[tt]=Pt.value}return le.map=tt=>{me.properties=tt;const nt={};for(const Ct of ze)nt[Ct]=ee[Ct].evaluate(Se,me);return nt},le.reduce=(tt,nt)=>{me.properties=nt;for(const Ct of ze)Se.accumulated=tt[Ct],tt[Ct]=ye[Ct].evaluate(Se,me)},le}(L)).load((yield this._pendingData).features):(G=yield this._pendingData,new rn(G,L.geojsonVtOptions)),this.loaded={};const re={};if(j){const le=j.finish();le&&(re.resourceTiming={},re.resourceTiming[L.source]=JSON.parse(JSON.stringify(le)))}return re}catch(re){if(delete this._pendingRequest,w.bB(re))return{abandoned:!0};throw re}var G})}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(L){const D=this.loaded;return D&&D[L.uid]?super.reloadTile(L):this.loadTile(L)}loadAndProcessGeoJSON(L,D){return w._(this,void 0,void 0,function*(){let j=yield this.loadGeoJSON(L,D);if(delete this._pendingRequest,typeof j!="object")throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(Ie(j,!0),L.filter){const G=w.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(G.result==="error")throw new Error(G.value.map(le=>`${le.key}: ${le.message}`).join(", "));j={type:"FeatureCollection",features:j.features.filter(le=>G.value.evaluate({zoom:0},le))}}return j})}loadGeoJSON(L,D){return w._(this,void 0,void 0,function*(){const{promoteId:j}=L;if(L.request){const G=yield w.h(L.request,D);return this._dataUpdateable=xr(G.data,j)?Fr(G.data,j):void 0,G.data}if(typeof L.data=="string")try{const G=JSON.parse(L.data);return this._dataUpdateable=xr(G,j)?Fr(G,j):void 0,G}catch{throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`)}if(!L.dataDiff)throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${L.source}`);return function(G,re,le){var de,ee,ye,Se;if(re.removeAll&&G.clear(),re.remove)for(const me of re.remove)G.delete(me);if(re.add)for(const me of re.add){const ze=dt(me,le);ze!=null&&G.set(ze,me)}if(re.update)for(const me of re.update){let ze=G.get(me.id);if(ze==null)continue;const tt=!me.removeAllProperties&&(((de=me.removeProperties)===null||de===void 0?void 0:de.length)>0||((ee=me.addOrUpdateProperties)===null||ee===void 0?void 0:ee.length)>0);if((me.newGeometry||me.removeAllProperties||tt)&&(ze=Object.assign({},ze),G.set(me.id,ze),tt&&(ze.properties=Object.assign({},ze.properties))),me.newGeometry&&(ze.geometry=me.newGeometry),me.removeAllProperties)ze.properties={};else if(((ye=me.removeProperties)===null||ye===void 0?void 0:ye.length)>0)for(const nt of me.removeProperties)Object.prototype.hasOwnProperty.call(ze.properties,nt)&&delete ze.properties[nt];if(((Se=me.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0)for(const{key:nt,value:Ct}of me.addOrUpdateProperties)ze.properties[nt]=Ct}}(this._dataUpdateable,L.dataDiff,j),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(L){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(L){return this._geoJSONIndex.getClusterExpansionZoom(L.clusterId)}getClusterChildren(L){return this._geoJSONIndex.getChildren(L.clusterId)}getClusterLeaves(L){return this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset)}}class wr{constructor(L){this.self=L,this.actor=new w.F(L),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,j)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=j},this.self.addProtocol=w.bi,this.self.removeProtocol=w.bj,this.self.registerRTLTextPlugin=D=>{if(w.bD.isParsed())throw new Error("RTL text plugin already registered.");w.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",(D,j)=>this._getDEMWorkerSource(D,j.source).loadTile(j)),this.actor.registerMessageHandler("RDT",(D,j)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(D,j.source).removeTile(j)})),this.actor.registerMessageHandler("GCEZ",(D,j)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(D,j.type,j.source).getClusterExpansionZoom(j)})),this.actor.registerMessageHandler("GCC",(D,j)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(D,j.type,j.source).getClusterChildren(j)})),this.actor.registerMessageHandler("GCL",(D,j)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(D,j.type,j.source).getClusterLeaves(j)})),this.actor.registerMessageHandler("LD",(D,j)=>this._getWorkerSource(D,j.type,j.source).loadData(j)),this.actor.registerMessageHandler("GD",(D,j)=>this._getWorkerSource(D,j.type,j.source).getData()),this.actor.registerMessageHandler("LT",(D,j)=>this._getWorkerSource(D,j.type,j.source).loadTile(j)),this.actor.registerMessageHandler("RT",(D,j)=>this._getWorkerSource(D,j.type,j.source).reloadTile(j)),this.actor.registerMessageHandler("AT",(D,j)=>this._getWorkerSource(D,j.type,j.source).abortTile(j)),this.actor.registerMessageHandler("RMT",(D,j)=>this._getWorkerSource(D,j.type,j.source).removeTile(j)),this.actor.registerMessageHandler("RS",(D,j)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[D]||!this.workerSources[D][j.type]||!this.workerSources[D][j.type][j.source])return;const G=this.workerSources[D][j.type][j.source];delete this.workerSources[D][j.type][j.source],G.removeSource!==void 0&&G.removeSource(j)})),this.actor.registerMessageHandler("RM",D=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})),this.actor.registerMessageHandler("SR",(D,j)=>w._(this,void 0,void 0,function*(){this.referrer=j})),this.actor.registerMessageHandler("SRPS",(D,j)=>this._syncRTLPluginState(D,j)),this.actor.registerMessageHandler("IS",(D,j)=>w._(this,void 0,void 0,function*(){this.self.importScripts(j)})),this.actor.registerMessageHandler("SI",(D,j)=>this._setImages(D,j)),this.actor.registerMessageHandler("UL",(D,j)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(D).update(j.layers,j.removedIds)})),this.actor.registerMessageHandler("SL",(D,j)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(D).replace(j)}))}_setImages(L,D){return w._(this,void 0,void 0,function*(){this.availableImages[L]=D;for(const j in this.workerSources[L]){const G=this.workerSources[L][j];for(const re in G)G[re].availableImages=D}})}_syncRTLPluginState(L,D){return w._(this,void 0,void 0,function*(){if(w.bD.isParsed())return w.bD.getState();if(D.pluginStatus!=="loading")return w.bD.setState(D),D;const j=D.pluginURL;if(this.self.importScripts(j),w.bD.isParsed()){const G={pluginStatus:"loaded",pluginURL:j};return w.bD.setState(G),G}throw w.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${j}`)})}_getAvailableImages(L){let D=this.availableImages[L];return D||(D=[]),D}_getLayerIndex(L){let D=this.layerIndexes[L];return D||(D=this.layerIndexes[L]=new d),D}_getWorkerSource(L,D,j){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][D]||(this.workerSources[L][D]={}),!this.workerSources[L][D][j]){const G={sendAsync:(re,le)=>(re.targetMapId=L,this.actor.sendAsync(re,le))};switch(D){case"vector":this.workerSources[L][D][j]=new X(G,this._getLayerIndex(L),this._getAvailableImages(L));break;case"geojson":this.workerSources[L][D][j]=new eo(G,this._getLayerIndex(L),this._getAvailableImages(L));break;default:this.workerSources[L][D][j]=new this.externalWorkerSourceTypes[D](G,this._getLayerIndex(L),this._getAvailableImages(L))}}return this.workerSources[L][D][j]}_getDEMWorkerSource(L,D){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][D]||(this.demWorkerSources[L][D]=new $),this.demWorkerSources[L][D]}}return w.i(self)&&(self.worker=new wr(self)),wr}),y("index",["exports","./shared"],function(w,d){var O="4.7.1";let W,oe;const X={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise((e,s)=>{const u=requestAnimationFrame(e);f.signal.addEventListener("abort",()=>{cancelAnimationFrame(u),s(d.c())})}),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,s.drawImage(f,0,0,f.width,f.height),s},resolveURL:f=>(W||(W=document.createElement("a")),W.href=f,W.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(oe==null&&(oe=matchMedia("(prefers-reduced-motion: reduce)")),oe.matches)}};class ${static testProp(e){if(!$.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in $.docStyle)return e[s];return e[0]}static create(e,s,u){const c=window.document.createElement(e);return s!==void 0&&(c.className=s),u&&u.appendChild(c),c}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){$.docStyle&&$.selectProp&&($.userSelect=$.docStyle[$.selectProp],$.docStyle[$.selectProp]="none")}static enableDrag(){$.docStyle&&$.selectProp&&($.docStyle[$.selectProp]=$.userSelect)}static setTransform(e,s){e.style[$.transformProp]=s}static addEventListener(e,s,u,c={}){e.addEventListener(s,u,"passive"in c?c:c.capture)}static removeEventListener(e,s,u,c={}){e.removeEventListener(s,u,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",$.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",$.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",$.suppressClickInternal,!0)},0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,u){const c=s.boundingClientRect;return new d.P((u.clientX-c.left)/s.x-e.clientLeft,(u.clientY-c.top)/s.y-e.clientTop)}static mousePos(e,s){const u=$.getScale(e);return $.getPoint(e,u,s)}static touchPos(e,s){const u=[],c=$.getScale(e);for(let p=0;p<s.length;p++)u.push($.getPoint(e,c,s[p]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}$.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,$.selectProp=$.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),$.transformProp=$.testProp(["transform","WebkitTransform"]);const be={supported:!1,testSupport:function(f){!Qe&&Ie&&(ue?ie(f):Te=f)}};let Te,Ie,Qe=!1,ue=!1;function ie(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Ie),f.isContextLost())return;be.supported=!0}catch{}f.deleteTexture(e),Qe=!0}var se;typeof document<"u"&&(Ie=document.createElement("img"),Ie.onload=()=>{Te&&ie(Te),Te=null,ue=!0},Ie.onerror=()=>{Qe=!0,Te=null},Ie.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,s,u,c;f.resetRequestQueue=()=>{e=[],s=0,u=0,c={}},f.addThrottleControl=k=>{const C=u++;return c[C]=k,C},f.removeThrottleControl=k=>{delete c[k],x()},f.getImage=(k,C,M=!0)=>new Promise((z,F)=>{be.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),d.e(k,{type:"image"}),e.push({abortController:C,requestParameters:k,supportImageRefresh:M,state:"queued",onError:V=>{F(V)},onSuccess:V=>{z(V)}}),x()});const p=k=>d._(this,void 0,void 0,function*(){k.state="running";const{requestParameters:C,supportImageRefresh:M,onError:z,onSuccess:F,abortController:V}=k,U=M===!1&&!d.i(self)&&!d.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((Q,te)=>Q&&te==="accept",!0));s++;const H=U?S(C,V):d.m(C,V);try{const Q=yield H;delete k.abortController,k.state="completed",Q.data instanceof HTMLImageElement||d.b(Q.data)?F(Q):Q.data&&F({data:yield(J=Q.data,typeof createImageBitmap=="function"?d.d(J):d.f(J)),cacheControl:Q.cacheControl,expires:Q.expires})}catch(Q){delete k.abortController,z(Q)}finally{s--,x()}var J}),x=()=>{const k=(()=>{for(const C of Object.keys(c))if(c[C]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=s;C<k&&e.length>0;C++){const M=e.shift();M.abortController.signal.aborted?C--:p(M)}},S=(k,C)=>new Promise((M,z)=>{const F=new Image,V=k.url,U=k.credentials;U&&U==="include"?F.crossOrigin="use-credentials":(U&&U==="same-origin"||!d.s(V))&&(F.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{F.src="",z(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,M({data:F})},F.onerror=()=>{F.onerror=F.onload=null,C.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=V})}(se||(se={})),se.resetRequestQueue();class xe{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Pe(f){var e=new d.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var $e,Ve=function(f,e,s){return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],f};$e=new d.A(3),d.A!=Float32Array&&($e[0]=0,$e[1]=0,$e[2]=0);var Ge=function(f){var e=f[0],s=f[1];return e*e+s*s};function Et(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const s=[];for(const{id:u,url:c}of f){const p=`${u}${c}`;s.indexOf(p)===-1&&(s.push(p),e.push({id:u,url:c}))}}return e}function mt(f,e,s){const u=f.split("?");return u[0]+=`${e}${s}`,u.join("?")}(function(){var f=new d.A(2);d.A!=Float32Array&&(f[0]=0,f[1]=0)})();class gt{constructor(e,s,u,c){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(s,c)}update(e,s,u){const{width:c,height:p}=e,x=!(this.size&&this.size[0]===c&&this.size[1]===p||u),{context:S}=this,{gl:k}=S;if(this.useMipmap=!!(s&&s.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!s||s.premultiply!==!1)),x)this.size=[c,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,e):k.texImage2D(k.TEXTURE_2D,0,this.format,c,p,0,this.format,k.UNSIGNED_BYTE,e.data);else{const{x:C,y:M}=u||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?k.texSubImage2D(k.TEXTURE_2D,0,C,M,k.RGBA,k.UNSIGNED_BYTE,e):k.texSubImage2D(k.TEXTURE_2D,0,C,M,c,p,k.RGBA,k.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(e,s,u){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||e),this.filter=e),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function gr(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class oi extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:u}of this.requestors)u(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const u=s.spriteData;s.data=new d.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let u=!0;const c=s.data||s.spriteData;return this._validateStretch(s.stretchX,c&&c.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,c&&c.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,s){if(!e)return!0;let u=0;for(const c of e){if(c[0]<u||c[1]<c[0]||s<c[1])return!1;u=c[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const u=s.spriteData,c=u&&u.width||s.data.width,p=u&&u.height||s.data.height;return!(e[0]<0||c<e[0]||e[1]<0||p<e[1]||e[2]<0||c<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,u=!0){const c=this.getImage(e);if(u&&(c.data.width!==s.data.width||c.data.height!==s.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=c.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((s,u)=>{let c=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(c=!1);this.isLoaded()||c?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})})}_getImagesForIds(e){const s={};for(const u of e){let c=this.getImage(u);c||(this.fire(new d.k("styleimagemissing",{id:u})),c=this.getImage(u)),c?s[u]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:d.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],u=this.getImage(e);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const c={w:u.data.width+2,h:u.data.height+2,x:0,y:0},p=new d.I(c,u);this.patterns[e]={bin:c,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new gt(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:s,h:u}=d.p(e),c=this.atlasImage;c.resize({width:s||1,height:u||1});for(const p in this.patterns){const{bin:x}=this.patterns[p],S=x.x+1,k=x.y+1,C=this.getImage(p).data,M=C.width,z=C.height;d.R.copy(C,c,{x:0,y:0},{x:S,y:k},{width:M,height:z}),d.R.copy(C,c,{x:0,y:z-1},{x:S,y:k-1},{width:M,height:1}),d.R.copy(C,c,{x:0,y:0},{x:S,y:k+z},{width:M,height:1}),d.R.copy(C,c,{x:M-1,y:0},{x:S-1,y:k},{width:1,height:z}),d.R.copy(C,c,{x:0,y:0},{x:S+M,y:k},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.getImage(s);u||d.w(`Image with ID: "${s}" was not found`),gr(u)&&this.updateImage(s,u)}}}const wi=1e20;function Zn(f,e,s,u,c,p,x,S,k){for(let C=e;C<e+u;C++)_r(f,s*p+C,p,c,x,S,k);for(let C=s;C<s+c;C++)_r(f,C*p+e,1,u,x,S,k)}function _r(f,e,s,u,c,p,x){p[0]=0,x[0]=-wi,x[1]=wi,c[0]=f[e];for(let S=1,k=0,C=0;S<u;S++){c[S]=f[e+S*s];const M=S*S;do{const z=p[k];C=(c[S]-c[z]+M-z*z)/(S-z)/2}while(C<=x[k]&&--k>-1);k++,p[k]=S,x[k]=C,x[k+1]=wi}for(let S=0,k=0;S<u;S++){for(;x[k+1]<S;)k++;const C=p[k],M=S-C;f[e+S*s]=c[C]+M*M}}class en{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const s=[];for(const p in e)for(const x of e[p])s.push(this._getAndCacheGlyphsPromise(p,x));const u=yield Promise.all(s),c={};for(const{stack:p,id:x,glyph:S}of u)c[p]||(c[p]={}),c[p][x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return c})}_getAndCacheGlyphsPromise(e,s){return d._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=u.glyphs[s];if(c!==void 0)return{stack:e,id:s,glyph:c};if(c=this._tinySDF(u,e,s),c)return u.glyphs[s]=c,{stack:e,id:s,glyph:c};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[p])return{stack:e,id:s,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[p]){const S=en.loadGlyphRange(e,p,this.url,this.requestManager);u.requests[p]=S}const x=yield u.requests[p];for(const S in x)this._doesCharSupportLocalGlyph(+S)||(u.glyphs[+S]=x[+S]);return u.ranges[p]=!0,{stack:e,id:s,glyph:x[s]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,u){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(u))return;let p=e.tinySDF;if(!p){let S="400";/bold/i.test(s)?S="900":/medium/i.test(s)?S="500":/light/i.test(s)&&(S="200"),p=e.tinySDF=new en.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:S})}const x=p.draw(String.fromCharCode(u));return{id:u,bitmap:new d.o({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}en.loadGlyphRange=function(f,e,s,u){return d._(this,void 0,void 0,function*(){const c=256*e,p=c+255,x=u.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${c}-${p}`),"Glyphs"),S=yield d.l(x,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${p}`);const k={};for(const C of d.n(S.data))k[C.id]=C;return k})},en.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:s=8,cutoff:u=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=s;const S=this.size=f+4*e,k=this._createCanvas(S),C=this.ctx=k.getContext("2d",{willReadFrequently:!0});C.font=`${x} ${p} ${f}px ${c}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(f),x=Math.ceil(s),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),k=Math.min(this.size-this.buffer,x+Math.ceil(u)),C=S+2*this.buffer,M=k+2*this.buffer,z=Math.max(C*M,0),F=new Uint8ClampedArray(z),V={data:F,width:C,height:M,glyphWidth:S,glyphHeight:k,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(S===0||k===0)return V;const{ctx:U,buffer:H,gridInner:J,gridOuter:Q}=this;U.clearRect(H,H,S,k),U.fillText(f,H,H+x);const te=U.getImageData(H,H,S,k);Q.fill(wi,0,z),J.fill(0,0,z);for(let q=0;q<k;q++)for(let ae=0;ae<S;ae++){const ce=te.data[4*(q*S+ae)+3]/255;if(ce===0)continue;const fe=(q+H)*C+ae+H;if(ce===1)Q[fe]=0,J[fe]=wi;else{const we=.5-ce;Q[fe]=we>0?we*we:0,J[fe]=we<0?we*we:0}}Zn(Q,0,0,C,M,C,this.f,this.v,this.z),Zn(J,H,H,S,k,C,this.f,this.v,this.z);for(let q=0;q<z;q++){const ae=Math.sqrt(Q[q])-Math.sqrt(J[q]);F[q]=Math.round(255-255*(ae/this.radius+this.cutoff))}return V}};class We{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,s){return d.x(e.expression.evaluate(s))}interpolate(e,s,u){return{x:d.y.number(e.x,s.x,u),y:d.y.number(e.y,s.y,u),z:d.y.number(e.z,s.z,u)}}}let ct;class ht extends d.E{constructor(e){super(),ct=ct||new d.q({anchor:new d.D(d.v.light.anchor),position:new We,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(ct),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(d.r,e,s))for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,u){return(!u||u.validate!==!1)&&d.t(this,e.call(d.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const It=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class Bt extends d.E{constructor(e){super(),this._transitionable=new d.T(It),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,s={}){if(!this._validate(d.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const c=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),c):this._transitionable.setValue(u,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,u={}){return(u==null?void 0:u.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Gn{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const u=e.join(",")+String(s);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,s)),this.dashEntry[u]}getDashRanges(e,s,u){const c=[];let p=e.length%2==1?-e[e.length-1]*u:0,x=e[0]*u,S=!0;c.push({left:p,right:x,isDash:S,zeroLength:e[0]===0});let k=e[0];for(let C=1;C<e.length;C++){S=!S;const M=e[C];p=k*u,k+=M,x=k*u,c.push({left:p,right:x,isDash:S,zeroLength:M===0})}return c}addRoundDash(e,s,u){const c=s/2;for(let p=-u;p<=u;p++){const x=this.width*(this.nextRow+u+p);let S=0,k=e[S];for(let C=0;C<this.width;C++){C/k.right>1&&(k=e[++S]);const M=Math.abs(C-k.left),z=Math.abs(C-k.right),F=Math.min(M,z);let V;const U=p/u*(c+1);if(k.isDash){const H=c-Math.abs(U);V=Math.sqrt(F*F+H*H)}else V=c-Math.sqrt(F*F+U*U);this.data[x+C]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const k=e[S],C=e[S+1];k.zeroLength?e.splice(S,1):C&&C.isDash===k.isDash&&(C.left=k.left,e.splice(S,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const c=this.width*this.nextRow;let p=0,x=e[p];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++p]);const k=Math.abs(S-x.left),C=Math.abs(S-x.right),M=Math.min(k,C);this.data[c+S]=Math.max(0,Math.min(255,(x.isDash?M:-M)+128))}}addDash(e,s){const u=s?7:0,c=2*u+1;if(this.nextRow+c>this.height)return d.w("LineAtlas out of space"),null;let p=0;for(let S=0;S<e.length;S++)p+=e[S];if(p!==0){const S=this.width/p,k=this.getDashRanges(e,this.width,S);s?this.addRoundDash(k,S,u):this.addRegularDash(k)}const x={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:p};return this.nextRow+=c,this.dirty=!0,x}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Di="maplibre_preloaded_worker_pool";class tn{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<tn.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Di]}numActive(){return Object.keys(this.active).length}}const nn=Math.floor(X.hardwareConcurrency/2);let bi,Hn;function go(){return bi||(bi=new tn),bi}tn.workerCount=d.C(globalThis)?Math.max(Math.min(nn,3),1):1;class _o{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const u=this.workerPool.acquire(s);for(let c=0;c<u.length;c++){const p=new d.F(u[c],s);p.name=`Worker ${c}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const u=[];for(const c of this.actors)u.push(c.sendAsync({type:e,data:s}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const u of this.actors)u.registerMessageHandler(e,s)}}function Ks(){return Hn||(Hn=new _o(go(),d.G),Hn.registerMessageHandler("GR",(f,e,s)=>d.m(e,s))),Hn}function Lr(f,e){const s=d.H();return d.J(s,s,[1,1,0]),d.K(s,s,[.5*f.width,.5*f.height,1]),d.L(s,s,f.calculatePosMatrix(e.toUnwrapped()))}function Kr(f,e,s,u,c,p){const x=function(z,F,V){if(z)for(const U of z){const H=F[U];if(H&&H.source===V&&H.type==="fill-extrusion")return!0}else for(const U in F){const H=F[U];if(H.source===V&&H.type==="fill-extrusion")return!0}return!1}(c&&c.layers,e,f.id),S=p.maxPitchScaleFactor(),k=f.tilesIn(u,S,x);k.sort(Yr);const C=[];for(const z of k)C.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,s,f._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,c,p,S,Lr(f.transform,z.tileID))});const M=function(z){const F={},V={};for(const U of z){const H=U.queryResults,J=U.wrappedTileID,Q=V[J]=V[J]||{};for(const te in H){const q=H[te],ae=Q[te]=Q[te]||{},ce=F[te]=F[te]||[];for(const fe of q)ae[fe.featureIndex]||(ae[fe.featureIndex]=!0,ce.push(fe))}}return F}(C);for(const z in M)M[z].forEach(F=>{const V=F.feature,U=f.getFeatureState(V.layer["source-layer"],V.id);V.source=V.layer.source,V.layer["source-layer"]&&(V.sourceLayer=V.layer["source-layer"]),V.state=U});return M}function Yr(f,e){const s=f.tileID,u=e.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}function Ho(f,e,s){return d._(this,void 0,void 0,function*(){let u=f;if(f.url?u=(yield d.h(e.transformRequest(f.url,"Source"),s)).data:yield X.frameAsync(s),!u)return null;const c=d.M(d.e(u,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(c.vectorLayerIds=u.vector_layers.map(p=>p.id)),c})}class ge{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const s=this._sw,u=this._ne;let c,p;if(e instanceof d.N)c=e,p=e;else{if(!(e instanceof ge))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ge.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(c=e._sw,p=e._ne,!c||!p)return this}return s||u?(s.lng=Math.min(c.lng,s.lng),s.lat=Math.min(c.lat,s.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new d.N(c.lng,c.lat),this._ne=new d.N(p.lng,p.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:u}=d.N.convert(e);let c=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&c}static convert(e){return e instanceof ge?e:e&&new ge(e)}static fromLngLat(e,s=0){const u=360*s/40075017,c=u/Math.cos(Math.PI/180*e.lat);return new ge(new d.N(e.lng-c,e.lat-u),new d.N(e.lng+c,e.lat+u))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),s=new d.N(this._ne.lng,this._ne.lat);return new ge(e,e.lng>s.lng?new d.N(s.lng+360,s.lat):s)}}class yo{constructor(e,s,u){this.bounds=ge.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),u=Math.floor(d.O(this.bounds.getWest())*s),c=Math.floor(d.Q(this.bounds.getNorth())*s),p=Math.ceil(d.O(this.bounds.getEast())*s),x=Math.ceil(d.Q(this.bounds.getSouth())*s);return e.x>=u&&e.x<p&&e.y>=c&&e.y<x}}class Ys extends d.E{constructor(e,s,u,c){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(s,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ho(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new yo(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};u.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,x)=>{e.reloadPromise={resolve:p,reject:x}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:c,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Dt extends d.E{constructor(e,s,u,c){super(),this.id=e,this.dispatcher=u,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},s),d.e(this,d.M(s,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ho(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new yo(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield se.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const c=this.map.painter.context,p=c.gl,x=u.data;e.texture=this.map.painter.getTileTexture(x.width),e.texture?e.texture.update(x,{useMipmap:!0}):(e.texture=new gt(c,x,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class ei extends Dt{constructor(e,s,u,c){super(e,s,u,c),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield se.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const p=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const x=d.b(p)&&d.U()?p:yield this.readImageNow(p),S={type:this.type,uid:e.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const k=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=k,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const s=e.width+2,u=e.height+2;try{return new d.R({width:s,height:u},yield d.W(e,-1,-1,s,u))}catch{}}return X.getImageData(e,1)})}_getNeighboringTiles(e){const s=e.canonical,u=Math.pow(2,s.z),c=(s.x-1+u)%u,p=s.x===0?e.wrap-1:e.wrap,x=(s.x+1+u)%u,S=s.x+1===u?e.wrap+1:e.wrap,k={};return k[new d.S(e.overscaledZ,p,s.z,c,s.y).key]={backfilled:!1},k[new d.S(e.overscaledZ,S,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(k[new d.S(e.overscaledZ,p,s.z,c,s.y-1).key]={backfilled:!1},k[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},k[new d.S(e.overscaledZ,S,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<u&&(k[new d.S(e.overscaledZ,p,s.z,c,s.y+1).key]={backfilled:!1},k[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},k[new d.S(e.overscaledZ,S,s.z,x,s.y+1).key]={backfilled:!1}),k}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Js extends d.E{constructor(e,s,u,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(c),this._data=s.data,this._options=d.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=d.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:d.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:u}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const s=d.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(X.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const u=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||u.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let c=null;u.resourceTiming&&u.resourceTiming[this.id]&&(c=u.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&d.e(p,{resourceTiming:c}),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(u){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(u))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:s,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,s==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Jr=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Rr extends d.E{constructor(e,s,u,c){super(),this.id=e,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=s}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield se.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new d.j(s))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(d.Z.fromLngLat);this.tileID=function(c){let p=1/0,x=1/0,S=-1/0,k=-1/0;for(const F of c)p=Math.min(p,F.x),x=Math.min(x,F.y),S=Math.max(S,F.x),k=Math.max(k,F.y);const C=Math.max(S-p,k-x),M=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),z=Math.pow(2,M);return new d.a1(M,Math.floor((p+S)/2*z),Math.floor((x+k)/2*z))}(s),this.minzoom=this.maxzoom=this.tileID.z;const u=s.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,d.X,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,d.X),this._boundsArray.emplaceBack(u[2].x,u[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Jr.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new gt(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Wo extends Rr{constructor(e,s,u,c){super(e,s,u,c),this.roundZoom=!0,this.type="video",this.options=s}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield d.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new d.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Jr.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new gt(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Mn extends Rr{constructor(e,s,u,c){super(e,s,u,c),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(x=>typeof x!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Jr.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new gt(s,this.canvas,u.RGBA,{premultiply:!0});let c=!1;for(const p in this.tiles){const x=this.tiles[p];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,c=!0)}c&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Qs={},ea=f=>{switch(f){case"geojson":return Js;case"image":return Rr;case"raster":return Dt;case"raster-dem":return ei;case"vector":return Ys;case"video":return Wo;case"canvas":return Mn}return Qs[f]},Ce="RTLPluginLoaded";class yr extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ks()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(s,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=X.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(Ce))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let qi=null;function vr(){return qi||(qi=new yr),qi}class Qr{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,p){const x={};if(!p)return x;for(const S of c){const k=S.layerIds.map(C=>p.getLayer(C)).filter(Boolean);if(k.length!==0){S.layers=k,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(C=>k.filter(M=>M.id===C)[0]));for(const C of k)x[C.id]=S}}return x}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const p=this.buckets[c];if(p instanceof d.a6){if(this.hasSymbolBuckets=!0,!u)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const p=this.buckets[c];if(p instanceof d.a6&&p.hasRTLText){this.hasRTLText=!0,vr().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const p=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(c).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const c=this.buckets[u];c.uploadPending()&&c.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gt(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gt(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,u,c,p,x,S,k,C,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:p,scale:x,tileSize:this.tileSize,pixelPosMatrix:M,transform:k,params:S,queryPadding:this.queryPadding*C},e,s,u):{}}querySourceFeatures(e,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const c=u.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",x=c._geojsonTileLayer||c[p];if(!x)return;const S=d.a7(s&&s.filter),{z:k,x:C,y:M}=this.tileID.canonical,z={z:k,x:C,y:M};for(let F=0;F<x.length;F++){const V=x.feature(F);if(S.needGeometry){const J=d.a8(V,!0);if(!S.filter(new d.z(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!S.filter(new d.z(this.tileID.overscaledZ),V))continue;const U=u.getId(V,p),H=new d.a9(V,k,C,M,U);H.tile=z,e.push(H)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const u=d.aa(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let c=!1;if(this.expirationTime>u)c=!1;else if(s)if(this.expirationTime<s)c=!0;else{const p=this.expirationTime-s;p?this.expirationTime=u+Math.max(p,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!s.style.hasLayer(c))continue;const p=this.buckets[c],x=p.layers[0].sourceLayer||"_geojsonTileLayer",S=u[x],k=e[x];if(!S||!k||Object.keys(k).length===0)continue;p.update(k,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=s&&s.style&&s.style.getLayer(c);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<X.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=X.now()+e}setDependencies(e,s){const u={};for(const c of s)u[c]=!0;this.dependencies[e]=u}hasDependency(e,s){for(const u of e){const c=this.dependencies[u];if(c){for(const p of s)if(c[p])return!0}}return!1}}class Le{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,u){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const p={value:s,timeout:void 0};if(u!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},u)),this.data[c].push(p),this.order.push(c),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const u=e.wrapped().key,c=s===void 0?0:this.data[u].indexOf(s),p=this.data[u][c];return this.data[u].splice(c,1),p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(p.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const u in this.data)for(const c of this.data[u])e(c.value)||s.push(c);for(const u of s)this.remove(u.value.tileID,u)}}class _t{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,u){const c=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},d.e(this.stateChanges[e][c],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==c&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const p in this.state[e][c])u[p]||(this.deletedStates[e][c][p]=null)}else for(const p in u)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][p]===null&&delete this.deletedStates[e][c][p]}removeFeatureState(e,s,u){if(this.deletedStates[e]===null)return;const c=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&s!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][u]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(u in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][u]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,s){const u=String(s),c=d.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const x in p)delete c[x]}return c}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const u={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const p={};for(const x in this.stateChanges[c])this.state[c][x]||(this.state[c][x]={}),d.e(this.state[c][x],this.stateChanges[c][x]),p[x]=this.state[c][x];u[c]=p}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const p={};if(this.deletedStates[c]===null)for(const x in this.state[c])p[x]={},this.state[c][x]={};else for(const x in this.deletedStates[c]){if(this.deletedStates[c][x]===null)this.state[c][x]={};else for(const S of Object.keys(this.deletedStates[c][x]))delete this.state[c][x][S];p[x]=this.state[c][x]}u[c]=u[c]||{},d.e(u[c],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const c in e)e[c].setFeatureState(u,s)}}class st extends d.E{constructor(e,s,u){super(),this.id=e,this.dispatcher=u,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,p,x,S)=>{const k=new(ea(p.type))(c,p,x,S);if(k.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${k.id}`);return k})(e,s,u,this),this._tiles={},this._cache=new Le(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _t,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,u){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,u)}catch(c){e.state="errored",c.status!==404?this._source.fire(new d.j(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(rn).map(e=>e.key)}getRenderableIds(e){const s=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&s.push(this._tiles[u]);return e?s.sort((u,c)=>{const p=u.tileID,x=c.tileID,S=new d.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),k=new d.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-x.overscaledZ||k.y-S.y||k.x-S.x}).map(u=>u.tileID.key):s.map(u=>u.tileID).sort(rn).map(u=>u.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return d._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=s),yield this._loadTile(u,e,s))})}_tileLoaded(e,s,u){e.timeAdded=X.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let c=0;c<s.length;c++){const p=s[c];if(e.neighboringTiles&&e.neighboringTiles[p]){const x=this.getTileByID(p);u(e,x),u(x,e)}}function u(c,p){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let x=p.tileID.canonical.x-c.tileID.canonical.x;const S=p.tileID.canonical.y-c.tileID.canonical.y,k=Math.pow(2,c.tileID.canonical.z),C=p.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+k)===1?x+=k:Math.abs(x-k)===1&&(x-=k)),p.dem&&c.dem&&(c.dem.backfillBorder(p.dem,x,S),c.neighboringTiles&&c.neighboringTiles[C]&&(c.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,u,c){for(const p in this._tiles){let x=this._tiles[p];if(c[p]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>u)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const C=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[C.key],x&&x.hasData()&&(S=C)}let k=S;for(;k.overscaledZ>s;)if(k=k.scaledTo(k.overscaledZ-1),e[k.key]){c[S.key]=S;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=e.overscaledZ-1;u>=s;u--){const c=e.scaledTo(u),p=this._getLoadedTile(c);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(s*u*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(p)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const u={};for(const c in this._tiles){const p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),u[p.tileID.key]=p}this._tiles=u;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,s,u,c,p,x){const S={},k={},C=Object.keys(e),M=X.now();for(const z of C){const F=e[z],V=this._tiles[z];if(!V||V.fadeEndTime!==0&&V.fadeEndTime<=M)continue;const U=this.findLoadedParent(F,s),H=this.findLoadedSibling(F),J=U||H||null;J&&(this._addTile(J.tileID),S[J.tileID.key]=J.tileID),k[z]=F}this._retainLoadedChildren(k,c,u,e);for(const z in S)e[z]||(this._coveredTiles[z]=!0,e[z]=S[z]);if(x){const z={},F={};for(const V of p)this._tiles[V.key].hasData()?z[V.key]=V:F[V.key]=V;for(const V in F){const U=F[V].children(this._source.maxzoom);this._tiles[U[0].key]&&this._tiles[U[1].key]&&this._tiles[U[2].key]&&this._tiles[U[3].key]&&(z[U[0].key]=e[U[0].key]=U[0],z[U[1].key]=e[U[1].key]=U[1],z[U[2].key]=e[U[2].key]=U[2],z[U[3].key]=e[U[3].key]=U[3],delete F[V])}for(const V in F){const U=F[V],H=this.findLoadedParent(U,this._source.minzoom),J=this.findLoadedSibling(U),Q=H||J||null;if(Q){z[Q.tileID.key]=e[Q.tileID.key]=Q.tileID;for(const te in z)z[te].isChildOf(Q.tileID)&&delete z[te]}}for(const V in this._tiles)z[V]||(this._coveredTiles[V]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new d.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(u=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(u=u.filter(M=>this._source.hasTile(M)))):u=[];const c=e.coveringZoomLevel(this._source),p=Math.max(c-st.maxOverzooming,this._source.minzoom),x=Math.max(c+st.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of u)if(z.canonical.z>this._source.minzoom){const F=z.scaledTo(z.canonical.z-1);M[F.key]=F;const V=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[V.key]=V}u=u.concat(Object.values(M))}const S=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(u,c);Wn(this._source.type)&&this._updateCoveredAndRetainedTiles(k,p,x,c,u,s);for(const M in k)this._tiles[M].clearFadeHold();const C=d.ab(this._tiles,k);for(const M of C){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var u;const c={},p={},x=Math.max(s-st.maxOverzooming,this._source.minzoom),S=Math.max(s+st.maxUnderzooming,this._source.minzoom),k={};for(const C of e){const M=this._addTile(C);c[C.key]=C,M.hasData()||s<this._source.maxzoom&&(k[C.key]=C)}this._retainLoadedChildren(k,s,S,c);for(const C of e){let M=this._tiles[C.key];if(M.hasData())continue;if(s+1>this._source.maxzoom){const F=C.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){c[F.key]=F;continue}}else{const F=C.children(this._source.maxzoom);if(c[F[0].key]&&c[F[1].key]&&c[F[2].key]&&c[F[3].key])continue}let z=M.wasRequested();for(let F=C.overscaledZ-1;F>=x;--F){const V=C.scaledTo(F);if(p[V.key])break;if(p[V.key]=!0,M=this.getTile(V),!M&&z&&(M=this._addTile(V)),M){const U=M.hasData();if((U||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||z)&&(c[V.key]=V),z=M.wasRequested(),U)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let u,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){u=this._loadedParentTiles[c.key];break}s.push(c.key);const p=c.scaledTo(c.overscaledZ-1);if(u=this._getLoadedTile(p),u)break;c=p}for(const p of s)this._loadedParentTiles[p]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,u=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=u}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const u=s;return s||(s=new Qr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,u||this._source.fire(new d.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=s.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,u){const c=[],p=this.transform;if(!p)return c;const x=u?p.getCameraQueryGeometry(e):e,S=e.map(U=>p.pointCoordinate(U,this.terrain)),k=x.map(U=>p.pointCoordinate(U,this.terrain)),C=this.getIds();let M=1/0,z=1/0,F=-1/0,V=-1/0;for(const U of k)M=Math.min(M,U.x),z=Math.min(z,U.y),F=Math.max(F,U.x),V=Math.max(V,U.y);for(let U=0;U<C.length;U++){const H=this._tiles[C[U]];if(H.holdingForFade())continue;const J=H.tileID,Q=Math.pow(2,p.zoom-H.tileID.overscaledZ),te=s*H.queryPadding*d.X/H.tileSize/Q,q=[J.getTilePoint(new d.Z(M,z)),J.getTilePoint(new d.Z(F,V))];if(q[0].x-te<d.X&&q[0].y-te<d.X&&q[1].x+te>=0&&q[1].y+te>=0){const ae=S.map(fe=>J.getTilePoint(fe)),ce=k.map(fe=>J.getTilePoint(fe));c.push({tile:H,tileID:J,queryGeometry:ae,cameraQueryGeometry:ce,scale:Q})}}return c}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of s)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Wn(this._source.type)){const e=X.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,u){this._state.updateState(e=e||"_geojsonTileLayer",s,u)}removeFeatureState(e,s,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,u)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,u){const c=this._tiles[e];c&&c.setDependencies(s,u)}reloadTilesForDependencies(e,s){for(const u in this._tiles)this._tiles[u].hasDependency(e,s)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,s))}}function rn(f,e){const s=Math.abs(2*f.wrap)-+(f.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||u-s||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function Wn(f){return f==="raster"||f==="image"||f==="video"}st.maxOverzooming=10,st.maxUnderzooming=3;class dt{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let s=1,u=this._distances[s];const c=e*this.paddedLength+this.padding;for(;u<c&&s<this._distances.length;)u=this._distances[++s];const p=s-1,x=this._distances[p],S=u-x,k=S>0?(c-x)/S:0;return this.points[p].mult(1-k).add(this.points[s].mult(k))}}function xr(f,e){let s=!0;return f==="always"||f!=="never"&&e!=="never"||(s=!1),s}class Fr{constructor(e,s,u){const c=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(s/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)c.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,u,c,p){this._forEachCell(s,u,c,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(p)}insertCircle(e,s,u,c){this._forEachCell(s-c,u-c,s+c,u+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(u),this.circles.push(c)}_insertBoxCell(e,s,u,c,p,x){this.boxCells[p].push(x)}_insertCircleCell(e,s,u,c,p,x){this.circleCells[p].push(x)}_query(e,s,u,c,p,x,S){if(u<0||e>this.width||c<0||s>this.height)return[];const k=[];if(e<=0&&s<=0&&this.width<=u&&this.height<=c){if(p)return[{key:null,x1:e,y1:s,x2:u,y2:c}];for(let C=0;C<this.boxKeys.length;C++)k.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const M=this.circles[3*C],z=this.circles[3*C+1],F=this.circles[3*C+2];k.push({key:this.circleKeys[C],x1:M-F,y1:z-F,x2:M+F,y2:z+F})}}else this._forEachCell(e,s,u,c,this._queryCell,k,{hitTest:p,overlapMode:x,seenUids:{box:{},circle:{}}},S);return k}query(e,s,u,c){return this._query(e,s,u,c,!1,null)}hitTest(e,s,u,c,p,x){return this._query(e,s,u,c,!0,p,x).length>0}hitTestCircle(e,s,u,c,p){const x=e-u,S=e+u,k=s-u,C=s+u;if(S<0||x>this.width||C<0||k>this.height)return!1;const M=[];return this._forEachCell(x,k,S,C,this._queryCellCircle,M,{hitTest:!0,overlapMode:c,circle:{x:e,y:s,radius:u},seenUids:{box:{},circle:{}}},p),M.length>0}_queryCell(e,s,u,c,p,x,S,k){const{seenUids:C,hitTest:M,overlapMode:z}=S,F=this.boxCells[p];if(F!==null){const U=this.bboxes;for(const H of F)if(!C.box[H]){C.box[H]=!0;const J=4*H,Q=this.boxKeys[H];if(e<=U[J+2]&&s<=U[J+3]&&u>=U[J+0]&&c>=U[J+1]&&(!k||k(Q))&&(!M||!xr(z,Q.overlapMode))&&(x.push({key:Q,x1:U[J],y1:U[J+1],x2:U[J+2],y2:U[J+3]}),M))return!0}}const V=this.circleCells[p];if(V!==null){const U=this.circles;for(const H of V)if(!C.circle[H]){C.circle[H]=!0;const J=3*H,Q=this.circleKeys[H];if(this._circleAndRectCollide(U[J],U[J+1],U[J+2],e,s,u,c)&&(!k||k(Q))&&(!M||!xr(z,Q.overlapMode))){const te=U[J],q=U[J+1],ae=U[J+2];if(x.push({key:Q,x1:te-ae,y1:q-ae,x2:te+ae,y2:q+ae}),M)return!0}}}return!1}_queryCellCircle(e,s,u,c,p,x,S,k){const{circle:C,seenUids:M,overlapMode:z}=S,F=this.boxCells[p];if(F!==null){const U=this.bboxes;for(const H of F)if(!M.box[H]){M.box[H]=!0;const J=4*H,Q=this.boxKeys[H];if(this._circleAndRectCollide(C.x,C.y,C.radius,U[J+0],U[J+1],U[J+2],U[J+3])&&(!k||k(Q))&&!xr(z,Q.overlapMode))return x.push(!0),!0}}const V=this.circleCells[p];if(V!==null){const U=this.circles;for(const H of V)if(!M.circle[H]){M.circle[H]=!0;const J=3*H,Q=this.circleKeys[H];if(this._circlesCollide(U[J],U[J+1],U[J+2],C.x,C.y,C.radius)&&(!k||k(Q))&&!xr(z,Q.overlapMode))return x.push(!0),!0}}}_forEachCell(e,s,u,c,p,x,S,k){const C=this._convertToXCellCoord(e),M=this._convertToYCellCoord(s),z=this._convertToXCellCoord(u),F=this._convertToYCellCoord(c);for(let V=C;V<=z;V++)for(let U=M;U<=F;U++)if(p.call(this,e,s,u,c,this.xCellCount*U+V,x,S,k))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,u,c,p,x){const S=c-e,k=p-s,C=u+x;return C*C>S*S+k*k}_circleAndRectCollide(e,s,u,c,p,x,S){const k=(x-c)/2,C=Math.abs(e-(c+k));if(C>k+u)return!1;const M=(S-p)/2,z=Math.abs(s-(p+M));if(z>M+u)return!1;if(C<=k||z<=M)return!0;const F=C-k,V=z-M;return F*F+V*V<=u*u}}function eo(f,e,s,u,c){const p=d.H();return e?(d.K(p,p,[1/c,1/c,1]),s||d.ad(p,p,u.angle)):d.L(p,u.labelPlaneMatrix,f),p}function wr(f,e,s,u,c){if(e){const p=d.ae(f);return d.K(p,p,[c,c,1]),s||d.ad(p,p,-u.angle),p}return u.glCoordMatrix}function K(f,e,s,u){let c;u?(c=[f,e,u(f,e),1],d.af(c,c,s)):(c=[f,e,0,1],Ct(c,c,s));const p=c[3];return{point:new d.P(c[0]/p,c[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function L(f,e){return .5+f/e*.5}function D(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function j(f,e,s,u,c,p,x,S,k,C,M,z,F,V,U){const H=u?f.textSizeData:f.iconSizeData,J=d.ag(H,s.transform.zoom),Q=[256/s.width*2+1,256/s.height*2+1],te=u?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;te.clear();const q=f.lineVertexArray,ae=u?f.text.placedSymbolArray:f.icon.placedSymbolArray,ce=s.transform.width/s.transform.height;let fe=!1;for(let we=0;we<ae.length;we++){const Ee=ae.get(we);if(Ee.hidden||Ee.writingMode===d.ah.vertical&&!fe){nt(Ee.numGlyphs,te);continue}fe=!1;const Be=K(Ee.anchorX,Ee.anchorY,e,U);if(!D(Be.point,Q)){nt(Ee.numGlyphs,te);continue}const Ue=L(s.transform.cameraToCenterDistance,Be.signedDistanceFromCamera),De=d.ai(H,J,Ee),Ae=x?De/Ue:De*Ue,Ke={getElevation:U,labelPlaneMatrix:c,lineVertexArray:q,pitchWithMap:x,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:C,tileAnchorPoint:new d.P(Ee.anchorX,Ee.anchorY),unwrappedTileID:M,width:z,height:F,translation:V},ut=le(Ke,Ee,Ae,!1,S,e,p,f.glyphOffsetArray,te,ce,k);fe=ut.useVertical,(ut.notEnoughRoom||fe||ut.needsFlipping&&le(Ke,Ee,Ae,!0,S,e,p,f.glyphOffsetArray,te,ce,k).notEnoughRoom)&&nt(Ee.numGlyphs,te)}u?f.text.dynamicLayoutVertexBuffer.updateData(te):f.icon.dynamicLayoutVertexBuffer.updateData(te)}function G(f,e,s,u,c,p,x,S){const k=p.glyphStartIndex+p.numGlyphs,C=p.lineStartIndex,M=p.lineStartIndex+p.lineLength,z=e.getoffsetX(p.glyphStartIndex),F=e.getoffsetX(k-1),V=ze(f*z,s,u,c,p.segment,C,M,S,x);if(!V)return null;const U=ze(f*F,s,u,c,p.segment,C,M,S,x);return U?S.projectionCache.anyProjectionOccluded?null:{first:V,last:U}:null}function re(f,e,s,u){return f===d.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*u?{useVertical:!0}:(f===d.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function le(f,e,s,u,c,p,x,S,k,C,M){const z=s/24,F=e.lineOffsetX*z,V=e.lineOffsetY*z;let U;if(e.numGlyphs>1){const H=e.glyphStartIndex+e.numGlyphs,J=e.lineStartIndex,Q=e.lineStartIndex+e.lineLength,te=G(z,S,F,V,u,e,M,f);if(!te)return{notEnoughRoom:!0};const q=K(te.first.point.x,te.first.point.y,x,f.getElevation).point,ae=K(te.last.point.x,te.last.point.y,x,f.getElevation).point;if(c&&!u){const ce=re(e.writingMode,q,ae,C);if(ce)return ce}U=[te.first];for(let ce=e.glyphStartIndex+1;ce<H-1;ce++)U.push(ze(z*S.getoffsetX(ce),F,V,u,e.segment,J,Q,f,M));U.push(te.last)}else{if(c&&!u){const J=K(f.tileAnchorPoint.x,f.tileAnchorPoint.y,p,f.getElevation).point,Q=e.lineStartIndex+e.segment+1,te=new d.P(f.lineVertexArray.getx(Q),f.lineVertexArray.gety(Q)),q=K(te.x,te.y,p,f.getElevation),ae=q.signedDistanceFromCamera>0?q.point:function(fe,we,Ee,Be,Ue,De){return de(fe,we,Ee,1,Ue,De)}(f.tileAnchorPoint,te,J,0,p,f),ce=re(e.writingMode,J,ae,C);if(ce)return ce}const H=ze(z*S.getoffsetX(e.glyphStartIndex),F,V,u,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,M);if(!H||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[H]}for(const H of U)d.aj(k,H.point,H.angle);return{}}function de(f,e,s,u,c,p){const x=f.add(f.sub(e)._unit()),S=c!==void 0?K(x.x,x.y,c,p.getElevation).point:ye(x.x,x.y,p).point,k=s.sub(S);return s.add(k._mult(u/k.mag()))}function ee(f,e,s){const u=e.projectionCache;if(u.projections[f])return u.projections[f];const c=new d.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),p=ye(c.x,c.y,e);if(p.signedDistanceFromCamera>0)return u.projections[f]=p.point,u.anyProjectionOccluded=u.anyProjectionOccluded||p.isOccluded,p.point;const x=f-s.direction;return function(S,k,C,M,z){return de(S,k,C,M,void 0,z)}(s.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(x),e.lineVertexArray.gety(x)),c,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function ye(f,e,s){const u=f+s.translation[0],c=e+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(u,c,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=K(u,c,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function Se(f,e,s){return f._unit()._perp()._mult(e*s)}function me(f,e,s,u,c,p,x,S,k){if(S.projectionCache.offsets[f])return S.projectionCache.offsets[f];const C=s.add(e);if(f+k.direction<u||f+k.direction>=c)return S.projectionCache.offsets[f]=C,C;const M=ee(f+k.direction,S,k),z=Se(M.sub(s),x,k.direction),F=s.add(z),V=M.add(z);return S.projectionCache.offsets[f]=d.ak(p,C,F,V)||C,S.projectionCache.offsets[f]}function ze(f,e,s,u,c,p,x,S,k){const C=u?f-e:f+e;let M=C>0?1:-1,z=0;u&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let F,V=M>0?p+c:p+c+1;S.projectionCache.cachedAnchorPoint?F=S.projectionCache.cachedAnchorPoint:(F=ye(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=F);let U,H,J=F,Q=F,te=0,q=0;const ae=Math.abs(C),ce=[];let fe;for(;te+q<=ae;){if(V+=M,V<p||V>=x)return null;te+=q,Q=J,H=U;const Be={absOffsetX:ae,direction:M,distanceFromAnchor:te,previousVertex:Q};if(J=ee(V,S,Be),s===0)ce.push(Q),fe=J.sub(Q);else{let Ue;const De=J.sub(Q);Ue=De.mag()===0?Se(ee(V+M,S,Be).sub(J),s,M):Se(De,s,M),H||(H=Q.add(Ue)),U=me(V,Ue,J,p,x,H,s,S,Be),ce.push(H),fe=U.sub(H)}q=fe.mag()}const we=fe._mult((ae-te)/q)._add(H||Q),Ee=z+Math.atan2(J.y-Q.y,J.x-Q.x);return ce.push(we),{point:we,angle:k?Ee:0,path:ce}}const tt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nt(f,e){for(let s=0;s<f;s++){const u=e.length;e.resize(u+4),e.float32.set(tt,3*u)}}function Ct(f,e,s){const u=e[0],c=e[1];return f[0]=s[0]*u+s[4]*c+s[12],f[1]=s[1]*u+s[5]*c+s[13],f[3]=s[3]*u+s[7]*c+s[15],f}const pt=100;class Pt{constructor(e,s,u=new Fr(e.width+200,e.height+200,25),c=new Fr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=u,this.ignoredGrid=c,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+pt,this.screenBottomBoundary=e.height+pt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,u,c,p,x,S,k,C,M,z){const F=e.anchorPointX+k[0],V=e.anchorPointY+k[1],U=this.projectAndGetPerspectiveRatio(c,F,V,p,M),H=u*U.perspectiveRatio;let J;if(x||S)J=this._projectCollisionBox(e,H,c,p,x,S,k,U,M,z);else{const ce=U.point.x+(z?z.x*H:0),fe=U.point.y+(z?z.y*H:0);J={allPointsOccluded:!1,box:[ce+e.x1*H,fe+e.y1*H,ce+e.x2*H,fe+e.y2*H]}}const[Q,te,q,ae]=J.box;return this.mapProjection.useSpecialProjectionForSymbols&&(x?J.allPointsOccluded:this.mapProjection.isOccluded(F,V,p))||U.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Q,te,q,ae)||s!=="always"&&this.grid.hitTest(Q,te,q,ae,s,C)?{box:[Q,te,q,ae],placeable:!1,offscreen:!1}:{box:[Q,te,q,ae],placeable:!0,offscreen:this.isOffscreen(Q,te,q,ae)}}placeCollisionCircles(e,s,u,c,p,x,S,k,C,M,z,F,V,U,H,J){const Q=[],te=new d.P(s.anchorX,s.anchorY),q=this.getPerspectiveRatio(x,te.x,te.y,S,J),ae=(z?p/q:p*q)/d.ap,ce={getElevation:J,labelPlaneMatrix:k,lineVertexArray:u,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:te,unwrappedTileID:S,width:this.transform.width,height:this.transform.height,translation:H},fe=G(ae,c,s.lineOffsetX*ae,s.lineOffsetY*ae,!1,s,!1,ce);let we=!1,Ee=!1,Be=!0;if(fe){const Ue=.5*V*q+U,De=new d.P(-100,-100),Ae=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ke=new dt,ut=fe.first,Re=fe.last;let Ne=[];for(let ft=ut.path.length-1;ft>=1;ft--)Ne.push(ut.path[ft]);for(let ft=1;ft<Re.path.length;ft++)Ne.push(Re.path[ft]);const at=2.5*Ue;if(C){const ft=this.projectPathToScreenSpace(Ne,ce,C);Ne=ft.some(wt=>wt.signedDistanceFromCamera<=0)?[]:ft.map(wt=>wt.point)}let Wt=[];if(Ne.length>0){const ft=Ne[0].clone(),wt=Ne[0].clone();for(let Xt=1;Xt<Ne.length;Xt++)ft.x=Math.min(ft.x,Ne[Xt].x),ft.y=Math.min(ft.y,Ne[Xt].y),wt.x=Math.max(wt.x,Ne[Xt].x),wt.y=Math.max(wt.y,Ne[Xt].y);Wt=ft.x>=De.x&&wt.x<=Ae.x&&ft.y>=De.y&&wt.y<=Ae.y?[Ne]:wt.x<De.x||ft.x>Ae.x||wt.y<De.y||ft.y>Ae.y?[]:d.al([Ne],De.x,De.y,Ae.x,Ae.y)}for(const ft of Wt){Ke.reset(ft,.25*Ue);let wt=0;wt=Ke.length<=.5*Ue?1:Math.ceil(Ke.paddedLength/at)+1;for(let Xt=0;Xt<wt;Xt++){const Ri=Xt/Math.max(wt-1,1),er=Ke.lerp(Ri),Kt=er.x+pt,an=er.y+pt;Q.push(Kt,an,Ue,0);const Gi=Kt-Ue,Fi=an-Ue,Hi=Kt+Ue,kr=an+Ue;if(Be=Be&&this.isOffscreen(Gi,Fi,Hi,kr),Ee=Ee||this.isInsideGrid(Gi,Fi,Hi,kr),e!=="always"&&this.grid.hitTestCircle(Kt,an,Ue,e,F)&&(we=!0,!M))return{circles:[],offscreen:!1,collisionDetected:we}}}}return{circles:!M&&we||!Ee||q<this.perspectiveRatioCutoff?[]:Q,offscreen:Be,collisionDetected:we}}projectPathToScreenSpace(e,s,u){return e.map(c=>K(c.x,c.y,u,s.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let u=1/0,c=1/0,p=-1/0,x=-1/0;for(const M of e){const z=new d.P(M.x+pt,M.y+pt);u=Math.min(u,z.x),c=Math.min(c,z.y),p=Math.max(p,z.x),x=Math.max(x,z.y),s.push(z)}const S=this.grid.query(u,c,p,x).concat(this.ignoredGrid.query(u,c,p,x)),k={},C={};for(const M of S){const z=M.key;if(k[z.bucketInstanceId]===void 0&&(k[z.bucketInstanceId]={}),k[z.bucketInstanceId][z.featureIndex])continue;const F=[new d.P(M.x1,M.y1),new d.P(M.x2,M.y1),new d.P(M.x2,M.y2),new d.P(M.x1,M.y2)];d.am(s,F)&&(k[z.bucketInstanceId][z.featureIndex]=!0,C[z.bucketInstanceId]===void 0&&(C[z.bucketInstanceId]=[]),C[z.bucketInstanceId].push(z.featureIndex))}return C}insertCollisionBox(e,s,u,c,p,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:x,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,u,c,p,x){const S=u?this.ignoredGrid:this.grid,k={bucketInstanceId:c,featureIndex:p,collisionGroupID:x,overlapMode:s};for(let C=0;C<e.length;C+=4)S.insertCircle(k,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,s,u,c,p){let x;p?(x=[s,u,p(s,u),1],d.af(x,x,e)):(x=[s,u,0,1],Ct(x,x,e));const S=x[3];return{point:new d.P((x[0]/S+1)/2*this.transform.width+pt,(-x[1]/S+1)/2*this.transform.height+pt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}getPerspectiveRatio(e,s,u,c,p){const x=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,u,c,p):K(s,u,e,p);return .5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5}isOffscreen(e,s,u,c){return u<pt||e>=this.screenRightBoundary||c<pt||s>this.screenBottomBoundary}isInsideGrid(e,s,u,c){return u>=0&&e<this.gridRightBoundary&&c>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,u,c,p,x,S,k,C,M){let z=new d.P(1,0),F=new d.P(0,1);const V=new d.P(e.anchorPointX+S[0],e.anchorPointY+S[1]);if(x&&!p){const Be=this.projectAndGetPerspectiveRatio(u,V.x+1,V.y,c,C).point.sub(k.point).unit(),Ue=Math.atan(Be.y/Be.x)+(Be.x<0?Math.PI:0),De=Math.sin(Ue),Ae=Math.cos(Ue);z=new d.P(Ae,De),F=new d.P(-De,Ae)}else if(!x&&p){const Be=-this.transform.angle,Ue=Math.sin(Be),De=Math.cos(Be);z=new d.P(De,Ue),F=new d.P(-Ue,De)}let U=k.point,H=s;if(p){U=V;const Be=this.transform.zoom-Math.floor(this.transform.zoom);H=Math.pow(2,-Be),H*=this.mapProjection.getPitchedTextCorrection(this.transform,V,c),M||(H*=d.ac(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(U=U.add(z.mult(M.x*H)).add(F.mult(M.y*H)));const J=e.x1*H,Q=e.x2*H,te=(J+Q)/2,q=e.y1*H,ae=e.y2*H,ce=(q+ae)/2,fe=[{offsetX:J,offsetY:q},{offsetX:te,offsetY:q},{offsetX:Q,offsetY:q},{offsetX:Q,offsetY:ce},{offsetX:Q,offsetY:ae},{offsetX:te,offsetY:ae},{offsetX:J,offsetY:ae},{offsetX:J,offsetY:ce}];let we=[];for(const{offsetX:Be,offsetY:Ue}of fe)we.push(new d.P(U.x+z.x*Be+F.x*Ue,U.y+z.y*Be+F.y*Ue));let Ee=!1;if(p){const Be=we.map(Ue=>this.projectAndGetPerspectiveRatio(u,Ue.x,Ue.y,c,C));Ee=Be.some(Ue=>!Ue.isOccluded),we=Be.map(Ue=>Ue.point)}else Ee=!0;return{box:d.ao(we),allPointsOccluded:!Ee}}}function xt(f,e,s){return e*(d.X/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class mi{constructor(e,s,u,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):c&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class ti{constructor(e,s,u,c,p){this.text=new mi(e?e.text:null,s,u,p),this.icon=new mi(e?e.icon:null,s,c,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yt{constructor(e,s,u){this.text=e,this.icon=s,this.skipFade=u}}class Ot{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class Jt{constructor(e,s,u,c,p){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=c,this.tileID=p}}class Si{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[e]}}function Ci(f,e,s,u,c){const{horizontalAlign:p,verticalAlign:x}=d.au(f);return new d.P(-(p-.5)*e+u[0]*c,-(x-.5)*s+u[1]*c)}class Zi{constructor(e,s,u,c,p,x){this.transform=e.clone(),this.terrain=u,this.collisionIndex=new Pt(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Si(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(u,c)=>s.getElevation(e,u,c):null}getBucketParts(e,s,u,c){const p=u.getBucket(s),x=u.latestFeatureIndex;if(!p||!x||s.id!==p.layerIds[0])return;const S=u.collisionBoxArray,k=p.layers[0].layout,C=p.layers[0].paint,M=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),z=u.tileSize/d.X,F=u.tileID.toUnwrapped(),V=this.transform.calculatePosMatrix(F),U=k.get("text-pitch-alignment")==="map",H=k.get("text-rotation-alignment")==="map",J=xt(u,1,this.transform.zoom),Q=this.collisionIndex.mapProjection.translatePosition(this.transform,u,C.get("text-translate"),C.get("text-translate-anchor")),te=this.collisionIndex.mapProjection.translatePosition(this.transform,u,C.get("icon-translate"),C.get("icon-translate-anchor")),q=eo(V,U,H,this.transform,J);let ae=null;if(U){const fe=wr(V,U,H,this.transform,J);ae=d.L([],this.transform.labelPlaneMatrix,fe)}this.retainedQueryData[p.bucketInstanceId]=new Jt(p.bucketInstanceId,x,p.sourceLayerIndex,p.index,u.tileID);const ce={bucket:p,layout:k,translationText:Q,translationIcon:te,posMatrix:V,unwrappedTileID:F,textLabelPlaneMatrix:q,labelToScreenMatrix:ae,scale:M,textPixelRatio:z,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:d.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(c)for(const fe of p.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Ee,symbolInstanceEnd:Be}=fe;e.push({sortKey:we,symbolInstanceStart:Ee,symbolInstanceEnd:Be,parameters:ce})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(e,s,u,c,p,x,S,k,C,M,z,F,V,U,H,J,Q,te,q){const ae=d.aq[e.textAnchor],ce=[e.textOffset0,e.textOffset1],fe=Ci(ae,u,c,ce,p),we=this.collisionIndex.placeCollisionBox(s,F,k,C,M,S,x,J,z.predicate,q,fe);if((!te||this.collisionIndex.placeCollisionBox(te,F,k,C,M,S,x,Q,z.predicate,q,fe).placeable)&&we.placeable){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:ce,width:u,height:c,anchor:ae,textBoxScale:p,prevAnchor:Ee},this.markUsedJustification(U,ae,V,H),U.allowVerticalPlacement&&(this.markUsedOrientation(U,H,V),this.placedOrientations[V.crossTileID]=H),{shift:fe,placedGlyphBoxes:we}}}placeLayerBucketPart(e,s,u){const{bucket:c,layout:p,translationText:x,translationIcon:S,posMatrix:k,unwrappedTileID:C,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:F,holdingForFade:V,collisionBoxArray:U,partiallyEvaluatedTextSize:H,collisionGroup:J}=e.parameters,Q=p.get("text-optional"),te=p.get("icon-optional"),q=d.ar(p,"text-overlap","text-allow-overlap"),ae=q==="always",ce=d.ar(p,"icon-overlap","icon-allow-overlap"),fe=ce==="always",we=p.get("text-rotation-alignment")==="map",Ee=p.get("text-pitch-alignment")==="map",Be=p.get("icon-text-fit")!=="none",Ue=p.get("symbol-z-order")==="viewport-y",De=ae&&(fe||!c.hasIconData()||te),Ae=fe&&(ae||!c.hasTextData()||Q);!c.collisionArrays&&U&&c.deserializeCollisionBoxes(U);const Ke=this._getTerrainElevationFunc(this.retainedQueryData[c.bucketInstanceId].tileID),ut=(Re,Ne,at)=>{var Wt,ft;if(s[Re.crossTileID])return;if(V)return void(this.placements[Re.crossTileID]=new yt(!1,!1,!1));let wt=!1,Xt=!1,Ri=!0,er=null,Kt={box:null,placeable:!1,offscreen:null},an={box:null,placeable:!1,offscreen:null},Gi=null,Fi=null,Hi=null,kr=0,_s=0,Sl=0;Ne.textFeatureIndex?kr=Ne.textFeatureIndex:Re.useRuntimeCollisionCircles&&(kr=Re.featureIndex),Ne.verticalTextFeatureIndex&&(_s=Ne.verticalTextFeatureIndex);const ys=Ne.textBox;if(ys){const Fn=Pi=>{let Bi=d.ah.horizontal;if(c.allowVerticalPlacement&&!Pi&&this.prevPlacement){const Sn=this.prevPlacement.placedOrientations[Re.crossTileID];Sn&&(this.placedOrientations[Re.crossTileID]=Sn,Bi=Sn,this.markUsedOrientation(c,Bi,Re))}return Bi},Bn=(Pi,Bi)=>{if(c.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&Ne.verticalTextBox){for(const Sn of c.writingModes)if(Sn===d.ah.vertical?(Kt=Bi(),an=Kt):Kt=Pi(),Kt&&Kt.placeable)break}else Kt=Pi()},no=Re.textAnchorOffsetStartIndex,tr=Re.textAnchorOffsetEndIndex;if(tr===no){const Pi=(Bi,Sn)=>{const Tt=this.collisionIndex.placeCollisionBox(Bi,q,F,k,C,Ee,we,x,J.predicate,Ke);return Tt&&Tt.placeable&&(this.markUsedOrientation(c,Sn,Re),this.placedOrientations[Re.crossTileID]=Sn),Tt};Bn(()=>Pi(ys,d.ah.horizontal),()=>{const Bi=Ne.verticalTextBox;return c.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&Bi?Pi(Bi,d.ah.vertical):{box:null,offscreen:null}}),Fn(Kt&&Kt.placeable)}else{let Pi=d.aq[(ft=(Wt=this.prevPlacement)===null||Wt===void 0?void 0:Wt.variableOffsets[Re.crossTileID])===null||ft===void 0?void 0:ft.anchor];const Bi=(Tt,zo,vs)=>{const xs=Tt.x2-Tt.x1,Qh=Tt.y2-Tt.y1,bf=Re.textBoxScale,ed=Be&&ce==="never"?zo:null;let ro=null,td=q==="never"?1:2,kl="never";Pi&&td++;for(let va=0;va<td;va++){for(let Il=no;Il<tr;Il++){const El=c.textAnchorOffsets.get(Il);if(Pi&&El.textAnchor!==Pi)continue;const ws=this.attemptAnchorPlacement(El,Tt,xs,Qh,bf,we,Ee,F,k,C,J,kl,Re,c,vs,x,S,ed,Ke);if(ws&&(ro=ws.placedGlyphBoxes,ro&&ro.placeable))return wt=!0,er=ws.shift,ro}Pi?Pi=null:kl=q}return u&&!ro&&(ro={box:this.collisionIndex.placeCollisionBox(ys,"always",F,k,C,Ee,we,x,J.predicate,Ke,new d.P(0,0)).box,offscreen:!1,placeable:!1}),ro};Bn(()=>Bi(ys,Ne.iconBox,d.ah.horizontal),()=>{const Tt=Ne.verticalTextBox;return c.allowVerticalPlacement&&(!Kt||!Kt.placeable)&&Re.numVerticalGlyphVertices>0&&Tt?Bi(Tt,Ne.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Kt&&(wt=Kt.placeable,Ri=Kt.offscreen);const Sn=Fn(Kt&&Kt.placeable);if(!wt&&this.prevPlacement){const Tt=this.prevPlacement.variableOffsets[Re.crossTileID];Tt&&(this.variableOffsets[Re.crossTileID]=Tt,this.markUsedJustification(c,Tt.anchor,Re,Sn))}}}if(Gi=Kt,wt=Gi&&Gi.placeable,Ri=Gi&&Gi.offscreen,Re.useRuntimeCollisionCircles){const Fn=c.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex),Bn=d.ai(c.textSizeData,H,Fn),no=p.get("text-padding");Fi=this.collisionIndex.placeCollisionCircles(q,Fn,c.lineVertexArray,c.glyphOffsetArray,Bn,k,C,M,z,u,Ee,J.predicate,Re.collisionCircleDiameter,no,x,Ke),Fi.circles.length&&Fi.collisionDetected&&!u&&d.w("Collisions detected, but collision boxes are not shown"),wt=ae||Fi.circles.length>0&&!Fi.collisionDetected,Ri=Ri&&Fi.offscreen}if(Ne.iconFeatureIndex&&(Sl=Ne.iconFeatureIndex),Ne.iconBox){const Fn=Bn=>this.collisionIndex.placeCollisionBox(Bn,ce,F,k,C,Ee,we,S,J.predicate,Ke,Be&&er?er:void 0);an&&an.placeable&&Ne.verticalIconBox?(Hi=Fn(Ne.verticalIconBox),Xt=Hi.placeable):(Hi=Fn(Ne.iconBox),Xt=Hi.placeable),Ri=Ri&&Hi.offscreen}const Rn=Q||Re.numHorizontalGlyphVertices===0&&Re.numVerticalGlyphVertices===0,Tl=te||Re.numIconVertices===0;Rn||Tl?Tl?Rn||(Xt=Xt&&wt):wt=Xt&&wt:Xt=wt=Xt&&wt;const oc=Xt&&Hi.placeable;if(wt&&Gi.placeable&&this.collisionIndex.insertCollisionBox(Gi.box,q,p.get("text-ignore-placement"),c.bucketInstanceId,an&&an.placeable&&_s?_s:kr,J.ID),oc&&this.collisionIndex.insertCollisionBox(Hi.box,ce,p.get("icon-ignore-placement"),c.bucketInstanceId,Sl,J.ID),Fi&&wt&&this.collisionIndex.insertCollisionCircles(Fi.circles,q,p.get("text-ignore-placement"),c.bucketInstanceId,kr,J.ID),u&&this.storeCollisionData(c.bucketInstanceId,at,Ne,Gi,Hi,Fi),Re.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Re.crossTileID]=new yt(wt||De,Xt||Ae,Ri||c.justReloaded),s[Re.crossTileID]=!0};if(Ue){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Re=c.getSortedSymbolIndexes(this.transform.angle);for(let Ne=Re.length-1;Ne>=0;--Ne){const at=Re[Ne];ut(c.symbolInstances.get(at),c.collisionArrays[at],at)}}else for(let Re=e.symbolInstanceStart;Re<e.symbolInstanceEnd;Re++)ut(c.symbolInstances.get(Re),c.collisionArrays[Re],Re);if(u&&c.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[c.bucketInstanceId];d.as(Re.invProjMatrix,k),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}storeCollisionData(e,s,u,c,p,x){if(u.textBox||u.iconBox){let S,k;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(s)?k=S.get(s):(k={text:null,icon:null},S.set(s,k)),u.textBox&&(k.text=c.box),u.iconBox&&(k.icon=p.box)}if(x){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=new Ot);for(let k=0;k<x.circles.length;k+=4)S.circles.push(x.circles[k+0]),S.circles.push(x.circles[k+1]),S.circles.push(x.circles[k+2]),S.circles.push(x.collisionDetected?1:0)}}markUsedJustification(e,s,u,c){let p;p=c===d.ah.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[d.at(s)];const x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of x)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=p>=0&&S!==p?0:u.crossTileID)}markUsedOrientation(e,s,u){const c=s===d.ah.horizontal||s===d.ah.horizontalOnly?s:0,p=s===d.ah.vertical?s:0,x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of x)e.text.placedSymbolArray.get(S).placedOrientation=c;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const c=s?s.symbolFadeChange(e):1,p=s?s.opacities:{},x=s?s.variableOffsets:{},S=s?s.placedOrientations:{};for(const k in this.placements){const C=this.placements[k],M=p[k];M?(this.opacities[k]=new ti(M,c,C.text,C.icon),u=u||C.text!==M.text.placed||C.icon!==M.icon.placed):(this.opacities[k]=new ti(null,c,C.text,C.icon,C.skipFade),u=u||C.text||C.icon)}for(const k in p){const C=p[k];if(!this.opacities[k]){const M=new ti(C,c,!1,!1);M.isHidden()||(this.opacities[k]=M,u=u||C.text.placed||C.icon.placed)}}for(const k in x)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=x[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const u={};for(const c of s){const p=c.getBucket(e);p&&c.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,c.tileID,u,c.collisionBoxArray)}}updateBucketOpacities(e,s,u,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],x=p.layout,S=new ti(null,0,!1,!1,!0),k=x.get("text-allow-overlap"),C=x.get("icon-allow-overlap"),M=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=x.get("text-rotation-alignment")==="map",F=x.get("text-pitch-alignment")==="map",V=x.get("icon-text-fit")!=="none",U=new ti(null,0,k&&(C||!e.hasIconData()||x.get("icon-optional")),C&&(k||!e.hasTextData()||x.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const H=(Q,te,q)=>{for(let ae=0;ae<te/4;ae++)Q.opacityVertexArray.emplaceBack(q);Q.hasVisibleVertices=Q.hasVisibleVertices||q!==Ko},J=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Q=0;Q<e.symbolInstances.length;Q++){const te=e.symbolInstances.get(Q),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:ae,crossTileID:ce}=te;let fe=this.opacities[ce];u[ce]?fe=S:fe||(fe=U,this.opacities[ce]=fe),u[ce]=!0;const we=te.numIconVertices>0,Ee=this.placedOrientations[te.crossTileID],Be=Ee===d.ah.vertical,Ue=Ee===d.ah.horizontal||Ee===d.ah.horizontalOnly;if(q>0||ae>0){const Ae=xn(fe.text);H(e.text,q,Be?Ko:Ae),H(e.text,ae,Ue?Ko:Ae);const Ke=fe.text.isHidden();[te.rightJustifiedTextSymbolIndex,te.centerJustifiedTextSymbolIndex,te.leftJustifiedTextSymbolIndex].forEach(Ne=>{Ne>=0&&(e.text.placedSymbolArray.get(Ne).hidden=Ke||Be?1:0)}),te.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(te.verticalPlacedTextSymbolIndex).hidden=Ke||Ue?1:0);const ut=this.variableOffsets[te.crossTileID];ut&&this.markUsedJustification(e,ut.anchor,te,Ee);const Re=this.placedOrientations[te.crossTileID];Re&&(this.markUsedJustification(e,"left",te,Re),this.markUsedOrientation(e,Re,te))}if(we){const Ae=xn(fe.icon),Ke=!(V&&te.verticalPlacedIconSymbolIndex&&Be);te.placedIconSymbolIndex>=0&&(H(e.icon,te.numIconVertices,Ke?Ae:Ko),e.icon.placedSymbolArray.get(te.placedIconSymbolIndex).hidden=fe.icon.isHidden()),te.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,te.numVerticalIconVertices,Ke?Ko:Ae),e.icon.placedSymbolArray.get(te.verticalPlacedIconSymbolIndex).hidden=fe.icon.isHidden())}const De=J&&J.has(Q)?J.get(Q):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ae=e.collisionArrays[Q];if(Ae){let Ke=new d.P(0,0);if(Ae.textBox||Ae.verticalTextBox){let ut=!0;if(M){const Re=this.variableOffsets[ce];Re?(Ke=Ci(Re.anchor,Re.width,Re.height,Re.textOffset,Re.textBoxScale),z&&Ke._rotate(F?this.transform.angle:-this.transform.angle)):ut=!1}if(Ae.textBox||Ae.verticalTextBox){let Re;Ae.textBox&&(Re=Be),Ae.verticalTextBox&&(Re=Ue),Xo(e.textCollisionBox.collisionVertexArray,fe.text.placed,!ut||Re,De.text,Ke.x,Ke.y)}}if(Ae.iconBox||Ae.verticalIconBox){const ut=!!(!Ue&&Ae.verticalIconBox);let Re;Ae.iconBox&&(Re=ut),Ae.verticalIconBox&&(Re=!ut),Xo(e.iconCollisionBox.collisionVertexArray,fe.icon.placed,Re,De.icon,V?Ke.x:0,V?Ke.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=Q.invProjMatrix,e.placementViewportMatrix=Q.viewportMatrix,e.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function Xo(f,e,s,u,c,p){u&&u.length!==0||(u=[0,0,0,0]);const x=u[0]-pt,S=u[1]-pt,k=u[2]-pt,C=u[3]-pt;f.emplaceBack(e?1:0,s?1:0,c||0,p||0,x,S),f.emplaceBack(e?1:0,s?1:0,c||0,p||0,k,S),f.emplaceBack(e?1:0,s?1:0,c||0,p||0,k,C),f.emplaceBack(e?1:0,s?1:0,c||0,p||0,x,C)}const Nt=Math.pow(2,25),gu=Math.pow(2,24),_u=Math.pow(2,17),yn=Math.pow(2,16),vn=Math.pow(2,9),Xp=Math.pow(2,8),zn=Math.pow(2,1);function xn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Nt+e*gu+s*_u+e*yn+s*vn+e*Xp+s*zn+e}const Ko=0;function vo(){return{isOccluded:(f,e,s)=>!1,getPitchedTextCorrection:(f,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,s,u){throw new Error("Not implemented.")},translatePosition:(f,e,s,u)=>function(c,p,x,S,k=!1){if(!x[0]&&!x[1])return[0,0];const C=k?S==="map"?c.angle:0:S==="viewport"?-c.angle:0;if(C){const M=Math.sin(C),z=Math.cos(C);x=[x[0]*z-x[1]*M,x[0]*M+x[1]*z]}return[k?x[0]:xt(p,x[0],c.zoom),k?x[1]:xt(p,x[1],c.zoom)]}(f,e,s,u),getCircleRadiusCorrection:f=>1}}class gi{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,u,c,p){const x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(x,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((S,k)=>S.sortKey-k.sortKey));this._currentPartIndex<x.length;)if(s.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,p())return!0;return!1}}class ta{constructor(e,s,u,c,p,x,S,k){this.placement=new Zi(e,vo(),s,x,S,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,s,u){const c=X.now(),p=()=>!this._forceFullPlacement&&X.now()-c>2;for(;this._currentPlacementIndex>=0;){const x=s[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new gi(x)),this._inProgressLayer.continuePlacement(u[x.source],this.placement,this._showCollisionBoxes,x,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Xn=512/d.X/2;class ci{constructor(e,s,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const c=new Map;for(let p=0;p<s.length;p++){const x=s.get(p),S=x.key,k=c.get(S);k?k.push(x):c.set(S,[x])}for(const[p,x]of c){const S={positions:x.map(k=>({x:Math.floor(k.anchorX*Xn),y:Math.floor(k.anchorY*Xn)})),crossTileIDs:x.map(k=>k.crossTileID)};if(S.positions.length>128){const k=new d.av(S.positions.length,16,Uint16Array);for(const{x:C,y:M}of S.positions)k.add(C,M);k.finish(),delete S.positions,S.index=k}this._symbolsByKey[p]=S}}getScaledCoordinates(e,s){const{x:u,y:c,z:p}=this.tileID.canonical,{x,y:S,z:k}=s.canonical,C=Xn/Math.pow(2,k-p),M=(S*d.X+e.anchorY)*C,z=c*d.X*Xn;return{x:Math.floor((x*d.X+e.anchorX)*C-u*d.X*Xn),y:Math.floor(M-z)}}findMatches(e,s,u){const c=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<e.length;p++){const x=e.get(p);if(x.crossTileID)continue;const S=this._symbolsByKey[x.key];if(!S)continue;const k=this.getScaledCoordinates(x,s);if(S.index){const C=S.index.range(k.x-c,k.y-c,k.x+c,k.y+c).sort();for(const M of C){const z=S.crossTileIDs[M];if(!u[z]){u[z]=!0,x.crossTileID=z;break}}}else if(S.positions)for(let C=0;C<S.positions.length;C++){const M=S.positions[C],z=S.crossTileIDs[C];if(Math.abs(M.x-k.x)<=c&&Math.abs(M.y-k.y)<=c&&!u[z]){u[z]=!0,x.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ga{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const u in this.indexes){const c=this.indexes[u],p={};for(const x in c){const S=c[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+s),p[S.tileID.key]=S}this.indexes[u]=p}this.lng=e}addBucket(e,s,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const x=this.indexes[p];if(Number(p)>e.overscaledZ)for(const S in x){const k=x[S];k.tileID.isChildOf(e)&&k.findMatches(s.symbolInstances,e,c)}else{const S=x[e.scaledTo(Number(p)).key];S&&S.findMatches(s.symbolInstances,e,c)}}for(let p=0;p<s.symbolInstances.length;p++){const x=s.symbolInstances.get(p);x.crossTileID||(x.crossTileID=u.generate(),c[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new ci(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const u of s.getCrossTileIDsLists())for(const c of u)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let s=!1;for(const u in this.indexes){const c=this.indexes[u];for(const p in c)e[c[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,c[p]),delete c[p],s=!0)}return s}}class yu{constructor(){this.layerIndexes={},this.crossTileIDs=new Ga,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,u){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new Kn);let p=!1;const x={};c.handleWrapJump(u);for(const S of s){const k=S.getBucket(e);k&&e.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(S.tileID,k,this.crossTileIDs)&&(p=!0),x[k.bucketInstanceId]=!0)}return c.removeStaleBuckets(x)&&(p=!0),p}pruneUnusedLayers(e){const s={};e.forEach(u=>{s[u]=!0});for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}const Yn=(f,e)=>d.t(f,e&&e.filter(s=>s.identifier!=="source.canvas")),Kp=d.aw();class Ha extends d.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const c=this.sourceCaches[u].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new _o(go(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(u,c)=>this.getGlyphs(u,c)),this.dispatcher.registerMessageHandler("GI",(u,c)=>this.getImages(u,c)),this.imageManager=new oi,this.imageManager.setEventedParent(this),this.glyphManager=new en(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Gn(256,512),this.crossTileSymbolIndex=new yu,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),vr().on(Ce,this._rtlPluginLoaded),this.on("data",u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const c=this.sourceCaches[u.sourceId];if(!c)return;const p=c.getSource();if(p&&p.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===p.id&&this._validateLayer(S)}})}loadURL(e,s={},u){this.fire(new d.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;d.h(c,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,s,u)}).catch(x=>{this._loadStyleRequest=null,x&&!p.signal.aborted&&this.fire(new d.j(x))})}loadJSON(e,s={},u){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,X.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,u)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(Kp,{validate:!1})}_load(e,s,u){var c;const p=s.transformStyle?s.transformStyle(u,e):e;if(!s.validate||!Yn(this,d.u(p))){this._loaded=!0,this.stylesheet=p;for(const x in p.sources)this.addSource(x,p.sources[x],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new ht(this.stylesheet.light),this.sky=new Bt(this.stylesheet.sky),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const u=d.aA(s);u.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=u}}_loadSprite(e,s=!1,u=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,x,S,k){return d._(this,void 0,void 0,function*(){const C=Et(p),M=S>1?"@2x":"",z={},F={};for(const{id:V,url:U}of C){const H=x.transformRequest(mt(U,M,".json"),"SpriteJSON");z[V]=d.h(H,k);const J=x.transformRequest(mt(U,M,".png"),"SpriteImage");F[V]=se.getImage(J,k)}return yield Promise.all([...Object.values(z),...Object.values(F)]),function(V,U){return d._(this,void 0,void 0,function*(){const H={};for(const J in V){H[J]={};const Q=X.getImageCanvasContext((yield U[J]).data),te=(yield V[J]).data;for(const q in te){const{width:ae,height:ce,x:fe,y:we,sdf:Ee,pixelRatio:Be,stretchX:Ue,stretchY:De,content:Ae,textFitWidth:Ke,textFitHeight:ut}=te[q];H[J][q]={data:null,pixelRatio:Be,sdf:Ee,stretchX:Ue,stretchY:De,content:Ae,textFitWidth:Ke,textFitHeight:ut,spriteData:{width:ae,height:ce,x:fe,y:we,context:Q}}}}return H})}(z,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const x in p){this._spritesImagesIds[x]=[];const S=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(k=>!(k in p)):[];for(const k of S)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in p[x]){const C=x==="default"?k:`${x}:${k}`;this._spritesImagesIds[x].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,p[x][k],!1):this.imageManager.addImage(C,p[x][k]),s&&(this._changedImages[C]=!0)}}}).catch(p=>{this._spriteRequest=null,c=p,this.fire(new d.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),u&&u(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const u=e.sourceLayer;if(!u)return;const c=s.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(u)===-1)&&this.fire(new d.j(new Error(`Source layer "${u}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?d.aB(u):u);const c=[];for(const p of e)if(u[p]){const x=s?d.aB(u[p]):u[p];c.push(x)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const u of s){const c=this._layers[u];c.type!=="custom"&&(e[u]=c.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const c=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(c.length||p.length)&&this._updateWorkerLayers(c,p);for(const x in this._updatedSources){const S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const c in this.sourceCaches){const p=this.sourceCaches[c];u[c]=p.used,p.used=!1}for(const c of this._order){const p=this._layers[c];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const c in u){const p=this.sourceCaches[c];!!u[c]!=!!p.used&&p.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var u;this._checkLoaded();const c=this.serialize();if(e=s.transformStyle?s.transformStyle(c,e):e,((u=s.validate)===null||u===void 0||u)&&Yn(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const p=d.aC(c,e),x=this._getOperationsToPerform(p);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const S of x.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],u=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":s.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":s.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,c.args));break;case"setSky":s.push(()=>this.setSky.apply(this,c.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":s.push(()=>{});break;default:u.push(c.command)}return{operations:s,unimplemented:u}}addImage(e,s){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(d.u.source,`sources.${e}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const c=this.sourceCaches[e]=new st(e,s,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,u={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new d.j(new Error(`Layer "${c}" already exists on this map.`)));let p;if(e.type==="custom"){if(Yn(this,d.aD(e)))return;p=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=d.aB(e),e=d.e(e,{source:c})),this._validate(d.u.layer,`layers.${c}`,e,{arrayIndex:-1},u))return;p=d.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:c}})}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)this.fire(new d.j(new Error(`Cannot add layer "${c}" before non-existing layer "${s}".`)));else{if(this._order.splice(x,0,c),this._layerOrderChanged=!0,this._layers[c]=p,this._removedLayers[c]&&p.source&&p.type!=="custom"){const S=this._removedLayers[c];delete this._removedLayers[c],S.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const u=this._order.indexOf(e);this._order.splice(u,1);const c=s?this._order.indexOf(s):this._order.length;s&&c===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,u){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===s&&c.maxzoom===u||(s!=null&&(c.minzoom=s),u!=null&&(c.maxzoom=u),this._updateLayer(c)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,u={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!d.aE(c.filter,s))return s==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(d.u.filter,`layers.${c.id}.filter`,s,null,u)||(c.filter=d.aB(s),this._updateLayer(c)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,u,c={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getLayoutProperty(s),u)||(p.setLayoutProperty(s,u,c),this._updateLayer(p)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const u=this.getLayer(e);if(u)return u.getLayoutProperty(s);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,u,c={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getPaintProperty(s),u)||(p.setPaintProperty(s,u,c)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const u=e.source,c=e.sourceLayer,p=this.sourceCaches[u];if(p===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const x=p.getSource().type;x==="geojson"&&c?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||c?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(c,e.id,s)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const u=e.source,c=this.sourceCaches[u];if(c===void 0)return void this.fire(new d.j(new Error(`The source '${u}' does not exist in the map's style.`)));const p=c.getSource().type,x=p==="vector"?e.sourceLayer:void 0;p!=="vector"||x?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(x,e.id,s):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,u=e.sourceLayer,c=this.sourceCaches[s];if(c!==void 0)return c.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(u,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,p=>p.serialize()),s=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,c=this.stylesheet;return d.aG({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:e,layers:s,terrain:u},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=x=>this._layers[x].type==="fill-extrusion",u={},c=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(s(S)){u[S]=x;for(const k of e){const C=k[S];if(C)for(const M of C)c.push(M)}}}c.sort((x,S)=>S.intersectionZ-x.intersectionZ);const p=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(s(S))for(let k=c.length-1;k>=0;k--){const C=c[k].feature;if(u[C.layer.id]<x)break;p.push(C),c.pop()}else for(const k of e){const C=k[S];if(C)for(const M of C)p.push(M.feature)}}return p}queryRenderedFeatures(e,s,u){s&&s.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const c={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const S of s.layers){const k=this._layers[S];if(!k)return this.fire(new d.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];c[k.source]=!0}}const p=[];s.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const S in this.sourceCaches)s.layers&&!c[S]||p.push(Kr(this.sourceCaches[S],this._layers,x,e,s,u));return this.placement&&p.push(function(S,k,C,M,z,F,V){const U={},H=F.queryRenderedSymbols(M),J=[];for(const Q of Object.keys(H).map(Number))J.push(V[Q]);J.sort(Yr);for(const Q of J){const te=Q.featureIndex.lookupSymbolFeatures(H[Q.bucketInstanceId],k,Q.bucketIndex,Q.sourceLayerIndex,z.filter,z.layers,z.availableImages,S);for(const q in te){const ae=U[q]=U[q]||[],ce=te[q];ce.sort((fe,we)=>{const Ee=Q.featureSortOrder;if(Ee){const Be=Ee.indexOf(fe.featureIndex);return Ee.indexOf(we.featureIndex)-Be}return we.featureIndex-fe.featureIndex});for(const fe of ce)ae.push(fe)}}for(const Q in U)U[Q].forEach(te=>{const q=te.feature,ae=C[S[Q].source].getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=ae});return U}(this._layers,x,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,s){s&&s.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",s.filter,null,s);const u=this.sourceCaches[e];return u?function(c,p){const x=c.getRenderableIds().map(C=>c.getTileByID(C)),S=[],k={};for(let C=0;C<x.length;C++){const M=x[C],z=M.tileID.canonical.key;k[z]||(k[z]=!0,M.querySourceFeatures(S,p))}return S}(u,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const u=this.light.getLight();let c=!1;for(const x in e)if(!d.aE(e[x],u[x])){c=!0;break}if(!c)return;const p={now:X.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const u=this.getSky();let c=!1;if(!e&&!u)return;if(e&&!u)c=!0;else if(!e&&u)c=!0;else for(const x in e)if(!d.aE(e[x],u[x])){c=!0;break}if(!c)return;const p={now:X.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(p)}_validate(e,s,u,c,p={}){return(!p||p.validate!==!1)&&Yn(this,e.call(d.u,d.e({key:s,style:this.serialize(),value:u,styleSpec:d.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),vr().off(Ce,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const u=this.sourceCaches[s];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,u,c,p=!1){let x=!1,S=!1;const k={};for(const C of this._order){const M=this._layers[C];if(M.type!=="symbol")continue;if(!k[M.source]){const F=this.sourceCaches[M.source];k[M.source]=F.getRenderableIds(!0).map(V=>F.getTileByID(V)).sort((V,U)=>U.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(U.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,k[M.source],e.center.lng);x=x||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(X.now(),e.zoom))&&(this.pauseablePlacement=new ta(e,this.map.terrain,this._order,p,s,u,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(X.now()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(const C of this._order){const M=this._layers[C];M.type==="symbol"&&this.placement.updateLayerOpacities(M,k[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(X.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return d._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[s.source];return c&&c.setDependencies(s.tileID.key,s.type,s.icons),u})}getGlyphs(e,s){return d._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(s.stacks),c=this.sourceCaches[s.source];return c&&c.setDependencies(s.tileID.key,s.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,u={},c){this._checkLoaded();const p=[{id:e,url:s}],x=[...Et(this.stylesheet.sprite),...p];this._validate(d.u.sprite,"sprite",x,null,u)||(this.stylesheet.sprite=x,this._loadSprite(p,!0,c))}removeSprite(e){this._checkLoaded();const s=Et(this.stylesheet.sprite);if(s.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;s.splice(s.findIndex(u=>u.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Et(this.stylesheet.sprite)}setSprite(e,s={},u){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var xo=d.Y([{name:"a_pos",type:"Int16",components:2}]);const to={prelude:Lt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Lt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Lt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Lt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Lt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Lt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Lt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Lt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Lt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Lt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Lt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Lt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Lt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Lt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Lt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Lt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Lt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Lt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Lt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Lt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Lt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Lt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Lt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Lt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Lt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Lt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Lt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Lt(f,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/attribute ([\w]+) ([\w]+)/g),c=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=p?p.concat(c):c,S={};return{fragmentSource:f=f.replace(s,(k,C,M,z,F)=>(S[F]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${M} ${z} ${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(s,(k,C,M,z,F)=>{const V=z==="float"?"vec2":"vec4",U=F.match(/color/)?"color":V;return S[F]?C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${V} a_${F};
varying ${M} ${z} ${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${U}(a_${F}, u_${F}_t);
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${M} ${V} a_${F};
#else
uniform ${M} ${z} u_${F};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = a_${F};
#else
    ${M} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${M} ${z} ${F} = unpack_mix_${U}(a_${F}, u_${F}_t);
#else
    ${M} ${z} ${F} = u_${F};
#endif
`}),staticAttributes:u,staticUniforms:x}}class vu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,u,c,p,x,S,k,C){this.context=e;let M=this.boundPaintVertexBuffers.length!==c.length;for(let z=0;!M&&z<c.length;z++)this.boundPaintVertexBuffers[z]!==c[z]&&(M=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||M||this.boundIndexBuffer!==p||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==C?this.freshBind(s,u,c,p,x,S,k,C):(e.bindVertexArray.set(this.vao),S&&S.bind(),p&&p.dynamicDraw&&p.bind(),k&&k.bind(),C&&C.bind())}freshBind(e,s,u,c,p,x,S,k){const C=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=c,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=k,s.enableAttributes(z,e);for(const F of u)F.enableAttributes(z,e);x&&x.enableAttributes(z,e),S&&S.enableAttributes(z,e),k&&k.enableAttributes(z,e),s.bind(),s.setVertexAttribPointers(z,e,p);for(const F of u)F.bind(),F.setVertexAttribPointers(z,e,p);x&&(x.bind(),x.setVertexAttribPointers(z,e,p)),c&&c.bind(),S&&(S.bind(),S.setVertexAttribPointers(z,e,p)),k&&(k.bind(),k.setVertexAttribPointers(z,e,p)),M.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const xu=(f,e,s,u,c)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:u?u.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:u?u.calculateFogBlendOpacity(c):0,u_horizon_color:u?u.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1});function Yo(f){const e=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const u=f[s].split(" ");e.push(u.pop())}return e}class wu{constructor(e,s,u,c,p,x){const S=e.gl;this.program=S.createProgram();const k=Yo(s.staticAttributes),C=u?u.getBinderAttributes():[],M=k.concat(C),z=to.prelude.staticUniforms?Yo(to.prelude.staticUniforms):[],F=s.staticUniforms?Yo(s.staticUniforms):[],V=u?u.getBinderUniforms():[],U=z.concat(F).concat(V),H=[];for(const fe of U)H.indexOf(fe)<0&&H.push(fe);const J=u?u.defines():[];p&&J.push("#define OVERDRAW_INSPECTOR;"),x&&J.push("#define TERRAIN3D;");const Q=J.concat(to.prelude.fragmentSource,s.fragmentSource).join(`
`),te=J.concat(to.prelude.vertexSource,s.vertexSource).join(`
`),q=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(q,Q),S.compileShader(q),!S.getShaderParameter(q,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(q)}`);S.attachShader(this.program,q);const ae=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(ae,te),S.compileShader(ae),!S.getShaderParameter(ae,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(ae)}`);S.attachShader(this.program,ae),this.attributes={};const ce={};this.numAttributes=M.length;for(let fe=0;fe<this.numAttributes;fe++)M[fe]&&(S.bindAttribLocation(this.program,fe,M[fe]),this.attributes[M[fe]]=fe);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(ae),S.deleteShader(q);for(let fe=0;fe<H.length;fe++){const we=H[fe];if(we&&!ce[we]){const Ee=S.getUniformLocation(this.program,we);Ee&&(ce[we]=Ee)}}this.fixedUniforms=c(e,ce),this.terrainUniforms=((fe,we)=>({u_depth:new d.aH(fe,we.u_depth),u_terrain:new d.aH(fe,we.u_terrain),u_terrain_dim:new d.aI(fe,we.u_terrain_dim),u_terrain_matrix:new d.aJ(fe,we.u_terrain_matrix),u_terrain_unpack:new d.aK(fe,we.u_terrain_unpack),u_terrain_exaggeration:new d.aI(fe,we.u_terrain_exaggeration)}))(e,ce),this.binderUniforms=u?u.getUniforms(e,ce):[]}draw(e,s,u,c,p,x,S,k,C,M,z,F,V,U,H,J,Q,te){const q=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(c),e.setColorMode(p),e.setCullFace(x),k){e.activeTexture.set(q.TEXTURE2),q.bindTexture(q.TEXTURE_2D,k.depthTexture),e.activeTexture.set(q.TEXTURE3),q.bindTexture(q.TEXTURE_2D,k.texture);for(const ce in this.terrainUniforms)this.terrainUniforms[ce].set(k[ce])}for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(S[ce]);H&&H.setUniforms(e,this.binderUniforms,V,{zoom:U});let ae=0;switch(s){case q.LINES:ae=2;break;case q.TRIANGLES:ae=3;break;case q.LINE_STRIP:ae=1}for(const ce of F.get()){const fe=ce.vaos||(ce.vaos={});(fe[C]||(fe[C]=new vu)).bind(e,this,M,H?H.getPaintVertexBuffers():[],z,ce.vertexOffset,J,Q,te),q.drawElements(s,ce.primitiveLength*ae,q.UNSIGNED_SHORT,ce.primitiveOffset*ae*2)}}}function Wa(f,e,s){const u=1/xt(s,1,e.transform.tileZoom),c=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,e.transform.tileZoom)/c,x=p*(s.tileID.canonical.x+s.tileID.wrap*c),S=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[u,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const ia=(f,e,s,u)=>{const c=e.style.light,p=c.properties.get("position"),x=[p.x,p.y,p.z],S=function(){var C=new d.A(9);return d.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();c.properties.get("anchor")==="viewport"&&function(C,M){var z=Math.sin(M),F=Math.cos(M);C[0]=F,C[1]=z,C[2]=0,C[3]=-z,C[4]=F,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(S,-e.transform.angle),function(C,M,z){var F=M[0],V=M[1],U=M[2];C[0]=F*z[0]+V*z[3]+U*z[6],C[1]=F*z[1]+V*z[4]+U*z[7],C[2]=F*z[2]+V*z[5]+U*z[8]}(x,x,S);const k=c.properties.get("color");return{u_matrix:f,u_lightpos:x,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+s,u_opacity:u}},Xa=(f,e,s,u,c,p,x)=>d.e(ia(f,e,s,u),Wa(p,e,x),{u_height_factor:-Math.pow(2,c.overscaledZ)/x.tileSize/8}),Jo=f=>({u_matrix:f}),xh=(f,e,s,u)=>d.e(Jo(f),Wa(s,e,u)),Yp=(f,e)=>({u_matrix:f,u_world:e}),wh=(f,e,s,u,c)=>d.e(xh(f,e,s,u),{u_world:c}),Jp=(f,e,s,u)=>{const c=f.transform;let p,x;if(u.paint.get("circle-pitch-alignment")==="map"){const S=xt(s,1,c.zoom);p=!0,x=[S,S]}else p=!1,x=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,s,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:x}},wo=(f,e,s)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),na=(f,e,s=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:s}),on=f=>({u_matrix:f}),sn=(f,e,s,u)=>({u_matrix:f,u_extrude_scale:xt(e,1,s),u_intensity:u}),Ka=(f,e,s,u)=>{const c=d.H();d.aP(c,0,f.width,f.height,0,0,1);const p=f.context.gl;return{u_matrix:c,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}};function Ya(f,e){const s=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new d.Z(0,u/s).toLngLat().lat,new d.Z(0,(u+1)/s).toLngLat().lat]}const Ja=(f,e,s,u)=>{const c=f.transform;return{u_matrix:Th(f,e,s,u),u_ratio:1/xt(e,1,c.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},bh=(f,e,s,u,c)=>d.e(Ja(f,e,s,c),{u_image:0,u_image_height:u}),Qo=(f,e,s,u,c)=>{const p=f.transform,x=Sh(e,p);return{u_matrix:Th(f,e,s,c),u_texsize:e.imageAtlasTexture.size,u_ratio:1/xt(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[x,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Qp=(f,e,s,u,c,p)=>{const x=f.lineAtlas,S=Sh(e,f.transform),k=s.layout.get("line-cap")==="round",C=x.getDash(u.from,k),M=x.getDash(u.to,k),z=C.width*c.fromScale,F=M.width*c.toScale;return d.e(Ja(f,e,s,p),{u_patternscale_a:[S/z,-C.height/2],u_patternscale_b:[S/F,-M.height/2],u_sdfgamma:x.width/(256*Math.min(z,F)*f.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:M.y,u_mix:c.t})};function Sh(f,e){return 1/xt(f,1,e.tileZoom)}function Th(f,e,s,u){return f.translatePosMatrix(u?u.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const ef=(f,e,s,u,c)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(x=c.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(p=c.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:tf(c.paint.get("raster-hue-rotate"))};var p,x};function tf(f){f*=Math.PI/180;const e=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const kh=(f,e,s,u,c,p,x,S,k,C,M,z,F,V)=>{const U=x.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:U.cameraToCenterDistance,u_pitch:U.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:U.width/U.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:k,u_coord_matrix:C,u_is_text:+z,u_pitch_with_map:+u,u_is_along_line:c,u_is_variable_anchor:p,u_texsize:F,u_texture:0,u_translation:M,u_pitched_scale:V}},ra=(f,e,s,u,c,p,x,S,k,C,M,z,F,V,U)=>{const H=x.transform;return d.e(kh(f,e,s,u,c,p,x,S,k,C,M,z,F,U),{u_gamma_scale:u?Math.cos(H._pitch)*H.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:+V})},bu=(f,e,s,u,c,p,x,S,k,C,M,z,F,V)=>d.e(ra(f,e,s,u,c,p,x,S,k,C,M,!0,z,!0,V),{u_texsize_icon:F,u_texture_icon:1}),Qa=(f,e,s)=>({u_matrix:f,u_opacity:e,u_color:s}),Su=(f,e,s,u,c,p)=>d.e(function(x,S,k,C){const M=k.imageManager.getPattern(x.from.toString()),z=k.imageManager.getPattern(x.to.toString()),{width:F,height:V}=k.imageManager.getPixelSize(),U=Math.pow(2,C.tileID.overscaledZ),H=C.tileSize*Math.pow(2,k.transform.tileZoom)/U,J=H*(C.tileID.canonical.x+C.tileID.wrap*U),Q=H*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[F,V],u_mix:S.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/xt(C,1,k.transform.tileZoom),u_pixel_coord_upper:[J>>16,Q>>16],u_pixel_coord_lower:[65535&J,65535&Q]}}(u,p,s,c),{u_matrix:f,u_opacity:e}),Tu={fillExtrusion:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_opacity:new d.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_height_factor:new d.aI(f,e.u_height_factor),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade),u_opacity:new d.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(f,e.u_scale_with_map),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_extrude_scale:new d.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_matrix:new d.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_pixel_extrude_scale:new d.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_inv_matrix:new d.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_viewport_size:new d.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new d.aL(f,e.u_color),u_matrix:new d.aJ(f,e.u_matrix),u_overlay:new d.aH(f,e.u_overlay),u_overlay_scale:new d.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new d.aI(f,e.u_extrude_scale),u_intensity:new d.aI(f,e.u_intensity),u_matrix:new d.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_color_ramp:new d.aH(f,e.u_color_ramp),u_opacity:new d.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_latrange:new d.aO(f,e.u_latrange),u_light:new d.aO(f,e.u_light),u_shadow:new d.aL(f,e.u_shadow),u_highlight:new d.aL(f,e.u_highlight),u_accent:new d.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_dimension:new d.aO(f,e.u_dimension),u_zoom:new d.aI(f,e.u_zoom),u_unpack:new d.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_image:new d.aH(f,e.u_image),u_image_height:new d.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texsize:new d.aO(f,e.u_texsize),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_image:new d.aH(f,e.u_image),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_patternscale_a:new d.aO(f,e.u_patternscale_a),u_patternscale_b:new d.aO(f,e.u_patternscale_b),u_sdfgamma:new d.aI(f,e.u_sdfgamma),u_image:new d.aH(f,e.u_image),u_tex_y_a:new d.aI(f,e.u_tex_y_a),u_tex_y_b:new d.aI(f,e.u_tex_y_b),u_mix:new d.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_tl_parent:new d.aO(f,e.u_tl_parent),u_scale_parent:new d.aI(f,e.u_scale_parent),u_buffer_scale:new d.aI(f,e.u_buffer_scale),u_fade_t:new d.aI(f,e.u_fade_t),u_opacity:new d.aI(f,e.u_opacity),u_image0:new d.aH(f,e.u_image0),u_image1:new d.aH(f,e.u_image1),u_brightness_low:new d.aI(f,e.u_brightness_low),u_brightness_high:new d.aI(f,e.u_brightness_high),u_saturation_factor:new d.aI(f,e.u_saturation_factor),u_contrast_factor:new d.aI(f,e.u_contrast_factor),u_spin_weights:new d.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texsize_icon:new d.aO(f,e.u_texsize_icon),u_texture:new d.aH(f,e.u_texture),u_texture_icon:new d.aH(f,e.u_texture_icon),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_color:new d.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_image:new d.aH(f,e.u_image),u_pattern_tl_a:new d.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(f,e.u_pattern_br_b),u_texsize:new d.aO(f,e.u_texsize),u_mix:new d.aI(f,e.u_mix),u_pattern_size_a:new d.aO(f,e.u_pattern_size_a),u_pattern_size_b:new d.aO(f,e.u_pattern_size_b),u_scale_a:new d.aI(f,e.u_scale_a),u_scale_b:new d.aI(f,e.u_scale_b),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_ele_delta:new d.aI(f,e.u_ele_delta),u_fog_matrix:new d.aJ(f,e.u_fog_matrix),u_fog_color:new d.aL(f,e.u_fog_color),u_fog_ground_blend:new d.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon_fog_blend:new d.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ele_delta:new d.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_terrain_coords_id:new d.aI(f,e.u_terrain_coords_id),u_ele_delta:new d.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new d.aL(f,e.u_sky_color),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon:new d.aI(f,e.u_horizon),u_sky_horizon_blend:new d.aI(f,e.u_sky_horizon_blend)})};class br{constructor(e,s,u){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const nf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ku{constructor(e,s,u,c){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=c,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let u=0;u<this.attributes.length;u++){const c=s.attributes[this.attributes[u].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,s,u){for(let c=0;c<this.attributes.length;c++){const p=this.attributes[c],x=s.attributes[p.name];x!==void 0&&e.vertexAttribPointer(x,p.components,e[nf[p.type]],!1,this.itemSize,p.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bo=new WeakMap;function io(f){var e;if(bo.has(f))return bo.get(f);{const s=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return bo.set(f,s),s}}class Rt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class el extends Rt{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class rf extends Rt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class es extends Rt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class of extends Rt{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ih extends Rt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class sf extends Rt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Eh extends Rt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Iu extends Rt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Ch extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Ph extends Rt{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Mh extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class zh extends Rt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class So extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class Ah extends Rt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class af extends Rt{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Dh extends Rt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class oa extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class lf extends Rt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class tl extends Rt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class uf extends Rt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class cf extends Rt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Lh extends Rt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Rh extends Rt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Fh extends Rt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Eu extends Rt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Bh extends Rt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class il extends Rt{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Br extends Rt{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const u=this.gl;io(u)?u.bindVertexArray(e):(s=u.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Cu extends Rt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Pu extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Mu extends Rt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class nl extends Rt{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class zu extends nl{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class To extends nl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Au extends nl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class hf{constructor(e,s,u,c,p){this.context=e,this.width=s,this.height=u;const x=e.gl,S=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new zu(e,S),c)this.depthAttachment=p?new Au(e,S):new To(e,S);else if(p)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class si{constructor(e,s,u){this.blendFunction=e,this.blendColor=s,this.mask=u}}si.Replace=[1,0],si.disabled=new si(si.Replace,d.aM.transparent,[!1,!1,!1,!1]),si.unblended=new si(si.Replace,d.aM.transparent,[!0,!0,!0,!0]),si.alphaBlended=new si([1,771],d.aM.transparent,[!0,!0,!0,!0]);class df{constructor(e){var s,u;if(this.gl=e,this.clearColor=new el(this),this.clearDepth=new rf(this),this.clearStencil=new es(this),this.colorMask=new of(this),this.depthMask=new Ih(this),this.stencilMask=new sf(this),this.stencilFunc=new Eh(this),this.stencilOp=new Iu(this),this.stencilTest=new Ch(this),this.depthRange=new Ph(this),this.depthTest=new Mh(this),this.depthFunc=new zh(this),this.blend=new So(this),this.blendFunc=new Ah(this),this.blendColor=new af(this),this.blendEquation=new Dh(this),this.cullFace=new oa(this),this.cullFaceSide=new lf(this),this.frontFace=new tl(this),this.program=new uf(this),this.activeTexture=new cf(this),this.viewport=new Lh(this),this.bindFramebuffer=new Rh(this),this.bindRenderbuffer=new Fh(this),this.bindTexture=new Eu(this),this.bindVertexBuffer=new Bh(this),this.bindElementBuffer=new il(this),this.bindVertexArray=new Br(this),this.pixelStoreUnpack=new Cu(this),this.pixelStoreUnpackPremultiplyAlpha=new Pu(this),this.pixelStoreUnpackFlipY=new Mu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),io(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new br(this,e,s)}createVertexBuffer(e,s,u){return new ku(this,e,s,u)}createRenderbuffer(e,s,u){const c=this.gl,p=c.createRenderbuffer();return this.bindRenderbuffer.set(p),c.renderbufferStorage(c.RENDERBUFFER,e,s,u),this.bindRenderbuffer.set(null),p}createFramebuffer(e,s,u,c){return new hf(this,e,s,u,c)}clear({color:e,depth:s,stencil:u}){const c=this.gl;let p=0;e&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(p|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),c.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return io(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return io(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class vt{constructor(e,s,u){this.func=e,this.mask=s,this.range=u}}vt.ReadOnly=!1,vt.ReadWrite=!0,vt.disabled=new vt(519,vt.ReadOnly,[0,1]);const rl=7680;class qt{constructor(e,s,u,c,p,x){this.test=e,this.ref=s,this.mask=u,this.fail=c,this.depthFail=p,this.pass=x}}qt.disabled=new qt({func:519,mask:0},0,0,rl,rl,rl);class Vt{constructor(e,s,u){this.enable=e,this.mode=s,this.frontFace=u}}let ko;function sa(f,e,s,u,c){const p=f.context,x=p.gl,S=f.useProgram("collisionBox"),k=[];let C=0,M=0;for(let Q=0;Q<u.length;Q++){const te=u[Q],q=e.getTile(te).getBucket(s);if(!q)continue;const ae=c?q.textCollisionBox:q.iconCollisionBox,ce=q.collisionCircleArray;if(ce.length>0){const fe=d.H();d.aQ(fe,q.placementInvProjMatrix,f.transform.glCoordMatrix),d.aQ(fe,fe,q.placementViewportMatrix),k.push({circleArray:ce,circleOffset:M,transform:te.posMatrix,invTransform:fe,coord:te}),C+=ce.length/4,M=C}ae&&S.draw(p,x.LINES,vt.disabled,qt.disabled,f.colorModeForRenderPass(),Vt.disabled,{u_matrix:te.posMatrix,u_pixel_extrude_scale:[1/(z=f.transform).width,1/z.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(te),s.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,null,f.transform.zoom,null,null,ae.collisionVertexBuffer)}var z;if(!c||!k.length)return;const F=f.useProgram("collisionCircle"),V=new d.aR;V.resize(4*C),V._trim();let U=0;for(const Q of k)for(let te=0;te<Q.circleArray.length/4;te++){const q=4*te,ae=Q.circleArray[q+0],ce=Q.circleArray[q+1],fe=Q.circleArray[q+2],we=Q.circleArray[q+3];V.emplace(U++,ae,ce,fe,we,0),V.emplace(U++,ae,ce,fe,we,1),V.emplace(U++,ae,ce,fe,we,2),V.emplace(U++,ae,ce,fe,we,3)}(!ko||ko.length<2*C)&&(ko=function(Q){const te=2*Q,q=new d.aT;q.resize(te),q._trim();for(let ae=0;ae<te;ae++){const ce=6*ae;q.uint16[ce+0]=4*ae+0,q.uint16[ce+1]=4*ae+1,q.uint16[ce+2]=4*ae+2,q.uint16[ce+3]=4*ae+2,q.uint16[ce+4]=4*ae+3,q.uint16[ce+5]=4*ae+0}return q}(C));const H=p.createIndexBuffer(ko,!0),J=p.createVertexBuffer(V,d.aS.members,!0);for(const Q of k){const te=wo(Q.transform,Q.invTransform,f.transform);F.draw(p,x.TRIANGLES,vt.disabled,qt.disabled,f.colorModeForRenderPass(),Vt.disabled,te,f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q.coord),s.id,J,H,d.a0.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,f.transform.zoom,null,null,null)}J.destroy(),H.destroy()}Vt.disabled=new Vt(!1,1029,2305),Vt.backCCW=new Vt(!0,1029,2305);const aa=d.an(new Float32Array(16));function Du(f,e,s,u,c,p){const{horizontalAlign:x,verticalAlign:S}=d.au(f);return new d.P((-(x-.5)*e/c+u[0])*p,(-(S-.5)*s/c+u[1])*p)}function Io(f,e,s,u,c,p){const x=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=u.mult(p);s||(S=S.rotate(-c));const k=x.add(S);return K(k.x,k.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const S=ye(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),k=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return f.add(u.rotate(k))}return f.add(u)}function ts(f,e,s,u,c,p,x,S,k,C,M,z,F,V){const U=f.text.placedSymbolArray,H=f.text.dynamicLayoutVertexArray,J=f.icon.dynamicLayoutVertexArray,Q={};H.clear();for(let te=0;te<U.length;te++){const q=U.get(te),ae=q.hidden||!q.crossTileID||f.allowVerticalPlacement&&!q.placedOrientation?null:u[q.crossTileID];if(ae){const ce=new d.P(q.anchorX,q.anchorY),fe={getElevation:V,width:c.width,height:c.height,labelPlaneMatrix:p,lineVertexArray:null,pitchWithMap:s,projection:M,projectionCache:null,tileAnchorPoint:ce,translation:z,unwrappedTileID:F},we=s?K(ce.x,ce.y,x,V):ye(ce.x,ce.y,fe),Ee=L(c.cameraToCenterDistance,we.signedDistanceFromCamera);let Be=d.ai(f.textSizeData,k,q)*Ee/d.ap;s&&(Be*=f.tilePixelRatio/S);const{width:Ue,height:De,anchor:Ae,textOffset:Ke,textBoxScale:ut}=ae,Re=Du(Ae,Ue,De,Ke,ut,Be),Ne=M.getPitchedTextCorrection(c,ce.add(new d.P(z[0],z[1])),F),at=Io(we.point,fe,e,Re,c.angle,Ne),Wt=f.allowVerticalPlacement&&q.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let ft=0;ft<q.numGlyphs;ft++)d.aj(H,at,Wt);C&&q.associatedIconIndex>=0&&(Q[q.associatedIconIndex]={shiftedAnchor:at,angle:Wt})}else nt(q.numGlyphs,H)}if(C){J.clear();const te=f.icon.placedSymbolArray;for(let q=0;q<te.length;q++){const ae=te.get(q);if(ae.hidden)nt(ae.numGlyphs,J);else{const ce=Q[q];if(ce)for(let fe=0;fe<ae.numGlyphs;fe++)d.aj(J,ce.shiftedAnchor,ce.angle);else nt(ae.numGlyphs,J)}}f.icon.dynamicLayoutVertexBuffer.updateData(J)}f.text.dynamicLayoutVertexBuffer.updateData(H)}function An(f,e,s){return s.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Lu(f,e,s,u,c,p,x,S,k,C,M,z){const F=f.context,V=F.gl,U=f.transform,H=vo(),J=S==="map",Q=k==="map",te=S!=="viewport"&&s.layout.get("symbol-placement")!=="point",q=J&&!Q&&!te,ae=!Q&&te,ce=!s.layout.get("symbol-sort-key").isConstant();let fe=!1;const we=f.depthModeForSublayer(0,vt.ReadOnly),Ee=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Be=[],Ue=H.getCircleRadiusCorrection(U);for(const De of u){const Ae=e.getTile(De),Ke=Ae.getBucket(s);if(!Ke)continue;const ut=c?Ke.text:Ke.icon;if(!ut||!ut.segments.get().length||!ut.hasVisibleVertices)continue;const Re=ut.programConfigurations.get(s.id),Ne=c||Ke.sdfIcons,at=c?Ke.textSizeData:Ke.iconSizeData,Wt=Q||U.pitch!==0,ft=f.useProgram(An(Ne,c,Ke),Re),wt=d.ag(at,U.zoom),Xt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(De);let Ri,er,Kt,an,Gi=[0,0],Fi=null;if(c)er=Ae.glyphAtlasTexture,Kt=V.LINEAR,Ri=Ae.glyphAtlasTexture.size,Ke.iconsInText&&(Gi=Ae.imageAtlasTexture.size,Fi=Ae.imageAtlasTexture,an=Wt||f.options.rotating||f.options.zooming||at.kind==="composite"||at.kind==="camera"?V.LINEAR:V.NEAREST);else{const Tt=s.layout.get("icon-size").constantOr(0)!==1||Ke.iconsNeedLinear;er=Ae.imageAtlasTexture,Kt=Ne||f.options.rotating||f.options.zooming||Tt||Wt?V.LINEAR:V.NEAREST,Ri=Ae.imageAtlasTexture.size}const Hi=xt(Ae,1,f.transform.zoom),kr=ae?De.posMatrix:aa,_s=eo(kr,Q,J,f.transform,Hi),Sl=wr(kr,Q,J,f.transform,Hi),ys=wr(De.posMatrix,Q,J,f.transform,Hi),Rn=H.translatePosition(f.transform,Ae,p,x),Tl=Ee&&Ke.hasTextData(),oc=s.layout.get("icon-text-fit")!=="none"&&Tl&&Ke.hasIconData();if(te){const Tt=f.style.map.terrain?(vs,xs)=>f.style.map.terrain.getElevation(De,vs,xs):null,zo=s.layout.get("text-rotation-alignment")==="map";j(Ke,De.posMatrix,f,c,_s,ys,Q,C,zo,H,De.toUnwrapped(),U.width,U.height,Rn,Tt)}const Fn=De.posMatrix,Bn=c&&Ee||oc,no=te||Bn?aa:_s,tr=Sl,Pi=Ne&&s.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Bi;Bi=Ne?Ke.iconsInText?bu(at.kind,wt,q,Q,te,Bn,f,Fn,no,tr,Rn,Ri,Gi,Ue):ra(at.kind,wt,q,Q,te,Bn,f,Fn,no,tr,Rn,c,Ri,!0,Ue):kh(at.kind,wt,q,Q,te,Bn,f,Fn,no,tr,Rn,c,Ri,Ue);const Sn={program:ft,buffers:ut,uniformValues:Bi,atlasTexture:er,atlasTextureIcon:Fi,atlasInterpolation:Kt,atlasInterpolationIcon:an,isSDF:Ne,hasHalo:Pi};if(ce&&Ke.canOverlap){fe=!0;const Tt=ut.segments.get();for(const zo of Tt)Be.push({segments:new d.a0([zo]),sortKey:zo.sortKey,state:Sn,terrainData:Xt})}else Be.push({segments:ut.segments,sortKey:0,state:Sn,terrainData:Xt})}fe&&Be.sort((De,Ae)=>De.sortKey-Ae.sortKey);for(const De of Be){const Ae=De.state;if(F.activeTexture.set(V.TEXTURE0),Ae.atlasTexture.bind(Ae.atlasInterpolation,V.CLAMP_TO_EDGE),Ae.atlasTextureIcon&&(F.activeTexture.set(V.TEXTURE1),Ae.atlasTextureIcon&&Ae.atlasTextureIcon.bind(Ae.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Ae.isSDF){const Ke=Ae.uniformValues;Ae.hasHalo&&(Ke.u_is_halo=1,Ru(Ae.buffers,De.segments,s,f,Ae.program,we,M,z,Ke,De.terrainData)),Ke.u_is_halo=0}Ru(Ae.buffers,De.segments,s,f,Ae.program,we,M,z,Ae.uniformValues,De.terrainData)}}function Ru(f,e,s,u,c,p,x,S,k,C){const M=u.context;c.draw(M,M.gl.TRIANGLES,p,x,S,Vt.disabled,k,C,s.id,f.layoutVertexBuffer,f.indexBuffer,e,s.paint,u.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Fu(f,e,s,u){const c=f.context,p=c.gl,x=qt.disabled,S=new si([p.ONE,p.ONE],d.aM.transparent,[!0,!0,!0,!0]),k=e.getBucket(s);if(!k)return;const C=u.key;let M=s.heatmapFbos.get(C);M||(M=la(c,e.tileSize,e.tileSize),s.heatmapFbos.set(C,M)),c.bindFramebuffer.set(M.framebuffer),c.viewport.set([0,0,e.tileSize,e.tileSize]),c.clear({color:d.aM.transparent});const z=k.programConfigurations.get(s.id),F=f.useProgram("heatmap",z),V=f.style.map.terrain.getTerrainData(u);F.draw(c,p.TRIANGLES,vt.disabled,x,S,Vt.disabled,sn(u.posMatrix,e,f.transform.zoom,s.paint.get("heatmap-intensity")),V,s.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,s.paint,f.transform.zoom,z)}function Eo(f,e,s){const u=f.context,c=u.gl;u.setColorMode(f.colorModeForRenderPass());const p=ua(u,e),x=s.key,S=e.heatmapFbos.get(x);S&&(u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,S.colorAttachment.get()),u.activeTexture.set(c.TEXTURE1),p.bind(c.LINEAR,c.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(u,c.TRIANGLES,vt.disabled,qt.disabled,f.colorModeForRenderPass(),Vt.disabled,Ka(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),S.destroy(),e.heatmapFbos.delete(x))}function la(f,e,s){var u,c;const p=f.gl,x=p.createTexture();p.bindTexture(p.TEXTURE_2D,x),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const S=(u=f.HALF_FLOAT)!==null&&u!==void 0?u:p.UNSIGNED_BYTE,k=(c=f.RGBA16F)!==null&&c!==void 0?c:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,k,e,s,0,p.RGBA,S,null);const C=f.createFramebuffer(e,s,!1,!1);return C.colorAttachment.set(x),C}function ua(f,e){return e.colorRampTexture||(e.colorRampTexture=new gt(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function is(f,e,s,u,c){if(!s||!u||!u.imageAtlas)return;const p=u.imageAtlas.patternPositions;let x=p[s.to.toString()],S=p[s.from.toString()];if(!x&&S&&(x=S),!S&&x&&(S=x),!x||!S){const k=c.getPaintProperty(e);x=p[k],S=p[k]}x&&S&&f.setConstantPatternPositions(x,S)}function ca(f,e,s,u,c,p,x){const S=f.context.gl,k="fill-pattern",C=s.paint.get(k),M=C&&C.constantOr(1),z=s.getCrossfadeParameters();let F,V,U,H,J;x?(V=M&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=S.LINES):(V=M?"fillPattern":"fill",F=S.TRIANGLES);const Q=C.constantOr(null);for(const te of u){const q=e.getTile(te);if(M&&!q.patternsLoaded())continue;const ae=q.getBucket(s);if(!ae)continue;const ce=ae.programConfigurations.get(s.id),fe=f.useProgram(V,ce),we=f.style.map.terrain&&f.style.map.terrain.getTerrainData(te);M&&(f.context.activeTexture.set(S.TEXTURE0),q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ce.updatePaintBuffers(z)),is(ce,k,Q,q,s);const Ee=we?te:null,Be=f.translatePosMatrix(Ee?Ee.posMatrix:te.posMatrix,q,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(x){H=ae.indexBuffer2,J=ae.segments2;const Ue=[S.drawingBufferWidth,S.drawingBufferHeight];U=V==="fillOutlinePattern"&&M?wh(Be,f,z,q,Ue):Yp(Be,Ue)}else H=ae.indexBuffer,J=ae.segments,U=M?xh(Be,f,z,q):Jo(Be);fe.draw(f.context,F,c,f.stencilModeForClipping(te),p,Vt.disabled,U,we,s.id,ae.layoutVertexBuffer,H,J,s.paint,f.transform.zoom,ce)}}function ol(f,e,s,u,c,p,x){const S=f.context,k=S.gl,C="fill-extrusion-pattern",M=s.paint.get(C),z=M.constantOr(1),F=s.getCrossfadeParameters(),V=s.paint.get("fill-extrusion-opacity"),U=M.constantOr(null);for(const H of u){const J=e.getTile(H),Q=J.getBucket(s);if(!Q)continue;const te=f.style.map.terrain&&f.style.map.terrain.getTerrainData(H),q=Q.programConfigurations.get(s.id),ae=f.useProgram(z?"fillExtrusionPattern":"fillExtrusion",q);z&&(f.context.activeTexture.set(k.TEXTURE0),J.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),q.updatePaintBuffers(F)),is(q,C,U,J,s);const ce=f.translatePosMatrix(H.posMatrix,J,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),fe=s.paint.get("fill-extrusion-vertical-gradient"),we=z?Xa(ce,f,fe,V,H,F,J):ia(ce,f,fe,V);ae.draw(S,S.gl.TRIANGLES,c,p,x,Vt.backCCW,we,te,s.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,s.paint,f.transform.zoom,q,f.style.map.terrain&&Q.centroidVertexBuffer)}}function ns(f,e,s,u,c,p,x){const S=f.context,k=S.gl,C=s.fbo;if(!C)return;const M=f.useProgram("hillshade"),z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,C.colorAttachment.get()),M.draw(S,k.TRIANGLES,c,p,x,Vt.disabled,((F,V,U,H)=>{const J=U.paint.get("hillshade-shadow-color"),Q=U.paint.get("hillshade-highlight-color"),te=U.paint.get("hillshade-accent-color");let q=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(q-=F.transform.angle);const ae=!F.options.moving;return{u_matrix:H?H.posMatrix:F.transform.calculatePosMatrix(V.tileID.toUnwrapped(),ae),u_image:0,u_latrange:Ya(0,V.tileID),u_light:[U.paint.get("hillshade-exaggeration"),q],u_shadow:J,u_highlight:Q,u_accent:te}})(f,s,u,z?e:null),z,u.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function rs(f,e,s,u,c,p){const x=f.context,S=x.gl,k=e.dem;if(k&&k.data){const C=k.dim,M=k.stride,z=k.getPixels();if(x.activeTexture.set(S.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(M),e.demTexture){const V=e.demTexture;V.update(z,{premultiply:!1}),V.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else e.demTexture=new gt(x,z,S.RGBA,{premultiply:!1}),e.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);x.activeTexture.set(S.TEXTURE0);let F=e.fbo;if(!F){const V=new gt(x,{width:C,height:C,data:null},S.RGBA);V.bind(S.LINEAR,S.CLAMP_TO_EDGE),F=e.fbo=x.createFramebuffer(C,C,!0,!1),F.colorAttachment.set(V.texture)}x.bindFramebuffer.set(F.framebuffer),x.viewport.set([0,0,C,C]),f.useProgram("hillshadePrepare").draw(x,S.TRIANGLES,u,c,p,Vt.disabled,((V,U)=>{const H=U.stride,J=d.H();return d.aP(J,0,d.X,-d.X,0,0,1),d.J(J,J,[0,-d.X,0]),{u_matrix:J,u_image:1,u_dimension:[H,H],u_zoom:V.overscaledZ,u_unpack:U.getUnpackVector()}})(e.tileID,k),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Oh(f,e,s,u,c,p){const x=u.paint.get("raster-fade-duration");if(!p&&x>0){const S=X.now(),k=(S-f.timeAdded)/x,C=e?(S-e.timeAdded)/x:-1,M=s.getSource(),z=c.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),V=F&&f.refreshedUponExpiration?1:d.ac(F?k:1-C,0,1);return f.refreshedUponExpiration&&k>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}const Bu=new d.aM(1,0,0,1),zt=new d.aM(0,1,0,1),sl=new d.aM(0,0,1,1),pf=new d.aM(1,0,1,1),Nh=new d.aM(0,1,1,1);function os(f,e,s,u){al(f,0,e+s/2,f.transform.width,s,u)}function Vh(f,e,s,u){al(f,e-s/2,0,s,f.transform.height,u)}function al(f,e,s,u,c,p){const x=f.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*f.pixelRatio,s*f.pixelRatio,u*f.pixelRatio,c*f.pixelRatio),x.clear({color:p}),S.disable(S.SCISSOR_TEST)}function jh(f,e,s){const u=f.context,c=u.gl,p=s.posMatrix,x=f.useProgram("debug"),S=vt.disabled,k=qt.disabled,C=f.colorModeForRenderPass(),M="$debug",z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(s);u.activeTexture.set(c.TEXTURE0);const F=e.getTileByID(s.key).latestRawTileData,V=Math.floor((F&&F.byteLength||0)/1024),U=e.getTile(s).tileSize,H=512/Math.min(U,512)*(s.overscaledZ/f.transform.zoom)*.5;let J=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(J+=` => ${s.overscaledZ}`),function(Q,te){Q.initDebugOverlayCanvas();const q=Q.debugOverlayCanvas,ae=Q.context.gl,ce=Q.debugOverlayCanvas.getContext("2d");ce.clearRect(0,0,q.width,q.height),ce.shadowColor="white",ce.shadowBlur=2,ce.lineWidth=1.5,ce.strokeStyle="white",ce.textBaseline="top",ce.font="bold 36px Open Sans, sans-serif",ce.fillText(te,5,5),ce.strokeText(te,5,5),Q.debugOverlayTexture.update(q),Q.debugOverlayTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}(f,`${J} ${V}kB`),x.draw(u,c.TRIANGLES,S,k,si.alphaBlended,Vt.disabled,na(p,d.aM.transparent,H),null,M,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),x.draw(u,c.LINE_STRIP,S,k,C,Vt.disabled,na(p,d.aM.red),z,M,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function Uh(f,e,s){const u=f.context,c=u.gl,p=f.colorModeForRenderPass(),x=new vt(c.LEQUAL,vt.ReadWrite,f.depthRangeFor3D),S=f.useProgram("terrain"),k=e.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,f.width,f.height]);for(const C of s){const M=f.renderToTexture.getTexture(C),z=e.getTerrainData(C.tileID);u.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,M.texture);const F=f.transform.calculatePosMatrix(C.tileID.toUnwrapped()),V=e.getMeshFrameDelta(f.transform.zoom),U=f.transform.calculateFogMatrix(C.tileID.toUnwrapped()),H=xu(F,V,U,f.style.sky,f.transform.pitch);S.draw(u,c.TRIANGLES,x,qt.disabled,p,Vt.backCCW,H,z,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class ll{constructor(e,s,u){this.vertexBuffer=e,this.indexBuffer=s,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class ul{constructor(e,s){this.context=new df(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=st.maxUnderzooming+st.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new yu}resize(e,s,u){if(this.width=Math.floor(e*u),this.height=Math.floor(s*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,s=new d.aX;s.emplaceBack(0,0),s.emplaceBack(d.X,0),s.emplaceBack(0,d.X),s.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(s,xo.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const u=new d.aX;u.emplaceBack(0,0),u.emplaceBack(d.X,0),u.emplaceBack(0,d.X),u.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(u,xo.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const c=new d.$;c.emplaceBack(0,0,0,0),c.emplaceBack(d.X,0,d.X,0),c.emplaceBack(0,d.X,0,d.X),c.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(c,Jr.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const p=new d.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,xo.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const x=new d.aZ;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(x);const S=new d.aY;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);const k=this.context.gl;this.stencilClearMode=new qt({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=d.H();d.aP(u,0,this.width,this.height,0,0,1),d.K(u,u,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,vt.disabled,this.stencilClearMode,si.disabled,Vt.disabled,on(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const u=this.context,c=u.gl;this.nextStencilID+s.length>256&&this.clearStencil(),u.setColorMode(si.disabled),u.setDepthMode(vt.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of s){const S=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);p.draw(u,c.TRIANGLES,vt.disabled,new qt({func:c.ALWAYS,mask:0},S,255,c.KEEP,c.KEEP,c.REPLACE),si.disabled,Vt.disabled,on(x.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new qt({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new qt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,u=e.sort((x,S)=>S.overscaledZ-x.overscaledZ),c=u[u.length-1].overscaledZ,p=u[0].overscaledZ-c+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const x={};for(let S=0;S<p;S++)x[S+c]=new qt({func:s.GEQUAL,mask:255},S+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[x,u]}return[{[c]:qt.disabled},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new si([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?si.unblended:si.alphaBlended}depthModeForSublayer(e,s,u){if(!this.opaquePassEnabledForLayer())return vt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new vt(u||this.context.gl.LEQUAL,s,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(X.now()),this.imageManager.beginFrame();const u=this.style._order,c=this.style.sourceCaches,p={},x={},S={};for(const k in c){const C=c[k];C.used&&C.prepare(this.context),p[k]=C.getVisibleCoordinates(),x[k]=p[k].slice().reverse(),S[k]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<u.length;k++)if(this.style._layers[u[k]].is3D()){this.opaquePassCutoff=k;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const k of u){const C=this.style._layers[k];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const M=x[C.source];(C.type==="custom"||M.length)&&this.renderLayer(this,c[C.source],C,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(k,C){const M=k.context,z=M.gl,F=((Q,te,q)=>({u_sky_color:Q.properties.get("sky-color"),u_horizon_color:Q.properties.get("horizon-color"),u_horizon:(te.height/2+te.getHorizon())*q,u_sky_horizon_blend:Q.properties.get("sky-horizon-blend")*te.height/2*q}))(C,k.style.map.transform,k.pixelRatio),V=new vt(z.LEQUAL,vt.ReadWrite,[0,1]),U=qt.disabled,H=k.colorModeForRenderPass(),J=k.useProgram("sky");if(!C.mesh){const Q=new d.aX;Q.emplaceBack(-1,-1),Q.emplaceBack(1,-1),Q.emplaceBack(1,1),Q.emplaceBack(-1,1);const te=new d.aY;te.emplaceBack(0,1,2),te.emplaceBack(0,2,3),C.mesh=new ll(M.createVertexBuffer(Q,xo.members),M.createIndexBuffer(te),d.a0.simpleSegment(0,0,Q.length,te.length))}J.draw(M,z.TRIANGLES,V,U,H,Vt.disabled,F,void 0,"sky",C.mesh.vertexBuffer,C.mesh.indexBuffer,C.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[u[this.currentLayer]],C=c[k.source],M=p[k.source];this._renderTileClippingMasks(k,M),this.renderLayer(this,C,k,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const k=this.style._layers[u[this.currentLayer]],C=c[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const M=(k.type==="symbol"?S:x)[k.source];this._renderTileClippingMasks(k,p[k.source]),this.renderLayer(this,C,k,M)}if(this.options.showTileBoundaries){const k=function(C,M){let z=null;const F=Object.values(C._layers).flatMap(J=>J.source&&!J.isHidden(M)?[C.sourceCaches[J.source]]:[]),V=F.filter(J=>J.getSource().type==="vector"),U=F.filter(J=>J.getSource().type!=="vector"),H=J=>{(!z||z.getSource().maxzoom<J.getSource().maxzoom)&&(z=J)};return V.forEach(J=>H(J)),z||U.forEach(J=>H(J)),z}(this.style,this.transform.zoom);k&&function(C,M,z){for(let F=0;F<z.length;F++)jh(C,M,z[F])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const C=k.transform.padding;os(k,k.transform.height-(C.top||0),3,Bu),os(k,C.bottom||0,3,zt),Vh(k,C.left||0,3,sl),Vh(k,k.transform.width-(C.right||0),3,pf);const M=k.transform.centerPoint;(function(z,F,V,U){al(z,F-1,V-10,2,20,U),al(z,F-10,V-1,20,2,U)})(k,M.x,k.transform.height-M.y,Nh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!d.a_(s,u):!d.a$(s,u)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(d.b0(s,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,x){const S=p.context,k=S.gl,C=si.unblended,M=new vt(k.LEQUAL,vt.ReadWrite,[0,1]),z=x.getTerrainMesh(),F=x.sourceCache.getRenderableTiles(),V=p.useProgram("terrainDepth");S.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),S.clear({color:d.aM.transparent,depth:1});for(const U of F){const H=x.getTerrainData(U.tileID),J={u_matrix:p.transform.calculatePosMatrix(U.tileID.toUnwrapped()),u_ele_delta:x.getMeshFrameDelta(p.transform.zoom)};V.draw(S,k.TRIANGLES,M,qt.disabled,C,Vt.backCCW,J,H,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,x){const S=p.context,k=S.gl,C=si.unblended,M=new vt(k.LEQUAL,vt.ReadWrite,[0,1]),z=x.getTerrainMesh(),F=x.getCoordsTexture(),V=x.sourceCache.getRenderableTiles(),U=p.useProgram("terrainCoords");S.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),S.clear({color:d.aM.transparent,depth:1}),x.coordsIndex=[];for(const H of V){const J=x.getTerrainData(H.tileID);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,F.texture);const Q={u_matrix:p.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(p.transform.zoom)};U.draw(S,k.TRIANGLES,M,qt.disabled,C,Vt.backCCW,Q,J,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),x.coordsIndex.push(H.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(e,s,u,c){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(c||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(p,x,S,k,C){if(p.renderPass!=="translucent")return;const M=qt.disabled,z=p.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,V,U,H,J,Q,te,q,ae){const ce=V.transform,fe=vo(),we=J==="map",Ee=Q==="map";for(const Be of F){const Ue=H.getTile(Be),De=Ue.getBucket(U);if(!De||!De.text||!De.text.segments.get().length)continue;const Ae=d.ag(De.textSizeData,ce.zoom),Ke=xt(Ue,1,V.transform.zoom),ut=eo(Be.posMatrix,Ee,we,V.transform,Ke),Re=U.layout.get("icon-text-fit")!=="none"&&De.hasIconData();if(Ae){const Ne=Math.pow(2,ce.zoom-Ue.tileID.overscaledZ),at=V.style.map.terrain?(ft,wt)=>V.style.map.terrain.getElevation(Be,ft,wt):null,Wt=fe.translatePosition(ce,Ue,te,q);ts(De,we,Ee,ae,ce,ut,Be.posMatrix,Ne,Ae,Re,fe,Wt,Be.toUnwrapped(),at)}}}(k,p,S,x,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),C),S.paint.get("icon-opacity").constantOr(1)!==0&&Lu(p,x,S,k,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),M,z),S.paint.get("text-opacity").constantOr(1)!==0&&Lu(p,x,S,k,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),M,z),x.map.showCollisionBoxes&&(sa(p,x,S,k,!0),sa(p,x,S,k,!1))})(e,s,u,c,this.style.placement.variableOffsets);break;case"circle":(function(p,x,S,k){if(p.renderPass!=="translucent")return;const C=S.paint.get("circle-opacity"),M=S.paint.get("circle-stroke-width"),z=S.paint.get("circle-stroke-opacity"),F=!S.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(M.constantOr(1)===0||z.constantOr(1)===0))return;const V=p.context,U=V.gl,H=p.depthModeForSublayer(0,vt.ReadOnly),J=qt.disabled,Q=p.colorModeForRenderPass(),te=[];for(let q=0;q<k.length;q++){const ae=k[q],ce=x.getTile(ae),fe=ce.getBucket(S);if(!fe)continue;const we=fe.programConfigurations.get(S.id),Ee=p.useProgram("circle",we),Be=fe.layoutVertexBuffer,Ue=fe.indexBuffer,De=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ae),Ae={programConfiguration:we,program:Ee,layoutVertexBuffer:Be,indexBuffer:Ue,uniformValues:Jp(p,ae,ce,S),terrainData:De};if(F){const Ke=fe.segments.get();for(const ut of Ke)te.push({segments:new d.a0([ut]),sortKey:ut.sortKey,state:Ae})}else te.push({segments:fe.segments,sortKey:0,state:Ae})}F&&te.sort((q,ae)=>q.sortKey-ae.sortKey);for(const q of te){const{programConfiguration:ae,program:ce,layoutVertexBuffer:fe,indexBuffer:we,uniformValues:Ee,terrainData:Be}=q.state;ce.draw(V,U.TRIANGLES,H,J,Q,Vt.disabled,Ee,Be,S.id,fe,we,q.segments,S.paint,p.transform.zoom,ae)}})(e,s,u,c);break;case"heatmap":(function(p,x,S,k){if(S.paint.get("heatmap-opacity")===0)return;const C=p.context;if(p.style.map.terrain){for(const M of k){const z=x.getTile(M);x.hasRenderableParent(M)||(p.renderPass==="offscreen"?Fu(p,z,S,M):p.renderPass==="translucent"&&Eo(p,S,M))}C.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?function(M,z,F,V){const U=M.context,H=U.gl,J=qt.disabled,Q=new si([H.ONE,H.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(te,q,ae){const ce=te.gl;te.activeTexture.set(ce.TEXTURE1),te.viewport.set([0,0,q.width/4,q.height/4]);let fe=ae.heatmapFbos.get(d.aU);fe?(ce.bindTexture(ce.TEXTURE_2D,fe.colorAttachment.get()),te.bindFramebuffer.set(fe.framebuffer)):(fe=la(te,q.width/4,q.height/4),ae.heatmapFbos.set(d.aU,fe))})(U,M,F),U.clear({color:d.aM.transparent});for(let te=0;te<V.length;te++){const q=V[te];if(z.hasRenderableParent(q))continue;const ae=z.getTile(q),ce=ae.getBucket(F);if(!ce)continue;const fe=ce.programConfigurations.get(F.id),we=M.useProgram("heatmap",fe),{zoom:Ee}=M.transform;we.draw(U,H.TRIANGLES,vt.disabled,J,Q,Vt.disabled,sn(q.posMatrix,ae,Ee,F.paint.get("heatmap-intensity")),null,F.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,F.paint,M.transform.zoom,fe)}U.viewport.set([0,0,M.width,M.height])}(p,x,S,k):p.renderPass==="translucent"&&function(M,z){const F=M.context,V=F.gl;F.setColorMode(M.colorModeForRenderPass());const U=z.heatmapFbos.get(d.aU);U&&(F.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,U.colorAttachment.get()),F.activeTexture.set(V.TEXTURE1),ua(F,z).bind(V.LINEAR,V.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(F,V.TRIANGLES,vt.disabled,qt.disabled,M.colorModeForRenderPass(),Vt.disabled,Ka(M,z,0,1),null,z.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,z.paint,M.transform.zoom))}(p,S)})(e,s,u,c);break;case"line":(function(p,x,S,k){if(p.renderPass!=="translucent")return;const C=S.paint.get("line-opacity"),M=S.paint.get("line-width");if(C.constantOr(1)===0||M.constantOr(1)===0)return;const z=p.depthModeForSublayer(0,vt.ReadOnly),F=p.colorModeForRenderPass(),V=S.paint.get("line-dasharray"),U=S.paint.get("line-pattern"),H=U.constantOr(1),J=S.paint.get("line-gradient"),Q=S.getCrossfadeParameters(),te=H?"linePattern":V?"lineSDF":J?"lineGradient":"line",q=p.context,ae=q.gl;let ce=!0;for(const fe of k){const we=x.getTile(fe);if(H&&!we.patternsLoaded())continue;const Ee=we.getBucket(S);if(!Ee)continue;const Be=Ee.programConfigurations.get(S.id),Ue=p.context.program.get(),De=p.useProgram(te,Be),Ae=ce||De.program!==Ue,Ke=p.style.map.terrain&&p.style.map.terrain.getTerrainData(fe),ut=U.constantOr(null);if(ut&&we.imageAtlas){const at=we.imageAtlas,Wt=at.patternPositions[ut.to.toString()],ft=at.patternPositions[ut.from.toString()];Wt&&ft&&Be.setConstantPatternPositions(Wt,ft)}const Re=Ke?fe:null,Ne=H?Qo(p,we,S,Q,Re):V?Qp(p,we,S,V,Q,Re):J?bh(p,we,S,Ee.lineClipsArray.length,Re):Ja(p,we,S,Re);if(H)q.activeTexture.set(ae.TEXTURE0),we.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Be.updatePaintBuffers(Q);else if(V&&(Ae||p.lineAtlas.dirty))q.activeTexture.set(ae.TEXTURE0),p.lineAtlas.bind(q);else if(J){const at=Ee.gradients[S.id];let Wt=at.texture;if(S.gradientVersion!==at.version){let ft=256;if(S.stepInterpolant){const wt=x.getSource().maxzoom,Xt=fe.canonical.z===wt?Math.ceil(1<<p.transform.maxZoom-fe.canonical.z):1;ft=d.ac(d.aV(Ee.maxLineLength/d.X*1024*Xt),256,q.maxTextureSize)}at.gradient=d.aW({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:ft,image:at.gradient||void 0,clips:Ee.lineClipsArray}),at.texture?at.texture.update(at.gradient):at.texture=new gt(q,at.gradient,ae.RGBA),at.version=S.gradientVersion,Wt=at.texture}q.activeTexture.set(ae.TEXTURE0),Wt.bind(S.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}De.draw(q,ae.TRIANGLES,z,p.stencilModeForClipping(fe),F,Vt.disabled,Ne,Ke,S.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,S.paint,p.transform.zoom,Be,Ee.layoutVertexBuffer2),ce=!1}})(e,s,u,c);break;case"fill":(function(p,x,S,k){const C=S.paint.get("fill-color"),M=S.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const z=p.colorModeForRenderPass(),F=S.paint.get("fill-pattern"),V=p.opaquePassEnabledForLayer()&&!F.constantOr(1)&&C.constantOr(d.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===V){const U=p.depthModeForSublayer(1,p.renderPass==="opaque"?vt.ReadWrite:vt.ReadOnly);ca(p,x,S,k,U,z,!1)}if(p.renderPass==="translucent"&&S.paint.get("fill-antialias")){const U=p.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,vt.ReadOnly);ca(p,x,S,k,U,z,!0)}})(e,s,u,c);break;case"fill-extrusion":(function(p,x,S,k){const C=S.paint.get("fill-extrusion-opacity");if(C!==0&&p.renderPass==="translucent"){const M=new vt(p.context.gl.LEQUAL,vt.ReadWrite,p.depthRangeFor3D);if(C!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))ol(p,x,S,k,M,qt.disabled,si.disabled),ol(p,x,S,k,M,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const z=p.colorModeForRenderPass();ol(p,x,S,k,M,qt.disabled,z)}}})(e,s,u,c);break;case"hillshade":(function(p,x,S,k){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const C=p.context,M=p.depthModeForSublayer(0,vt.ReadOnly),z=p.colorModeForRenderPass(),[F,V]=p.renderPass==="translucent"?p.stencilConfigForOverlap(k):[{},k];for(const U of V){const H=x.getTile(U);H.needsHillshadePrepare!==void 0&&H.needsHillshadePrepare&&p.renderPass==="offscreen"?rs(p,H,S,M,qt.disabled,z):p.renderPass==="translucent"&&ns(p,U,H,S,M,F[U.overscaledZ],z)}C.viewport.set([0,0,p.width,p.height])})(e,s,u,c);break;case"raster":(function(p,x,S,k){if(p.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!k.length)return;const C=p.context,M=C.gl,z=x.getSource(),F=p.useProgram("raster"),V=p.colorModeForRenderPass(),[U,H]=z instanceof Rr?[{},k]:p.stencilConfigForOverlap(k),J=H[H.length-1].overscaledZ,Q=!p.options.moving;for(const te of H){const q=p.depthModeForSublayer(te.overscaledZ-J,S.paint.get("raster-opacity")===1?vt.ReadWrite:vt.ReadOnly,M.LESS),ae=x.getTile(te);ae.registerFadeDuration(S.paint.get("raster-fade-duration"));const ce=x.findLoadedParent(te,0),fe=x.findLoadedSibling(te),we=Oh(ae,ce||fe||null,x,S,p.transform,p.style.map.terrain);let Ee,Be;const Ue=S.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;C.activeTexture.set(M.TEXTURE0),ae.texture.bind(Ue,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(M.TEXTURE1),ce?(ce.texture.bind(Ue,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),Ee=Math.pow(2,ce.tileID.overscaledZ-ae.tileID.overscaledZ),Be=[ae.tileID.canonical.x*Ee%1,ae.tileID.canonical.y*Ee%1]):ae.texture.bind(Ue,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),ae.texture.useMipmap&&C.extTextureFilterAnisotropic&&p.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const De=p.style.map.terrain&&p.style.map.terrain.getTerrainData(te),Ae=De?te:null,Ke=Ae?Ae.posMatrix:p.transform.calculatePosMatrix(te.toUnwrapped(),Q),ut=ef(Ke,Be||[0,0],Ee||1,we,S);z instanceof Rr?F.draw(C,M.TRIANGLES,q,qt.disabled,V,Vt.disabled,ut,De,S.id,z.boundsBuffer,p.quadTriangleIndexBuffer,z.boundsSegments):F.draw(C,M.TRIANGLES,q,U[te.overscaledZ],V,Vt.disabled,ut,De,S.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,s,u,c);break;case"background":(function(p,x,S,k){const C=S.paint.get("background-color"),M=S.paint.get("background-opacity");if(M===0)return;const z=p.context,F=z.gl,V=p.transform,U=V.tileSize,H=S.paint.get("background-pattern");if(p.isPatternMissing(H))return;const J=!H&&C.a===1&&M===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==J)return;const Q=qt.disabled,te=p.depthModeForSublayer(0,J==="opaque"?vt.ReadWrite:vt.ReadOnly),q=p.colorModeForRenderPass(),ae=p.useProgram(H?"backgroundPattern":"background"),ce=k||V.coveringTiles({tileSize:U,terrain:p.style.map.terrain});H&&(z.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context));const fe=S.getCrossfadeParameters();for(const we of ce){const Ee=k?we.posMatrix:p.transform.calculatePosMatrix(we.toUnwrapped()),Be=H?Su(Ee,M,p,H,{tileID:we,tileSize:U},fe):Qa(Ee,M,C),Ue=p.style.map.terrain&&p.style.map.terrain.getTerrainData(we);ae.draw(z,F.TRIANGLES,te,Q,q,Vt.disabled,Be,Ue,S.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,u,c);break;case"custom":(function(p,x,S){const k=p.context,C=S.implementation;if(p.renderPass==="offscreen"){const M=C.prerender;M&&(p.setCustomLayerDefaults(),k.setColorMode(p.colorModeForRenderPass()),M.call(C,k.gl,p.transform.customLayerMatrix()),k.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),k.setColorMode(p.colorModeForRenderPass()),k.setStencilMode(qt.disabled);const M=C.renderingMode==="3d"?new vt(p.context.gl.LEQUAL,vt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,vt.ReadOnly);k.setDepthMode(M),C.render(k.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),k.setDirty(),p.setBaseState(),k.bindFramebuffer.set(null)}})(e,0,u)}}translatePosMatrix(e,s,u,c,p){if(!u[0]&&!u[1])return e;const x=p?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(x){const C=Math.sin(x),M=Math.cos(x);u=[u[0]*M-u[1]*C,u[0]*C+u[1]*M]}const S=[p?u[0]:xt(s,u[0],this.transform.zoom),p?u[1]:xt(s,u[1],this.transform.zoom),0],k=new Float32Array(16);return d.J(k,e,S),k}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!s||!u}useProgram(e,s){this.cache=this.cache||{};const u=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new wu(this.context,to[e],s,Tu[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new gt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class ss{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,u){const c=Math.pow(2,u),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const k=1/(S=d.af([],S,e))[3]/s*c;return d.b1(S,S,[k,k,1/S[3],k])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const k=function(F,V){var U=V[0],H=V[1],J=V[2],Q=U*U+H*H+J*J;return Q>0&&(Q=1/Math.sqrt(Q)),F[0]=V[0]*Q,F[1]=V[1]*Q,F[2]=V[2]*Q,F}([],function(F,V,U){var H=V[0],J=V[1],Q=V[2],te=U[0],q=U[1],ae=U[2];return F[0]=J*ae-Q*q,F[1]=Q*te-H*ae,F[2]=H*q-J*te,F}([],Ve([],p[S[0]],p[S[1]]),Ve([],p[S[2]],p[S[1]]))),C=-((M=k)[0]*(z=p[S[1]])[0]+M[1]*z[1]+M[2]*z[2]);var M,z;return k.concat(C)});return new ss(p,x)}}class as{constructor(e,s){this.min=e,this.max=s,this.center=function(u,c,p){return u[0]=.5*c[0],u[1]=.5*c[1],u[2]=.5*c[2],u}([],function(u,c,p){return u[0]=c[0]+p[0],u[1]=c[1]+p[1],u[2]=c[2]+p[2],u}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],u=Pe(this.min),c=Pe(this.max);for(let p=0;p<s.length;p++)u[p]=s[p]?this.min[p]:this.center[p],c[p]=s[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new as(u,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let c=0;c<e.planes.length;c++){const p=e.planes[c];let x=0;for(let S=0;S<s.length;S++)d.b2(p,s[S])>=0&&x++;if(x===0)return 0;x!==s.length&&(u=!1)}if(u)return 2;for(let c=0;c<3;c++){let p=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let S=0;S<e.points.length;S++){const k=e.points[S][c]-this.min[c];p=Math.min(p,k),x=Math.max(x,k)}if(x<0||p>this.max[c]-this.min[c])return 0}return 1}}class ls{constructor(e=0,s=0,u=0,c=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=u,this.right=c}interpolate(e,s,u){return s.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,s.top,u)),s.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,s.bottom,u)),s.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,s.left,u)),s.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,s.right,u)),this}getCenter(e,s){const u=d.ac((this.left+e-this.right)/2,0,e),c=d.ac((this.top+s-this.bottom)/2,0,s);return new d.P(u,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ls(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ou=85.051129;class us{constructor(e,s,u,c,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ls,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new us(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-d.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var u=new d.A(4);return d.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,c,p){var x=c[0],S=c[1],k=c[2],C=c[3],M=Math.sin(p),z=Math.cos(p);u[0]=x*z+k*M,u[1]=S*z+C*M,u[2]=x*-M+k*z,u[3]=S*-M+C*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,u){this._unmodified=!1,this._edgeInsets.interpolate(e,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new d.b4(0,e)];if(this._renderWorldCopies){const u=this.pointCoordinate(new d.P(0,0)),c=this.pointCoordinate(new d.P(this.width,0)),p=this.pointCoordinate(new d.P(this.width,this.height)),x=this.pointCoordinate(new d.P(0,this.height)),S=Math.floor(Math.min(u.x,c.x,p.x,x.x)),k=Math.floor(Math.max(u.x,c.x,p.x,x.x)),C=1;for(let M=S-C;M<=k+C;M++)M!==0&&s.push(new d.b4(M,e))}return s}coveringTiles(e){var s,u;let c=this.coveringZoomLevel(e);const p=c;if(e.minzoom!==void 0&&c<e.minzoom)return[];e.maxzoom!==void 0&&c>e.maxzoom&&(c=e.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),S=d.Z.fromLngLat(this.center),k=Math.pow(2,c),C=[k*x.x,k*x.y,0],M=[k*S.x,k*S.y,0],z=ss.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,c);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=c);const V=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,U=q=>({aabb:new as([q*k,0,0],[(q+1)*k,k,0]),zoom:0,x:0,y:0,wrap:q,fullyVisible:!1}),H=[],J=[],Q=c,te=e.reparseOverscaled?p:c;if(this._renderWorldCopies)for(let q=1;q<=3;q++)H.push(U(-q)),H.push(U(q));for(H.push(U(0));H.length>0;){const q=H.pop(),ae=q.x,ce=q.y;let fe=q.fullyVisible;if(!fe){const De=q.aabb.intersects(z);if(De===0)continue;fe=De===2}const we=e.terrain?C:M,Ee=q.aabb.distanceX(we),Be=q.aabb.distanceY(we),Ue=Math.max(Math.abs(Ee),Math.abs(Be));if(q.zoom===Q||Ue>V+(1<<Q-q.zoom)-2&&q.zoom>=F){const De=Q-q.zoom,Ae=C[0]-.5-(ae<<De),Ke=C[1]-.5-(ce<<De);J.push({tileID:new d.S(q.zoom===Q?te:q.zoom,q.wrap,q.zoom,ae,ce),distanceSq:Ge([M[0]-.5-ae,M[1]-.5-ce]),tileDistanceToCamera:Math.sqrt(Ae*Ae+Ke*Ke)})}else for(let De=0;De<4;De++){const Ae=(ae<<1)+De%2,Ke=(ce<<1)+(De>>1),ut=q.zoom+1;let Re=q.aabb.quadrant(De);if(e.terrain){const Ne=new d.S(ut,q.wrap,ut,Ae,Ke),at=e.terrain.getMinMaxElevation(Ne),Wt=(s=at.minElevation)!==null&&s!==void 0?s:this.elevation,ft=(u=at.maxElevation)!==null&&u!==void 0?u:this.elevation;Re=new as([Re.min[0],Re.min[1],Wt],[Re.max[0],Re.max[1],ft])}H.push({aabb:Re,zoom:ut,x:Ae,y:Ke,wrap:q.wrap,fullyVisible:fe})}}return J.sort((q,ae)=>q.distanceSq-ae.distanceSq).map(q=>q.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=d.ac(e.lat,-85.051129,Ou);return new d.P(d.O(e.lng)*this.worldSize,d.Q(s)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,u=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-p))return;const x=u+s-p,S=Math.cos(this._pitch)*this.cameraToCenterDistance/x/d.b5(1,c.lat),k=this.scaleZoom(S/this.tileSize);this._elevation=p,this._center=c,this.zoom=k}setLocationAtPoint(e,s){const u=this.pointCoordinate(s),c=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),x=new d.Z(p.x-(u.x-c.x),p.y-(u.y-c.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const F=s.pointCoordinate(e);if(F!=null)return F}const u=[e.x,e.y,0,1],c=[e.x,e.y,1,1];d.af(u,u,this.pixelMatrixInverse),d.af(c,c,this.pixelMatrixInverse);const p=u[3],x=c[3],S=u[1]/p,k=c[1]/x,C=u[2]/p,M=c[2]/x,z=C===M?0:(0-C)/(M-C);return new d.Z(d.y.number(u[0]/p,c[0]/x,z)/this.worldSize,d.y.number(S,k,z)/this.worldSize)}coordinatePoint(e,s=0,u=this.pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,s,1];return d.af(c,c,u),new d.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new ge().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ge([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ou])}calculateTileMatrix(e){const s=e.canonical,u=this.worldSize/this.zoomScale(s.z),c=s.x+Math.pow(2,s.z)*e.wrap,p=d.an(new Float64Array(16));return d.J(p,p,[c*u,s.y*u,0]),d.K(p,p,[u/d.X,u/d.X,1]),p}calculatePosMatrix(e,s=!1){const u=e.key,c=s?this._alignedPosMatrixCache:this._posMatrixCache;if(c[u])return c[u];const p=this.calculateTileMatrix(e);return d.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),c[u]=new Float32Array(p),c[u]}calculateFogMatrix(e){const s=e.key,u=this._fogMatrixCache;if(u[s])return u[s];const c=this.calculateTileMatrix(e);return d.L(c,this.fogMatrix,c),u[s]=new Float32Array(c),u[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=d.ac(+s,this.minZoom,this.maxZoom);const u={center:new d.N(e.lng,e.lat),zoom:s};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const q=179.9999999999;c=[-q,q]}const p=this.tileSize*this.zoomScale(u.zoom);let x=0,S=p,k=0,C=p,M=0,z=0;const{x:F,y:V}=this.size;if(this.latRange){const q=this.latRange;x=d.Q(q[1])*p,S=d.Q(q[0])*p,S-x<V&&(M=V/(S-x))}c&&(k=d.b3(d.O(c[0])*p,0,p),C=d.b3(d.O(c[1])*p,0,p),C<k&&(C+=p),C-k<F&&(z=F/(C-k)));const{x:U,y:H}=this.project.call({worldSize:p},e);let J,Q;const te=Math.max(z||0,M||0);if(te){const q=new d.P(z?(C+k)/2:U,M?(S+x)/2:H);return u.center=this.unproject.call({worldSize:p},q).wrap(),u.zoom+=this.scaleZoom(te),u}if(this.latRange){const q=V/2;H-q<x&&(Q=x+q),H+q>S&&(Q=S-q)}if(c){const q=(k+C)/2;let ae=U;this._renderWorldCopies&&(ae=d.b3(U,q-p/2,q+p/2));const ce=F/2;ae-ce<k&&(J=k+ce),ae+ce>C&&(J=C-ce)}if(J!==void 0||Q!==void 0){const q=new d.P(J??U,Q??H);u.center=this.unproject.call({worldSize:p},q).wrap()}return u}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:u}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=u,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let c=d.an(new Float64Array(16));d.K(c,c,[this.width/2,-this.height/2,1]),d.J(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=d.an(new Float64Array(16)),d.K(c,c,[1,-1,1]),d.J(c,c,[-1,-1,0]),d.K(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this.minElevationForCurrentTile),S=p-x*this._pixelPerMeter/Math.cos(this._pitch),k=x<0?S:p,C=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),z=Math.sin(M)*k/Math.sin(d.ac(Math.PI-C-M,.01,Math.PI-.01)),F=this.getHorizon(),V=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),U=Math.sin(V)*k/Math.sin(d.ac(Math.PI-C-V,.01,Math.PI-.01)),H=Math.min(z,U);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*H+k),this.nearZ=this.height/50,c=new Float64Array(16),d.b6(c,this._fov,this.width/this.height,this.nearZ,this.farZ),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,this.projectionMatrix=d.ae(c),d.K(c,c,[1,-1,1]),d.J(c,c,[0,0,-this.cameraToCenterDistance]),d.b7(c,c,this._pitch),d.ad(c,c,this.angle),d.J(c,c,[-s,-u,0]),this.mercatorMatrix=d.K([],c,[this.worldSize,this.worldSize,this.worldSize]),d.K(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,c),d.J(c,c,[0,0,-this.elevation]),this.modelViewProjectionMatrix=c,this.invModelViewProjectionMatrix=d.as([],c),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-s,-u,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,c);const J=this.width%2/2,Q=this.height%2/2,te=Math.cos(this.angle),q=Math.sin(this.angle),ae=s-Math.round(s)+te*J+q*Q,ce=u-Math.round(u)+te*Q+q*J,fe=new Float64Array(c);if(d.J(fe,fe,[ae>.5?ae-1:ae,ce>.5?ce-1:ce,0]),this.alignedModelViewProjectionMatrix=fe,c=d.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let u=s.x,c=s.y,p=s.x,x=s.y;for(const S of e)u=Math.min(u,S.x),c=Math.min(c,S.y),p=Math.max(p,S.x),x=Math.max(x,S.y);return[new d.P(u,c),new d.P(p,c),new d.P(p,x),new d.P(u,x),new d.P(u,c)]}}lngLatToCameraDepth(e,s){const u=this.locationCoordinate(e),c=[u.x*this.worldSize,u.y*this.worldSize,s,1];return d.af(c,c,this.modelViewProjectionMatrix),c[2]/c[3]}}function ha(f,e){let s,u=!1,c=null,p=null;const x=()=>{c=null,u&&(f.apply(p,s),c=setTimeout(x,e),u=!1)};return(...S)=>(u=!0,p=this,s=S,c||x(),c)}class cl{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(u=c)}),(u&&u[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const u=s.join("/");let c=u;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${u}`);let p=window.location.hash.replace(c,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let x=window.location.href.replace(/(#.+)?$/,p);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=ha(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,c=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,c),x=Math.round(s.lng*p)/p,S=Math.round(s.lat*p)/p,k=this._map.getBearing(),C=this._map.getPitch();let M="";if(M+=e?`/${x}/${S}/${u}`:`${u}/${S}/${x}`,(k||C)&&(M+="/"+Math.round(10*k)/10),C&&(M+=`/${Math.round(C)}`),this._hashName){const z=this._hashName;let F=!1;const V=window.location.hash.slice(1).split("&").map(U=>{const H=U.split("=")[0];return H===z?(F=!0,`${H}=${M}`):U}).filter(U=>U);return F||V.push(`${z}=${M}`),`#${V.join("&")}`}return`#${M}`}}const hl={linearity:.3,easing:d.b8(0,0,.3,1)},Nu=d.e({deceleration:2500,maxSpeed:1400},hl),ff=d.e({deceleration:20,maxSpeed:1400},hl),$h=d.e({deceleration:1e3,maxSpeed:360},hl),dl=d.e({deceleration:1e3,maxSpeed:90},hl);class Vu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:X.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=X.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(s.pan.mag()){const p=pa(s.pan.mag(),u,d.e({},Nu,e||{}));c.offset=s.pan.mult(p.amount/s.pan.mag()),c.center=this._map.transform.center,da(c,p)}if(s.zoom){const p=pa(s.zoom,u,ff);c.zoom=this._map.transform.zoom+p.amount,da(c,p)}if(s.bearing){const p=pa(s.bearing,u,$h);c.bearing=this._map.transform.bearing+d.ac(p.amount,-179,179),da(c,p)}if(s.pitch){const p=pa(s.pitch,u,dl);c.pitch=this._map.transform.pitch+p.amount,da(c,p)}if(c.zoom||c.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;c.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),d.e(c,{noMoveStart:!0})}}function da(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function pa(f,e,s){const{maxSpeed:u,linearity:c,deceleration:p}=s,x=d.ac(f*c/(e/1e3),-u,u),S=Math.abs(x)/(p*c);return{easing:s.easing,duration:1e3*S,amount:x*(S/2)}}class Li extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u,c={}){const p=$.mousePos(s.getCanvas(),u),x=s.unproject(p);super(e,d.e({point:p,lngLat:x,originalEvent:u},c)),this._defaultPrevented=!1,this.target=s}}class Co extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u){const c=e==="touchend"?u.changedTouches:u.touches,p=$.touchPos(s.getCanvasContainer(),c),x=p.map(k=>s.unproject(k)),S=p.reduce((k,C,M,z)=>k.add(C.div(z.length)),new d.P(0,0));super(e,{points:p,point:S,lngLats:x,lngLat:s.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class qh extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class Zh{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new qh(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Li(e.type,this._map,e))}mouseup(e){this._map.fire(new Li(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Li(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Li(e.type,this._map,e))}mouseover(e){this._map.fire(new Li(e.type,this._map,e))}mouseout(e){this._map.fire(new Li(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Co(e.type,this._map,e))}touchmove(e){this._map.fire(new Co(e.type,this._map,e))}touchend(e){this._map.fire(new Co(e.type,this._map,e))}touchcancel(e){this._map.fire(new Co(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ai{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Li(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Li("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Li(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Jn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class wn{constructor(e,s){this._map=e,this._tr=new Jn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&($.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const u=s;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=u,this._box||(this._box=$.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(c.x,u.x),x=Math.max(c.x,u.x),S=Math.min(c.y,u.y),k=Math.max(c.y,u.y);$.setTransform(this._box,`translate(${p}px,${S}px)`),this._box.style.width=x-p+"px",this._box.style.height=k-S+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const u=this._startPos,c=s;if(this.reset(),$.suppressClick(),u.x!==c.x||u.y!==c.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(u,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&($.remove(this._box),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new d.k(e,{originalEvent:s}))}}function fa(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const s={};for(let u=0;u<f.length;u++)s[f[u].identifier]=e[u];return s}class ju{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(c){const p=new d.P(0,0);for(const x of c)p._add(x);return p.div(c.length)}(s),this.touches=fa(u,s)))}touchmove(e,s,u){if(this.aborted||!this.centroid)return;const c=fa(u,s);for(const p in this.touches){const x=c[p];(!x||x.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,s,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class pl{constructor(e){this.singleTap=new ju(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,u){this.singleTap.touchstart(e,s,u)}touchmove(e,s,u){this.singleTap.touchmove(e,s,u)}touchend(e,s,u){const c=this.singleTap.touchend(e,s,u);if(c){const p=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(c)<30;if(p&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class cs{constructor(e){this._tr=new Jn(e),this._zoomIn=new pl({numTouches:1,numTaps:2}),this._zoomOut=new pl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,u){this._zoomIn.touchstart(e,s,u),this._zoomOut.touchstart(e,s,u)}touchmove(e,s,u){this._zoomIn.touchmove(e,s,u),this._zoomOut.touchmove(e,s,u)}touchend(e,s,u){const c=this._zoomIn.touchend(e,s,u),p=this._zoomOut.touchend(e,s,u),x=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(c)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Or{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=s.length?s[0]:s;return!this._moved&&c.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(u,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&$.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Uu={0:1,2:2};class fl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=$.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,u){const c=Uu[u];return s.buttons===void 0||(s.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return $.mouseButton(e)===this._eventButton}}class $u{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const ml=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},qu=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const u=new fl({checkCorrectEvent:c=>$.mouseButton(c)===0&&c.ctrlKey||$.mouseButton(c)===2});return new Or({clickTolerance:e,move:(c,p)=>({bearingDelta:(p.x-c.x)*s}),moveStateManager:u,enable:f,assignEvents:ml})},Zu=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const u=new fl({checkCorrectEvent:c=>$.mouseButton(c)===0&&c.ctrlKey||$.mouseButton(c)===2});return new Or({clickTolerance:e,move:(c,p)=>({pitchDelta:(p.y-c.y)*s}),moveStateManager:u,enable:f,assignEvents:ml})};class Po{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,u){return this._calculateTransform(e,s,u)}touchmove(e,s,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,s,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,u){this._calculateTransform(e,s,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,u){u.length>0&&(this._active=!0);const c=fa(u,s),p=new d.P(0,0),x=new d.P(0,0);let S=0;for(const C in c){const M=c[C],z=this._touches[C];z&&(p._add(M),x._add(M.sub(z)),S++,c[C]=M)}if(this._touches=c,this._shouldBePrevented(S)||!x.mag())return;const k=x.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(S),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,u){if(!this._firstTwoTouches)return;e.preventDefault();const[c,p]=this._firstTwoTouches,x=ma(u,s,c),S=ma(u,s,p);if(!x||!S)return;const k=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],k,e)}touchend(e,s,u){if(!this._firstTwoTouches)return;const[c,p]=this._firstTwoTouches,x=ma(u,s,c),S=ma(u,s,p);x&&S||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ma(f,e,s){for(let u=0;u<f.length;u++)if(f[u].identifier===s)return e[u]}function Gu(f,e){return Math.log(f/e)/Math.LN2}class Hu extends gl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Gu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gu(this._distance,u),pinchAround:s}}}function Wu(f,e){return 180*f.angleWith(e)/Math.PI}class Xu extends gl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,u){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Wu(this._vector,c),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,u=Wu(e,this._startVector);return Math.abs(u)<s}}function _l(f){return Math.abs(f.y)>Math.abs(f.x)}class hs extends gl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,u){super.touchstart(e,s,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,_l(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,p,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,u){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,p=s.mag()>=2;if(!c&&!p)return;if(!c||!p)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=e.y>0==s.y>0;return _l(e)&&_l(s)&&x}}const Gh={panStep:100,bearingStep:15,pitchStep:10};class Dn{constructor(e){this._tr=new Jn(e);const s=Gh;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,u=0,c=0,p=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,c=0),{cameraAnimation:S=>{const k=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:Sr,zoom:s?Math.round(k.zoom)+s*(e.shiftKey?2:1):k.zoom,bearing:k.bearing+u*this._bearingStep,pitch:k.pitch+c*this._pitchStep,offset:[-p*this._panStep,-x*this._panStep],center:k.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Sr(f){return f*(2-f)}const Ku=4.000244140625;class Qn{constructor(e,s){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new Jn(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=X.now(),c=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%Ku==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=$.mousePos(this._map.getCanvas(),e),u=this._tr;this._around=s.y>u.transform.height/2-u.transform.getHorizon()?d.N.convert(this._aroundCenter?u.center:u.unproject(s)):d.N.convert(u.center),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Ku?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&C!==0&&(C=1/C);const M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*C))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,u=this._startZoom,c=this._easing;let p,x=!1;const S=X.now()-this._lastWheelEventTime;if(this._type==="wheel"&&u&&c&&S){const k=Math.min(S/200,1),C=c(k);p=d.y.number(u,s,C),k<1?this._frameId||(this._frameId=!0):x=!0}else p=s,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=d.b9;if(this._prevEase){const u=this._prevEase,c=(X.now()-u.start)/u.duration,p=u.easing(c+.01)-u.easing(c),x=.27/Math.sqrt(p*p+1e-4)*.01,S=Math.sqrt(.0729-x*x);s=d.b8(x,S,.25,1)}return this._prevEase={start:X.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Mo{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class mf{constructor(e){this._tr=new Jn(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gf{constructor(){this._tap=new pl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,u){if(!this._swipePoint)if(this._tapTime){const c=s[0],p=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(c)<30;p&&x?u.length>0&&(this._swipePoint=c,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,s,u)}touchmove(e,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const c=s[0],p=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,s,u)}touchend(e,s,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const c=this._tap.touchend(e,s,u);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hh{constructor(e,s,u){this._el=e,this._mousePan=s,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wh{constructor(e,s,u){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Yu{constructor(e,s,u,c){this._el=e,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ds{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=$.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=s,this._container.appendChild(c);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=u,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&($.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ln=f=>f.zoom||f.drag||f.pitch||f.rotate;class Ze extends d.k{}function yl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Ju{constructor(e,s){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,p)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=c.type==="renderFrame"?void 0:c,S={needsRenderFrame:!1},k={},C={},M=c.touches,z=M?this._getMapTouches(M):void 0,F=z?$.touchPos(this._map.getCanvas(),z):$.mousePos(this._map.getCanvas(),c);for(const{handlerName:H,handler:J,allowed:Q}of this._handlers){if(!J.isEnabled())continue;let te;this._blockedByActive(C,Q,H)?J.reset():J[p||c.type]&&(te=J[p||c.type](c,F,z),this.mergeHandlerResult(S,k,te,H,x),te&&te.needsRenderFrame&&this._triggerRenderFrame()),(te||J.isActive())&&(C[H]=J)}const V={};for(const H in this._previousActiveHandlers)C[H]||(V[H]=x);this._previousActiveHandlers=C,(Object.keys(V).length||yl(S))&&(this._changes.push([S,k,V]),this._triggerRenderFrame()),(Object.keys(C).length||yl(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=S;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vu(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,p,x]of this._listeners)$.addEventListener(c,p,c===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[e,s,u]of this._listeners)$.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new Zh(s,e));const c=s.boxZoom=new wn(s,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const p=s.cooperativeGestures=new ds(s,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const x=new cs(s),S=new mf(s);s.doubleClickZoom=new Mo(S,x),this._add("tapZoom",x),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const k=new gf;this._add("tapDragZoom",k);const C=s.touchPitch=new hs(s);this._add("touchPitch",C),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const M=qu(e),z=Zu(e);s.dragRotate=new Wh(e,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const F=(({enable:te,clickTolerance:q})=>{const ae=new fl({checkCorrectEvent:ce=>$.mouseButton(ce)===0&&!ce.ctrlKey});return new Or({clickTolerance:q,move:(ce,fe)=>({around:fe,panDelta:fe.sub(ce)}),activateOnStart:!0,moveStateManager:ae,enable:te,assignEvents:ml})})(e),V=new Po(e,s);s.dragPan=new Hh(u,F,V),this._add("mousePan",F),this._add("touchPan",V,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const U=new Xu,H=new Hu;s.touchZoomRotate=new Yu(u,H,U,k),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const J=s.scrollZoom=new Qn(s,()=>this._triggerRenderFrame());this._add("scrollZoom",J,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const Q=s.keyboard=new Dn(s);this._add("keyboard",Q),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new ai(s))}_add(e,s,u){this._handlers.push({handlerName:e,handler:s,allowed:u}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ln(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,u){for(const c in e)if(c!==u&&(!s||s.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const u of e)this._el.contains(u.target)&&s.push(u);return s}mergeHandlerResult(e,s,u,c,p){if(!u)return;d.e(e,u);const x={handlerName:c,originalEvent:u.originalEvent||p};u.zoomDelta!==void 0&&(s.zoom=x),u.panDelta!==void 0&&(s.drag=x),u.pitchDelta!==void 0&&(s.pitch=x),u.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const e={},s={},u={};for(const[c,p,x]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),d.e(s,p),d.e(u,x);this._updateMapTransform(e,s,u),this._changes=[]}_updateMapTransform(e,s,u){const c=this._map,p=c._getTransformForUpdate(),x=c.terrain;if(!(yl(e)||x&&this._terrainMovement))return this._fireEvents(s,u,!0);let{panDelta:S,zoomDelta:k,bearingDelta:C,pitchDelta:M,around:z,pinchAround:F}=e;F!==void 0&&(z=F),c._stop(!0),z=z||c.transform.centerPoint;const V=p.pointLocation(S?z.sub(S):z);C&&(p.bearing+=C),M&&(p.pitch+=M),k&&(p.zoom+=k),x?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(S)):p.setLocationAtPoint(V,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(V,z)):p.setLocationAtPoint(V,z),c._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,u,!0)}_fireEvents(e,s,u){const c=Ln(this._eventsInProgress),p=Ln(e),x={};for(const z in e){const{originalEvent:F}=e[z];this._eventsInProgress[z]||(x[`${z}start`]=F),this._eventsInProgress[z]=e[z]}!c&&p&&this._fireEvent("movestart",p.originalEvent);for(const z in x)this._fireEvent(z,x[z]);p&&this._fireEvent("move",p.originalEvent);for(const z in e){const{originalEvent:F}=e[z];this._fireEvent(z,F)}const S={};let k;for(const z in this._eventsInProgress){const{handlerName:F,originalEvent:V}=this._eventsInProgress[z];this._handlersById[F].isActive()||(delete this._eventsInProgress[z],k=s[F]||V,S[`${z}end`]=k)}for(const z in S)this._fireEvent(z,S[z]);const C=Ln(this._eventsInProgress),M=(c||p)&&!C;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(u&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;!z||!z.essential&&X.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:k})),F(this._map.getBearing())&&this._map.resetNorth()):(F(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new d.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Ze("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Xh extends d.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const u=Math.min((X.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,u){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},s),u)}panTo(e,s,u){return this.easeTo(d.e({center:e},s),u)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,u){return this.easeTo(d.e({zoom:e},s),u)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,u){return this.easeTo(d.e({bearing:e},s),u)}resetNorth(e,s){return this.rotateTo(0,d.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=ge.convert(e).adjustAntiMeridian();const u=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,s)}_cameraForBoxAndBearing(e,s,u,c){const p={top:0,bottom:0,right:0,left:0};if(typeof(c=d.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const De=c.padding;c.padding={top:De,bottom:De,right:De,left:De}}c.padding=d.e(p,c.padding);const x=this.transform,S=x.padding,k=new ge(e,s),C=x.project(k.getNorthWest()),M=x.project(k.getNorthEast()),z=x.project(k.getSouthEast()),F=x.project(k.getSouthWest()),V=d.ba(-u),U=C.rotate(V),H=M.rotate(V),J=z.rotate(V),Q=F.rotate(V),te=new d.P(Math.max(U.x,H.x,Q.x,J.x),Math.max(U.y,H.y,Q.y,J.y)),q=new d.P(Math.min(U.x,H.x,Q.x,J.x),Math.min(U.y,H.y,Q.y,J.y)),ae=te.sub(q),ce=(x.width-(S.left+S.right+c.padding.left+c.padding.right))/ae.x,fe=(x.height-(S.top+S.bottom+c.padding.top+c.padding.bottom))/ae.y;if(fe<0||ce<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const we=Math.min(x.scaleZoom(x.scale*Math.min(ce,fe)),c.maxZoom),Ee=d.P.convert(c.offset),Be=new d.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(d.ba(u)),Ue=Ee.add(Be).mult(x.scale/x.zoomScale(we));return{center:x.unproject(C.add(z).div(2).sub(Ue)),zoom:we,bearing:u}}fitBounds(e,s,u){return this._fitInternal(this.cameraForBounds(e,s),s,u)}fitScreenCoordinates(e,s,u,c,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(s)),u,c),c,p)}_fitInternal(e,s,u){return e?(delete(s=d.e(e,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(e,s){this.stop();const u=this._getTransformForUpdate();let c=!1,p=!1,x=!1;return"zoom"in e&&u.zoom!==+e.zoom&&(c=!0,u.zoom=+e.zoom),e.center!==void 0&&(u.center=d.N.convert(e.center)),"bearing"in e&&u.bearing!==+e.bearing&&(p=!0,u.bearing=+e.bearing),"pitch"in e&&u.pitch!==+e.pitch&&(x=!0,u.pitch=+e.pitch),e.padding==null||u.isPaddingEqual(e.padding)||(u.padding=e.padding),this._applyUpdatedTransform(u),this.fire(new d.k("movestart",s)).fire(new d.k("move",s)),c&&this.fire(new d.k("zoomstart",s)).fire(new d.k("zoom",s)).fire(new d.k("zoomend",s)),p&&this.fire(new d.k("rotatestart",s)).fire(new d.k("rotate",s)).fire(new d.k("rotateend",s)),x&&this.fire(new d.k("pitchstart",s)).fire(new d.k("pitch",s)).fire(new d.k("pitchend",s)),this.fire(new d.k("moveend",s))}calculateCameraOptionsFromTo(e,s,u,c=0){const p=d.Z.fromLngLat(e,s),x=d.Z.fromLngLat(u,c),S=x.x-p.x,k=x.y-p.y,C=x.z-p.z,M=Math.hypot(S,k,C);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(S,k),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),V=180*Math.atan2(S,-k)/Math.PI;let U=180*Math.acos(z/M)/Math.PI;return U=C<0?90-U:90+U,{center:x.toLngLat(),zoom:F,pitch:U,bearing:V}}easeTo(e,s){var u;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&X.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),p=c.zoom,x=c.bearing,S=c.pitch,k=c.padding,C="bearing"in e?this._normalizeBearing(e.bearing,x):x,M="pitch"in e?+e.pitch:S,z="padding"in e?e.padding:c.padding,F=d.P.convert(e.offset);let V=c.centerPoint.add(F);const U=c.pointLocation(V),{center:H,zoom:J}=c.getConstrained(d.N.convert(e.center||U),(u=e.zoom)!==null&&u!==void 0?u:p);this._normalizeCenter(H,c);const Q=c.project(U),te=c.project(H).sub(Q),q=c.zoomScale(J-p);let ae,ce;e.around&&(ae=d.N.convert(e.around),ce=c.locationPoint(ae));const fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||J!==p,this._rotating=this._rotating||x!==C,this._pitching=this._pitching||M!==S,this._padding=!c.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,fe),this.terrain&&this._prepareElevation(H),this._ease(we=>{if(this._zooming&&(c.zoom=d.y.number(p,J,we)),this._rotating&&(c.bearing=d.y.number(x,C,we)),this._pitching&&(c.pitch=d.y.number(S,M,we)),this._padding&&(c.interpolatePadding(k,z,we),V=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(we),ae)c.setLocationAtPoint(ae,ce);else{const Ee=c.zoomScale(c.zoom-p),Be=J>p?Math.min(2,q):Math.max(.5,q),Ue=Math.pow(Be,1-we),De=c.unproject(Q.add(te.mult(we*Ue)).mult(Ee));c.setLocationAtPoint(c.renderWorldCopies?De.wrap():De,V)}this._applyUpdatedTransform(c),this._fireMoveEvents(s)},we=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,we)},e),this}_prepareEase(e,s,u={}){this._moving=!0,s||u.moving||this.fire(new d.k("movestart",e)),this._zooming&&!u.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(s-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),u=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<u){const c=this.calculateCameraOptionsFromTo(s.lngLat,u,e.center,e.elevation);return{pitch:c.pitch,zoom:c.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&s.push(c=>this.transformCameraUpdate(c)),!s.length)return;const u=e.clone();for(const c of s){const p=u.clone(),{center:x,zoom:S,pitch:k,bearing:C,elevation:M}=c(p);x&&(p.center=x),S!==void 0&&(p.zoom=S),k!==void 0&&(p.pitch=k),C!==void 0&&(p.bearing=C),M!==void 0&&(p.elevation=M),u.apply(p)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const u=this._zooming,c=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new d.k("zoomend",e)),c&&this.fire(new d.k("rotateend",e)),p&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,s){var u;if(!e.essential&&X.prefersReducedMotion){const Ne=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ne,s)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const c=this._getTransformForUpdate(),p=c.zoom,x=c.bearing,S=c.pitch,k=c.padding,C="bearing"in e?this._normalizeBearing(e.bearing,x):x,M="pitch"in e?+e.pitch:S,z="padding"in e?e.padding:c.padding,F=d.P.convert(e.offset);let V=c.centerPoint.add(F);const U=c.pointLocation(V),{center:H,zoom:J}=c.getConstrained(d.N.convert(e.center||U),(u=e.zoom)!==null&&u!==void 0?u:p);this._normalizeCenter(H,c);const Q=c.zoomScale(J-p),te=c.project(U),q=c.project(H).sub(te);let ae=e.curve;const ce=Math.max(c.width,c.height),fe=ce/Q,we=q.mag();if("minZoom"in e){const Ne=d.ac(Math.min(e.minZoom,p,J),c.minZoom,c.maxZoom),at=ce/c.zoomScale(Ne-p);ae=Math.sqrt(at/we*2)}const Ee=ae*ae;function Be(Ne){const at=(fe*fe-ce*ce+(Ne?-1:1)*Ee*Ee*we*we)/(2*(Ne?fe:ce)*Ee*we);return Math.log(Math.sqrt(at*at+1)-at)}function Ue(Ne){return(Math.exp(Ne)-Math.exp(-Ne))/2}function De(Ne){return(Math.exp(Ne)+Math.exp(-Ne))/2}const Ae=Be(!1);let Ke=function(Ne){return De(Ae)/De(Ae+ae*Ne)},ut=function(Ne){return ce*((De(Ae)*(Ue(at=Ae+ae*Ne)/De(at))-Ue(Ae))/Ee)/we;var at},Re=(Be(!0)-Ae)/ae;if(Math.abs(we)<1e-6||!isFinite(Re)){if(Math.abs(ce-fe)<1e-6)return this.easeTo(e,s);const Ne=fe<ce?-1:1;Re=Math.abs(Math.log(fe/ce))/ae,ut=()=>0,Ke=at=>Math.exp(Ne*ae*at)}return e.duration="duration"in e?+e.duration:1e3*Re/("screenSpeed"in e?+e.screenSpeed/ae:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=x!==C,this._pitching=M!==S,this._padding=!c.isPaddingEqual(z),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(H),this._ease(Ne=>{const at=Ne*Re,Wt=1/Ke(at);c.zoom=Ne===1?J:p+c.scaleZoom(Wt),this._rotating&&(c.bearing=d.y.number(x,C,Ne)),this._pitching&&(c.pitch=d.y.number(S,M,Ne)),this._padding&&(c.interpolatePadding(k,z,Ne),V=c.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ne);const ft=Ne===1?H:c.unproject(te.add(q.mult(ut(at))).mult(Wt));c.setLocationAtPoint(c.renderWorldCopies?ft.wrap():ft,V),this._applyUpdatedTransform(c),this._fireMoveEvents(s)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,s)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,s,u){u.animate===!1||u.duration===0?(e(1),s()):(this._easeStart=X.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=d.b3(e,-180,180);const u=Math.abs(e-s);return Math.abs(e-360-s)<u&&(e-=360),Math.abs(e+360-s)<u&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const u=e.lng-s.center.lng;e.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const ps={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class fs{constructor(e=ps){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=$.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=$.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const u=this._map._getUIString(`AttributionControl.${s}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const s=this._map.style.sourceCaches;for(const c in s){const p=s[c];if(p.used||p.usedForTerrain){const x=p.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,p)=>c.length-p.length),e=e.filter((c,p)=>{for(let x=p+1;x<e.length;x++)if(e[x].indexOf(c)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Qu{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=$.create("div","maplibregl-ctrl");const s=$.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){$.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class St{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const c of u)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ec=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class _f extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const u={};for(const c of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))u[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),d.aP(c.posMatrix,0,d.X,0,d.X,0,1),this._tiles[c.key]=new Qr(c,this.tileSize));for(const c in this._tiles)u[c]||delete this._tiles[c]}freeRtt(e){for(const s in this._tiles){const u=this._tiles[s];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const u of this._renderableTilesKeys){const c=this._tiles[u].tileID;if(c.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),d.aP(p.posMatrix,0,d.X,0,d.X,0,1),s[u]=p}else if(c.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const x=c.canonical.z-e.canonical.z,S=c.canonical.x-(c.canonical.x>>x<<x),k=c.canonical.y-(c.canonical.y>>x<<x),C=d.X>>x;d.aP(p.posMatrix,0,C,0,C,0,1),d.J(p.posMatrix,p.posMatrix,[-S*C,-k*C,0]),s[u]=p}else if(e.canonical.isChildOf(c.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const x=e.canonical.z-c.canonical.z,S=e.canonical.x-(e.canonical.x>>x<<x),k=e.canonical.y-(e.canonical.y>>x<<x),C=d.X>>x;d.aP(p.posMatrix,0,d.X,0,d.X,0,1),d.J(p.posMatrix,p.posMatrix,[S*C,k*C,0]),d.K(p.posMatrix,p.posMatrix,[1/2**x,1/2**x,0]),s[u]=p}}return s}getSourceTile(e,s){const u=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>u.maxzoom&&(c=u.maxzoom),c<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&s)for(;c>=u.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(c--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class tc{constructor(e,s,u){this.painter=e,this.sourceCache=new _f(s),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,u,c=d.X){var p;if(!(s>=0&&s<c&&u>=0&&u<c))return 0;const x=this.getTerrainData(e),S=(p=x.tile)===null||p===void 0?void 0:p.dem;if(!S)return 0;const k=function(U,H,J){var Q=H[0],te=H[1];return U[0]=J[0]*Q+J[4]*te+J[12],U[1]=J[1]*Q+J[5]*te+J[13],U}([],[s/c*d.X,u/c*d.X],x.u_terrain_matrix),C=[k[0]*S.dim,k[1]*S.dim],M=Math.floor(C[0]),z=Math.floor(C[1]),F=C[0]-M,V=C[1]-z;return S.get(M,z)*(1-F)*(1-V)+S.get(M+1,z)*F*(1-V)+S.get(M,z+1)*(1-F)*V+S.get(M+1,z+1)*F*V}getElevationForLngLatZoom(e,s){if(!d.bb(s,e.wrap()))return 0;const{tileID:u,mercatorX:c,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(u,c%d.X,p%d.X,d.X)}getElevation(e,s,u,c=d.X){return this.getDEMElevation(e,s,u,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,p=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new gt(c,p,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new gt(c,new d.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const c=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new gt(c,s.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),s.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const u=s&&s+s.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const c=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?p=e.canonical.z-c:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=e.canonical.x-(e.canonical.x>>p<<p),S=e.canonical.y-(e.canonical.y>>p<<p),k=d.bc(new Float64Array(16),[1/(d.X<<p),1/(d.X<<p),0]);d.J(k,k,[x*d.X,S*d.X,0]),this._demMatrixCache[e.key]={matrix:k,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,u=s.width/devicePixelRatio,c=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new gt(s.context,{width:u,height:c,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new gt(s.context,{width:u,height:c,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(u,c,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,u,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,x=0;p<this._coordsTextureSize;p++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)s[x+0]=255&S,s[x+1]=255&p,s[x+2]=S>>8<<4|p>>8,s[x+3]=0;const u=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),c=new gt(e,u,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),u=this.painter.context,c=u.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(p,S-x-1,1,1,c.RGBA,c.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null);const k=s[0]+(s[2]>>4<<8),C=s[1]+((15&s[2])<<8),M=this.coordsIndex[255-s[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const F=this._coordsTextureSize,V=(1<<z.tileID.canonical.z)*F;return new d.Z((z.tileID.canonical.x*F+k)/V+z.tileID.wrap,(z.tileID.canonical.y*F+C)/V,this.getElevation(z.tileID,k,C,F))}depthAtPoint(e){const s=new Uint8Array(4),u=this.painter.context,c=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new d.bd,u=new d.aY,c=this.meshSize,p=d.X/c,x=c*c;for(let z=0;z<=c;z++)for(let F=0;F<=c;F++)s.emplaceBack(F*p,z*p,0);for(let z=0;z<x;z+=c+1)for(let F=0;F<c;F++)u.emplaceBack(F+z,c+F+z+1,c+F+z+2),u.emplaceBack(F+z,c+F+z+2,F+z+1);const S=s.length,k=S+2*(c+1);for(const z of[0,1])for(let F=0;F<=c;F++)for(const V of[0,1])s.emplaceBack(F*p,z*d.X,V);for(let z=0;z<2*c;z+=2)u.emplaceBack(k+z,k+z+1,k+z+3),u.emplaceBack(k+z,k+z+3,k+z+2),u.emplaceBack(S+z,S+z+3,S+z+1),u.emplaceBack(S+z,S+z+2,S+z+3);const C=s.length,M=C+2*(c+1);for(const z of[0,1])for(let F=0;F<=c;F++)for(const V of[0,1])s.emplaceBack(z*d.X,F*p,V);for(let z=0;z<2*c;z+=2)u.emplaceBack(C+z,C+z+1,C+z+3),u.emplaceBack(C+z,C+z+3,C+z+2),u.emplaceBack(M+z,M+z+3,M+z+1),u.emplaceBack(M+z,M+z+2,M+z+3);return this._mesh=new ll(e.createVertexBuffer(s,ec.members),e.createIndexBuffer(u),d.a0.simpleSegment(0,0,s.length,u.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var u;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(u=this.getMinMaxElevation(c).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return s&&s.dem&&(u.minElevation=s.dem.min*this.exaggeration,u.maxElevation=s.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,s){const u=d.Z.fromLngLat(e.wrap()),c=(1<<s)*d.X,p=u.x*c,x=u.y*c,S=Math.floor(p/d.X),k=Math.floor(x/d.X);return{tileID:new d.S(s,0,s,S,k),mercatorX:p,mercatorY:x}}}class yf{constructor(e,s,u){this._context=e,this._size=s,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new gt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(u.texture),{id:e,fbo:s,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const ms={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Kh{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new yf(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(s)),this._coordsDescendingInv={};for(const u in e.sourceCaches){this._coordsDescendingInv[u]={};const c=e.sourceCaches[u].getVisibleCoordinates();for(const p of c){const x=this.terrain.sourceCache.getTerrainCoords(p);for(const S in x)this._coordsDescendingInv[u][S]||(this._coordsDescendingInv[u][S]=[]),this._coordsDescendingInv[u][S].push(x[S])}}this._coordsDescendingInvStr={};for(const u of e._order){const c=e._layers[u],p=c.source;if(ms[c.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const x in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][x]=this._coordsDescendingInv[p][x].map(S=>S.key).sort().join()}}for(const u of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[c][u.tileID.key];p&&p!==u.rttCoords[c]&&(u.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,u=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ms[s]&&(this._prevType&&ms[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!c))return!0;if(ms[this._prevType]||ms[s]&&c){this._prevType=s;const p=this._stacks.length-1,x=this._stacks[p]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Uh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[p]){const C=this.pool.getObjectForId(S.rtt[p].id);if(C.stamp===S.rtt[p].stamp){this.pool.useObject(C);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),S.rtt[p]={id:k.id,stamp:k.stamp},u.context.bindFramebuffer.set(k.fbo.framebuffer),u.context.clear({color:d.aM.transparent,stencil:0}),u.currentStencilSource=void 0;for(let C=0;C<x.length;C++){const M=u.style._layers[x[C]],z=M.source?this._coordsDescendingInv[M.source][S.tileID.key]:[S.tileID];u.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),u._renderTileClippingMasks(M,z),u.renderLayer(u,u.style.sourceCaches[M.source],M,z),M.source&&(S.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][S.tileID.key])}}return Uh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ms[s]}return!1}}const ic={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Yh=O,vf={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ps,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},nc=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},xf={showCompass:!0,showZoom:!0,visualizePitch:!1};class wf{constructor(e,s,u=!1){this.mousedown=x=>{this.startMouse(d.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),$.mousePos(this.element,x)),$.addEventListener(window,"mousemove",this.mousemove),$.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,$.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),$.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=qu({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:S,bearingDegreesPerPixelMoved:k=.8})=>{const C=new $u;return new Or({clickTolerance:S,move:(M,z)=>({bearingDelta:(z.x-M.x)*k}),moveStateManager:C,enable:x,assignEvents:nc})})({clickTolerance:c,enable:!0}),this.map=e,u&&(this.mousePitch=Zu({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:S,pitchDegreesPerPixelMoved:k=-.5})=>{const C=new $u;return new Or({clickTolerance:S,move:(M,z)=>({pitchDelta:(z.y-M.y)*k}),moveStateManager:C,enable:x,assignEvents:nc})})({clickTolerance:p,enable:!0})),$.addEventListener(s,"mousedown",this.mousedown),$.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),$.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),$.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),$.disableDrag()}moveMouse(e,s){const u=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(e,s)||{};if(c&&u.setBearing(u.getBearing()+c),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,s)||{};p&&u.setPitch(u.getPitch()+p)}}moveTouch(e,s){const u=this.map,{bearingDelta:c}=this.touchRotate.dragMove(e,s)||{};if(c&&u.setBearing(u.getBearing()+c),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,s)||{};p&&u.setPitch(u.getPitch()+p)}}off(){const e=this.element;$.removeEventListener(e,"mousedown",this.mousedown),$.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend),$.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),$.removeEventListener(window,"mousemove",this.mousemove),$.removeEventListener(window,"mouseup",this.mouseup),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend)}}let bn;function Ht(f,e,s){const u=new d.N(f.lng,f.lat);if(f=new d.N(f.lng,f.lat),e){const c=new d.N(f.lng-360,f.lat),p=new d.N(f.lng+360,f.lat),x=s.locationPoint(f).distSqr(e);s.locationPoint(c).distSqr(e)<x?f=c:s.locationPoint(p).distSqr(e)<x&&(f=p)}for(;Math.abs(f.lng-s.center.lng)>180;){const c=s.locationPoint(f);if(c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f.lng!==u.lng&&s.locationPoint(f).y>s.height/2-s.getHorizon()?f:u}const gs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vl(f,e,s){const u=f.classList;for(const c in gs)u.remove(`maplibregl-${s}-anchor-${c}`);u.add(`maplibregl-${s}-anchor-${e}`)}class xl extends d.E{constructor(e){if(super(),this._onKeyPress=s=>{const u=s.code,c=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=s=>{const u=s.originalEvent.target,c=this._element;this._popup&&(u===c||c.contains(u))&&this.togglePopup()},this._update=s=>{var u;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ht(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),$.setTransform(this._element,`${gs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${p}`),X.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div");const s=$.createNS("http://www.w3.org/2000/svg","svg"),u=41,c=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${u}px`),s.setAttributeNS(null,"width",`${c}px`),s.setAttributeNS(null,"viewBox",`0 0 ${c} ${u}`);const p=$.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const x=$.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const S=$.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Q of k){const te=$.createNS("http://www.w3.org/2000/svg","ellipse");te.setAttributeNS(null,"opacity","0.04"),te.setAttributeNS(null,"cx","10.5"),te.setAttributeNS(null,"cy","5.80029008"),te.setAttributeNS(null,"rx",Q.rx),te.setAttributeNS(null,"ry",Q.ry),S.appendChild(te)}const C=$.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const M=$.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(M);const z=$.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const F=$.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(F);const V=$.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(6.0, 7.0)"),V.setAttributeNS(null,"fill","#FFFFFF");const U=$.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const H=$.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#000000"),H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962");const J=$.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#FFFFFF"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962"),U.appendChild(H),U.appendChild(J),x.appendChild(S),x.appendChild(C),x.appendChild(z),x.appendChild(V),x.appendChild(U),s.appendChild(x),s.setAttributeNS(null,"height",u*this._scale+"px"),s.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(s),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),vl(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),$.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,u;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,p=c.terrain.depthAtPoint(this._pos),x=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,x)-p<.006)return void(this._element.style.opacity=this._opacity);const S=-this._offset.y/c.transform._pixelPerMeter,k=Math.sin(c.getPitch()*Math.PI/180)*S,C=c.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),M=c.transform.lngLatToCameraDepth(this._lngLat,x+k)-C>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Jh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ga=0,_a=!1;const Tr={maxWidth:100,unit:"metric"};function ya(f,e,s){const u=s&&s.maxWidth||100,c=f._container.clientHeight/2,p=f.unproject([0,c]),x=f.unproject([u,c]),S=p.distanceTo(x);if(s&&s.unit==="imperial"){const k=3.2808*S;k>5280?Xe(e,u,k/5280,f._getUIString("ScaleControl.Miles")):Xe(e,u,k,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Xe(e,u,S/1852,f._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Xe(e,u,S/1e3,f._getUIString("ScaleControl.Kilometers")):Xe(e,u,S,f._getUIString("ScaleControl.Meters"))}function Xe(f,e,s,u){const c=function(p){const x=Math.pow(10,`${Math.floor(p)}`.length-1);let S=p/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(k){const C=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*C)/C}(S),x*S}(s);f.style.width=e*(c/s)+"px",f.innerHTML=`${c}&nbsp;${u}`}const ot={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},wl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bl(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,f),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-f),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(f,0),right:new d.P(-f,0)}}if(f instanceof d.P||Array.isArray(f)){const e=d.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(f.center||[0,0]),top:d.P.convert(f.top||[0,0]),"top-left":d.P.convert(f["top-left"]||[0,0]),"top-right":d.P.convert(f["top-right"]||[0,0]),bottom:d.P.convert(f.bottom||[0,0]),"bottom-left":d.P.convert(f["bottom-left"]||[0,0]),"bottom-right":d.P.convert(f["bottom-right"]||[0,0]),left:d.P.convert(f.left||[0,0]),right:d.P.convert(f.right||[0,0])}}return bl(new d.P(0,0))}const rc=O;w.AJAXError=d.bh,w.Evented=d.E,w.LngLat=d.N,w.MercatorCoordinate=d.Z,w.Point=d.P,w.addProtocol=d.bi,w.config=d.a,w.removeProtocol=d.bj,w.AttributionControl=fs,w.BoxZoomHandler=wn,w.CanvasSource=Mn,w.CooperativeGesturesHandler=ds,w.DoubleClickZoomHandler=Mo,w.DragPanHandler=Hh,w.DragRotateHandler=Wh,w.EdgeInsets=ls,w.FullscreenControl=class extends d.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){$.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=$.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);$.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=Js,w.GeolocateControl=class extends d.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new d.N(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,c=this._map.getBearing(),p=d.e({bearing:c},this.options.fitBoundsOptions),x=ge.fromLngLat(s,u);this._map.fitBounds(x,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&_a)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=$.create("button","maplibregl-ctrl-geolocate",this._container),$.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new xl({element:this._dotElement}),this._circleElement=$.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},Jh,f)}onAdd(f){return this._map=f,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(bn!==void 0&&!e)return bn;if(window.navigator.permissions===void 0)return bn=!!window.navigator.geolocation,bn;try{bn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{bn=!!window.navigator.geolocation}return bn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),$.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ga=0,_a=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),s=f.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),s=f.getNorthEast(),u=e.distanceTo(s),c=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ga--,_a=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ga++,ga>1?(f={maximumAge:6e5,timeout:0},_a=!0):(f=this.options.positionOptions,_a=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.Hash=cl,w.ImageSource=Rr,w.KeyboardHandler=Dn,w.LngLatBounds=ge,w.LogoControl=Qu,w.Map=class extends Xh{constructor(f){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},vf),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new us(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new St,this._controls=[],this._mapId=d.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ic),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=se.addThrottleControl(()=>this.isMoving()),this._requestManager=new xe(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const u=ha(c=>{this._trackResize&&!this._removed&&(this.resize(c),this.redraw())},50);this._resizeObserver=new ResizeObserver(c=>{s?u(c):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ju(this,e),this._hash=e.hash&&new cl(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new fs(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Qu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new d.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new d.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new d.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,s,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,s,u)}resize(f){var e;const s=this._containerDimensions(),u=s[0],c=s[1],p=this._getClampedPixelRatio(u,c);if(this._resizeCanvas(u,c,p),this.painter.resize(u,c,p),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const k=this._getClampedPixelRatio(u,c);this._resizeCanvas(u,c,k),this.painter.resize(u,c,k)}this.transform.resize(u,c),(e=this._requestedCameraState)===null||e===void 0||e.resize(u,c);const x=!this._moving;return x&&(this.stop(),this.fire(new d.k("movestart",f)).fire(new d.k("move",f))),this.fire(new d.k("resize",f)),x&&this.fire(new d.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:s,1:u}=this._maxCanvasSize,c=this.getPixelRatio(),p=f*c,x=e*c;return Math.min(p>s?s/p:1,x>u?u/x:1)*c}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(ge.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(d.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(d.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,s){if(f==="mouseenter"||f==="mouseover"){let u=!1;return{layers:e,listener:s,delegates:{mousemove:p=>{const x=e.filter(k=>this.getLayer(k)),S=x.length!==0?this.queryRenderedFeatures(p.point,{layers:x}):[];S.length?u||(u=!0,s.call(this,new Li(f,this,p.originalEvent,{features:S}))):u=!1},mouseout:()=>{u=!1}}}}if(f==="mouseleave"||f==="mouseout"){let u=!1;return{layers:e,listener:s,delegates:{mousemove:x=>{const S=e.filter(k=>this.getLayer(k));(S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[]).length?u=!0:u&&(u=!1,s.call(this,new Li(f,this,x.originalEvent)))},mouseout:x=>{u&&(u=!1,s.call(this,new Li(f,this,x.originalEvent)))}}}}{const u=c=>{const p=e.filter(S=>this.getLayer(S)),x=p.length!==0?this.queryRenderedFeatures(c.point,{layers:p}):[];x.length&&(c.features=x,s.call(this,c),delete c.features)};return{layers:e,listener:s,delegates:{[f]:u}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,s){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const u=this._delegatedListeners[f];for(let c=0;c<u.length;c++){const p=u[c];if(p.listener===s&&p.layers.length===e.length&&p.layers.every(x=>e.includes(x))){for(const x in p.delegates)this.off(x,p.delegates[x]);return void u.splice(c,1)}}}on(f,e,s){if(s===void 0)return super.on(f,e);const u=this._createDelegatedListener(f,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(f,u);for(const c in u.delegates)this.on(c,u.delegates[c]);return this}once(f,e,s){if(s===void 0)return super.once(f,e);const u=typeof e=="string"?[e]:e,c=this._createDelegatedListener(f,u,s);for(const p in c.delegates){const x=c.delegates[p];c.delegates[p]=(...S)=>{this._removeDelegatedListener(f,u,s),x(...S)}}this._saveDelegatedListener(f,c);for(const p in c.delegates)this.once(p,c.delegates[p]);return this}off(f,e,s){return s===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let s;const u=f instanceof d.P||Array.isArray(f),c=u?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:f)||{},c instanceof d.P||typeof c[0]=="number")s=[d.P.convert(c)];else{const p=d.P.convert(c[0]),x=d.P.convert(c[1]);s=[p,new d.P(x.x,p.y),x,new d.P(p.x,x.y),p]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Ha(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,s):this.style.loadJSON(f,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ha(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,"Style");d.h(s,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new d.j(u))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(s){d.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const u=this.style._layers[s];u.type==="hillshade"&&u.source===f.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new tc(this.painter,e,f),this.painter.renderToTexture=new Kh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const s=f[e]._tiles;for(const u in s){const c=s[u];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,s={}){const{pixelRatio:u=1,sdf:c=!1,stretchX:p,stretchY:x,content:S,textFitWidth:k,textFitHeight:C}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:F}=e,V=e;return this.style.addImage(f,{data:new d.R({width:M,height:z},new Uint8Array(F)),pixelRatio:u,stretchX:p,stretchY:x,content:S,textFitWidth:k,textFitHeight:C,sdf:c,version:0,userImage:V}),V.onAdd&&V.onAdd(this,f),this}}{const{width:M,height:z,data:F}=X.getImageData(e);this.style.addImage(f,{data:new d.R({width:M,height:z},F),pixelRatio:u,stretchX:p,stretchY:x,content:S,textFitWidth:k,textFitHeight:C,sdf:c,version:0})}}updateImage(f,e){const s=this.style.getImage(f);if(!s)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||d.b(e)?X.getImageData(e):e,{width:c,height:p,data:x}=u;if(c===void 0||p===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==s.data.width||p!==s.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||d.b(e));return s.data.replace(x,S),this.style.updateImage(f,s),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return se.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,s){return this.style.setLayerZoomRange(f,e,s),this._update(!0)}setFilter(f,e,s={}){return this.style.setFilter(f,e,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,s,u={}){return this.style.setPaintProperty(f,e,s,u),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,s,u={}){return this.style.setLayoutProperty(f,e,s,u),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,s,u=>{u||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,s=>{s||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=$.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=$.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),u=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],u);const c=this._controlContainer=$.create("div","maplibregl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{p[x]=$.create("div",`maplibregl-ctrl-${x} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,s){this._canvas.width=Math.floor(s*f),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:f},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});const s=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!s){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new ul(s,this.transform),be.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,p=X.now();this.style.zoomHistory.update(c,p);const x=new d.z(c,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=x.crossFadingFactor();S===1&&S===this._crossFadingFactor||(s=!0,this._crossFadingFactor=S),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),se.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),$.remove(this._canvasContainer),$.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,X.frameAsync(this._frameRequest).then(f=>{d.bf.frame(f),this._frameRequest=null,this._render(f)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Yh}getCameraTargetElevation(){return this.transform.elevation}},w.MapMouseEvent=Li,w.MapTouchEvent=Co,w.MapWheelEvent=qh,w.Marker=xl,w.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const u=this._map._getUIString(`NavigationControl.${s}`);e.title=u,e.setAttribute("aria-label",u)},this.options=d.e({},xf,f),this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),$.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),$.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=$.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){$.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const s=$.create("button",f,this._container);return s.type="button",s.addEventListener("click",e),s}},w.Popup=class extends d.E{constructor(f){super(),this.remove=()=>(this._content&&$.remove(this._content),this._container&&($.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=$.create("div","maplibregl-popup",this._map.getContainer()),this._tip=$.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const S of this.options.className.split(" "))this._container.classList.add(S);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ht(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const u=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const p=bl(this.options.offset);if(!c){const S=this._container.offsetWidth,k=this._container.offsetHeight;let C;C=u.y+p.bottom.y<k?["top"]:u.y>this._map.transform.height-k?["bottom"]:[],u.x<S/2?C.push("left"):u.x>this._map.transform.width-S/2&&C.push("right"),c=C.length===0?"bottom":C.join("-")}let x=u.add(p[c]);this.options.subpixelPositioning||(x=x.round()),$.setTransform(this._container,`${gs[c]} translate(${x.x}px,${x.y}px)`),vl(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(ot),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=f;u=s.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(wl);f&&f.focus()}},w.RasterDEMTileSource=ei,w.RasterTileSource=Dt,w.ScaleControl=class{constructor(f){this._onMove=()=>{ya(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,ya(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Tr),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){$.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=Qn,w.Style=Ha,w.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$.create("button","maplibregl-ctrl-terrain",this._container),$.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){$.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=hs,w.TwoFingersTouchRotateHandler=Xu,w.TwoFingersTouchZoomHandler=Hu,w.TwoFingersTouchZoomRotateHandler=Yu,w.VectorTileSource=Ys,w.VideoSource=Wo,w.addSourceType=(f,e)=>d._(void 0,void 0,void 0,function*(){if(ea(f))throw new Error(`A source type called "${f}" already exists.`);((s,u)=>{Qs[s]=u})(f,e)}),w.clearPrewarmedResources=function(){const f=bi;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Di),bi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return vr().getRTLTextPluginStatus()},w.getVersion=function(){return rc},w.getWorkerCount=function(){return tn.workerCount},w.getWorkerUrl=function(){return d.a.WORKER_URL},w.importScriptInWorkers=function(f){return Ks().broadcast("IS",f)},w.prewarm=function(){go().acquire(Di)},w.setMaxParallelImageRequests=function(f){d.a.MAX_PARALLEL_IMAGE_REQUESTS=f},w.setRTLTextPlugin=function(f,e){return vr().setRTLTextPlugin(f,e)},w.setWorkerCount=function(f){tn.workerCount=f},w.setWorkerUrl=function(f){d.a.WORKER_URL=f}});var T=l;return T})})(Lw);var $S=Lw.exports;const qS=e1($S),Fw="map",ZS="#D8F2FF",GS="#666666",Yv="#ffffff",HS="#999999",WS="#08254d",Bw="#6EE143",Ow=.5,XS={fillColor:"#6EE143",fillOpacity:.1,strokeColor:"#666",strokeOpacity:1,strokeWidth:2.5},KS={fillColor:"#6EE143",fillOpacity:.1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:3.5},YS={id:"43f36e14-e3f5-43c1-84c0-50a9c80dc5c7",name:"MapLibre",zoom:.8619833357855968,pitch:0,center:[17.65431710431244,32.954120326746775],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf",layers:[{id:"background",type:"background",paint:{"background-color":ZS},filter:["all"],layout:{visibility:"visible"},maxzoom:24},{id:"coastline",type:"line",paint:{"line-blur":.5,"line-color":GS,"line-width":{stops:[[0,2],[6,6],[14,9],[22,18]]}},filter:["all"],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},source:"maplibre",maxzoom:24,minzoom:0,"source-layer":"countries"},{id:"countries-fill",type:"fill",paint:{"fill-color":Yv},filter:["all"],layout:{visibility:"visible"},source:"maplibre",maxzoom:24,"source-layer":"countries"},{id:"countries-boundary",type:"line",paint:{"line-color":HS,"line-width":{stops:[[1,1],[6,2],[14,6],[22,12]]},"line-opacity":{stops:[[3,.5],[6,1]]}},layout:{"line-cap":"round","line-join":"round",visibility:"visible"},source:"maplibre",maxzoom:24,"source-layer":"countries"},{id:"countries-label",type:"symbol",paint:{"text-color":WS,"text-halo-blur":{stops:[[2,.2],[6,0]]},"text-halo-color":"rgba(255, 255, 255, 1)","text-halo-width":{stops:[[2,1],[6,1.6]]}},filter:["all"],layout:{"text-font":["Open Sans Semibold"],"text-size":{stops:[[2,10],[4,12],[6,16]]},"text-field":{stops:[[2,"{ABBREV}"],[4,"{NAME}"]]},visibility:"visible","text-max-width":10,"text-transform":{stops:[[0,"uppercase"],[2,"none"]]}},source:"maplibre",maxzoom:24,minzoom:2,"source-layer":"centroids"},{id:"crimea-fill",type:"fill",source:"crimea",paint:{"fill-color":Yv}}],bearing:0,sources:{maplibre:{url:"https://demotiles.maplibre.org/tiles/tiles.json",type:"vector"},crimea:{type:"geojson",data:{type:"Feature",geometry:{type:"Polygon",coordinates:[[[34.00905273547181,46.55925987559425],[33.64325260204026,46.34533545368038],[33.628682598560204,46.12569762665683],[33.64292861730951,46.10476396128129],[33.648473474905984,46.09033047763651],[33.63876482059936,46.077976784785335],[33.62782672238245,46.06747935719011],[33.62911357645072,46.05708111413949],[33.642686868727424,46.02192963417187],[33.6429723910654,46.01521185644708],[33.636224138774026,46.006705833212465],[33.63052626465907,45.99692992186792],[33.63193836679693,45.988472992911284],[33.64276684834442,45.984575360297384],[33.646928693041986,45.97981936210982],[33.638745893564305,45.96829769147004],[33.61958133326394,45.951176418494185],[33.63181380398527,45.9445404758078],[33.638921676216,45.94737012930554],[33.64561542516918,45.95403251372139],[33.65666403976448,45.95687114427736],[33.6825817382811,45.95878100879199],[33.738791807037614,45.94836945227263],[33.758180142697,45.94072970008301],[33.77735917288169,45.92923970233858],[33.75927796793485,45.92241179584471],[33.72529865009221,45.91587363154565],[33.70875012326826,45.91008760988058],[33.69378857293381,45.91480850795665],[33.69092650243843,45.89657370898402],[33.693592356906805,45.87271465766318],[33.69226765972388,45.86041392418218],[33.6704813511748,45.8584273836251],[33.65936345808916,45.85944682601249],[33.653870582376726,45.86425922279372],[33.65107345584843,45.87089907254003],[33.63067378180233,45.88040685247182],[33.61945300059696,45.88147266102649],[33.60987421595539,45.88048951126686],[33.59906957603934,45.877610457390375],[33.57828877687868,45.86810261756233],[33.55357394560386,45.84700625141778],[33.530220674480375,45.84221983655459],[33.5192297395441,45.84121682367507],[33.50832088442496,45.84313067048083],[33.48901101848409,45.85268298292175],[33.482152996405716,45.854578171799005],[33.46719955896293,45.849912739405056],[33.42447496599681,45.83075886348303],[33.40940172404095,45.82691953557702],[33.37918350072067,45.802867525073566],[33.37362145339398,45.79619281922518],[33.33805543634864,45.78577808972071],[33.26498872665803,45.75410774187094],[33.22887541283427,45.75131270772724],[33.19548267281132,45.7644887297206],[33.1789202379222,45.78010311364778],[33.1688456078636,45.78470227904205],[33.161012432811674,45.77921593899549],[33.15951585299757,45.76864464913777],[33.165962301438725,45.762685940125465],[33.1750888126426,45.759218220695715],[33.181464829753,45.75490447884948],[33.17613930782352,45.7437961960276],[33.16369168844906,45.735912015025065],[32.93692665480876,45.662114646778264],[32.86839112407645,45.63044340698664],[32.83803944575723,45.60834075026611],[32.82702772424804,45.59576101516498],[32.82433467080986,45.58705137380335],[32.82563941622885,45.579605763895614],[32.82993674258438,45.56978311819469],[32.82851940940563,45.56227808675749],[32.813310142795274,45.55930933158257],[32.80213583657516,45.560145780074464],[32.78258622159436,45.565158335073846],[32.77333922465823,45.56689313356526],[32.758306734735356,45.565030173463356],[32.750177256846115,45.55943726334968],[32.74340732630185,45.55261895849793],[32.73524549539499,45.54598788110354],[32.72031700779701,45.53735927760957],[32.70536040418847,45.53169142131733],[32.68589438933773,45.52663379187257],[32.66370583186284,45.52563107058867],[32.64312077736798,45.52188979044979],[32.525284074162556,45.45838108691365],[32.49490411219156,45.43524910229854],[32.48107654411925,45.408986638827514],[32.48514589713025,45.39458067125969],[32.51256939517424,45.34060655033625],[32.535915460470335,45.33777248012882],[32.57027153843481,45.32510892683359],[32.590830644991826,45.32038723212662],[32.66380378113439,45.320421746458976],[32.67760722618917,45.32609231279554],[32.71316246802607,45.353283572618125],[32.72817188836078,45.36074681043402],[32.750518060251466,45.36371725645313],[32.89973931692998,45.35412322462227],[32.941197846443885,45.34245505845169],[32.97701667405008,45.32596743563991],[33.04296090827762,45.2853982930032],[33.05274355585479,45.28154273654923],[33.06850284417635,45.27703461892352],[33.07825272648239,45.272210805127315],[33.089426322403455,45.25656353201492],[33.09897492343546,45.247820101667884],[33.12384611720435,45.238235755071685],[33.15767197859745,45.20755227709648],[33.172959979330074,45.19681657531794],[33.21837666514142,45.187878368659824],[33.24017433636709,45.180191106261134],[33.248571989896675,45.16588271012458],[33.259649216030766,45.155918961282026],[33.28309785485047,45.16064860772312],[33.31767999550894,45.17535522412791],[33.35458473323109,45.18598673360148],[33.39725661527919,45.18973663076909],[33.41344561756824,45.18490731877088],[33.468468576977216,45.149132412229676],[33.537128652906205,45.11719769268973],[33.56161328289443,45.094099022711475],[33.57837628774928,45.053145935448015],[33.58247744978442,45.027377243150454],[33.5851414316958,45.01816461606674],[33.6031021265521,44.993103583251695],[33.605922209331794,44.986905272229734],[33.60843524291815,44.97039962759274],[33.61943161357851,44.93184946652454],[33.619484500808824,44.90819321920554],[33.61549738593425,44.88894092276257],[33.608561183117274,44.871288478948514],[33.59889474705494,44.859790298912856],[33.55904244709464,44.850057575124595],[33.54667558363471,44.83724531175508],[33.53701832136994,44.81871953508235],[33.5303157846202,44.798338017069625],[33.5249116915937,44.78918633101301],[33.51669091675143,44.784809980590666],[33.524785531609865,44.77183212449111],[33.5302902535075,44.75724515985675],[33.53710734694323,44.73034290771247],[33.54650992495621,44.70989226909535],[33.5481286806762,44.699106546699085],[33.543995566510915,44.68230506537358],[33.53580273994743,44.6726082589706],[33.52337411931097,44.661863083605255],[33.515320778874354,44.6491266698327],[33.516377841582795,44.63464990118433],[33.52466971637648,44.62863961572572],[33.557474298027785,44.62473000923737],[33.5710648827386,44.620853511273225],[33.55105839203679,44.61506440493406],[33.499905706797676,44.61452599304897],[33.48451102966331,44.60992438254493],[33.47658499621011,44.60714391514574],[33.46705078205747,44.60616254193252],[33.44476599234898,44.607062134677875],[33.4353466482458,44.60509936890821],[33.413591053005575,44.593500212748125],[33.40543527945235,44.59055535193136],[33.37510958624222,44.58564691897425],[33.37074452434078,44.58851022190515],[33.372237834990756,44.576810695127364],[33.37913003799301,44.56412673079859],[33.48759131590526,44.51024086451031],[33.50011215135888,44.50041002882833],[33.517917009115365,44.49074142372788],[33.53836387802215,44.49164280212756],[33.56041892763031,44.4966411022441],[33.57822378538677,44.497542389459795],[33.59062975079095,44.48975808594983],[33.619577003408466,44.46229988129974],[33.62635433636015,44.45336293328907],[33.63175322871038,44.434828756313124],[33.645537634715026,44.42498521035591],[33.721007257593925,44.39946630464436],[33.74168386660085,44.39560878121904],[33.80727466517129,44.39454176175843],[33.81841706002561,44.39552670349164],[33.83909366903248,44.40143600575672],[33.85149963444792,44.40143600575945],[33.91467816197718,44.38387049706651],[33.938111652185,44.38083293528811],[33.957065210440874,44.38272116790142],[34.06614966692763,44.42019923628979],[34.088893936836286,44.42200415824283],[34.10279321289039,44.42487551014821],[34.135933345669,44.44163597968952],[34.14696087047267,44.44959070749778],[34.16058918507403,44.466287285335795],[34.170123399227776,44.48186111741296],[34.182759104731986,44.49267838558103],[34.22923417224524,44.49949719774551],[34.24301857824986,44.50744404277697],[34.263903954150294,44.53186886058606],[34.26631622520165,44.53555362837611],[34.26631622520165,44.54153064468656],[34.27033667695244,44.545378535987936],[34.2757355693048,44.54644280144541],[34.285384653508004,44.54562413743594],[34.299973149863405,44.54554227040174],[34.32260254971496,44.543577427039224],[34.3308731933177,44.54546040325087],[34.340292537420794,44.55798473830754],[34.38042135640006,44.631830317636684],[34.41495238900856,44.673669777529994],[34.424193090575585,44.68239452736094],[34.42959198292681,44.68884644523774],[34.469399167794535,44.730194532749294],[34.47376422969597,44.73011292571252],[34.47376422969597,44.72635887754967],[34.475142670296464,44.723502373339585],[34.499724861011515,44.74292382044041],[34.532800295801195,44.752620844929055],[34.61217550038418,44.76534519537847],[34.65065696715081,44.777088262503725],[34.72084256772871,44.811080759265764],[34.756796893391225,44.82094054159748],[34.82646979041766,44.81208604604609],[34.84289620758207,44.816893835303176],[34.856910353686715,44.82373813182468],[34.889648317948144,44.817871641692506],[34.90733830566026,44.820886440346584],[34.922960632465504,44.83050015059965],[34.92950822531711,44.83652826953224],[34.94179932067178,44.84019370922482],[34.95282684547897,44.841415470643284],[34.98567967978991,44.840275160795755],[35.0053224583441,44.83538786296728],[35.017958163849414,44.82219008824552],[35.02703289780189,44.80890779582285],[35.037933245998005,44.79869792240089],[35.08073333784134,44.793525442788905],[35.1080207326404,44.824553365795765],[35.130368105574235,44.86879838545747],[35.15485200090768,44.90071251697748],[35.17111229780758,44.90746386008772],[35.21522068940149,44.91421441031795],[35.233163085981715,44.925728224907715],[35.25636688416236,44.95896657181197],[35.27300098099195,44.96690119386028],[35.29748487632534,44.95605693543271],[35.30496087491386,44.96121482614441],[35.315240372954605,44.965711070514175],[35.31935217217088,44.96941359539801],[35.36757236298112,44.94362319076086],[35.36103086422793,44.97364475976596],[35.362152264014156,44.98593980935419],[35.374674561627444,44.997835734117416],[35.389439658813274,45.00180049366759],[35.42270785247763,45.00087540764923],[35.43504325012745,45.00470780964241],[35.43504325012745,45.011446929213974],[35.40631957913584,45.02015821022701],[35.40089948016896,45.025046135473445],[35.39790908073891,45.03482073400548],[35.40052568024015,45.042216617888045],[35.40631957913584,45.051328088783805],[35.40744097892215,45.06294640963205],[35.41734667704213,45.0708666385693],[35.469304867139925,45.10068964922732],[35.5070260597534,45.113341616151644],[35.54758335202416,45.12019982412133],[35.59019654390909,45.11993606213795],[35.63411803553862,45.11439677872579],[35.70669729572677,45.09480210570922],[35.771782422456766,45.06572995732262],[35.78430472007,45.057941041321754],[35.81250040352472,45.031852200991295],[35.81941570220667,45.021152336906454],[35.82763930064016,44.99895365027004],[35.848198296721705,44.99208088455586],[35.916977483614176,45.00172895661731],[35.99360646900681,44.997896355361604],[36.00893226608571,45.00926125333629],[36.02539976723364,45.03288661039673],[36.047827762958946,45.048074065419456],[36.078666257082034,45.03883000769565],[36.079137312377895,45.046610970582435],[36.135020401727616,45.02125162210126],[36.2241716847341,45.00751061631556],[36.24398308095806,45.011474706353084],[36.24828178013877,45.01649549321965],[36.25332807917695,45.03247980324494],[36.25743987839326,45.03842324279259],[36.267158676549116,45.043573724415154],[36.2783726744118,45.04555455542638],[36.36740852558336,45.04833265291825],[36.44029951169139,45.06787222615526],[36.45375630913995,45.07631970334319],[36.455251508854985,45.09202341204062],[36.44142091149291,45.10709638287736],[36.41432041665814,45.12872568311289],[36.40852651776157,45.149160473330085],[36.409997342308856,45.171615955386955],[36.418312796420764,45.23001671705953],[36.42672329481775,45.25186253492981],[36.43756477765089,45.27227491599612],[36.4497132753354,45.28542626329343],[36.45905827355429,45.28753019598713],[36.4814862692796,45.28845064200263],[36.4909554290368,45.29213135137758],[36.49637552800283,45.300940007322055],[36.49394582846682,45.305015191082816],[36.48871262946426,45.30935296803605],[36.48460083024801,45.315924724862185],[36.489647129296515,45.336413860372005],[36.502169426909745,45.34731734941451],[36.52104632331191,45.35033842661815],[36.544281237819945,45.34731734942025],[36.57455903204905,45.33601971904315],[36.585399229982954,45.333917585593355],[36.59810088537549,45.334837278577254],[36.630808379142394,45.34048649352954],[36.637536777859964,45.3511265071989],[36.63099527910589,45.3741073632589],[36.61359545390113,45.40895280985421],[36.59845655678569,45.421547717459106],[36.58331765967199,45.42731944465129],[36.566309762912795,45.42548305000767],[36.54836736633254,45.41210180010589],[36.53285466928139,45.4090840212946],[36.51565987255873,45.41957994832251],[36.49117597722616,45.44279525429408],[36.47043008117939,45.4458112314303],[36.411182792482634,45.43610707766504],[36.391371396258705,45.43991025572652],[36.35959840231365,45.45407156049933],[36.33960010612526,45.45695583486963],[36.33025510790637,45.454464879327446],[36.32053630976225,45.44856480887407],[36.31156511147125,45.4438443081136],[36.29885591389362,45.442795254299995],[36.3072664122906,45.46115087970253],[36.30016421364425,45.47320989503609],[36.283717016779036,45.476355300848866],[36.267082919949445,45.46704963343626],[36.25213092279836,45.46115087970253],[36.13681364478941,45.46219959214511],[36.11700224855986,45.45721803432335],[36.097003952371466,45.441483909606006],[36.06952965760803,45.43046741078453],[36.0655449627526,45.42553028973455],[36.05134056545904,45.39535242162091],[36.022557970944945,45.368441166003805],[35.986486277818386,45.362926059418186],[35.94723728529826,45.372380198658874],[35.87220216002379,45.404075760536614],[35.85388596351393,45.413916621802144],[35.84715756479628,45.426379251448395],[35.8524047739447,45.44386497541683],[35.85950697259193,45.45933624762881],[35.857824872912545,45.469953901705],[35.83278027768503,45.47087138287168],[35.8167068807486,45.46392436820739],[35.80362388324218,45.44963442058864],[35.79469305616038,45.42980210462429],[35.791889556694684,45.41209230278156],[35.772265060435046,45.39214572935421],[35.767405661361295,45.38873311015669],[35.75189296431793,45.386632934388984],[35.7481549650407,45.379938103368545],[35.746846665290036,45.369960021421576],[35.74423006578874,45.36076812520648],[35.71619507113218,45.34040932557082],[35.69451467527287,45.32989869277279],[35.51720627467216,45.29506847418358],[35.48038698168983,45.2979608697527],[35.33194061536096,45.371562726652314],[35.04491375777232,45.669545248704424],[35.00230056589345,45.7290693869553],[34.70631294999043,46.024929846739866],[34.35868883309806,46.106725558140795],[34.00905273547181,46.55925987559425]]]}}}},version:8,metadata:{"maptiler:copyright":"This style was generated on MapTiler Cloud. Usage is governed by the license terms in https://github.com/maplibre/demotiles/blob/gh-pages/LICENSE","openmaptiles:version":"3.x"}};let gn=null;const JS=()=>{const i=N_();return bt.useCallback(()=>(gn=new qS.Map({container:Fw,style:YS,center:[27,-17],zoom:2.5}),i($a.actions.setIsMapInitialized(!0)),()=>{i($a.actions.setIsMapInitialized(!1)),gn.remove(),gn=null}),[i])},vh=()=>{const i=qn(o=>o.main.isMapInitialized);return bt.useCallback(o=>{if(!i||gn===null)return()=>null;const l=o();return typeof l=="function"?()=>{!i||gn===null||l()}:l},[i])},Nw=()=>{const i=vh();return bt.useCallback((o,l)=>i(()=>(gn.on(o,l),()=>gn.off(o,l))),[i])},QS=()=>{const i=Nw();return bt.useCallback(o=>i("click",o),[i])},Jv={strokeColor:"black",strokeOpacity:1,strokeWidth:2,fillColor:"white",fillOpacity:.5},Wp=()=>{const i=vh();return bt.useCallback((o,l=Jv)=>i(()=>{const m=d=>l[d]??Jv[d],y=`geo-json-${Math.random()}`,T=`${y}-fill`,w=`${y}-stroke`;return gn.addSource(y,{type:"geojson",data:o}),gn.addLayer({id:T,type:"fill",source:y,paint:{"fill-color":m("fillColor"),"fill-opacity":m("fillOpacity")}}),gn.addLayer({id:w,type:"line",source:y,paint:{"line-color":m("strokeColor"),"line-opacity":m("strokeOpacity"),"line-width":m("strokeWidth")}}),()=>{gn.removeLayer(T),gn.removeLayer(w),gn.removeSource(y)}}),[i])},eT={padding:100},tT=()=>{const i=vh();return bt.useCallback((o,l=eT)=>i(()=>{gn.fitBounds([[o[0],o[1]],[o[2],o[3]]],l)}),[i])},iT={},nT=()=>{const i=vh();return bt.useCallback((o,l,m,y=iT)=>i(()=>{gn.flyTo({center:[o,l],zoom:m,...y})}),[i])},rT=()=>{const i=vh();return bt.useCallback((o,l)=>i(()=>{const m=gn.unproject([o,l]);return[m.lng,m.lat]}),[i])},oT=3,Vd=100,sT=()=>{const i=tT(),o=nT(),l=aT();return bt.useCallback(m=>{const y=m.bbox[0];if(m.bbox[2]-y>180){const[d,O]=m.coordLonLat;o(d,O,oT,{...l})}else i(m.bbox,{...l})},[i,o,l])},aT=()=>{const i=qn(o=>o.main.menuWidthPx);return bt.useMemo(()=>({padding:{top:Vd,right:Vd,bottom:Vd,left:Vd+i}}),[i])},lT=()=>{const i=Wp(),o=qn(m=>m.main.focusedCountry),l=uT();return bt.useCallback(()=>{if(o===null)return()=>null;const m=[],y=!!o.statesData;return m.push(i(o.geojson,{fillColor:Bw,fillOpacity:y?0:Ow})),m.push(l()),()=>m.forEach(T=>T())},[o,l,i])},uT=()=>{const i=Wp(),o=qn(l=>l.main.focusedCountry);return bt.useCallback(()=>{if(!(o!=null&&o.statesData))return()=>null;const l={type:"FeatureCollection",features:o.statesData.map(m=>({...m.geojson,properties:{color:"#ffffff"}}))};return i(l,{fillColor:["get","color"],fillOpacity:0})},[o,i])},cT=()=>{const i=Wp(),o=qn(l=>l.main.focusedState);return bt.useCallback(()=>o?i(o.geojson,{fillColor:Bw,fillOpacity:Ow}):()=>null,[o,i])},hT="_container_1r1dt_1",dT="_triangle_1r1dt_13",pT="_content_1r1dt_23",fT="_title_1r1dt_32",mT="_description_1r1dt_40",Dc={container:hT,triangle:dT,content:pT,title:fT,description:mT},gT=({x:i,y:o})=>{const[l,m]=bt.useState(!1),[y,T]=bt.useState(!1),[w,d]=bt.useState(null),[O,W]=bt.useState(null),oe=qn(Ie=>Ie.main.focusedCountry),X=rT();bt.useEffect(()=>{(async()=>{if(l||y){d(null),W(null);return}const Ie=X(i,o),Qe=Ie[0],ue=Ie[1],ie=await yw(Qe,ue);if(d(ie),oe&&ie&&oe.name===ie.name&&oe.statesData){const se=await vw(Qe,ue,oe.statesData);W(se)}})()},[oe,X,l,y,i,o]);const $=Nw();bt.useEffect(()=>$("movestart",()=>m(!0)),[$]),bt.useEffect(()=>$("moveend",()=>m(!1)),[$]),bt.useEffect(()=>$("zoomstart",()=>T(!0)),[$]),bt.useEffect(()=>$("zoomend",()=>T(!1)),[$]);const be=bt.useMemo(()=>w&&O?{title:`${O.name}, ${w.name}`,descriptions:[`Name: ${O.name}`,`Code: ${O.stateCode}`,`Country name: ${w.name}`,`Country code: ${w.codeIso3}`]}:w&&!O?{title:`${w.name}`,descriptions:[`Name: ${w.name}`,`Code: ${w.codeIso3}`]}:null,[w,O]),Te=Wp();return bt.useEffect(()=>{if(O)return Te(O.geojson,KS);if(w)return Te(w.geojson,XS)},[w,O,Te]),be===null?null:kt.jsxs("div",{className:Dc.container,style:{top:o,left:i},children:[kt.jsx("div",{className:Dc.triangle}),kt.jsxs("div",{className:Dc.content,children:[kt.jsx("h3",{className:Dc.title,children:be.title}),be.descriptions.map((Ie,Qe)=>kt.jsx("p",{className:Dc.description,children:Ie},Qe))]})]})};let jm=null;const _T=100,yT=()=>{const[i,o]=bt.useState(null);return bt.useEffect(()=>{const l=m=>{jm&&clearTimeout(jm),o(null),!!m.target.closest(`#${Fw}`)&&(jm=setTimeout(()=>{o(kt.jsx(gT,{x:m.clientX,y:m.clientY}))},_T))};return document.addEventListener("mousemove",l),()=>document.removeEventListener("mousemove",l)},[]),i},vT="_container_17w4n_1",xT="_map_17w4n_11",Qv={container:vT,map:xT},wT=()=>{const i=N_(),o=JS();bt.useEffect(()=>o(),[o]);const l=sT(),m=QS(),y=qn(O=>O.main.focusedCountry);bt.useEffect(()=>m(async O=>{const W=O.lngLat.lng,oe=O.lngLat.lat,X=await yw(W,oe);let $=null;X&&y&&X.name===y.name&&y.statesData&&($=await vw(W,oe,y.statesData)),i($a.actions.setFocusedCountry(X)),i($a.actions.setFocusedState($)),$?l($):X&&l(X)}),[m,i,l,y]);const T=yT(),w=lT();bt.useEffect(()=>w(),[w]);const d=cT();return bt.useEffect(()=>d(),[d]),kt.jsxs("div",{className:Qv.container,children:[kt.jsx("div",{className:Qv.map,id:"map"}),T,kt.jsx(US,{})]})},bT=wS({reducer:{main:$a.reducer}});Um.createRoot(document.getElementById("root")).render(kt.jsx(Hg.StrictMode,{children:kt.jsx(I5,{store:bT,children:kt.jsx(wT,{})})}));
